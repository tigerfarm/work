/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2019, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes javascript-state-machine under the following license.

    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes q under the following license.

    Copyright 2009–2014 Kristopher Michael Kowal. All rights reserved.
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to
    deal in the Software without restriction, including without limitation the
    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
    sell copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
    IN THE SOFTWARE.

This software includes platform.js under the following license.

    Copyright 2014 Benjamin Tan <https://d10.github.io/>
    Copyright 2011-2015 John-David Dalton <http://allyoucanleet.com/>

    Permission is hereby granted, free of charge, to any person obtaining
    a copy of this software and associated documentation files (the
    "Software"), to deal in the Software without restriction, including
    without limitation the rights to use, copy, modify, merge, publish,
    distribute, sublicense, and/or sell copies of the Software, and to
    permit persons to whom the Software is furnished to do so, subject to
    the following conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
    LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
    OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
    WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/
this.Twilio=this.Twilio||{},this.Twilio.Chat=function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var r=function(e){return e&&e.Math==Math&&e},i=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")(),a={},o=function(e){try{return!!e()}catch(e){return!0}},s=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),u={},c={}.propertyIsEnumerable,l=Object.getOwnPropertyDescriptor,f=l&&!c.call({1:2},1);u.f=f?function(e){var t=l(this,e);return!!t&&t.enumerable}:c;var h=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},d={}.toString,p=function(e){return d.call(e).slice(8,-1)},y=p,v="".split,m=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==y(e)?v.call(e,""):Object(e)}:Object,g=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},b=m,k=g,w=function(e){return b(k(e))},x=function(e){return"object"==typeof e?null!==e:"function"==typeof e},_=x,S=function(e,t){if(!_(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!_(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!_(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!_(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},T=g,E=function(e){return Object(T(e))},I=E,C={}.hasOwnProperty,R=Object.hasOwn||function(e,t){return C.call(I(e),t)},O=x,M=i.document,P=O(M)&&O(M.createElement),A=function(e){return P?M.createElement(e):{}},D=A,j=!s&&!o((function(){return 7!=Object.defineProperty(D("div"),"a",{get:function(){return 7}}).a})),N=s,L=u,U=h,B=w,F=S,q=R,W=j,z=Object.getOwnPropertyDescriptor;a.f=N?z:function(e,t){if(e=B(e),t=F(t,!0),W)try{return z(e,t)}catch(e){}if(q(e,t))return U(!L.f.call(e,t),e[t])};var G={},J=x,V=function(e){if(!J(e))throw TypeError(String(e)+" is not an object");return e},$=s,K=j,Q=V,H=S,X=Object.defineProperty;G.f=$?X:function(e,t,n){if(Q(e),t=H(t,!0),Q(n),K)try{return X(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Y=G,Z=h,ee=s?function(e,t,n){return Y.f(e,t,Z(1,n))}:function(e,t,n){return e[t]=n,e},te={exports:{}},ne=i,re=ee,ie=function(e,t){try{re(ne,e,t)}catch(n){ne[e]=t}return t},ae=ie,oe="__core-js_shared__",se=i[oe]||ae(oe,{}),ue=se,ce=Function.toString;"function"!=typeof ue.inspectSource&&(ue.inspectSource=function(e){return ce.call(e)});var le=ue.inspectSource,fe=le,he=i.WeakMap,de="function"==typeof he&&/native code/.test(fe(he)),pe={exports:{}},ye=se;(pe.exports=function(e,t){return ye[e]||(ye[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.14.0",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"});var ve,me,ge,be=0,ke=Math.random(),we=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++be+ke).toString(36)},xe=pe.exports,_e=we,Se=xe("keys"),Te=function(e){return Se[e]||(Se[e]=_e(e))},Ee={},Ie=de,Ce=x,Re=ee,Oe=R,Me=se,Pe=Te,Ae=Ee,De="Object already initialized",je=i.WeakMap;if(Ie||Me.state){var Ne=Me.state||(Me.state=new je),Le=Ne.get,Ue=Ne.has,Be=Ne.set;ve=function(e,t){if(Ue.call(Ne,e))throw new TypeError(De);return t.facade=e,Be.call(Ne,e,t),t},me=function(e){return Le.call(Ne,e)||{}},ge=function(e){return Ue.call(Ne,e)}}else{var Fe=Pe("state");Ae[Fe]=!0,ve=function(e,t){if(Oe(e,Fe))throw new TypeError(De);return t.facade=e,Re(e,Fe,t),t},me=function(e){return Oe(e,Fe)?e[Fe]:{}},ge=function(e){return Oe(e,Fe)}}var qe={set:ve,get:me,has:ge,enforce:function(e){return ge(e)?me(e):ve(e,{})},getterFor:function(e){return function(t){var n;if(!Ce(t)||(n=me(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},We=i,ze=ee,Ge=R,Je=ie,Ve=le,$e=qe.get,Ke=qe.enforce,Qe=String(String).split("String");(te.exports=function(e,t,n,r){var i,a=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,s=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||Ge(n,"name")||ze(n,"name",t),(i=Ke(n)).source||(i.source=Qe.join("string"==typeof t?t:""))),e!==We?(a?!s&&e[t]&&(o=!0):delete e[t],o?e[t]=n:ze(e,t,n)):o?e[t]=n:Je(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&$e(this).source||Ve(this)}));var He=i,Xe=He,Ye=i,Ze=function(e){return"function"==typeof e?e:void 0},et=function(e,t){return arguments.length<2?Ze(Xe[e])||Ze(Ye[e]):Xe[e]&&Xe[e][t]||Ye[e]&&Ye[e][t]},tt={},nt=Math.ceil,rt=Math.floor,it=function(e){return isNaN(e=+e)?0:(e>0?rt:nt)(e)},at=it,ot=Math.min,st=function(e){return e>0?ot(at(e),9007199254740991):0},ut=it,ct=Math.max,lt=Math.min,ft=function(e,t){var n=ut(e);return n<0?ct(n+t,0):lt(n,t)},ht=w,dt=st,pt=ft,yt=function(e){return function(t,n,r){var i,a=ht(t),o=dt(a.length),s=pt(r,o);if(e&&n!=n){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===n)return e||s||0;return!e&&-1}},vt={includes:yt(!0),indexOf:yt(!1)},mt=R,gt=w,bt=vt.indexOf,kt=Ee,wt=function(e,t){var n,r=gt(e),i=0,a=[];for(n in r)!mt(kt,n)&&mt(r,n)&&a.push(n);for(;t.length>i;)mt(r,n=t[i++])&&(~bt(a,n)||a.push(n));return a},xt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_t=wt,St=xt.concat("length","prototype");tt.f=Object.getOwnPropertyNames||function(e){return _t(e,St)};var Tt={};Tt.f=Object.getOwnPropertySymbols;var Et,It=tt,Ct=Tt,Rt=V,Ot=et("Reflect","ownKeys")||function(e){var t=It.f(Rt(e)),n=Ct.f;return n?t.concat(n(e)):t},Mt=R,Pt=Ot,At=a,Dt=G,jt=function(e,t){for(var n=Pt(t),r=Dt.f,i=At.f,a=0;a<n.length;a++){var o=n[a];Mt(e,o)||r(e,o,i(t,o))}},Nt=o,Lt=/#|\.prototype\./,Ut=function(e,t){var n=Ft[Bt(e)];return n==Wt||n!=qt&&("function"==typeof t?Nt(t):!!t)},Bt=Ut.normalize=function(e){return String(e).replace(Lt,".").toLowerCase()},Ft=Ut.data={},qt=Ut.NATIVE="N",Wt=Ut.POLYFILL="P",zt=Ut,Gt=i,Jt=a.f,Vt=ee,$t=te.exports,Kt=ie,Qt=jt,Ht=zt,Xt=function(e,t){var n,r,i,a,o,s=e.target,u=e.global,c=e.stat;if(n=u?Gt:c?Gt[s]||Kt(s,{}):(Gt[s]||{}).prototype)for(r in t){if(a=t[r],i=e.noTargetGet?(o=Jt(n,r))&&o.value:n[r],!Ht(u?r:s+(c?".":"#")+r,e.forced)&&void 0!==i){if(typeof a==typeof i)continue;Qt(a,i)}(e.sham||i&&i.sham)&&Vt(a,"sham",!0),$t(n,r,a,e)}},Yt=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Zt=wt,en=xt,tn=Object.keys||function(e){return Zt(e,en)},nn=G,rn=V,an=tn,on=s?Object.defineProperties:function(e,t){rn(e);for(var n,r=an(t),i=r.length,a=0;i>a;)nn.f(e,n=r[a++],t[n]);return e},sn=et("document","documentElement"),un=V,cn=on,ln=xt,fn=Ee,hn=sn,dn=A,pn=Te("IE_PROTO"),yn=function(){},vn=function(e){return"<script>"+e+"</"+"script>"},mn=function(){try{Et=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;mn=Et?function(e){e.write(vn("")),e.close();var t=e.parentWindow.Object;return e=null,t}(Et):((t=dn("iframe")).style.display="none",hn.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(vn("document.F=Object")),e.close(),e.F);for(var n=ln.length;n--;)delete mn.prototype[ln[n]];return mn()};fn[pn]=!0;var gn=Object.create||function(e,t){var n;return null!==e?(yn.prototype=un(e),n=new yn,yn.prototype=null,n[pn]=e):n=mn(),void 0===t?n:cn(n,t)},bn=Yt,kn=x,wn=[].slice,xn={},_n=function(e,t,n){if(!(t in xn)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";xn[t]=Function("C,a","return new C("+r.join(",")+")")}return xn[t](e,n)},Sn=Function.bind||function(e){var t=bn(this),n=wn.call(arguments,1),r=function(){var i=n.concat(wn.call(arguments));return this instanceof r?_n(t,i.length,i):t.apply(e,i)};return kn(t.prototype)&&(r.prototype=t.prototype),r},Tn=Xt,En=Yt,In=V,Cn=x,Rn=gn,On=Sn,Mn=o,Pn=et("Reflect","construct"),An=Mn((function(){function e(){}return!(Pn((function(){}),[],e)instanceof e)})),Dn=!Mn((function(){Pn((function(){}))})),jn=An||Dn;Tn({target:"Reflect",stat:!0,forced:jn,sham:jn},{construct:function(e,t){En(e),In(t);var n=arguments.length<3?e:En(arguments[2]);if(Dn&&!An)return Pn(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(On.apply(e,r))}var i=n.prototype,a=Rn(Cn(i)?i:Object.prototype),o=Function.apply.call(e,a,t);return Cn(o)?o:a}});var Nn=E,Ln=tn;Xt({target:"Object",stat:!0,forced:o((function(){Ln(1)}))},{keys:function(e){return Ln(Nn(e))}});var Un,Bn,Fn=et("navigator","userAgent")||"",qn=Fn,Wn=i.process,zn=Wn&&Wn.versions,Gn=zn&&zn.v8;Gn?Bn=(Un=Gn.split("."))[0]<4?1:Un[0]+Un[1]:qn&&(!(Un=qn.match(/Edge\/(\d+)/))||Un[1]>=74)&&(Un=qn.match(/Chrome\/(\d+)/))&&(Bn=Un[1]);var Jn=Bn&&+Bn,Vn=Jn,$n=o,Kn=!!Object.getOwnPropertySymbols&&!$n((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Vn&&Vn<41})),Qn=Kn&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Hn=p,Xn=Array.isArray||function(e){return"Array"==Hn(e)},Yn={},Zn=w,er=tt.f,tr={}.toString,nr="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Yn.f=function(e){return nr&&"[object Window]"==tr.call(e)?function(e){try{return er(e)}catch(e){return nr.slice()}}(e):er(Zn(e))};var rr=i,ir=pe.exports,ar=R,or=we,sr=Kn,ur=Qn,cr=ir("wks"),lr=rr.Symbol,fr=ur?lr:lr&&lr.withoutSetter||or,hr=function(e){return ar(cr,e)&&(sr||"string"==typeof cr[e])||(sr&&ar(lr,e)?cr[e]=lr[e]:cr[e]=fr("Symbol."+e)),cr[e]},dr={},pr=hr;dr.f=pr;var yr=He,vr=R,mr=dr,gr=G.f,br=function(e){var t=yr.Symbol||(yr.Symbol={});vr(t,e)||gr(t,e,{value:mr.f(e)})},kr=G.f,wr=R,xr=hr("toStringTag"),_r=function(e,t,n){e&&!wr(e=n?e:e.prototype,xr)&&kr(e,xr,{configurable:!0,value:t})},Sr=Yt,Tr=function(e,t,n){if(Sr(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},Er=x,Ir=Xn,Cr=hr("species"),Rr=function(e,t){var n;return Ir(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!Ir(n.prototype)?Er(n)&&null===(n=n[Cr])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},Or=Tr,Mr=m,Pr=E,Ar=st,Dr=Rr,jr=[].push,Nr=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(u,c,l,f){for(var h,d,p=Pr(u),y=Mr(p),v=Or(c,l,3),m=Ar(y.length),g=0,b=f||Dr,k=t?b(u,m):n||o?b(u,0):void 0;m>g;g++)if((s||g in y)&&(d=v(h=y[g],g,p),e))if(t)k[g]=d;else if(d)switch(e){case 3:return!0;case 5:return h;case 6:return g;case 2:jr.call(k,h)}else switch(e){case 4:return!1;case 7:jr.call(k,h)}return a?-1:r||i?i:k}},Lr={forEach:Nr(0),map:Nr(1),filter:Nr(2),some:Nr(3),every:Nr(4),find:Nr(5),findIndex:Nr(6),filterOut:Nr(7)},Ur=Xt,Br=i,Fr=et,qr=s,Wr=Kn,zr=Qn,Gr=o,Jr=R,Vr=Xn,$r=x,Kr=V,Qr=E,Hr=w,Xr=S,Yr=h,Zr=gn,ei=tn,ti=tt,ni=Yn,ri=Tt,ii=a,ai=G,oi=u,si=ee,ui=te.exports,ci=pe.exports,li=Ee,fi=we,hi=hr,di=dr,pi=br,yi=_r,vi=qe,mi=Lr.forEach,gi=Te("hidden"),bi="Symbol",ki=hi("toPrimitive"),wi=vi.set,xi=vi.getterFor(bi),_i=Object.prototype,Si=Br.Symbol,Ti=Fr("JSON","stringify"),Ei=ii.f,Ii=ai.f,Ci=ni.f,Ri=oi.f,Oi=ci("symbols"),Mi=ci("op-symbols"),Pi=ci("string-to-symbol-registry"),Ai=ci("symbol-to-string-registry"),Di=ci("wks"),ji=Br.QObject,Ni=!ji||!ji.prototype||!ji.prototype.findChild,Li=qr&&Gr((function(){return 7!=Zr(Ii({},"a",{get:function(){return Ii(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Ei(_i,t);r&&delete _i[t],Ii(e,t,n),r&&e!==_i&&Ii(_i,t,r)}:Ii,Ui=function(e,t){var n=Oi[e]=Zr(Si.prototype);return wi(n,{type:bi,tag:e,description:t}),qr||(n.description=t),n},Bi=zr?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof Si},Fi=function(e,t,n){e===_i&&Fi(Mi,t,n),Kr(e);var r=Xr(t,!0);return Kr(n),Jr(Oi,r)?(n.enumerable?(Jr(e,gi)&&e[gi][r]&&(e[gi][r]=!1),n=Zr(n,{enumerable:Yr(0,!1)})):(Jr(e,gi)||Ii(e,gi,Yr(1,{})),e[gi][r]=!0),Li(e,r,n)):Ii(e,r,n)},qi=function(e,t){Kr(e);var n=Hr(t),r=ei(n).concat(Ji(n));return mi(r,(function(t){qr&&!Wi.call(n,t)||Fi(e,t,n[t])})),e},Wi=function(e){var t=Xr(e,!0),n=Ri.call(this,t);return!(this===_i&&Jr(Oi,t)&&!Jr(Mi,t))&&(!(n||!Jr(this,t)||!Jr(Oi,t)||Jr(this,gi)&&this[gi][t])||n)},zi=function(e,t){var n=Hr(e),r=Xr(t,!0);if(n!==_i||!Jr(Oi,r)||Jr(Mi,r)){var i=Ei(n,r);return!i||!Jr(Oi,r)||Jr(n,gi)&&n[gi][r]||(i.enumerable=!0),i}},Gi=function(e){var t=Ci(Hr(e)),n=[];return mi(t,(function(e){Jr(Oi,e)||Jr(li,e)||n.push(e)})),n},Ji=function(e){var t=e===_i,n=Ci(t?Mi:Hr(e)),r=[];return mi(n,(function(e){!Jr(Oi,e)||t&&!Jr(_i,e)||r.push(Oi[e])})),r};(Wr||(ui((Si=function(){if(this instanceof Si)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=fi(e),n=function(e){this===_i&&n.call(Mi,e),Jr(this,gi)&&Jr(this[gi],t)&&(this[gi][t]=!1),Li(this,t,Yr(1,e))};return qr&&Ni&&Li(_i,t,{configurable:!0,set:n}),Ui(t,e)}).prototype,"toString",(function(){return xi(this).tag})),ui(Si,"withoutSetter",(function(e){return Ui(fi(e),e)})),oi.f=Wi,ai.f=Fi,ii.f=zi,ti.f=ni.f=Gi,ri.f=Ji,di.f=function(e){return Ui(hi(e),e)},qr&&(Ii(Si.prototype,"description",{configurable:!0,get:function(){return xi(this).description}}),ui(_i,"propertyIsEnumerable",Wi,{unsafe:!0}))),Ur({global:!0,wrap:!0,forced:!Wr,sham:!Wr},{Symbol:Si}),mi(ei(Di),(function(e){pi(e)})),Ur({target:bi,stat:!0,forced:!Wr},{for:function(e){var t=String(e);if(Jr(Pi,t))return Pi[t];var n=Si(t);return Pi[t]=n,Ai[n]=t,n},keyFor:function(e){if(!Bi(e))throw TypeError(e+" is not a symbol");if(Jr(Ai,e))return Ai[e]},useSetter:function(){Ni=!0},useSimple:function(){Ni=!1}}),Ur({target:"Object",stat:!0,forced:!Wr,sham:!qr},{create:function(e,t){return void 0===t?Zr(e):qi(Zr(e),t)},defineProperty:Fi,defineProperties:qi,getOwnPropertyDescriptor:zi}),Ur({target:"Object",stat:!0,forced:!Wr},{getOwnPropertyNames:Gi,getOwnPropertySymbols:Ji}),Ur({target:"Object",stat:!0,forced:Gr((function(){ri.f(1)}))},{getOwnPropertySymbols:function(e){return ri.f(Qr(e))}}),Ti)&&Ur({target:"JSON",stat:!0,forced:!Wr||Gr((function(){var e=Si();return"[null]"!=Ti([e])||"{}"!=Ti({a:e})||"{}"!=Ti(Object(e))}))},{stringify:function(e,t,n){for(var r,i=[e],a=1;arguments.length>a;)i.push(arguments[a++]);if(r=t,($r(t)||void 0!==e)&&!Bi(e))return Vr(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Bi(t))return t}),i[1]=t,Ti.apply(null,i)}});Si.prototype[ki]||si(Si.prototype,ki,Si.prototype.valueOf),yi(Si,bi),li[gi]=!0;var Vi=o,$i=Jn,Ki=hr("species"),Qi=function(e){return $i>=51||!Vi((function(){var t=[];return(t.constructor={})[Ki]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Hi=Lr.filter;Xt({target:"Array",proto:!0,forced:!Qi("filter")},{filter:function(e){return Hi(this,e,arguments.length>1?arguments[1]:void 0)}});var Xi=Xt,Yi=o,Zi=w,ea=a.f,ta=s,na=Yi((function(){ea(1)}));Xi({target:"Object",stat:!0,forced:!ta||na,sham:!ta},{getOwnPropertyDescriptor:function(e,t){return ea(Zi(e),t)}});var ra=S,ia=G,aa=h,oa=function(e,t,n){var r=ra(t);r in e?ia.f(e,r,aa(0,n)):e[r]=n},sa=Ot,ua=w,ca=a,la=oa;function fa(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ha(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){fa(a,r,i,o,s,"next",e)}function s(e){fa(a,r,i,o,s,"throw",e)}o(void 0)}))}}function da(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pa(e,t,n){return t&&da(e.prototype,t),n&&da(e,n),e}function ya(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function va(e,t){return(va=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ma(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&va(e,t)}function ga(e){return(ga="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ba(e,t){return!t||"object"!==ga(t)&&"function"!=typeof t?ya(e):t}function ka(e){return(ka=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Xt({target:"Object",stat:!0,sham:!s},{getOwnPropertyDescriptors:function(e){for(var t,n,r=ua(e),i=ca.f,a=sa(r),o={},s=0;a.length>s;)void 0!==(n=i(r,t=a[s++]))&&la(o,t,n);return o}});var _a,Sa=Object.prototype,Ta=Sa.hasOwnProperty,Ea="function"==typeof Symbol?Symbol:{},Ia=Ea.iterator||"@@iterator",Ca=Ea.asyncIterator||"@@asyncIterator",Ra=Ea.toStringTag||"@@toStringTag";function Oa(e,t,n,r){var i=t&&t.prototype instanceof La?t:La,a=Object.create(i.prototype),o=new Ha(r||[]);return a._invoke=function(e,t,n){var r=Pa;return function(i,a){if(r===Da)throw new Error("Generator is already running");if(r===ja){if("throw"===i)throw a;return Ya()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=$a(o,n);if(s){if(s===Na)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===Pa)throw r=ja,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=Da;var u=Ma(e,t,n);if("normal"===u.type){if(r=n.done?ja:Aa,u.arg===Na)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=ja,n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function Ma(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}var Pa="suspendedStart",Aa="suspendedYield",Da="executing",ja="completed",Na={};function La(){}function Ua(){}function Ba(){}var Fa={};Fa[Ia]=function(){return this};var qa=Object.getPrototypeOf,Wa=qa&&qa(qa(Xa([])));Wa&&Wa!==Sa&&Ta.call(Wa,Ia)&&(Fa=Wa);var za=Ba.prototype=La.prototype=Object.create(Fa);function Ga(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function Ja(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===Ua||"GeneratorFunction"===(t.displayName||t.name))}function Va(e,t){function n(r,i,a,o){var s=Ma(e[r],e,i);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"===ga(c)&&Ta.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)})):t.resolve(c).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,o)}))}o(s.arg)}var r;this._invoke=function(e,i){function a(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(a,a):a()}}function $a(e,t){var n=e.iterator[t.method];if(n===_a){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=_a,$a(e,t),"throw"===t.method))return Na;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return Na}var r=Ma(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,Na;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=_a),t.delegate=null,Na):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,Na)}function Ka(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function Qa(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Ha(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(Ka,this),this.reset(!0)}function Xa(e){if(e){var t=e[Ia];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(Ta.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=_a,t.done=!0,t};return r.next=r}}return{next:Ya}}function Ya(){return{value:_a,done:!0}}Ua.prototype=za.constructor=Ba,Ba.constructor=Ua,Ba[Ra]=Ua.displayName="GeneratorFunction",Ga(Va.prototype),Va.prototype[Ca]=function(){return this},Ga(za),za[Ra]="Generator",za[Ia]=function(){return this},za.toString=function(){return"[object Generator]"},Ha.prototype={constructor:Ha,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=_a,this.done=!1,this.delegate=null,this.method="next",this.arg=_a,this.tryEntries.forEach(Qa),!e)for(var t in this)"t"===t.charAt(0)&&Ta.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=_a)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=_a),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var o=Ta.call(i,"catchLoc"),s=Ta.call(i,"finallyLoc");if(o&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&Ta.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,Na):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),Na},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),Qa(n),Na}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;Qa(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:Xa(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=_a),Na}};var Za={wrap:Oa,isGeneratorFunction:Ja,AsyncIterator:Va,mark:function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,Ba):(e.__proto__=Ba,Ra in e||(e[Ra]="GeneratorFunction")),e.prototype=Object.create(za),e},awrap:function(e){return{__await:e}},async:function(e,t,n,r,i){void 0===i&&(i=Promise);var a=new Va(Oa(e,t,n,r),i);return Ja(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},keys:function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},values:Xa},eo={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},to=o,no=function(e,t){var n=[][e];return!!n&&to((function(){n.call(null,t||function(){throw 1},1)}))},ro=Lr.forEach,io=i,ao=eo,oo=no("forEach")?[].forEach:function(e){return ro(this,e,arguments.length>1?arguments[1]:void 0)},so=ee;for(var uo in ao){var co=io[uo],lo=co&&co.prototype;if(lo&&lo.forEach!==oo)try{so(lo,"forEach",oo)}catch(e){lo.forEach=oo}}var fo=gn,ho=G,po=hr("unscopables"),yo=Array.prototype;null==yo[po]&&ho.f(yo,po,{configurable:!0,value:fo(null)});var vo,mo,go,bo=function(e){yo[po][e]=!0},ko={},wo=!o((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),xo=R,_o=E,So=wo,To=Te("IE_PROTO"),Eo=Object.prototype,Io=So?Object.getPrototypeOf:function(e){return e=_o(e),xo(e,To)?e[To]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Eo:null},Co=o,Ro=Io,Oo=ee,Mo=R,Po=hr("iterator"),Ao=!1;[].keys&&("next"in(go=[].keys())?(mo=Ro(Ro(go)))!==Object.prototype&&(vo=mo):Ao=!0),(null==vo||Co((function(){var e={};return vo[Po].call(e)!==e})))&&(vo={}),Mo(vo,Po)||Oo(vo,Po,(function(){return this}));var Do={IteratorPrototype:vo,BUGGY_SAFARI_ITERATORS:Ao},jo=Do.IteratorPrototype,No=gn,Lo=h,Uo=_r,Bo=ko,Fo=function(){return this},qo=x,Wo=V,zo=function(e){if(!qo(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e},Go=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Wo(n),zo(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),Jo=Xt,Vo=function(e,t,n){var r=t+" Iterator";return e.prototype=No(jo,{next:Lo(1,n)}),Uo(e,r,!1),Bo[r]=Fo,e},$o=Io,Ko=Go,Qo=_r,Ho=ee,Xo=te.exports,Yo=ko,Zo=Do.IteratorPrototype,es=Do.BUGGY_SAFARI_ITERATORS,ts=hr("iterator"),ns="keys",rs="values",is="entries",as=function(){return this},os=function(e,t,n,r,i,a,o){Vo(n,t,r);var s,u,c,l=function(e){if(e===i&&y)return y;if(!es&&e in d)return d[e];switch(e){case ns:case rs:case is:return function(){return new n(this,e)}}return function(){return new n(this)}},f=t+" Iterator",h=!1,d=e.prototype,p=d[ts]||d["@@iterator"]||i&&d[i],y=!es&&p||l(i),v="Array"==t&&d.entries||p;if(v&&(s=$o(v.call(new e)),Zo!==Object.prototype&&s.next&&($o(s)!==Zo&&(Ko?Ko(s,Zo):"function"!=typeof s[ts]&&Ho(s,ts,as)),Qo(s,f,!0))),i==rs&&p&&p.name!==rs&&(h=!0,y=function(){return p.call(this)}),d[ts]!==y&&Ho(d,ts,y),Yo[t]=y,i)if(u={values:l(rs),keys:a?y:l(ns),entries:l(is)},o)for(c in u)(es||h||!(c in d))&&Xo(d,c,u[c]);else Jo({target:t,proto:!0,forced:es||h},u);return u},ss=w,us=bo,cs=ko,ls=qe,fs=os,hs="Array Iterator",ds=ls.set,ps=ls.getterFor(hs),ys=fs(Array,"Array",(function(e,t){ds(this,{type:hs,target:ss(e),index:0,kind:t})}),(function(){var e=ps(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");cs.Arguments=cs.Array,us("keys"),us("values"),us("entries");var vs={};vs[hr("toStringTag")]="z";var ms="[object z]"===String(vs),gs=ms,bs=p,ks=hr("toStringTag"),ws="Arguments"==bs(function(){return arguments}()),xs=gs?bs:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),ks))?n:ws?bs(t):"Object"==(r=bs(t))&&"function"==typeof t.callee?"Arguments":r},_s=xs,Ss=ms?{}.toString:function(){return"[object "+_s(this)+"]"},Ts=ms,Es=te.exports,Is=Ss;Ts||Es(Object.prototype,"toString",Is,{unsafe:!0});var Cs=i.Promise,Rs=te.exports,Os=function(e,t,n){for(var r in t)Rs(e,r,t[r],n);return e},Ms=et,Ps=G,As=s,Ds=hr("species"),js=function(e){var t=Ms(e),n=Ps.f;As&&t&&!t[Ds]&&n(t,Ds,{configurable:!0,get:function(){return this}})},Ns=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Ls=ko,Us=hr("iterator"),Bs=Array.prototype,Fs=function(e){return void 0!==e&&(Ls.Array===e||Bs[Us]===e)},qs=xs,Ws=ko,zs=hr("iterator"),Gs=function(e){if(null!=e)return e[zs]||e["@@iterator"]||Ws[qs(e)]},Js=V,Vs=function(e){var t=e.return;if(void 0!==t)return Js(t.call(e)).value},$s=V,Ks=Fs,Qs=st,Hs=Tr,Xs=Gs,Ys=Vs,Zs=function(e,t){this.stopped=e,this.result=t},eu=function(e,t,n){var r,i,a,o,s,u,c,l=n&&n.that,f=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_ITERATOR),d=!(!n||!n.INTERRUPTED),p=Hs(t,l,1+f+d),y=function(e){return r&&Ys(r),new Zs(!0,e)},v=function(e){return f?($s(e),d?p(e[0],e[1],y):p(e[0],e[1])):d?p(e,y):p(e)};if(h)r=e;else{if("function"!=typeof(i=Xs(e)))throw TypeError("Target is not iterable");if(Ks(i)){for(a=0,o=Qs(e.length);o>a;a++)if((s=v(e[a]))&&s instanceof Zs)return s;return new Zs(!1)}r=i.call(e)}for(u=r.next;!(c=u.call(r)).done;){try{s=v(c.value)}catch(e){throw Ys(r),e}if("object"==typeof s&&s&&s instanceof Zs)return s}return new Zs(!1)},tu=hr("iterator"),nu=!1;try{var ru=0,iu={next:function(){return{done:!!ru++}},return:function(){nu=!0}};iu[tu]=function(){return this},Array.from(iu,(function(){throw 2}))}catch(e){}var au,ou,su,uu=function(e,t){if(!t&&!nu)return!1;var n=!1;try{var r={};r[tu]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},cu=V,lu=Yt,fu=hr("species"),hu=function(e,t){var n,r=cu(e).constructor;return void 0===r||null==(n=cu(r)[fu])?t:lu(n)},du=/(?:iphone|ipod|ipad).*applewebkit/i.test(Fn),pu="process"==p(i.process),yu=i,vu=o,mu=Tr,gu=sn,bu=A,ku=du,wu=pu,xu=yu.location,_u=yu.setImmediate,Su=yu.clearImmediate,Tu=yu.process,Eu=yu.MessageChannel,Iu=yu.Dispatch,Cu=0,Ru={},Ou="onreadystatechange",Mu=function(e){if(Ru.hasOwnProperty(e)){var t=Ru[e];delete Ru[e],t()}},Pu=function(e){return function(){Mu(e)}},Au=function(e){Mu(e.data)},Du=function(e){yu.postMessage(e+"",xu.protocol+"//"+xu.host)};_u&&Su||(_u=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Ru[++Cu]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},au(Cu),Cu},Su=function(e){delete Ru[e]},wu?au=function(e){Tu.nextTick(Pu(e))}:Iu&&Iu.now?au=function(e){Iu.now(Pu(e))}:Eu&&!ku?(su=(ou=new Eu).port2,ou.port1.onmessage=Au,au=mu(su.postMessage,su,1)):yu.addEventListener&&"function"==typeof postMessage&&!yu.importScripts&&xu&&"file:"!==xu.protocol&&!vu(Du)?(au=Du,yu.addEventListener("message",Au,!1)):au=Ou in bu("script")?function(e){gu.appendChild(bu("script")).onreadystatechange=function(){gu.removeChild(this),Mu(e)}}:function(e){setTimeout(Pu(e),0)});var ju,Nu,Lu,Uu,Bu,Fu,qu,Wu,zu={set:_u,clear:Su},Gu=/web0s(?!.*chrome)/i.test(Fn),Ju=i,Vu=a.f,$u=zu.set,Ku=du,Qu=Gu,Hu=pu,Xu=Ju.MutationObserver||Ju.WebKitMutationObserver,Yu=Ju.document,Zu=Ju.process,ec=Ju.Promise,tc=Vu(Ju,"queueMicrotask"),nc=tc&&tc.value;nc||(ju=function(){var e,t;for(Hu&&(e=Zu.domain)&&e.exit();Nu;){t=Nu.fn,Nu=Nu.next;try{t()}catch(e){throw Nu?Uu():Lu=void 0,e}}Lu=void 0,e&&e.enter()},Ku||Hu||Qu||!Xu||!Yu?ec&&ec.resolve?((qu=ec.resolve(void 0)).constructor=ec,Wu=qu.then,Uu=function(){Wu.call(qu,ju)}):Uu=Hu?function(){Zu.nextTick(ju)}:function(){$u.call(Ju,ju)}:(Bu=!0,Fu=Yu.createTextNode(""),new Xu(ju).observe(Fu,{characterData:!0}),Uu=function(){Fu.data=Bu=!Bu}));var rc=nc||function(e){var t={fn:e,next:void 0};Lu&&(Lu.next=t),Nu||(Nu=t,Uu()),Lu=t},ic={},ac=Yt,oc=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=ac(t),this.reject=ac(n)};ic.f=function(e){return new oc(e)};var sc,uc,cc,lc,fc=V,hc=x,dc=ic,pc=i,yc="object"==typeof window,vc=Xt,mc=i,gc=et,bc=Cs,kc=te.exports,wc=Os,xc=Go,_c=_r,Sc=js,Tc=x,Ec=Yt,Ic=Ns,Cc=le,Rc=eu,Oc=uu,Mc=hu,Pc=zu.set,Ac=rc,Dc=function(e,t){if(fc(e),hc(t)&&t.constructor===e)return t;var n=dc.f(e);return(0,n.resolve)(t),n.promise},jc=function(e,t){var n=pc.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},Nc=ic,Lc=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Uc=qe,Bc=zt,Fc=yc,qc=pu,Wc=Jn,zc=hr("species"),Gc="Promise",Jc=Uc.get,Vc=Uc.set,$c=Uc.getterFor(Gc),Kc=bc&&bc.prototype,Qc=bc,Hc=Kc,Xc=mc.TypeError,Yc=mc.document,Zc=mc.process,el=Nc.f,tl=el,nl=!!(Yc&&Yc.createEvent&&mc.dispatchEvent),rl="function"==typeof PromiseRejectionEvent,il="unhandledrejection",al=!1,ol=Bc(Gc,(function(){var e=Cc(Qc)!==String(Qc);if(!e&&66===Wc)return!0;if(Wc>=51&&/native code/.test(Qc))return!1;var t=new Qc((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(t.constructor={})[zc]=n,!(al=t.then((function(){}))instanceof n)||!e&&Fc&&!rl})),sl=ol||!Oc((function(e){Qc.all(e).catch((function(){}))})),ul=function(e){var t;return!(!Tc(e)||"function"!=typeof(t=e.then))&&t},cl=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;Ac((function(){for(var r=e.value,i=1==e.state,a=0;n.length>a;){var o,s,u,c=n[a++],l=i?c.ok:c.fail,f=c.resolve,h=c.reject,d=c.domain;try{l?(i||(2===e.rejection&&dl(e),e.rejection=1),!0===l?o=r:(d&&d.enter(),o=l(r),d&&(d.exit(),u=!0)),o===c.promise?h(Xc("Promise-chain cycle")):(s=ul(o))?s.call(o,f,h):f(o)):h(r)}catch(e){d&&!u&&d.exit(),h(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&fl(e)}))}},ll=function(e,t,n){var r,i;nl?((r=Yc.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),mc.dispatchEvent(r)):r={promise:t,reason:n},!rl&&(i=mc["on"+e])?i(r):e===il&&jc("Unhandled promise rejection",n)},fl=function(e){Pc.call(mc,(function(){var t,n=e.facade,r=e.value;if(hl(e)&&(t=Lc((function(){qc?Zc.emit("unhandledRejection",r,n):ll(il,n,r)})),e.rejection=qc||hl(e)?2:1,t.error))throw t.value}))},hl=function(e){return 1!==e.rejection&&!e.parent},dl=function(e){Pc.call(mc,(function(){var t=e.facade;qc?Zc.emit("rejectionHandled",t):ll("rejectionhandled",t,e.value)}))},pl=function(e,t,n){return function(r){e(t,r,n)}},yl=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,cl(e,!0))},vl=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Xc("Promise can't be resolved itself");var r=ul(t);r?Ac((function(){var n={done:!1};try{r.call(t,pl(vl,n,e),pl(yl,n,e))}catch(t){yl(n,t,e)}})):(e.value=t,e.state=1,cl(e,!1))}catch(t){yl({done:!1},t,e)}}};if(ol&&(Hc=(Qc=function(e){Ic(this,Qc,Gc),Ec(e),sc.call(this);var t=Jc(this);try{e(pl(vl,t),pl(yl,t))}catch(e){yl(t,e)}}).prototype,(sc=function(e){Vc(this,{type:Gc,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=wc(Hc,{then:function(e,t){var n=$c(this),r=el(Mc(this,Qc));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=qc?Zc.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&cl(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),uc=function(){var e=new sc,t=Jc(e);this.promise=e,this.resolve=pl(vl,t),this.reject=pl(yl,t)},Nc.f=el=function(e){return e===Qc||e===cc?new uc(e):tl(e)},"function"==typeof bc&&Kc!==Object.prototype)){lc=Kc.then,al||(kc(Kc,"then",(function(e,t){var n=this;return new Qc((function(e,t){lc.call(n,e,t)})).then(e,t)}),{unsafe:!0}),kc(Kc,"catch",Hc.catch,{unsafe:!0}));try{delete Kc.constructor}catch(e){}xc&&xc(Kc,Hc)}vc({global:!0,wrap:!0,forced:ol},{Promise:Qc}),_c(Qc,Gc,!1),Sc(Gc),cc=gc(Gc),vc({target:Gc,stat:!0,forced:ol},{reject:function(e){var t=el(this);return t.reject.call(void 0,e),t.promise}}),vc({target:Gc,stat:!0,forced:ol},{resolve:function(e){return Dc(this,e)}}),vc({target:Gc,stat:!0,forced:sl},{all:function(e){var t=this,n=el(t),r=n.resolve,i=n.reject,a=Lc((function(){var n=Ec(t.resolve),a=[],o=0,s=1;Rc(e,(function(e){var u=o++,c=!1;a.push(void 0),s++,n.call(t,e).then((function(e){c||(c=!0,a[u]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise},race:function(e){var t=this,n=el(t),r=n.reject,i=Lc((function(){var i=Ec(t.resolve);Rc(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var ml=it,gl=g,bl=function(e){return function(t,n){var r,i,a=String(gl(t)),o=ml(n),s=a.length;return o<0||o>=s?e?"":void 0:(r=a.charCodeAt(o))<55296||r>56319||o+1===s||(i=a.charCodeAt(o+1))<56320||i>57343?e?a.charAt(o):r:e?a.slice(o,o+2):i-56320+(r-55296<<10)+65536}},kl={codeAt:bl(!1),charAt:bl(!0)},wl=kl.charAt,xl=qe,_l=os,Sl="String Iterator",Tl=xl.set,El=xl.getterFor(Sl);_l(String,"String",(function(e){Tl(this,{type:Sl,string:String(e),index:0})}),(function(){var e,t=El(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=wl(n,r),t.index+=e.length,{value:e,done:!1})}));var Il=i,Cl=eo,Rl=ys,Ol=ee,Ml=hr,Pl=Ml("iterator"),Al=Ml("toStringTag"),Dl=Rl.values;for(var jl in Cl){var Nl=Il[jl],Ll=Nl&&Nl.prototype;if(Ll){if(Ll[Pl]!==Dl)try{Ol(Ll,Pl,Dl)}catch(e){Ll[Pl]=Dl}if(Ll[Al]||Ol(Ll,Al,jl),Cl[jl])for(var Ul in Rl)if(Ll[Ul]!==Rl[Ul])try{Ol(Ll,Ul,Rl[Ul])}catch(e){Ll[Ul]=Rl[Ul]}}}var Bl=s,Fl=o,ql=tn,Wl=Tt,zl=u,Gl=E,Jl=m,Vl=Object.assign,$l=Object.defineProperty,Kl=!Vl||Fl((function(){if(Bl&&1!==Vl({b:1},Vl($l({},"a",{enumerable:!0,get:function(){$l(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=Vl({},e)[n]||ql(Vl({},t)).join("")!=r}))?function(e,t){for(var n=Gl(e),r=arguments.length,i=1,a=Wl.f,o=zl.f;r>i;)for(var s,u=Jl(arguments[i++]),c=a?ql(u).concat(a(u)):ql(u),l=c.length,f=0;l>f;)s=c[f++],Bl&&!o.call(u,s)||(n[s]=u[s]);return n}:Vl;Xt({target:"Object",stat:!0,forced:Object.assign!==Kl},{assign:Kl});var Ql=Math.floor,Hl=function(e,t){var n=e.length,r=Ql(n/2);return n<8?Xl(e,t):Yl(Hl(e.slice(0,r),t),Hl(e.slice(r),t),t)},Xl=function(e,t){for(var n,r,i=e.length,a=1;a<i;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},Yl=function(e,t,n){for(var r=e.length,i=t.length,a=0,o=0,s=[];a<r||o<i;)a<r&&o<i?s.push(n(e[a],t[o])<=0?e[a++]:t[o++]):s.push(a<r?e[a++]:t[o++]);return s},Zl=Hl,ef=Fn.match(/firefox\/(\d+)/i),tf=!!ef&&+ef[1],nf=/MSIE|Trident/.test(Fn),rf=Fn.match(/AppleWebKit\/(\d+)\./),af=!!rf&&+rf[1],of=Xt,sf=Yt,uf=E,cf=st,lf=o,ff=Zl,hf=no,df=tf,pf=nf,yf=Jn,vf=af,mf=[],gf=mf.sort,bf=lf((function(){mf.sort(void 0)})),kf=lf((function(){mf.sort(null)})),wf=hf("sort"),xf=!lf((function(){if(yf)return yf<70;if(!(df&&df>3)){if(pf)return!0;if(vf)return vf<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)mf.push({k:t+r,v:n})}for(mf.sort((function(e,t){return t.v-e.v})),r=0;r<mf.length;r++)t=mf[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));of({target:"Array",proto:!0,forced:bf||!kf||!wf||!xf},{sort:function(e){void 0!==e&&sf(e);var t=uf(this);if(xf)return void 0===e?gf.call(t):gf.call(t,e);var n,r,i=[],a=cf(t.length);for(r=0;r<a;r++)r in t&&i.push(t[r]);for(n=(i=ff(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:String(t)>String(n)?1:-1}}(e))).length,r=0;r<n;)t[r]=i[r++];for(;r<a;)delete t[r++];return t}});var _f=x,Sf=Go,Tf=function(e,t,n){var r,i;return Sf&&"function"==typeof(r=t.constructor)&&r!==n&&_f(i=r.prototype)&&i!==n.prototype&&Sf(e,i),e},Ef=g,If="[\t\n\v\f\r                　\u2028\u2029\ufeff]",Cf=RegExp("^"+If+If+"*"),Rf=RegExp(If+If+"*$"),Of=function(e){return function(t){var n=String(Ef(t));return 1&e&&(n=n.replace(Cf,"")),2&e&&(n=n.replace(Rf,"")),n}},Mf={start:Of(1),end:Of(2),trim:Of(3)},Pf=s,Af=i,Df=zt,jf=te.exports,Nf=R,Lf=p,Uf=Tf,Bf=S,Ff=o,qf=gn,Wf=tt.f,zf=a.f,Gf=G.f,Jf=Mf.trim,Vf="Number",$f=Af.Number,Kf=$f.prototype,Qf=Lf(qf(Kf))==Vf,Hf=function(e){var t,n,r,i,a,o,s,u,c=Bf(e,!1);if("string"==typeof c&&c.length>2)if(43===(t=(c=Jf(c)).charCodeAt(0))||45===t){if(88===(n=c.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(o=(a=c.slice(2)).length,s=0;s<o;s++)if((u=a.charCodeAt(s))<48||u>i)return NaN;return parseInt(a,r)}return+c};if(Df(Vf,!$f(" 0o1")||!$f("0b1")||$f("+0x1"))){for(var Xf,Yf=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof Yf&&(Qf?Ff((function(){Kf.valueOf.call(n)})):Lf(n)!=Vf)?Uf(new $f(Hf(t)),n,Yf):Hf(t)},Zf=Pf?Wf($f):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),eh=0;Zf.length>eh;eh++)Nf($f,Xf=Zf[eh])&&!Nf(Yf,Xf)&&Gf(Yf,Xf,zf($f,Xf));Yf.prototype=Kf,Kf.constructor=Yf,jf(Af,Vf,Yf)}function th(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":ga(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}function nh(e,t){if("object"===("undefined"==typeof Reflect?"undefined":ga(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function rh(){}function ih(){ih.init.call(this)}function ah(e){return void 0===e._maxListeners?ih.defaultMaxListeners:e._maxListeners}function oh(e,t,n){if(t)e.call(n);else for(var r=e.length,i=ph(e,r),a=0;a<r;++a)i[a].call(n)}function sh(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,a=ph(e,i),o=0;o<i;++o)a[o].call(n,r)}function uh(e,t,n,r,i){if(t)e.call(n,r,i);else for(var a=e.length,o=ph(e,a),s=0;s<a;++s)o[s].call(n,r,i)}function ch(e,t,n,r,i,a){if(t)e.call(n,r,i,a);else for(var o=e.length,s=ph(e,o),u=0;u<o;++u)s[u].call(n,r,i,a)}function lh(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,a=ph(e,i),o=0;o<i;++o)a[o].apply(n,r)}function fh(e,t,n,r){var i,a,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]):(a=e._events=new rh,e._eventsCount=0),o){if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=ah(e))&&i>0&&o.length>i){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else o=a[t]=n,++e._eventsCount;return e}function hh(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function dh(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function ph(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}rh.prototype=Object.create(null),ih.EventEmitter=ih,ih.usingDomains=!1,ih.prototype.domain=void 0,ih.prototype._events=void 0,ih.prototype._maxListeners=void 0,ih.defaultMaxListeners=10,ih.init=function(){this.domain=null,ih.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new rh,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ih.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},ih.prototype.getMaxListeners=function(){return ah(this)},ih.prototype.emit=function(e){var t,n,r,i,a,o,s,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=o[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:oh(n,l,this);break;case 2:sh(n,l,this,arguments[1]);break;case 3:uh(n,l,this,arguments[1],arguments[2]);break;case 4:ch(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),a=1;a<r;a++)i[a-1]=arguments[a];lh(n,l,this,i)}return!0},ih.prototype.addListener=function(e,t){return fh(this,e,t,!1)},ih.prototype.on=ih.prototype.addListener,ih.prototype.prependListener=function(e,t){return fh(this,e,t,!0)},ih.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,hh(this,e,t)),this},ih.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,hh(this,e,t)),this},ih.prototype.removeListener=function(e,t){var n,r,i,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new rh:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new rh,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,o||t)}return this},ih.prototype.off=function(e,t){return this.removeListener(e,t)},ih.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new rh,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new rh:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(r=i[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new rh,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},ih.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},ih.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):dh.call(e,t)},ih.prototype.listenerCount=dh,ih.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var yh=Object.freeze({__proto__:null,default:ih,EventEmitter:ih}),vh=Xt,mh=o,gh=Xn,bh=x,kh=E,wh=st,xh=oa,_h=Rr,Sh=Qi,Th=Jn,Eh=hr("isConcatSpreadable"),Ih=9007199254740991,Ch="Maximum allowed index exceeded",Rh=Th>=51||!mh((function(){var e=[];return e[Eh]=!1,e.concat()[0]!==e})),Oh=Sh("concat"),Mh=function(e){if(!bh(e))return!1;var t=e[Eh];return void 0!==t?!!t:gh(e)};vh({target:"Array",proto:!0,forced:!Rh||!Oh},{concat:function(e){var t,n,r,i,a,o=kh(this),s=_h(o,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(Mh(a=-1===t?o:arguments[t])){if(u+(i=wh(a.length))>Ih)throw TypeError(Ch);for(n=0;n<i;n++,u++)n in a&&xh(s,u,a[n])}else{if(u>=Ih)throw TypeError(Ch);xh(s,u++,a)}return s.length=u,s}});var Ph=V,Ah=Vs,Dh=Tr,jh=E,Nh=function(e,t,n,r){try{return r?t(Ph(n)[0],n[1]):t(n)}catch(t){throw Ah(e),t}},Lh=Fs,Uh=st,Bh=oa,Fh=Gs,qh=function(e){var t,n,r,i,a,o,s=jh(e),u="function"==typeof this?this:Array,c=arguments.length,l=c>1?arguments[1]:void 0,f=void 0!==l,h=Fh(s),d=0;if(f&&(l=Dh(l,c>2?arguments[2]:void 0,2)),null==h||u==Array&&Lh(h))for(n=new u(t=Uh(s.length));t>d;d++)o=f?l(s[d],d):s[d],Bh(n,d,o);else for(a=(i=h.call(s)).next,n=new u;!(r=a.call(i)).done;d++)o=f?Nh(i,l,[r.value,d],!0):r.value,Bh(n,d,o);return n.length=d,n};Xt({target:"Array",stat:!0,forced:!uu((function(e){Array.from(e)}))},{from:qh});var Wh,zh,Gh,Jh={exports:{}};function Vh(e,t){return["".concat((new Date).toISOString()," Chat ").concat(e,":")].concat(Array.from(t))}zh=t,Gh=function(){var e=function(){},t="undefined",n=("undefined"==typeof window?"undefined":ga(window))!==t&&ga(window.navigator)!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(r){return"debug"===r&&(r="log"),("undefined"==typeof console?"undefined":ga(console))!==t&&("trace"===r&&n?a:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}function s(t,n){for(var i=0;i<r.length;i++){var a=r[i];this[a]=i<t?e:this.methodFactory(a,t,n)}this.log=this.debug}function u(e,n,r){return function(){("undefined"==typeof console?"undefined":ga(console))!==t&&(s.call(this,n,r),this[e].apply(this,arguments))}}function c(e,t,n){return o(e)||u.apply(this,arguments)}function l(e,n,i){var a,o=this,u="loglevel";function l(){var e;if(("undefined"==typeof window?"undefined":ga(window))!==t&&u){try{e=window.localStorage[u]}catch(e){}if(ga(e)===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"===ga(e)&&(u=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=i||c,o.getLevel=function(){return a},o.setLevel=function(n,i){if("string"==typeof n&&void 0!==o.levels[n.toUpperCase()]&&(n=o.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(a=n,!1!==i&&function(e){var n=(r[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":ga(window))!==t&&u){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(n),s.call(o,n,e),("undefined"==typeof console?"undefined":ga(console))===t&&n<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){l()||o.setLevel(e,!1)},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var f=l();null==f&&(f=null==n?"WARN":n),o.setLevel(f,!1)}var f=new l,h={};f.getLogger=function(e){if("symbol"!==ga(e)&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new l(e,f.getLevel(),f.methodFactory)),t};var d=("undefined"==typeof window?"undefined":ga(window))!==t?window.log:void 0;return f.noConflict=function(){return("undefined"==typeof window?"undefined":ga(window))!==t&&window.log===f&&(window.log=d),f},f.getLoggers=function(){return h},f.default=f,f},(Wh=Jh).exports?Wh.exports=Gh():zh.log=Gh();var $h,Kh,Qh=Jh.exports.getLogger("twilio-chat"),Hh=function(){function e(t){xa(this,e),wa(this,"prefix",""),this.prefix=null!=t&&t.length>0?t+" ":""}return pa(e,[{key:"setLevel",value:function(e){Qh.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qh.trace.apply(null,Vh(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qh.debug.apply(null,Vh(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qh.info.apply(null,Vh(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qh.warn.apply(null,Vh(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qh.error.apply(null,Vh(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){Qh.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qh.trace.apply(null,Vh("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qh.debug.apply(null,Vh("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qh.info.apply(null,Vh("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qh.warn.apply(null,Vh("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qh.error.apply(null,Vh("E",t))}}]),e}(),Xh={};Object.defineProperty(Xh,"__esModule",{value:!0});var Yh=["weeks","years","months","days","hours","minutes","seconds"],Zh=Xh.pattern=new RegExp("P(?:(\\d+(?:[\\.,]\\d+)?W)|(\\d+(?:[\\.,]\\d+)?Y)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?D)?(?:T(\\d+(?:[\\.,]\\d+)?H)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?S)?)?)"),ed=Kh=Xh.parse=function(e){return e.match(Zh).slice(1).reduce((function(e,t,n){return e[Yh[n]]=parseFloat(t)||0,e}),{})},td=Xh.end=function(e,t){var n=t?t.getTime():Date.now(),r=new Date(n);return r.setFullYear(r.getFullYear()+e.years),r.setMonth(r.getMonth()+e.months),r.setDate(r.getDate()+e.days),r.setHours(r.getHours()+e.hours),r.setMinutes(r.getMinutes()+e.minutes),r.setMilliseconds(r.getMilliseconds()+1e3*e.seconds),r.setDate(r.getDate()+7*e.weeks),r},nd=$h=Xh.toSeconds=function(e,t){var n=t?t.getTime():Date.now(),r=new Date(n);return(td(e,r).getTime()-r.getTime())/1e3};function rd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function id(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rd(Object(n),!0).forEach((function(t){wa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Xh.default={end:td,toSeconds:nd,pattern:Zh,parse:ed};var ad="PT5S",od="PT5S",sd=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;xa(this,e),wa(this,"typingIndicatorTimeoutDefault",5e3);var i=t.Chat||t.IPMessaging||t||{};this.productId=i.productId,this.links={myConversations:n.links.my_conversations,conversations:n.links.conversations,users:n.links.users,currentUser:n.links.current_user,typing:n.links.typing,mediaService:n.links.media_service,messagesReceipts:n.links.messages_receipts},this.typingIndicatorTimeoutOverride=i.typingIndicatorTimeoutOverride,this.backoffConfiguration=id({min:1e3,max:4e3,maxAttemptsCount:3},i.backoffConfigOverride),this.retryWhenThrottled=void 0===i.retryWhenThrottledOverride||i.retryWhenThrottledOverride,this.userInfosToSubscribe=i.userInfosToSubscribeOverride||n.options.user_infos_to_subscribe||100,this.reachabilityEnabled=n.options.reachability_enabled,this.userIdentity=n.identity,this.userInfo=n.sync_objects.my_user_info,this.myConversations=n.sync_objects.my_conversations;var a=i.httpCacheIntervalOverride||n.options.http_cache_interval||ad;try{this.httpCacheInterval=$h(Kh(a))}catch(e){r.error("Failed to parse http cache interval ".concat(a,", using default value ").concat(ad)),this.httpCacheInterval=$h(Kh(ad))}var o=i.consumptionReportIntervalOverride||n.options.consumption_report_interval||od;try{this.consumptionReportInterval=$h(Kh(o))}catch(e){r.error("Failed to parse consumption report interval ".concat(o,", using default value ").concat(od)),this.consumptionReportInterval=$h(Kh(od))}},ud=Lr.map;Xt({target:"Array",proto:!0,forced:!Qi("map")},{map:function(e){return ud(this,e,arguments.length>1?arguments[1]:void 0)}});var cd=V,ld={},fd=o;function hd(e,t){return RegExp(e,t)}ld.UNSUPPORTED_Y=fd((function(){var e=hd("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),ld.BROKEN_CARET=fd((function(){var e=hd("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));var dd,pd,yd=function(){var e=cd(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},vd=ld,md=pe.exports,gd=RegExp.prototype.exec,bd=md("native-string-replace",String.prototype.replace),kd=gd,wd=(dd=/a/,pd=/b*/g,gd.call(dd,"a"),gd.call(pd,"a"),0!==dd.lastIndex||0!==pd.lastIndex),xd=vd.UNSUPPORTED_Y||vd.BROKEN_CARET,_d=void 0!==/()??/.exec("")[1];(wd||_d||xd)&&(kd=function(e){var t,n,r,i,a=this,o=xd&&a.sticky,s=yd.call(a),u=a.source,c=0,l=e;return o&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),l=String(e).slice(a.lastIndex),a.lastIndex>0&&(!a.multiline||a.multiline&&"\n"!==e[a.lastIndex-1])&&(u="(?: "+u+")",l=" "+l,c++),n=new RegExp("^(?:"+u+")",s)),_d&&(n=new RegExp("^"+u+"$(?!\\s)",s)),wd&&(t=a.lastIndex),r=gd.call(o?n:a,l),o?r?(r.input=r.input.slice(c),r[0]=r[0].slice(c),r.index=a.lastIndex,a.lastIndex+=r[0].length):a.lastIndex=0:wd&&r&&(a.lastIndex=a.global?r.index+r[0].length:t),_d&&r&&r.length>1&&bd.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r});var Sd=kd;Xt({target:"RegExp",proto:!0,forced:/./.exec!==Sd},{exec:Sd});var Td=te.exports,Ed=Sd,Id=o,Cd=hr,Rd=ee,Od=Cd("species"),Md=RegExp.prototype,Pd=!Id((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),Ad="$0"==="a".replace(/./,"$0"),Dd=Cd("replace"),jd=!!/./[Dd]&&""===/./[Dd]("a","$0"),Nd=!Id((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),Ld=kl.charAt,Ud=E,Bd=Math.floor,Fd="".replace,qd=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Wd=/\$([$&'`]|\d{1,2})/g,zd=p,Gd=Sd,Jd=function(e,t,n,r){var i=Cd(e),a=!Id((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),o=a&&!Id((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Od]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!a||!o||"replace"===e&&(!Pd||!Ad||jd)||"split"===e&&!Nd){var s=/./[i],u=n(i,""[e],(function(e,t,n,r,i){var o=t.exec;return o===Ed||o===Md.exec?a&&!i?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:Ad,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:jd}),c=u[0],l=u[1];Td(String.prototype,e,c),Td(Md,i,2==t?function(e,t){return l.call(e,this,t)}:function(e){return l.call(e,this)})}r&&Rd(Md[i],"sham",!0)},Vd=V,$d=st,Kd=it,Qd=g,Hd=function(e,t,n){return t+(n?Ld(e,t).length:1)},Xd=function(e,t,n,r,i,a){var o=n+e.length,s=r.length,u=Wd;return void 0!==i&&(i=Ud(i),u=qd),Fd.call(a,u,(function(a,u){var c;switch(u.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(o);case"<":c=i[u.slice(1,-1)];break;default:var l=+u;if(0===l)return a;if(l>s){var f=Bd(l/10);return 0===f?a:f<=s?void 0===r[f-1]?u.charAt(1):r[f-1]+u.charAt(1):a}c=r[l-1]}return void 0===c?"":c}))},Yd=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==zd(e))throw TypeError("RegExp#exec called on incompatible receiver");return Gd.call(e,t)},Zd=Math.max,ep=Math.min;Jd("replace",2,(function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,a=r.REPLACE_KEEPS_$0,o=i?"$":"$0";return[function(n,r){var i=Qd(this),a=null==n?void 0:n[e];return void 0!==a?a.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&a||"string"==typeof r&&-1===r.indexOf(o)){var s=n(t,e,this,r);if(s.done)return s.value}var u=Vd(e),c=String(this),l="function"==typeof r;l||(r=String(r));var f=u.global;if(f){var h=u.unicode;u.lastIndex=0}for(var d=[];;){var p=Yd(u,c);if(null===p)break;if(d.push(p),!f)break;""===String(p[0])&&(u.lastIndex=Hd(c,$d(u.lastIndex),h))}for(var y,v="",m=0,g=0;g<d.length;g++){p=d[g];for(var b=String(p[0]),k=Zd(ep(Kd(p.index),c.length),0),w=[],x=1;x<p.length;x++)w.push(void 0===(y=p[x])?y:String(y));var _=p.groups;if(l){var S=[b].concat(w,k,c);void 0!==_&&S.push(_);var T=String(r.apply(void 0,S))}else T=Xd(b,c,k,w,_,r);k>=m&&(v+=c.slice(m,k)+T,m=k+b.length)}return v+c.slice(m)}]}));var tp=Xt,np=w,rp=[].join,ip=m!=Object,ap=no("join",",");tp({target:"Array",proto:!0,forced:ip||!ap},{join:function(e){return rp.call(np(this),void 0===e?",":e)}});var op={},sp={};function up(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function cp(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(sp,"__esModule",{value:!0}),sp.Pointer=void 0;var lp=function(){function e(e){void 0===e&&(e=[""]),this.tokens=e}return e.fromJSON=function(t){var n=t.split("/").map(up);if(""!==n[0])throw new Error("Invalid JSON Pointer: "+t);return new e(n)},e.prototype.toString=function(){return this.tokens.map(cp).join("/")},e.prototype.evaluate=function(e){for(var t=null,n="",r=e,i=1,a=this.tokens.length;i<a;i++)r=((t=r)||{})[n=this.tokens[i]];return{parent:t,key:n,value:r}},e.prototype.get=function(e){return this.evaluate(e).value},e.prototype.set=function(e,t){for(var n=e,r=1,i=this.tokens.length-1,a=this.tokens[r];r<i;r++)n=(n||{})[a];n&&(n[this.tokens[this.tokens.length-1]]=t)},e.prototype.push=function(e){this.tokens.push(e)},e.prototype.add=function(t){return new e(this.tokens.concat(String(t)))},e}();sp.Pointer=lp;var fp={},hp={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.clone=e.objectType=e.hasOwnProperty=void 0,e.hasOwnProperty=Object.prototype.hasOwnProperty,e.objectType=function(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":ga(e)},e.clone=function t(n){if(null==n||"object"!=ga(n))return n;if(n.constructor==Array){for(var r=n.length,i=new Array(r),a=0;a<r;a++)i[a]=t(n[a]);return i}var o={};for(var s in n)e.hasOwnProperty.call(n,s)&&(o[s]=t(n[s]));return o}}(hp);var dp={};Object.defineProperty(dp,"__esModule",{value:!0}),dp.compare=void 0;var pp=hp;function yp(e,t){if(e===t)return!0;var n=pp.objectType(e),r=pp.objectType(t);return"array"==n&&"array"==r?function(e,t){var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(!yp(e[r],t[r]))return!1;return!0}(e,t):"object"==n&&"object"==r&&function(e,t){var n=Object.keys(e),r=Object.keys(t),i=n.length;if(i!==r.length)return!1;for(var a=0;a<i;a++){var o=n[a];if(!pp.hasOwnProperty.call(t,o)||!yp(e[o],t[o]))return!1}return!0}(e,t)}dp.compare=yp;var vp,mp=t&&t.__extends||(vp=function(e,t){return(vp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}vp(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(fp,"__esModule",{value:!0}),fp.apply=fp.InvalidOperationError=fp.test=fp.copy=fp.move=fp.replace=fp.remove=fp.add=fp.TestError=fp.MissingError=void 0;var gp=sp,bp=hp,kp=dp,wp=function(e){function t(t){var n=e.call(this,"Value required at path: "+t)||this;return n.path=t,n.name="MissingError",n}return mp(t,e),t}(Error);fp.MissingError=wp;var xp=function(e){function t(t,n){var r=e.call(this,"Test failed: "+t+" != "+n)||this;return r.actual=t,r.expected=n,r.name="TestError",r}return mp(t,e),t}(Error);function _p(e,t,n){if(Array.isArray(e))if("-"==t)e.push(n);else{var r=parseInt(t,10);e.splice(r,0,n)}else e[t]=n}function Sp(e,t){if(Array.isArray(e)){var n=parseInt(t,10);e.splice(n,1)}else delete e[t]}function Tp(e,t){var n=gp.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.parent?new wp(t.path):(_p(n.parent,n.key,bp.clone(t.value)),null)}function Ep(e,t){var n=gp.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.value?new wp(t.path):(Sp(n.parent,n.key),null)}function Ip(e,t){var n=gp.Pointer.fromJSON(t.path).evaluate(e);if(null===n.parent)return new wp(t.path);if(Array.isArray(n.parent)){if(parseInt(n.key,10)>=n.parent.length)return new wp(t.path)}else if(void 0===n.value)return new wp(t.path);return n.parent[n.key]=t.value,null}function Cp(e,t){var n=gp.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new wp(t.from);var r=gp.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.parent?new wp(t.path):(Sp(n.parent,n.key),_p(r.parent,r.key,n.value),null)}function Rp(e,t){var n=gp.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new wp(t.from);var r=gp.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.parent?new wp(t.path):(_p(r.parent,r.key,bp.clone(n.value)),null)}function Op(e,t){var n=gp.Pointer.fromJSON(t.path).evaluate(e);return kp.compare(n.value,t.value)?null:new xp(n.value,t.value)}fp.TestError=xp,fp.add=Tp,fp.remove=Ep,fp.replace=Ip,fp.move=Cp,fp.copy=Rp,fp.test=Op;var Mp=function(e){function t(t){var n=e.call(this,"Invalid operation: "+t.op)||this;return n.operation=t,n.name="InvalidOperationError",n}return mp(t,e),t}(Error);fp.InvalidOperationError=Mp,fp.apply=function(e,t){switch(t.op){case"add":return Tp(e,t);case"remove":return Ep(e,t);case"replace":return Ip(e,t);case"move":return Cp(e,t);case"copy":return Rp(e,t);case"test":return Op(e,t)}return new Mp(t)};var Pp={};Object.defineProperty(Pp,"__esModule",{value:!0}),Pp.diffAny=Pp.diffObjects=Pp.diffArrays=Pp.intersection=Pp.subtract=Pp.isDestructive=void 0;var Ap=dp,Dp=hp;function jp(e,t){var n={};for(var r in e)Dp.hasOwnProperty.call(e,r)&&void 0!==e[r]&&(n[r]=1);for(var i in t)Dp.hasOwnProperty.call(t,i)&&void 0!==t[i]&&delete n[i];return Object.keys(n)}function Np(e){for(var t=e.length,n={},r=0;r<t;r++){var i=e[r];for(var a in i)Dp.hasOwnProperty.call(i,a)&&void 0!==i[a]&&(n[a]=(n[a]||0)+1)}for(var a in n)n[a]<t&&delete n[a];return Object.keys(n)}function Lp(e,t){return{operations:e.operations.concat(t),cost:e.cost+1}}function Up(e,t,n,r){void 0===r&&(r=Fp);var i={"0,0":{operations:[],cost:0}};var a=isNaN(e.length)||e.length<=0?0:e.length,o=isNaN(t.length)||t.length<=0?0:t.length;return function n(r,a){var o=r+","+a,s=i[o];if(void 0===s){if(r>0&&a>0&&Ap.compare(e[r-1],t[a-1]))s=n(r-1,a-1);else{var u=[];if(r>0){var c=n(r-1,a),l={op:"remove",index:r-1};u.push(Lp(c,l))}if(a>0){var f=n(r,a-1),h={op:"add",index:r-1,value:t[a-1]};u.push(Lp(f,h))}if(r>0&&a>0){var d=n(r-1,a-1),p={op:"replace",index:r-1,original:e[r-1],value:t[a-1]};u.push(Lp(d,p))}s=u.sort((function(e,t){return e.cost-t.cost}))[0]}i[o]=s}return s}(a,o).operations.reduce((function(e,t){var i=e[0],o=e[1];if(function(e){return"add"===e.op}(t)){var s=t.index+1+o,u=s<a+o?String(s):"-",c={op:t.op,path:n.add(u).toString(),value:t.value};return[i.concat(c),o+1]}if(function(e){return"remove"===e.op}(t)){c={op:t.op,path:n.add(String(t.index+o)).toString()};return[i.concat(c),o-1]}var l=n.add(String(t.index+o)),f=r(t.original,t.value,l);return[i.concat.apply(i,f),o]}),[[],0])[0]}function Bp(e,t,n,r){void 0===r&&(r=Fp);var i=[];return jp(e,t).forEach((function(e){i.push({op:"remove",path:n.add(e).toString()})})),jp(t,e).forEach((function(e){i.push({op:"add",path:n.add(e).toString(),value:t[e]})})),Np([e,t]).forEach((function(a){i.push.apply(i,r(e[a],t[a],n.add(a)))})),i}function Fp(e,t,n,r){if(void 0===r&&(r=Fp),e===t)return[];var i=Dp.objectType(e),a=Dp.objectType(t);return"array"==i&&"array"==a?Up(e,t,n,r):"object"==i&&"object"==a?Bp(e,t,n,r):[{op:"replace",path:n.toString(),value:t}]}Pp.isDestructive=function(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t},Pp.subtract=jp,Pp.intersection=Np,Pp.diffArrays=Up,Pp.diffObjects=Bp,Pp.diffAny=Fp,Object.defineProperty(op,"__esModule",{value:!0}),op.createTests=Gp=op.createPatch=op.applyPatch=void 0;var qp=sp,Wp=fp,zp=Pp;op.applyPatch=function(e,t){return t.map((function(t){return Wp.apply(e,t)}))};var Gp=op.createPatch=function(e,t,n){var r=new qp.Pointer;return(n?function(e){return function t(n,r,i){var a=e(n,r,i);return Array.isArray(a)?a:zp.diffAny(n,r,i,t)}}(n):zp.diffAny)(e,t,r)};function Jp(e,t){var n=qp.Pointer.fromJSON(t).evaluate(e);if(void 0!==n)return{op:"test",path:t,value:n.value}}function Vp(e,t){return 0===Gp(e,t).length}function $p(e){return JSON.parse(JSON.stringify(e))}function Kp(e){return void 0===e||isNaN(Number(e))?null:Number(e)}function Qp(e){try{return new Date(e)}catch(e){return null}}function Hp(e,t,n){var r={};if(e)try{r=JSON.parse(e)}catch(e){n.warn(t,e)}return r}op.createTests=function(e,t){var n=new Array;return t.filter(zp.isDestructive).forEach((function(t){var r=Jp(e,t.path);if(r&&n.push(r),"from"in t){var i=Jp(e,t.from);i&&n.push(i)}})),n};var Xp=function(){function e(t){xa(this,e),this.base=t.replace(/\/$/,""),this.args=[],this.paths=[]}return pa(e,[{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"path",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}(),Yp=function(){function e(t,n,r,i){xa(this,e),this.state={prevToken:r,nextToken:i,source:n,items:t}}return pa(e,[{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}},{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):Promise.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):Promise.reject(new Error("No previous page"))}}]),e}(),Zp=Hh.scope("ChannelDescriptor"),ChannelDescriptor=function(){function ChannelDescriptor(e,t){xa(this,ChannelDescriptor),this.client=e,this.descriptor=t,this.sid=t.sid||t.conversation_sid,this.channel="".concat(this.sid,".channel"),this.uniqueName=t.unique_name,this.friendlyName=t.friendly_name,this.attributes=Hp(t.attributes,"Failed to parse channel attributes",Zp),this.createdBy=t.created_by,this.dateCreated=Qp(t.date_created),this.dateUpdated=Qp(t.date_updated),this.messagesCount=t.messages_count,this.membersCount=t.participants_count,this.type=t.type,this.isPrivate="private"===t.type,this.lastConsumedMessageIndex=t.last_consumed_message_index,this.notificationLevel=t.notification_level||void 0,this.status=t.status||"unknown"}return pa(ChannelDescriptor,[{key:"getChannel",value:function(){return this.client.getChannelBySid(this.sid)}}]),ChannelDescriptor}(),ey=function(){function e(t,n,r){xa(this,e),this.client=t,this.services=n,this.url=r}var t,n,r;return pa(e,[{key:"getChannels",value:(r=ha(Za.mark((function e(){var t,n,r,i=this,a=arguments;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=new Xp(this.url).arg("PageToken",t.pageToken).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,e.abrupt("return",new Yp(r.body.conversations.map((function(e){return new ChannelDescriptor(i.client,e)})),(function(e){return i.getChannels({pageToken:e})}),r.body.meta.previous_token,r.body.meta.next_token));case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getChannelBySid",value:(n=ha(Za.mark((function e(t){var n,r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Xp(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return r=e.sent,e.abrupt("return",new ChannelDescriptor(this.client,r.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getChannelByUniqueName",value:(t=ha(Za.mark((function e(t){var n,r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Xp(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return r=e.sent,e.abrupt("return",new ChannelDescriptor(this.client,r.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),ty=Xt,ny=x,ry=Xn,iy=ft,ay=st,oy=w,sy=oa,uy=hr,cy=Qi("slice"),ly=uy("species"),fy=[].slice,hy=Math.max;ty({target:"Array",proto:!0,forced:!cy},{slice:function(e,t){var n,r,i,a=oy(this),o=ay(a.length),s=iy(e,o),u=iy(void 0===t?o:t,o);if(ry(a)&&("function"!=typeof(n=a.constructor)||n!==Array&&!ry(n.prototype)?ny(n)&&null===(n=n[ly])&&(n=void 0):n=void 0,n===Array||void 0===n))return fy.call(a,s,u);for(r=new(void 0===n?Array:n)(hy(u-s,0)),i=0;s<u;s++,i++)s in a&&sy(r,i,a[s]);return r.length=i,r}});var dy=s,py=G.f,yy=Function.prototype,vy=yy.toString,my=/^\s*function ([^ (]*)/,gy="name";dy&&!(gy in yy)&&py(yy,gy,{configurable:!0,get:function(){try{return vy.call(this).match(my)[1]}catch(e){return""}}});var by=Xt,ky=s,wy=i,xy=R,_y=x,Sy=G.f,Ty=jt,Ey=wy.Symbol;if(ky&&"function"==typeof Ey&&(!("description"in Ey.prototype)||void 0!==Ey().description)){var Iy={},Cy=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Cy?new Ey(e):void 0===e?Ey():Ey(e);return""===e&&(Iy[t]=!0),t};Ty(Cy,Ey);var Ry=Cy.prototype=Ey.prototype;Ry.constructor=Cy;var Oy=Ry.toString,My="Symbol(test)"==String(Ey("test")),Py=/^Symbol\((.*)\)[^)]+$/;Sy(Ry,"description",{configurable:!0,get:function(){var e=_y(this)?this.valueOf():this,t=Oy.call(e);if(xy(Iy,e))return"";var n=My?t.slice(7,-1):t.replace(Py,"$1");return""===n?void 0:n}}),by({global:!0,forced:!0},{Symbol:Cy})}function Ay(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Dy(e,t){if(e){if("string"==typeof e)return Ay(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ay(e,t):void 0}}function jy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||Dy(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}br("iterator");var Ny={exports:{}},Ly=!o((function(){return Object.isExtensible(Object.preventExtensions({}))})),Uy=Ee,By=x,Fy=R,qy=G.f,Wy=Ly,zy=we("meta"),Gy=0,Jy=Object.isExtensible||function(){return!0},Vy=function(e){qy(e,zy,{value:{objectID:"O"+ ++Gy,weakData:{}}})},$y=Ny.exports={REQUIRED:!1,fastKey:function(e,t){if(!By(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Fy(e,zy)){if(!Jy(e))return"F";if(!t)return"E";Vy(e)}return e[zy].objectID},getWeakData:function(e,t){if(!Fy(e,zy)){if(!Jy(e))return!0;if(!t)return!1;Vy(e)}return e[zy].weakData},onFreeze:function(e){return Wy&&$y.REQUIRED&&Jy(e)&&!Fy(e,zy)&&Vy(e),e}};Uy[zy]=!0;var Ky=Xt,Qy=i,Hy=zt,Xy=te.exports,Yy=Ny.exports,Zy=eu,ev=Ns,tv=x,nv=o,rv=uu,iv=_r,av=Tf,ov=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),a=r?"set":"add",o=Qy[e],s=o&&o.prototype,u=o,c={},l=function(e){var t=s[e];Xy(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!tv(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!tv(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!tv(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(Hy(e,"function"!=typeof o||!(i||s.forEach&&!nv((function(){(new o).entries().next()})))))u=n.getConstructor(t,e,r,a),Yy.REQUIRED=!0;else if(Hy(e,!0)){var f=new u,h=f[a](i?{}:-0,1)!=f,d=nv((function(){f.has(1)})),p=rv((function(e){new o(e)})),y=!i&&nv((function(){for(var e=new o,t=5;t--;)e[a](t,t);return!e.has(-0)}));p||((u=t((function(t,n){ev(t,u,e);var i=av(new o,t,u);return null!=n&&Zy(n,i[a],{that:i,AS_ENTRIES:r}),i}))).prototype=s,s.constructor=u),(d||y)&&(l("delete"),l("has"),r&&l("get")),(y||h)&&l(a),i&&s.clear&&delete s.clear}return c[e]=u,Ky({global:!0,forced:u!=o},c),iv(u,e),i||n.setStrong(u,e,r),u},sv=G.f,uv=gn,cv=Os,lv=Tr,fv=Ns,hv=eu,dv=os,pv=js,yv=s,vv=Ny.exports.fastKey,mv=qe.set,gv=qe.getterFor,bv={getConstructor:function(e,t,n,r){var i=e((function(e,a){fv(e,i,t),mv(e,{type:t,index:uv(null),first:void 0,last:void 0,size:0}),yv||(e.size=0),null!=a&&hv(a,e[r],{that:e,AS_ENTRIES:n})})),a=gv(t),o=function(e,t,n){var r,i,o=a(e),u=s(e,t);return u?u.value=n:(o.last=u={index:i=vv(t,!0),key:t,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=u),r&&(r.next=u),yv?o.size++:e.size++,"F"!==i&&(o.index[i]=u)),e},s=function(e,t){var n,r=a(e),i=vv(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return cv(i.prototype,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,yv?e.size=0:this.size=0},delete:function(e){var t=this,n=a(t),r=s(t,e);if(r){var i=r.next,o=r.previous;delete n.index[r.index],r.removed=!0,o&&(o.next=i),i&&(i.previous=o),n.first==r&&(n.first=i),n.last==r&&(n.last=o),yv?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=a(this),r=lv(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),cv(i.prototype,n?{get:function(e){var t=s(this,e);return t&&t.value},set:function(e,t){return o(this,0===e?0:e,t)}}:{add:function(e){return o(this,e=0===e?0:e,e)}}),yv&&sv(i.prototype,"size",{get:function(){return a(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=gv(t),a=gv(r);dv(e,t,(function(e,t){mv(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),pv(t)}};ov("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),bv);var kv={},wv={exports:{}};function xv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}function _v(e){return e&&"object"===ga(e)&&"default"in e?e:{default:e}}!function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0}(wv),Object.defineProperty(kv,"__esModule",{value:!0});var Sv=_v(wv.exports);function Tv(){}function Ev(){Ev.init.call(this)}function Iv(e){return void 0===e._maxListeners?Ev.defaultMaxListeners:e._maxListeners}function Cv(e,t,n){if(t)e.call(n);else for(var r=e.length,i=Nv(e,r),a=0;a<r;++a)i[a].call(n)}function Rv(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,a=Nv(e,i),o=0;o<i;++o)a[o].call(n,r)}function Ov(e,t,n,r,i){if(t)e.call(n,r,i);else for(var a=e.length,o=Nv(e,a),s=0;s<a;++s)o[s].call(n,r,i)}function Mv(e,t,n,r,i,a){if(t)e.call(n,r,i,a);else for(var o=e.length,s=Nv(e,o),u=0;u<o;++u)s[u].call(n,r,i,a)}function Pv(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,a=Nv(e,i),o=0;o<i;++o)a[o].apply(n,r)}function Av(e,t,n,r){var i,a,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]):(a=e._events=new Tv,e._eventsCount=0),o){if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=Iv(e))&&i>0&&o.length>i){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else o=a[t]=n,++e._eventsCount;return e}function Dv(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function jv(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Nv(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}Tv.prototype=Object.create(null),Ev.EventEmitter=Ev,Ev.usingDomains=!1,Ev.prototype.domain=void 0,Ev.prototype._events=void 0,Ev.prototype._maxListeners=void 0,Ev.defaultMaxListeners=10,Ev.init=function(){this.domain=null,Ev.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Tv,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ev.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Ev.prototype.getMaxListeners=function(){return Iv(this)},Ev.prototype.emit=function(e){var t,n,r,i,a,o,s,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=o[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:Cv(n,l,this);break;case 2:Rv(n,l,this,arguments[1]);break;case 3:Ov(n,l,this,arguments[1],arguments[2]);break;case 4:Mv(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),a=1;a<r;a++)i[a-1]=arguments[a];Pv(n,l,this,i)}return!0},Ev.prototype.addListener=function(e,t){return Av(this,e,t,!1)},Ev.prototype.on=Ev.prototype.addListener,Ev.prototype.prependListener=function(e,t){return Av(this,e,t,!0)},Ev.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Dv(this,e,t)),this},Ev.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Dv(this,e,t)),this},Ev.prototype.removeListener=function(e,t){var n,r,i,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new Tv:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Tv,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,o||t)}return this},Ev.prototype.off=function(e,t){return this.removeListener(e,t)},Ev.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Tv,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new Tv:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(r=i[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new Tv,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Ev.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},Ev.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):jv.call(e,t)},Ev.prototype.listenerCount=jv,Ev.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Lv=function(e){ma(n,e);var t=xv(n);function n(e){var r;return xa(this,n),r=t.call(this),Sv.default(ya(r),"timeout",null),Sv.default(ya(r),"startTimestamp",-1),r.minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return pa(n,[{key:"attempt",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.attemptNum++,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt count limit reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((function(){return t.attempt()}),n)}},{key:"cleanup",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){if(this.inProgress)throw new Error("Retrier is already in progress");this.inProgress=!0,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"))}},{key:"succeeded",value:function(e){this.emit("succeeded",e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}}]),n}(Ev),Uv=function(e){ma(n,e);var t=xv(n);function n(e){var r;return xa(this,n),r=t.call(this),Sv.default(ya(r),"resolve",(function(){})),Sv.default(ya(r),"reject",(function(){})),r.retrier=new Lv(e),r}return pa(n,[{key:"run",value:function(e){var t=this;return this.retrier.on("attempt",(function(){e().then((function(e){return t.retrier.succeeded(e)})).catch((function(e){return t.retrier.failed(e)}))})),this.retrier.on("succeeded",(function(e){return t.resolve(e)})),this.retrier.on("cancelled",(function(){return t.reject(new Error("Cancelled"))})),this.retrier.on("failed",(function(e){return t.reject(e)})),new Promise((function(e,n){t.resolve=e,t.reject=n,t.retrier.start()}))}},{key:"cancel",value:function(){this.retrier.cancel()}}]),n}(Ev);function Bv(e){return null!=e}var Fv=function(e){ma(n,e);var t=xv(n);function n(e){var r;xa(this,n),r=t.call(this),Sv.default(ya(r),"backoffDelay",0),Sv.default(ya(r),"nextBackoffDelay",0),Sv.default(ya(r),"backoffNumber",0),Sv.default(ya(r),"timeoutID",null),Sv.default(ya(r),"maxNumberOfRetry",-1);var i=e=e||{},a=i.initialDelay,o=i.maxDelay,s=i.randomisationFactor,u=i.factor;if(Bv(a)&&a<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(Bv(o)&&o<=1)throw new Error("The maximal timeout must be greater than 1.");if(Bv(s)&&(s<0||s>1))throw new Error("The randomisation factor must be between 0 and 1.");if(Bv(u)&&u<=1)throw new Error("Exponential factor should be greater than 1.");if(r.initialDelay=a||100,r.maxDelay=o||1e4,r.maxDelay<=r.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return r.randomisationFactor=s||0,r.factor=u||2,r.reset(),r}return pa(n,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new n(e)}}]),n}(Ev),qv=kv.AsyncRetrier=Uv;kv.Backoff=Fv;var Wv=kv.Retrier=Lv;function zv(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Gv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gv(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Gv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Jv=function(){function e(t,n){xa(this,e),this.configuration=t,this.services=n,this.cache=new Map,this.cacheLifetime=100*this.configuration.httpCacheInterval,this.cleanupCache()}return pa(e,[{key:"isExpired",value:function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{key:"cleanupCache",value:function(){var e,t=zv(this.cache);try{for(t.s();!(e=t.n()).done;){var n=jy(e.value,2),r=n[0],i=n[1];this.isExpired(i.timestamp)&&this.cache.delete(r)}}catch(e){t.e(e)}finally{t.f()}0===this.cache.size&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var e=this;this.timer=this.timer||setInterval((function(){return e.cleanupCache()}),2*this.cacheLifetime)}},{key:"executeWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(r,i){var a=[502,503,504];n&&a.push(429);var o=new Wv(t.configuration.backoffConfiguration);o.on("attempt",(function(){e().then((function(e){return o.succeeded(e)})).catch((function(e){a.indexOf(e.status)>-1||"Twilsock disconnected"===e.message?o.failed(e):(o.removeAllListeners(),o.cancel(),i(e))}))})),o.on("succeeded",(function(e){r(e)})),o.on("cancelled",(function(e){return i(e)})),o.on("failed",(function(e){return i(e)})),o.start()}))}},{key:"get",value:function(){var e=ha(Za.mark((function e(t){var n,r,i,a=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))||this.isExpired(n.timestamp)){e.next=3;break}return e.abrupt("return",n.response);case 3:return r={},e.next=6,this.executeWithRetry((function(){return a.services.transport.get(t,r,a.configuration.productId)}),this.configuration.retryWhenThrottled);case 6:return i=e.sent,this.cache.set(t,{response:i,timestamp:Date.now()}),this.pokeTimer(),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Vv=function e(){xa(this,e)};wa(Vv,"TYPING_INDICATOR","twilio.ipmsg.typing_indicator"),wa(Vv,"NEW_MESSAGE","twilio.channel.new_message"),wa(Vv,"ADDED_TO_CHANNEL","twilio.channel.added_to_channel"),wa(Vv,"INVITED_TO_CHANNEL","twilio.channel.invited_to_channel"),wa(Vv,"REMOVED_FROM_CHANNEL","twilio.channel.removed_from_channel"),wa(Vv,"CONSUMPTION_UPDATE","twilio.channel.consumption_update");var $v={};function Kv(e,t,n){return(Kv="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ka(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}var Qv={},Hv=n(yh),Xv={};Object.defineProperty(Xv,"__esModule",{value:!0});var Yv=Jh.exports.getLogger("twilsock");function Zv(e,t){return["".concat((new Date).toISOString()," Twilsock ").concat(e,":")].concat(Array.from(t))}var em=function(){function e(t){xa(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?" "+t+":":""}return pa(e,[{key:"setLevel",value:function(e){Yv.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Yv.debug.apply(null,Zv("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Yv.debug.apply(null,Zv("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Yv.info.apply(null,Zv("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Yv.warn.apply(null,Zv("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Yv.error.apply(null,Zv("E",t))}}],[{key:"setLevel",value:function(e){Yv.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Yv.trace.apply(null,Zv("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Yv.debug.apply(null,Zv("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Yv.info.apply(null,Zv("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Yv.warn.apply(null,Zv("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Yv.error.apply(null,Zv("E",t))}}]),e}();Xv.Logger=em;var tm=new em("");Xv.log=tm;var nm={};Object.defineProperty(nm,"__esModule",{value:!0});var rm="0.6.2",im=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};xa(this,e),this.confirmedCapabilities=new Set,this.activeGrant=n,this._token=t;var i=r.region||"us1",a="wss://tsock.".concat(i,".twilio.com/v3/wsconnect"),o=r.twilsock||r.Twilsock||{};this.url=o.uri||a,this._continuationToken=r.continuationToken?r.continuationToken:null,this.logLevel=r.logLevel?r.logLevel:"error",this.retryPolicy=r.retryPolicy?r.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=r.clientMetadata?r.clientMetadata:{},this.clientMetadata.ver=rm,this.initRegistrations=r.initRegistrations?r.initRegistrations:null,this.tweaks=r.tweaks?r.tweaks:null}return pa(e,[{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}},{key:"updateToken",value:function(e){this._token=e}},{key:"updateContinuationToken",value:function(e){this._continuationToken=e}}]),e}();nm.Configuration=im;var am={},om={exports:{}};!function(e,t){var n;n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){e.exports=function(e,t){var n,r,i;for(n=1;n<arguments.length;n++)for(i in r=arguments[n])r.hasOwnProperty(i)&&(e[i]=r[i]);return e}},function(e,t,n){var r=n(0);e.exports={build:function(e,t){var n,i,a,o=t.plugins;for(n=0,i=o.length;n<i;n++)(a=o[n]).methods&&r(e,a.methods),a.properties&&Object.defineProperties(e,a.properties)},hook:function(e,t,n){var r,i,a,o,s=e.config.plugins,u=[e.context];for(n&&(u=u.concat(n)),r=0,i=s.length;r<i;r++)o=s[r],(a=s[r][t])&&a.apply(o,u)}}},function(e,t,n){function r(e){if(0===e.length)return e;var t,n,r=e.split(/[_-]/);if(1===r.length&&r[0][0].toLowerCase()===r[0][0])return e;for(n=r[0].toLowerCase(),t=1;t<r.length;t++)n=n+r[t].charAt(0).toUpperCase()+r[t].substring(1).toLowerCase();return n}r.prepended=function(e,t){return e+(t=r(t))[0].toUpperCase()+t.substring(1)},e.exports=r},function(e,t,n){var r=n(0),i=n(2);function a(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}r(a.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=i.prepended("onEnter",e),this.lifecycle.onLeave[e]=i.prepended("onLeave",e),this.lifecycle.on[e]=i.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=i.prepended("onBefore",e),this.lifecycle.onAfter[e]=i.prepended("onAfter",e),this.lifecycle.on[e]=i.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,r=e.to;return this.addState(n),"function"!=typeof r&&this.addState(r),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(r({},this.defaults.init,{to:e,active:!0})):"object"===ga(e)?this.mapTransition(r({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"===ga(e)?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var n,r,i;for(n=0,r=(e=e||[]).length;n<r;n++)"function"==typeof(i=e[n])&&(e[n]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,n,r,i,a,o=this.defaults.wildcard;for(n=0;n<e.length;n++)for(r=e[n],i=Array.isArray(r.from)?r.from:[r.from||o],a=r.to||o,t=0;t<i.length;t++)this.mapTransition({name:r.name,from:i[t],to:a})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=a},function(e,t,n){var r=n(0),i=n(6),a=n(1),o=[null,[]];function s(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}r(s.prototype,{init:function(e){if(r(this.context,this.config.data.apply(this.context,e)),a.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,r=this.config.transitionFor(this.state,e),i=r&&r.to;return"function"==typeof i?i.apply(this.context,t):i===n?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,r){var i=this.config.lifecycle,a=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),r.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),a?this.observersForEvent(i.onLeave.state):o,a?this.observersForEvent(i.onLeave[t]):o,this.observersForEvent(i.on.transition),a?["doTransit",[this]]:o,a?this.observersForEvent(i.onEnter.state):o,a?this.observersForEvent(i.onEnter[n]):o,a?this.observersForEvent(i.on[n]):o,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],r)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,r=this.observers.length,i=[];n<r;n++)(t=this.observers[n])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,n,r){if(0===e.length)return this.endTransit(void 0===r||r);var i=e[0][0],o=e[0][1],s=e[0][2];if(t[0].event=i,i&&s&&i!==n&&a.hook(this,"lifecycle",t),0===o.length)return e.shift(),this.observeEvents(e,t,i,r);var u=o.shift(),c=u[i].apply(u,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,i,c)},onInvalidTransition:function(e,t,n){throw new i("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new i("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=s},function(e,t,n){var r=n(0),i=n(2),a=n(1),o=n(3),s=n(4),u={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},c={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function l(e){return f(this||{},e)}function f(e,t){return h(e,new o(t,l)),e._fsm(),e}function h(e,t){if("object"!==ga(e)||Array.isArray(e))throw Error("StateMachine can only be applied to objects");a.build(e,t),Object.defineProperties(e,c),r(e,u),r(e,t.methods),t.allTransitions().forEach((function(t){e[i(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}})),e._fsm=function(){this._fsm=new s(this,t),this._fsm.init(arguments)}}l.version="3.0.1",l.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new o(t,l);return h(e.prototype,n),e.prototype._fsm.config=n,e},l.apply=f,l.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=l},function(e,t,n){e.exports=function(e,t,n,r,i){this.message=e,this.transition=t,this.from=n,this.to=r,this.current=i}}])},e.exports=n()}(om);var sm={},um={},cm={},lm={exports:{}},fm="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(fm){var hm=new Uint8Array(16);lm.exports=function(){return fm(hm),hm}}else{var dm=new Array(16);lm.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),dm[t]=e>>>((3&t)<<3)&255;return dm}}for(var pm=[],ym=0;ym<256;++ym)pm[ym]=(ym+256).toString(16).substr(1);var vm,mm,gm=function(e,t){var n=t||0,r=pm;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")},bm=lm.exports,km=gm,wm=0,xm=0;var _m=function(e,t,n){var r=t&&n||0,i=t||[],a=(e=e||{}).node||vm,o=void 0!==e.clockseq?e.clockseq:mm;if(null==a||null==o){var s=bm();null==a&&(a=vm=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==o&&(o=mm=16383&(s[6]<<8|s[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:xm+1,l=u-wm+(c-xm)/1e4;if(l<0&&void 0===e.clockseq&&(o=o+1&16383),(l<0||u>wm)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");wm=u,xm=c,mm=o;var f=(1e4*(268435455&(u+=122192928e5))+c)%4294967296;i[r++]=f>>>24&255,i[r++]=f>>>16&255,i[r++]=f>>>8&255,i[r++]=255&f;var h=u/4294967296*1e4&268435455;i[r++]=h>>>8&255,i[r++]=255&h,i[r++]=h>>>24&15|16,i[r++]=h>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var d=0;d<6;++d)i[r+d]=a[d];return t||km(i)},Sm=lm.exports,Tm=gm;var Em=_m,Im=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||Sm)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var a=0;a<16;++a)t[r+a]=i[a];return t||Tm(i)},Cm=Im;Cm.v1=Em,Cm.v4=Im;var Rm=Cm;Object.defineProperty(cm,"__esModule",{value:!0});var Om=Rm;function Mm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}cm.AbstractMessage=function e(t){xa(this,e),this.id=t||"TM".concat(Om.v4())},Object.defineProperty(um,"__esModule",{value:!0});var Pm=function(e){ma(n,e);var t=Mm(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return xa(this,n),(a=t.call(this)).method="init",a.token=e,a.continuation_token=r,a.metadata=i,a.registrations=o,a.tweaks=s,a.capabilities=["client_update","offline_storage","telemetry.v1"],a}return n}(cm.AbstractMessage);um.Init=Pm;var Am={};function Dm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(Am,"__esModule",{value:!0});var jm=cm;Am.ContinuationTokenStatus=function e(){xa(this,e)};var Nm=function(e){ma(n,e);var t=Dm(n);function n(e,r,i,a,o,s,u){var c;return xa(this,n),(c=t.call(this,e)).continuationToken=r,c.continuationTokenStatus=i,c.offlineStorage=a,c.initRegistrations=o,c.debugInfo=s,c.confirmedCapabilities=u,c}return n}(jm.AbstractMessage);Am.InitReply=Nm;var Lm={};function Um(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(Lm,"__esModule",{value:!0});var Bm=function(e){ma(n,e);var t=Um(n);function n(e){var r;return xa(this,n),(r=t.call(this)).method="update",r.token=e,r}return n}(cm.AbstractMessage);Lm.Update=Bm;var Fm={};function qm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(Fm,"__esModule",{value:!0});var Wm=function(e){ma(Message,e);var t=qm(Message);function Message(e,n,r){var i;return xa(this,Message),(i=t.call(this)).method="message",i.active_grant=e,i.payload_type=n,i.http_request=r,i}return Message}(cm.AbstractMessage);Fm.Message=Wm;var zm={};function Gm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(zm,"__esModule",{value:!0});var Jm=function(e){ma(n,e);var t=Gm(n);function n(e){var r;return xa(this,n),(r=t.call(this,e)).method="reply",r.payload_type="application/json",r.status={code:200,status:"OK"},r}return n}(cm.AbstractMessage);zm.Reply=Jm;var Vm={};function $m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(Vm,"__esModule",{value:!0});var Km=function(e){ma(n,e);var t=$m(n);function n(){var e;return xa(this,n),(e=t.call(this)).method="close",e}return n}(cm.AbstractMessage);Vm.Close=Km;var Qm={};function Hm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(Qm,"__esModule",{value:!0});var Xm=cm;Qm.TelemetryEvent=function e(t,n,r,i,a,o){xa(this,e),this.start=t,this.end=n,this.title=r,this.details=i,this.id=a,this.type=o};var Ym=function(e){ma(n,e);var t=Hm(n);function n(e){var r;return xa(this,n),(r=t.call(this)).method="telemetry.v1",r.events=e,r}return n}(Xm.AbstractMessage);Qm.Telemetry=Ym,Object.defineProperty(sm,"__esModule",{value:!0});var Zm=um;sm.Init=Zm.Init;var eg=Am;sm.InitReply=eg.InitReply;var tg=Lm;sm.Update=tg.Update;var ng=Fm;sm.Message=ng.Message;var rg=zm;sm.Reply=rg.Reply;var ig=Vm;sm.Close=ig.Close;var ag=Qm;sm.Telemetry=ag.Telemetry;var og={};Object.defineProperty(og,"__esModule",{value:!0});var sg=Xv;function ug(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})).length}function cg(e){var t=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,(function(e,t){n[t]=e.charCodeAt(0)})),n}function lg(e){var t=Array.prototype.map.call(e,(function(e){return String.fromCharCode(e)})).join("").replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}));return decodeURIComponent(t)}function fg(e){return JSON.parse(lg(e))}var hg=function(){function e(){xa(this,e)}return pa(e,null,[{key:"parse",value:function(e){var t=new Uint8Array(e),n=function(e){for(var t="",n=0;n<e.length;++n){var r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}var i=t.split(" ");return{size:n,protocol:i[0],version:i[1],headerSize:Number(i[2])}}(t);if("TWILSOCK"===n.protocol&&"V3.0"===n.version){var r=null;try{r=fg(t.subarray(n.size,n.size+n.headerSize))}catch(t){return void sg.log.error("failed to parse message header",t,e)}sg.log.debug("message received: ",r.method),sg.log.trace("message received: ",r);var i=null;if(r.payload_size>0){var a=2+n.size+n.headerSize,o=r.payload_size;if(r.hasOwnProperty("payload_type")&&0!==r.payload_type.indexOf("application/json"))0===r.payload_type.indexOf("text/plain")&&(i=lg(t.subarray(a,a+o)));else try{i=fg(t.subarray(a,a+o))}catch(t){return void sg.log.error("failed to parse message body",t,e)}}return{method:r.method,header:r,payload:i}}sg.log.error("unsupported protocol: ".concat(n.protocol," ver ").concat(n.version))}},{key:"createPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=ug(t);var n=JSON.stringify(e)+"\r\n",r="TWILSOCK V3.0 "+(ug(n)-2)+"\r\n";sg.log.debug("send request:",r+n+t);var i=cg(r+n+t);return i.buffer}}]),e}();og.Parser=hg;var dg={};function pg(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function yg(e,t,n){return(yg=pg()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&va(i,n.prototype),i}).apply(null,arguments)}function vg(e){var t="function"==typeof Map?new Map:void 0;return(vg=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return yg(e,arguments,ka(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),va(r,e)})(e)}var mg={};function gg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(mg,"__esModule",{value:!0});var bg=function(e){ma(n,e);var t=gg(n);function n(e){return xa(this,n),t.call(this,e)}return n}(vg(Error));function kg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}mg.TwilsockError=bg,Object.defineProperty(dg,"__esModule",{value:!0});var wg=function(e){ma(n,e);var t=kg(n);function n(e,r){var i;return xa(this,n),(i=t.call(this,e)).reply=r,i}return n}(mg.TwilsockError);dg.TwilsockReplyError=wg;var xg={},_g={},Sg={};function Tg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(Sg,"__esModule",{value:!0});var Eg=function(e){ma(n,e);var t=Tg(n);function n(e){var r;return xa(this,n),(r=t.call(this)).minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return pa(n,[{key:"attempt",value:function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),void this.reject(new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((function(){return t.attempt()}),n)}},{key:"cleanup",value:function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise((function(t,n){e.resolve=t,e.reject=n,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)}))}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}},{key:"succeeded",value:function(e){this.emit("succeeded",e),this.resolve(e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}},{key:"run",value:function(e){var t=this;return this.on("attempt",(function(){e().then((function(e){return t.succeeded(e)})).catch((function(e){return t.failed(e)}))})),this.start()}}]),n}(Hv.EventEmitter);Sg.Retrier=Eg,Sg.default=Eg;var Ig={};function Cg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}function Rg(e){return null!=e}Object.defineProperty(Ig,"__esModule",{value:!0});var Og=function(e){ma(n,e);var t=Cg(n);function n(e){var r;if(xa(this,n),r=t.call(this),Rg((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(Rg(e.maxDelay)&&e.maxDelay<=1)throw new Error("The maximal timeout must be greater than 1.");if(Rg(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");if(Rg(e.factor)&&e.factor<=1)throw new Error("Exponential factor should be greater than 1.");if(r.initialDelay=e.initialDelay||100,r.maxDelay=e.maxDelay||1e4,r.maxDelay<=r.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return r.randomisationFactor=e.randomisationFactor||0,r.factor=e.factor||2,r.maxNumberOfRetry=-1,r.reset(),r}return pa(n,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new n(e)}}]),n}(Hv.EventEmitter);Ig.Backoff=Og,Ig.default=Og,Object.defineProperty(_g,"__esModule",{value:!0});var Mg=Sg;_g.Retrier=Mg.Retrier;var Pg=Ig;function Ag(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}_g.Backoff=Pg.Backoff,_g.default=Mg.Retrier,Object.defineProperty(xg,"__esModule",{value:!0});var Dg=_g,jg=function(e){ma(n,e);var t=Ag(n);function n(e){var r;return xa(this,n),(r=t.call(this)).options=e?Object.assign({},e):{},r}return pa(n,[{key:"inProgress",get:function(){return!!this.retrier}},{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(e){this.newBackoff=e}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");this.newBackoff?!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():this.retrier.failed(new Error):this.retrier.failed(new Error)}},{key:"cancel",value:function(){this.retrier&&this.retrier.cancel()}},{key:"cleanRetrier",value:function(){this.retrier&&(this.retrier.removeAllListeners(),this.retrier.cancel(),this.retrier=null)}},{key:"getRetryPolicy",value:function(){var e=Object.assign({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}},{key:"createRetrier",value:function(){var e=this;this.cleanRetrier();var t=this.getRetryPolicy();this.retrier=new Dg.Retrier(t),this.retrier.once("attempt",(function(){e.retrier.on("attempt",(function(){return e.emit("attempt")})),e.retrier.failed(new Error("Skipping first attempt"))})),this.retrier.on("failed",(function(t){return e.emit("failed",t)})),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start().catch((function(e){}))}}]),n}(Hv.EventEmitter);function Ng(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}xg.BackoffRetrier=jg,Object.defineProperty(am,"__esModule",{value:!0});var Lg=Hv,Ug=om.exports,Bg=Xv,Fg=sm,qg=og,Wg=dg,zg=xg;am.Response=function e(){xa(this,e)};var Gg=function(e){ma(i,e);var t,n,r=Ng(i);function i(e,t,n){var a;return xa(this,i),(a=r.call(this)).terminalStates=["disconnected","rejected"],a.lastEmittedState=void 0,a.tokenExpiredSasCode=20104,a.terminationReason="Connection is not initialized",a.websocket=e,a.websocket.on("connected",(function(){return a.fsm.socketConnected()})),a.websocket.on("disconnected",(function(e){return a.fsm.socketClosed()})),a.websocket.on("message",(function(e){return a.onIncomingMessage(e)})),a.websocket.on("socketError",(function(e){return a.emit("connectionError",{terminal:!1,message:"Socket error: ".concat(e.message),httpStatusCode:null,errorCode:null})})),a.transport=t,a.config=n,a.retrier=new zg.BackoffRetrier(n.retryPolicy),a.retrier.on("attempt",(function(){return a.retry()})),a.retrier.on("failed",(function(e){Bg.log.warn("Retrying failed: ".concat(e.message)),a.disconnect()})),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",(function(){Bg.log.debug("Browser reported connectivity state: online"),a.resetBackoff(),a.fsm.systemOnline()})),window.addEventListener("offline",(function(){Bg.log.debug("Browser reported connectivity state: offline"),a.websocket.close(),a.fsm.socketClosed()}))),a.fsm=new Ug({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){a.setupSocket(),a.emit("connecting")},onEnterInitialising:function(){a.sendInit()},onLeaveInitialising:function(){a.cancelInit()},onEnterUpdating:function(){a.sendUpdate()},onLeaveUpdating:function(){a.cancelUpdate()},onEnterRetrying:function(){a.initRetry(),a.emit("connecting")},onEnterConnected:function(){a.resetBackoff(),a.onConnected()},onUserUpdateToken:function(){a.resetBackoff()},onTokenRejected:function(){a.resetBackoff(),a.closeSocket(!0),a.finalizeSocket()},onUserDisconnect:function(){a.closeSocket(!0)},onEnterDisconnecting:function(){a.startDisconnectTimer()},onLeaveDisconnecting:function(){a.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){a.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){a.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){a.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){a.cancelDisconnectTimer()},onDisconnected:function(){a.resetBackoff(),a.finalizeSocket()},onReceiveClose:function(e,t){a.onCloseReceived(t)},onReceiveOffload:function(e,t){Bg.log.debug("onreceiveoffload: ",t),a.modifyBackoff(t.body),a.onCloseReceived(t.status)},onUnsupported:function(){a.closeSocket(!0),a.finalizeSocket()},onError:function(e,t){a.closeSocket(t),a.finalizeSocket()},onEnterState:function(e){"none"!==e.from&&a.changeState(e)},onInvalidTransition:function(e,t,n){Bg.log.warn("FSM: unexpected transition",t,n)}}}),a}return pa(i,[{key:"changeState",value:function(e){Bg.log.debug("FSM: ".concat(e.transition,": ").concat(e.from," --\x3e ").concat(e.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){Bg.log.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(e){Bg.log.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}},{key:"startDisconnectTimer",value:function(){var e=this;Bg.log.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout((function(){Bg.log.debug("disconnecting is timed out"),e.closeSocket(!0)}),3e3)}},{key:"cancelDisconnectTimer",value:function(){Bg.log.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"isConnected",get:function(){return"connected"===this.state&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"rejected";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{key:"initRetry",value:function(){Bg.log.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{key:"retry",value:function(){"connecting"!=this.fsm.state?(Bg.log.trace("retry"),this.websocket.close(),this.fsm.userRetry()):Bg.log.trace("can\t retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){Bg.log.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){Bg.log.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}},{key:"onIncomingMessage",value:function(e){var t=qg.Parser.parse(e),n=t.method,r=t.header,i=t.payload;if("reply"!==n&&this.confirmReceiving(r),"notification"===n)this.emit("message",r.message_type,i);else if("reply"===r.method)this.transport.processReply({id:r.id,status:r.status,header:r,body:i});else if("client_update"===r.method)"token_about_to_expire"===r.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===r.method)if(308===r.status.code)Bg.log.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:r.status.status,body:i});else if(406===r.status.code){var a="Server closed connection because can't parse protocol: ".concat(JSON.stringify(r.status));this.emitReplyConnectionError(a,r,!0),Bg.log.error(a),this.fsm.receiveFatalClose()}else 417===r.status.code?(Bg.log.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify(r.status))),this.fsm.receiveFatalClose(r.status.status)):410===r.status.code?(Bg.log.warn("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status),this.emit("tokenExpired")):401===r.status.code?(Bg.log.error("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status)):(Bg.log.warn("unexpected message: ",r.status),this.fsm.receiveOffload({status:r.status.status,body:null}))}},{key:"sendInit",value:(n=ha(Za.mark((function e(){var t,n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Bg.log.trace("sendInit"),e.prev=1,this.emit("beforeSendInit"),e.next=5,this.transport.sendInit();case 5:t=e.sent,this.config.updateContinuationToken(t.continuationToken),this.config.confirmedCapabilities=t.confirmedCapabilities,this.fsm.initSuccess(t),this.emit("initialized",t),this.emit("tokenUpdated"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),e.t0 instanceof Wg.TwilsockReplyError?(n=!1,Bg.log.warn("Init rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),this.emit("sendInitFailed"),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(n=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.initError(!0)):500===e.t0.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(e.t0.message,e.t0.reply,n)):(this.terminationReason=e.t0.message,this.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: ".concat(e.t0.message,"\n").concat(JSON.stringify(e.t0,null,2)),httpStatusCode:null,errorCode:null}),this.fsm.initError(!0)),this.emit("tokenUpdated",e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(){return n.apply(this,arguments)})},{key:"sendUpdate",value:(t=ha(Za.mark((function e(){var t,n,r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Bg.log.trace("sendUpdate"),t=new Fg.Update(this.config.token),e.prev=2,e.next=5,this.transport.sendWithReply(t);case 5:n=e.sent,this.fsm.updateSuccess(n.body),this.emit("tokenUpdated"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0 instanceof Wg.TwilsockReplyError?(r=!1,Bg.log.warn("Token update rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(r=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0.reply.status),this.emitReplyConnectionError(e.t0.message,e.t0.reply,r)):(this.emit("error",!1,e.t0.message,null,null),this.fsm.updateError(e.t0)),this.emit("tokenUpdated",e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(){return t.apply(this,arguments)})},{key:"emitReplyConnectionError",value:function(e,t,n){var r=t.status&&t.status.description?t.status.description:e,i=t.status.code,a=t.status&&t.status.errorCode?t.status.errorCode:null;n&&(this.terminationReason=r),this.emit("connectionError",{terminal:n,message:"Connection error: ".concat(r),httpStatusCode:i,errorCode:a})}},{key:"cancelInit",value:function(){Bg.log.trace("cancelInit")}},{key:"cancelUpdate",value:function(){Bg.log.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(e){Bg.log.trace("confirmReceiving");try{this.transport.send(new Fg.Reply(e.id))}catch(e){Bg.log.debug("failed to confirm packet receiving",e)}}},{key:"closeSocket",value:function(e){var t=this;Bg.log.trace("closeSocket (graceful: ".concat(e,")")),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout((function(){return t.fsm.socketClosed()}),0)}},{key:"connect",value:function(){Bg.log.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return Bg.log.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise((function(t){e.disconnectedPromiseResolve=t,e.fsm.userDisconnect()}))}},{key:"updateToken",value:function(e){var t=this;return Bg.log.trace("updateToken:",e),new Promise((function(e,n){t.once("tokenUpdated",(function(t){t?n(t):e()})),t.fsm.userUpdateToken()}))}},{key:"isTerminalState",get:function(){return-1!==this.terminalStates.indexOf(this.fsm.state)}},{key:"getTerminationReason",get:function(){return this.terminationReason}},{key:"onCloseReceived",value:function(e){this.websocket.close()}}]),i}(Lg.EventEmitter);am.TwilsockChannel=Gg,am.TwilsockImpl=Gg;var Jg={},Vg={},$g={exports:{}};!function(e,n){(function(){var r={function:!0,object:!0}["undefined"==typeof window?"undefined":ga(window)]&&window||this,i=n,a=e&&!e.nodeType&&e,o=i&&a&&"object"==ga(t)&&t;!o||o.global!==o&&o.window!==o&&o.self!==o||(r=o);var s=Math.pow(2,53)-1,u=/\bOpera/,c=Object.prototype,l=c.hasOwnProperty,f=c.toString;function h(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function d(e){return e=g(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:h(e)}function p(e,t){for(var n in e)l.call(e,n)&&t(e[n],n,e)}function y(e){return null==e?h(e):f.call(e).slice(8,-1)}function v(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function m(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=s)for(;++n<r;)t(e[n],n,e);else p(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function g(e){return String(e).replace(/^ +| +$/g,"")}var b=function e(t){var n=r,i=t&&"object"==ga(t)&&"String"!=y(t);i&&(n=t,t=null);var a=n.navigator||{},o=a.userAgent||"";t||(t=o);var s,c,l=i?!!a.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(f.toString()),h="Object",b=i?h:"ScriptBridgingProxyObject",k=i?h:"Environment",w=i&&n.java?"JavaPackage":y(n.java),x=i?h:"RuntimeObject",_=/\bJava/.test(w)&&n.java,S=_&&y(n.environment)==k,T=_?"a":"α",E=_?"b":"β",I=n.document||{},C=n.operamini||n.opera,R=u.test(R=i&&C?C["[[Class]]"]:y(C))?R:C=null,O=t,M=[],P=null,A=t==o,D=A&&C&&"function"==typeof C.version&&C.version(),j=m([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||v(n))+"\\b","i").exec(t)&&(n.label||n)})),N=function(e){return m(e,(function(e,n){return e||RegExp("\\b"+(n.pattern||v(n))+"\\b","i").exec(t)&&(n.label||n)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),L=F([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),U=function(e){return m(e,(function(e,n,r){return e||(n[L]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(L)]||RegExp("\\b"+v(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),B=function(e){return m(e,(function(e,n){var r=n.pattern||v(n);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),d(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,n.label||n)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function F(e){return m(e,(function(e,n){var r=n.pattern||v(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=d(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function q(e){return m(e,(function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(j&&(j=[j]),/\bAndroid\b/.test(B)&&!L&&(s=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(L=g(s[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),U&&!L?L=F([U]):U&&L&&(L=L.replace(RegExp("^("+v(U)+")[-_.\\s]","i"),U+" ").replace(RegExp("^("+v(U)+")[-_.]?(\\w)","i"),U+" $2")),(s=/\bGoogle TV\b/.exec(L))&&(L=s[0]),/\bSimulator\b/i.test(t)&&(L=(L?L+" ":"")+"Simulator"),"Opera Mini"==N&&/\bOPiOS\b/.test(t)&&M.push("running in Turbo/Uncompressed mode"),"IE"==N&&/\blike iPhone OS\b/.test(t)?(U=(s=e(t.replace(/like iPhone OS/,""))).manufacturer,L=s.product):/^iP/.test(L)?(N||(N="Safari"),B="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"==N&&/^Linux\b/i.test(B)?B="Kubuntu":U&&"Google"!=U&&(/Chrome/.test(N)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(L))||/\bAndroid\b/.test(B)&&/^Chrome/.test(N)&&/\bVersion\//i.test(t)?(N="Android Browser",B=/\bAndroid\b/.test(B)?B:"Android"):"Silk"==N?(/\bMobi/i.test(t)||(B="Android",M.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&M.unshift("accelerated")):"UC Browser"==N&&/\bUCWEB\b/.test(t)?M.push("speed mode"):"PaleMoon"==N&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?M.push("identifying as Firefox "+s[1]):"Firefox"==N&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(B||(B="Firefox OS"),L||(L=s[1])):!N||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(N))?(N&&!L&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(N=null),(s=L||U||B)&&(L||U||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(B))&&(N=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(B)?B:s)+" Browser")):"Electron"==N&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&M.push("Chromium "+s),D||(D=q(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",v(N),"(?:Firefox|Minefield|NetFront)"])),(s=("iCab"==j&&parseFloat(D)>3?"WebKit":/\bOpera\b/.test(N)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(j)&&"WebKit"||!j&&/\bMSIE\b/i.test(t)&&("Mac OS"==B?"Tasman":"Trident")||"WebKit"==j&&/\bPlayStation\b(?! Vita\b)/i.test(N)&&"NetFront")&&(j=[s]),"IE"==N&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(N+=" Mobile",B="Windows Phone "+(/\+$/.test(s)?s:s+".x"),M.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(N="IE Mobile",B="Windows Phone 8.x",M.unshift("desktop mode"),D||(D=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=N&&"Trident"==j&&(s=/\brv:([\d.]+)/.exec(t))&&(N&&M.push("identifying as "+N+(D?" "+D:"")),N="IE",D=s[1]),A){if(function(e,t){var n=null!=e?ga(e[t]):"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}(n,"global"))if(_&&(O=(s=_.lang.System).getProperty("os.arch"),B=B||s.getProperty("os.name")+" "+s.getProperty("os.version")),S){try{D=n.require("ringo/engine").version.join("."),N="RingoJS"}catch(e){(s=n.system)&&s.global.system==n.system&&(N="Narwhal",B||(B=s[0].os||null))}N||(N="Rhino")}else"object"==ga(n.process)&&!n.process.browser&&(s=n.process)&&("object"==ga(s.versions)&&("string"==typeof s.versions.electron?(M.push("Node "+s.versions.node),N="Electron",D=s.versions.electron):"string"==typeof s.versions.nw&&(M.push("Chromium "+D,"Node "+s.versions.node),N="NW.js",D=s.versions.nw)),N||(N="Node.js",O=s.arch,B=s.platform,D=(D=/[\d.]+/.exec(s.version))?D[0]:null));else y(s=n.runtime)==b?(N="Adobe AIR",B=s.flash.system.Capabilities.os):y(s=n.phantom)==x?(N="PhantomJS",D=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof I.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(D=[D,I.documentMode],(s=+s[1]+4)!=D[1]&&(M.push("IE "+D[1]+" mode"),j&&(j[1]=""),D[1]=s),D="IE"==N?String(D[1].toFixed(1)):D[0]):"number"==typeof I.documentMode&&/^(?:Chrome|Firefox)\b/.test(N)&&(M.push("masking as "+N+" "+D),N="IE",D="11.0",j=["Trident"],B="Windows");B=B&&d(B)}if(D&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(D)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(A&&a.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(P=/b/i.test(s)?"beta":"alpha",D=D.replace(RegExp(s+"\\+?$"),"")+("beta"==P?E:T)+(/\d+\+?/.exec(s)||"")),"Fennec"==N||"Firefox"==N&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(B))N="Firefox Mobile";else if("Maxthon"==N&&D)D=D.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(L))"Xbox 360"==L&&(B=null),"Xbox 360"==L&&/\bIEMobile\b/.test(t)&&M.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(N)&&(!N||L||/Browser|Mobi/.test(N))||"Windows CE"!=B&&!/Mobi/i.test(t))if("IE"==N&&A)try{null===n.external&&M.unshift("platform preview")}catch(e){M.unshift("embedded")}else(/\bBlackBerry\b/.test(L)||/\bBB10\b/.test(t))&&(s=(RegExp(L.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||D)?(B=((s=[s,/BB10/.test(t)])[1]?(L=null,U="BlackBerry"):"Device Software")+" "+s[0],D=null):this!=p&&"Wii"!=L&&(A&&C||/Opera/.test(N)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==N&&/\bOS X (?:\d+\.){2,}/.test(B)||"IE"==N&&(B&&!/^Win/.test(B)&&D>5.5||/\bWindows XP\b/.test(B)&&D>8||8==D&&!/\bTrident\b/.test(t)))&&!u.test(s=e.call(p,t.replace(u,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),u.test(N)?(/\bIE\b/.test(s)&&"Mac OS"==B&&(B=null),s="identify"+s):(s="mask"+s,N=R?d(R.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(B=null),A||(D=null)),j=["Presto"],M.push(s));else N+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==N&&"+"==s[1].slice(-1)?(N="WebKit Nightly",P="alpha",D=s[1].slice(0,-1)):D!=s[1]&&D!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(D=null),s[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==j&&(j=["Blink"]),A&&(l||s[1])?(j&&(j[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=j?"27":"28")):(j&&(j[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:s<602?9:s<604?10:s<606?11:s<608?12:"12"),j&&(j[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==N&&(!D||parseInt(D)>45)?D=s:"Chrome"==N&&/\bHeadlessChrome/i.test(t)&&M.unshift("headless")),"Opera"==N&&(s=/\bzbov|zvav$/.exec(B))?(N+=" ",M.unshift("desktop mode"),"zvav"==s?(N+="Mini",D=null):N+="Mobile",B=B.replace(RegExp(" *"+s+"$"),"")):"Safari"==N&&/\bChrome\b/.exec(j&&j[1])?(M.unshift("desktop mode"),N="Chrome Mobile",D=null,/\bOS X\b/.test(B)?(U="Apple",B="iOS 4.3+"):B=null):/\bSRWare Iron\b/.test(N)&&!D&&(D=q("Chrome")),D&&0==D.indexOf(s=/[\d.]+$/.exec(B))&&t.indexOf("/"+s+"-")>-1&&(B=g(B.replace(s,""))),B&&-1!=B.indexOf(N)&&!RegExp(N+" OS").test(B)&&(B=B.replace(RegExp(" *"+v(N)+" *"),"")),j&&!/\b(?:Avant|Nook)\b/.test(N)&&(/Browser|Lunascape|Maxthon/.test(N)||"Safari"!=N&&/^iOS/.test(B)&&/\bSafari\b/.test(j[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(N)&&j[1])&&(s=j[j.length-1])&&M.push(s),M.length&&(M=["("+M.join("; ")+")"]),U&&L&&L.indexOf(U)<0&&M.push("on "+U),L&&M.push((/^on /.test(M[M.length-1])?"":"on ")+L),B&&(s=/ ([\d.+]+)$/.exec(B),c=s&&"/"==B.charAt(B.length-s[0].length-1),B={architecture:32,family:s&&!c?B.replace(s[0],""):B,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(O))&&!/\bi686\b/i.test(O)?(B&&(B.architecture=64,B.family=B.family.replace(RegExp(" *"+s),"")),N&&(/\bWOW64\b/i.test(t)||A&&/\w(?:86|32)$/.test(a.cpuClass||a.platform)&&!/\bWin64; x64\b/i.test(t))&&M.unshift("32-bit")):B&&/^OS X/.test(B.family)&&"Chrome"==N&&parseFloat(D)>=39&&(B.architecture=64),t||(t=null);var W={};return W.description=t,W.layout=j&&j[0],W.manufacturer=U,W.name=N,W.prerelease=P,W.product=L,W.ua=t,W.version=N&&D,W.os=B||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=e,W.toString=function(){return this.description||""},W.version&&M.unshift(D),W.name&&M.unshift(N),B&&N&&(B!=String(B).split(" ")[0]||B!=N.split(" ")[0]&&!L)&&M.push(L?"("+B+")":"on "+B),M.length&&(W.description=M.join(" ")),W}();i&&a?p(b,(function(e,t){i[t]=e})):r.platform=b}).call(t)}($g,$g.exports),Object.defineProperty(Vg,"__esModule",{value:!0});var Kg=$g.exports,Qg=function(){function e(){xa(this,e)}return pa(e,null,[{key:"getMetadata",value:function(e){"undefined"!=typeof navigator&&Kg.parse(navigator.userAgent);var t=e&&e.clientMetadata?e.clientMetadata:{},n={env:Kg.name,envv:Kg.version,os:Kg.os.family,osv:Kg.os.version,osa:Kg.os.architecture,sdk:"js-default"},r={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter((function(e){return e in t||e in n})).forEach((function(e){return r[e]=e in t?t[e]:n[e]})),r}}]),e}();Vg.Metadata=Qg,Object.defineProperty(Jg,"__esModule",{value:!0});var Hg=Xv,Xg=Rm,Yg=mg,Zg=dg,eb=og,tb=sm,nb=Vg;Jg.PacketResponse=function e(){xa(this,e)};var rb=function(){function e(t,n){var r=this;xa(this,e),this.config=n,this.activeRequests=new Map,this.channel=t,this.channel.on("reply",(function(e){return r.processReply(e)})),this.channel.on("disconnected",(function(){r.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new Yg.TwilsockError("disconnected"))})),r.activeRequests.clear()}))}var t;return pa(e,[{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"processReply",value:function(e){var t,n=this.activeRequests.get(e.id);n&&(clearTimeout(n.timeout),this.activeRequests.delete(e.id),(t=e.status.code)>=200&&t<300?n.resolve(e):(n.reject(new Zg.TwilsockReplyError("Transport failure: "+e.status.status,e)),Hg.log.trace("message rejected")))}},{key:"storeRequest",value:function(e,t,n){var r={resolve:t,reject:n,timeout:setTimeout((function(){Hg.log.trace("request",e,"is timed out"),n(new Yg.TwilsockError("Twilsock: request timeout: "+e))}),3e4)};this.activeRequests.set(e,r)}},{key:"shutdown",value:function(){this.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new Yg.TwilsockError("Twilsock: request cancelled by user"))})),this.activeRequests.clear()}},{key:"sendInit",value:(t=ha(Za.mark((function e(){var t,n,r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Hg.log.trace("sendInit"),t=nb.Metadata.getMetadata(this.config),n=new tb.Init(this.config.token,this.config.continuationToken,t,this.config.initRegistrations,this.config.tweaks),e.next=5,this.sendWithReply(n);case 5:return r=e.sent,e.abrupt("return",new tb.InitReply(r.id,r.header.continuation_token,r.header.continuation_token_status,r.header.offline_storage,r.header.init_registrations,r.header.debug_info,new Set(r.header.capabilities)));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"sendClose",value:function(){var e=new tb.Close;this.send(e)}},{key:"sendWithReply",value:function(e,t){var n=this;return new Promise((function(r,i){var a=n.send(e,t);n.storeRequest(a,r,i)}))}},{key:"send",value:function(e,t){e.id=e.id||"TM".concat(Xg.v4());var n=eb.Parser.createPacket(e,function(e){switch(ga(e)){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(t){throw Hg.log.debug("failed to send ",e,t),Hg.log.trace(t.stack),t}}}]),e}();Jg.PacketInterface=rb;var ib={},ab=n(Object.freeze({__proto__:null,default:{}}));function ob(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(ib,"__esModule",{value:!0});var sb=Xv,ub=function(e){ma(r,e);var n=ob(r);function r(e){var i;return xa(this,r),(i=n.call(this)).url=e,i.WebSocket=t.WebSocket||t.MozWebSocket||ab,i}return pa(r,[{key:"isConnected",get:function(){return this.socket&&1===this.socket.readyState}},{key:"connect",value:function(){var e,t=this;sb.log.trace("connecting to socket");try{e=new this.WebSocket(this.url)}catch(e){return sb.log.debug("Socket error: ".concat(this.url)),void this.emit("socketError",e)}e.binaryType="arraybuffer",e.onopen=function(){sb.log.debug("socket opened ".concat(t.url)),t.emit("connected")},e.onclose=function(e){sb.log.debug("socket closed",e),t.emit("disconnected",e)},e.onerror=function(e){sb.log.debug("Socket error:",e),t.emit("socketError",e)},e.onmessage=function(e){t.emit("message",e.data)},this.socket=e}},{key:"send",value:function(e){this.socket.send(e)}},{key:"close",value:function(){if(sb.log.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}]),r}(Hv.EventEmitter);ib.WebSocketChannel=ub;var cb={};function lb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(cb,"__esModule",{value:!0});var fb=Xv,hb=Rm,db=mg,pb=function(e){ma(o,e);var t,n,r,i,a=lb(o);function o(e){var t;return xa(this,o),(t=a.call(this)).transport=e,t.registrations=new Map,t.registrationsInProgress=new Map,t}return pa(o,[{key:"putNotificationContext",value:(i=ha(Za.mark((function e(t,n){var r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"put_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(r,n);case 3:case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"deleteNotificationContext",value:(r=ha(Za.mark((function e(t){var n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"delete_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(n);case 3:case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateRegistration",value:(n=ha(Za.mark((function e(t,n){var r,i;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fb.log.debug("update registration for context",t),(r=this.registrationsInProgress.get(t))||(r=new Set,this.registrationsInProgress.set(t,r)),i=hb.v4(),r.add(i),e.prev=5,e.next=8,this.putNotificationContext(t,n);case 8:fb.log.debug("registration attempt succeeded for context",n),r.delete(i),0===r.size&&(this.registrationsInProgress.delete(t),this.emit("registered",t)),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(5),fb.log.warn("registration attempt failed for context",n),fb.log.debug(e.t0),r.delete(i),0===r.size&&(this.registrationsInProgress.delete(t),this.emit("registrationFailed",t,e.t0));case 19:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(e,t){return n.apply(this,arguments)})},{key:"updateRegistrations",value:function(){var e=this;fb.log.trace("refreshing ".concat(this.registrations.size," registrations")),this.registrations.forEach((function(t,n){e.updateRegistration(n,t)}))}},{key:"setNotificationsContext",value:function(e,t){if(!e||!t)throw new db.TwilsockError("Invalid arguments provided");this.registrations.set(e,t),this.transport.isConnected&&this.updateRegistration(e,t)}},{key:"removeNotificationsContext",value:(t=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrations.has(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.deleteNotificationContext(t);case 4:this.transport.isConnected&&this.registrations.delete(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),o}(Hv.EventEmitter);cb.Registrations=pb;var yb={},vb={};function mb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(vb,"__esModule",{value:!0});var gb=function(e){ma(n,e);var t=mb(n);function n(e,r,i){var a;return xa(this,n),(a=t.call(this,r)).status=e,a.description=r,a.body=i,a}return n}(mg.TwilsockError);vb.TwilsockUpstreamError=gb;var bb={};function kb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(bb,"__esModule",{value:!0});var wb=function(e){ma(n,e);var t=kb(n);function n(e){return xa(this,n),t.call(this,e)}return n}(mg.TwilsockError);bb.TransportUnavailableError=wb,Object.defineProperty(yb,"__esModule",{value:!0});var xb=Xv,_b=mg,Sb=vb,Tb=sm,Eb=bb;function Ib(e,t){var n=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:null};if(n.search.length>0){var r=n.search.substring(1);n.params=r.split("&").map((function(e){return e.split("=")})).reduce((function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e}),{})}return n}throw new _b.TwilsockError("Incorrect URI: "+e)}(t),r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}function Cb(e,t,n,r,i){return{to:Ib(e,t),headers:n,body:r,grant:i}}var Rb=function(){function e(t,n,r){xa(this,e),this.config=r,this.transport=t,this.pendingMessages=[],this.twilsock=n}var t;return pa(e,[{key:"saveMessage",value:function(e){var t=this;return new Promise((function(n,r){var i={message:e,resolve:n,reject:r,alreadyRejected:!1,timeout:setTimeout((function(){xb.log.debug("request is timed out"),r(new _b.TwilsockError("request '".concat(e.to.method,"' to '").concat(e.to.host,"' timed out"))),i.alreadyRejected=!0}),2e4)};t.pendingMessages.push(i)}))}},{key:"sendPendingMessages",value:function(){for(var e=this,t=function(){var t=e.pendingMessages[0];if(!t.alreadyRejected)try{var n=t.message;e.actualSend(n).then((function(e){return t.resolve(e)})).catch((function(e){return t.reject(e)})),clearTimeout(t.timeout)}catch(e){return xb.log.debug("Failed to send pending message",e),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length;){if("break"===t())break}}},{key:"rejectPendingMessages",value:function(){var e=this;this.pendingMessages.forEach((function(t){t.reject(new Eb.TransportUnavailableError("Unable to connect: "+e.twilsock.getTerminationReason)),clearTimeout(t.timeout)})),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:(t=ha(Za.mark((function e(t){var n,r,i,a,o,s,u;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.to,r=t.headers,i=t.body,a=t.grant?t.grant:this.config.activeGrant,o={host:n.host,path:n.path,method:n.method,params:n.params,headers:r},s=new Tb.Message(a,r["Content-Type"]||"application/json",o),e.next=8,this.transport.sendWithReply(s,i);case 8:if(u=e.sent,!((l=u)&&l.header&&l.header.http_status)||(c=u.header.http_status.code)>=200&&c<300){e.next=11;break}throw new Sb.TwilsockUpstreamError(u.header.http_status.code,u.header.http_status.status,u.body);case 11:return e.abrupt("return",{status:u.header.http_status,headers:u.header.http_headers,body:u.body});case 12:case"end":return e.stop()}var c,l}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new Eb.TransportUnavailableError("Unable to connect: "+this.twilsock.getTerminationReason));var a=Cb(e,t,n,r,i);return this.twilsock.isConnected?this.actualSend(a):this.saveMessage(a)}}]),e}();yb.Upstream=Rb;var Ob={};Object.defineProperty(Ob,"__esModule",{value:!0});var Mb=function(){function e(){var t=this;xa(this,e),this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return pa(e,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}}]),e}();Ob.Deferred=Mb;var Pb={};Object.defineProperty(Pb,"__esModule",{value:!0});var Ab=mg,Db=function(){function e(t){xa(this,e),this.id=t}return pa(e,null,[{key:"create",value:function(t){if(t instanceof Object&&"storage_id"in t)return new e(t.storage_id);throw new Ab.TwilsockError('Field "storage_id" is missing')}}]),e}();Pb.OfflineProductStorage=Db;var jb={};Object.defineProperty(jb,"__esModule",{value:!0});var Nb=function(){function e(){xa(this,e)}return pa(e,null,[{key:"sessionStorage",get:function(){try{return t.sessionStorage}catch(e){return null}}},{key:"window",get:function(){try{return t.window}catch(e){return null}}},{key:"storeToken",value:function(t,n){e.canStore&&e.sessionStorage.setItem(e.getKeyName(n),t)}},{key:"getStoredToken",value:function(t){return e.canStore?e.sessionStorage.getItem(e.getKeyName(t)):null}},{key:"initialize",value:function(){e.canStore&&(e.sessionStorage.getItem(e.initializedFlag)&&this.clear(),e.sessionStorage.setItem(e.initializedFlag,"true"),e.window.addEventListener("unload",(function(){e.sessionStorage.removeItem(e.initializedFlag)})))}},{key:"clear",value:function(){if(e.canStore){for(var t=[],n=0;n<e.sessionStorage.length;n++){var r=e.sessionStorage.key(n);0===r.indexOf(e.tokenStoragePrefix)&&t.push(r)}t.forEach((function(t){return e.sessionStorage.removeItem(t)})),e.sessionStorage.removeItem(e.initializedFlag)}}},{key:"getKeyName",value:function(t){return"".concat(e.tokenStoragePrefix).concat(t)}},{key:"canStore",get:function(){return e.sessionStorage&&e.window}}]),e}();jb.TokenStorage=Nb,Nb.initializedFlag="twilio_twilsock_token_storage",Nb.tokenStoragePrefix="twilio_continuation_token_",Nb.initialize();var Lb={};Object.defineProperty(Lb,"__esModule",{value:!0});var Ub,Bb,Fb=Qm,qb=Xv,Wb=function(){function e(t,n,r,i,a,o){xa(this,e),this.title=t,this.details=n,this.start=r,this.type=a,this.id=o,this.end=i}return pa(e,[{key:"toTelemetryEvent",value:function(){var e=new Date,t=this.start,n=this.end?this.end:e;if(n<t){var r=n;n=t,t=r}var i=t.getTime()-e.getTime(),a=n.getTime()-e.getTime();return new Fb.TelemetryEvent(i,a,this.title,this.details,this.id,this.type)}}]),e}();Lb.TelemetryEventDescription=Wb,function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(Ub||(Ub={})),Lb.TelemetryPoint=Ub,function(e){e[e.MinEventsPortion=0]="MinEventsPortion",e[e.AnyEvents=1]="AnyEvents",e[e.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished"}(Bb||(Bb={})),Lb.EventSendingLimitation=Bb;var zb=function(){function e(t,n){xa(this,e),this.minEventsPortionToSend=50,this.maxEventsPortionToSend=100,this.pendingEvents=new Map,this.readyEvents=[],this.hasInitializationFinished=!1,this._canSendTelemetry=!1,this.config=t,this.packetInterface=n}return pa(e,[{key:"isTelemetryEnabled",get:function(){return this.config.confirmedCapabilities.has("telemetry.v1")}},{key:"canSendTelemetry",get:function(){return this._canSendTelemetry&&this.isTelemetryEnabled},set:function(e){qb.log.debug("TelemetryTracker.canSendTelemetry: ".concat(e," TelemetryTracker.isTelemetryEnabled: ").concat(this.isTelemetryEnabled)),this._canSendTelemetry&&!e&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=e,e&&this.sendTelemetry(Bb.AnyEvents),e&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}},{key:"addTelemetryEvent",value:function(e){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(e)}},{key:"addPartialEvent",value:function(e,t,n){qb.log.debug("Adding ".concat(n===Ub.Start?"starting":"ending"," timepoint for '").concat(t,"' event"));var r=this.pendingEvents.has(t);if(n===Ub.Start)r&&qb.log.debug("Overwriting starting point for '".concat(t,"' event")),this.pendingEvents.set(t,e);else{if(!r)return void qb.log.info("Could not find started event for '".concat(t,"' event"));this.addTelemetryEvent(this.merge(this.pendingEvents.get(t),e)),this.pendingEvents.delete(t)}}},{key:"getTelemetryToSend",value:function(e){return this.canSendTelemetry&&0!=this.readyEvents.length?e==Bb.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(e==Bb.AnyEventsIncludingUnfinished):[]}},{key:"getTelemetryPortion",value:function(e){var t=this,n=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),r=this.readyEvents.splice(0,n);return e&&r.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach((function(e,n){if(!(r.length>=t.maxEventsPortionToSend)){var i=t.pendingEvents.get(n);t.pendingEvents.delete(n),r.push(new Wb("[UNFINISHED] ".concat(i.title),i.details,i.start,null,i.type,i.id))}})),r}},{key:"merge",value:function(e,t){return new Wb(t.title?t.title:e.title,t.details?t.details:e.details,e.start,t.end,t.type?t.type:e.type,t.id?t.id:e.id)}},{key:"sendTelemetryIfMinimalPortionCollected",value:function(){this.sendTelemetry(Bb.MinEventsPortion)}},{key:"sendTelemetry",value:function(e){var t=this.getTelemetryToSend(e);if(0!==t.length)try{this.packetInterface.send(new Fb.Telemetry(t.map((function(e){return e.toTelemetryEvent()}))))}catch(e){qb.log.debug("Error while sending ".concat(t.length," telemetry events due to ").concat(e,"; they will be resubmitted")),this.readyEvents=this.readyEvents.concat(t)}}}]),e}();function Gb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Lb.TelemetryTracker=zb,Object.defineProperty(Qv,"__esModule",{value:!0});var Jb=Hv,Vb=Xv,$b=nm,Kb=am,Qb=Jg,Hb=ib,Xb=cb,Yb=yb,Zb=Ob,ek=mg,tk=Pb,nk=jb,rk=Lb,ik=function e(){xa(this,e)};Qv.TelemetryEvents=ik,ik.TWILSOCK_CONNECT="twilsock.sdk.connect",ik.TWILSOCK_INIT="twilsock.sdk.init";var ak=function(e){ma(r,e);var t,n=Gb(r);function r(e,t){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};xa(this,r),(i=n.call(this)).offlineStorageDeferred=new Zb.Deferred,a.continuationToken=a.continuationToken?a.continuationToken:nk.TokenStorage.getStoredToken(t);var o=i.config=new $b.Configuration(e,t,a);Vb.log.setLevel(o.logLevel);var s=new Hb.WebSocketChannel(o.url),u=a.transport?a.transport:new Qb.PacketInterface(s,o);return i.channel=a.channel?a.channel:new Kb.TwilsockImpl(s,u,o),i.registrations=a.registrations?a.registrations:new Xb.Registrations(u),i.upstream=new Yb.Upstream(u,i.channel,o),i.telemetryTracker=new rk.TelemetryTracker(o,u),i.channel.on("initialized",(function(){return i.telemetryTracker.canSendTelemetry=!0})),s.on("disconnected",(function(){return i.telemetryTracker.canSendTelemetry=!1})),i.registrations.on("registered",(function(e){return i.emit("registered",e)})),i.channel.on("message",(function(e,t){return setTimeout((function(){return i.emit("message",e,t)}),0)})),i.channel.on("stateChanged",(function(e){return setTimeout((function(){return i.emit("stateChanged",e)}),0)})),i.channel.on("connectionError",(function(e){return setTimeout((function(){return i.emit("connectionError",e)}),0)})),i.channel.on("tokenAboutToExpire",(function(){return setTimeout((function(){return i.emit("tokenAboutToExpire")}),0)})),i.channel.on("tokenExpired",(function(){return setTimeout((function(){return i.emit("tokenExpired")}),0)})),i.channel.on("connected",(function(){return i.registrations.updateRegistrations()})),i.channel.on("connected",(function(){return i.upstream.sendPendingMessages()})),i.channel.on("connected",(function(){return setTimeout((function(){return i.emit("connected")}),0)})),i.channel.on("beforeConnect",(function(){return i.telemetryTracker.addPartialEvent(new rk.TelemetryEventDescription("Establish WebSocket connection","",new Date),ik.TWILSOCK_CONNECT,rk.TelemetryPoint.Start)})),i.channel.on("connected",(function(){return i.telemetryTracker.addPartialEvent(new rk.TelemetryEventDescription("Establish WebSocket connection","",new Date,new Date),ik.TWILSOCK_CONNECT,rk.TelemetryPoint.End)})),i.channel.on("beforeSendInit",(function(){return i.telemetryTracker.addPartialEvent(new rk.TelemetryEventDescription("Send Twilsock init","",new Date),ik.TWILSOCK_INIT,rk.TelemetryPoint.Start)})),i.channel.on("initialized",(function(){return i.telemetryTracker.addPartialEvent(new rk.TelemetryEventDescription("Send Twilsock init","Succeeded",new Date,new Date),ik.TWILSOCK_INIT,rk.TelemetryPoint.End)})),i.channel.on("sendInitFailed",(function(){return i.telemetryTracker.addPartialEvent(new rk.TelemetryEventDescription("Send Twilsock init","Failed",new Date,new Date),ik.TWILSOCK_INIT,rk.TelemetryPoint.End)})),i.channel.on("initialized",(function(e){i.handleStorageId(t,e),nk.TokenStorage.storeToken(e.continuationToken,t),setTimeout((function(){return i.emit("initialized",e)}),0)})),i.channel.on("disconnected",(function(){return setTimeout((function(){return i.emit("disconnected")}),0)})),i.channel.on("disconnected",(function(){return i.upstream.rejectPendingMessages()})),i.channel.on("disconnected",(function(){return i.offlineStorageDeferred.fail(new ek.TwilsockError("Client disconnected"))})),i.offlineStorageDeferred.promise.catch((function(){})),i}return pa(r,[{key:"emit",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return Vb.log.debug("Emitting ".concat(e.toString(),"(").concat(i.map((function(e){return JSON.stringify(e)})).join(", "),")")),(t=Kv(ka(r.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}},{key:"handleStorageId",value:function(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(tk.OfflineProductStorage.create(t.offlineStorage[e])),Vb.log.debug("Offline storage for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage[e]),"."))}catch(n){this.offlineStorageDeferred.fail(new ek.TwilsockError("Failed to parse offline storage for ".concat(e," ").concat(JSON.stringify(t.offlineStorage[e]),". ").concat(n,".")))}else this.offlineStorageDeferred.fail(new ek.TwilsockError("No offline storage id for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage))));else this.offlineStorageDeferred.fail(new ek.TwilsockError("No offline storage id"))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}},{key:"updateToken",value:(t=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Vb.log.trace("updating token '".concat(t,"'")),this.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return this.config.updateToken(t),e.abrupt("return",this.channel.updateToken(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setNotificationsContext",value:function(e,t){this.registrations.setNotificationsContext(e,t)}},{key:"removeNotificationsContext",value:function(e){this.registrations.removeNotificationsContext(e)}},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:function(){return this.telemetryTracker.sendTelemetry(rk.EventSendingLimitation.AnyEventsIncludingUnfinished),this.channel.disconnect()}},{key:"get",value:function(e,t,n){return this.telemetryTracker.sendTelemetry(rk.EventSendingLimitation.AnyEvents),this.upstream.send("GET",e,t,void 0,n)}},{key:"post",value:function(e,t,n,r){return this.telemetryTracker.sendTelemetry(rk.EventSendingLimitation.AnyEvents),this.upstream.send("POST",e,t,n,r)}},{key:"put",value:function(e,t,n,r){return this.telemetryTracker.sendTelemetry(rk.EventSendingLimitation.AnyEvents),this.upstream.send("PUT",e,t,n,r)}},{key:"delete",value:function(e,t,n){return this.telemetryTracker.sendTelemetry(rk.EventSendingLimitation.AnyEvents),this.upstream.send("DELETE",e,t,void 0,n)}},{key:"addTelemetryEvent",value:function(e){this.telemetryTracker.addTelemetryEvent(e),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"addPartialTelemetryEvent",value:function(e,t,n){this.telemetryTracker.addPartialEvent(e,t,n),n===rk.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}}]),r}(Jb.EventEmitter);Qv.TwilsockClient=ak,Qv.Twilsock=ak,Object.defineProperty($v,"__esModule",{value:!0});var ok=Qv;$v.TwilsockClient=ok.TwilsockClient;var sk=$v.Twilsock=ok.TwilsockClient,uk=mg;$v.TwilsockError=uk.TwilsockError;var ck=bb;$v.TransportUnavailableError=ck.TransportUnavailableError;var lk={},fk={},hk={};Object.defineProperty(hk,"__esModule",{value:!0}),hk.Configuration=void 0;var dk=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};xa(this,e);var r=n.notifications||{},i=r.region||n.region||"us1",a="https://ers.".concat(i,".twilio.com/v1/registrations");this.registrarUrl=r.ersUrl||a,this._token=t}return pa(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"token",get:function(){return this._token}}]),e}();hk.Configuration=dk;var pk={},yk={},vk={},mk={};function gk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(mk,"__esModule",{value:!0});var bk=function(e){ma(n,e);var t=gk(n);function n(e){var r;return xa(this,n),(r=t.call(this)).minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return pa(n,[{key:"attempt",value:function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),void this.reject(new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((function(){return t.attempt()}),n)}},{key:"cleanup",value:function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise((function(t,n){e.resolve=t,e.reject=n,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)}))}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}},{key:"succeeded",value:function(e){this.emit("succeeded",e),this.resolve(e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}},{key:"run",value:function(e){var t=this;return this.on("attempt",(function(){e().then((function(e){return t.succeeded(e)})).catch((function(e){return t.failed(e)}))})),this.start()}}]),n}(Hv.EventEmitter);mk.Retrier=bk,mk.default=bk;var kk={};function wk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}function xk(e){return null!=e}Object.defineProperty(kk,"__esModule",{value:!0});var _k=function(e){ma(n,e);var t=wk(n);function n(e){var r;if(xa(this,n),r=t.call(this),xk((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(xk(e.maxDelay)&&e.maxDelay<=1)throw new Error("The maximal timeout must be greater than 1.");if(xk(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");if(xk(e.factor)&&e.factor<=1)throw new Error("Exponential factor should be greater than 1.");if(r.initialDelay=e.initialDelay||100,r.maxDelay=e.maxDelay||1e4,r.maxDelay<=r.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return r.randomisationFactor=e.randomisationFactor||0,r.factor=e.factor||2,r.maxNumberOfRetry=-1,r.reset(),r}return pa(n,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new n(e)}}]),n}(Hv.EventEmitter);kk.Backoff=_k,kk.default=_k,Object.defineProperty(vk,"__esModule",{value:!0});var Sk=mk;vk.Retrier=Sk.Retrier;var Tk=kk;vk.Backoff=Tk.Backoff,vk.default=Sk.Retrier;var Ek={};Object.defineProperty(Ek,"__esModule",{value:!0}),Ek.log=Ek.Logger=void 0;var Ik=Jh.exports;function Ck(e,t){return["".concat((new Date).toISOString()," Notifications ").concat(e,":")].concat(Array.from(t))}var Rk=function(){function e(){xa(this,e),this.prefix=""}return pa(e,[{key:"setLevel",value:function(e){Ik.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ik.debug.apply(null,Ck("T"+this.prefix,t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ik.debug.apply(null,Ck("D"+this.prefix,t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ik.info.apply(null,Ck("I"+this.prefix,t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ik.warn.apply(null,Ck("W"+this.prefix,t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ik.error.apply(null,Ck("E"+this.prefix,t))}}],[{key:"scope",value:function(){return new e}}]),e}();Ek.Logger=Rk;var Ok=Rk.scope();function Mk(e){return function(e){if(Array.isArray(e))return Ay(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Dy(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}Ek.log=Ok;var Pk={};function Ak(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(Pk,"__esModule",{value:!0}),Pk.Connector=Pk.RegistrationState=void 0;var Dk=Hv,jk=Ek,Nk=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;xa(this,e),this.token=t,this.notificationId=n,this.messageTypes=r}return pa(e,[{key:"clone",value:function(){return new e(this.token,this.notificationId,new Set(this.messageTypes))}}]),e}();function Lk(e,t){var n=new Set;return e.notificationId!==t.notificationId&&n.add("notificationId"),e.token!==t.token&&n.add("token"),function(e,t){return[].concat(Mk(Mk(e).filter((function(e){return!t.has(e)}))),Mk(Mk(t).filter((function(t){return!e.has(t)}))))}(e.messageTypes,t.messageTypes).length>0&&n.add("messageType"),[n.size>0,n]}Pk.RegistrationState=Nk;var Uk=function(e){ma(a,e);var t,n,r,i=Ak(a);function a(e){var t;return xa(this,a),(t=i.call(this)).config=e,t.desiredState=new Nk,t.currentState=new Nk,t.hasActiveAttempt=!1,t}return pa(a,[{key:"subscribe",value:(r=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.desiredState.messageTypes.has(t)){e.next=3;break}return jk.log.debug("message type already registered ",t),e.abrupt("return");case 3:return this.desiredState.messageTypes.add(t),e.next=6,this.persistRegistration();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"unsubscribe",value:(n=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.desiredState.messageTypes.has(t)){e.next=2;break}return e.abrupt("return");case 2:return this.desiredState.messageTypes.delete(t),e.next=5,this.persistRegistration();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"updateToken",value:function(e){this.desiredState.token=e,this.persistRegistration()}},{key:"persistRegistration",value:(t=ha(Za.mark((function e(){var t,n,r,i,a,o,s=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.token&&0!==this.config.token.length){e.next=3;break}return jk.log.trace("Can't persist registration: token is not set"),e.abrupt("return");case 3:if(!this.hasActiveAttempt){e.next=6;break}return jk.log.trace("One registration attempt is already in progress"),e.abrupt("return");case 6:if(t=Lk(this.desiredState,this.currentState),n=jy(t,2),r=n[0],i=n[1],r){e.next=9;break}return e.abrupt("return");case 9:if(this.currentState.notificationId||i.delete("notificationId"),jk.log.trace("Persisting registration",i,this.desiredState),e.prev=11,this.hasActiveAttempt=!0,!((a=this.desiredState.clone()).messageTypes.size>0)){e.next=24;break}return e.next=17,this.updateRegistration(a,i);case 17:o=e.sent,this.currentState.token=o.token,this.currentState.notificationId=o.notificationId,this.currentState.messageTypes=o.messageTypes,this.emit("stateChanged","registered"),e.next=30;break;case 24:return e.next=26,this.removeRegistration();case 26:this.currentState.token=a.token,this.currentState.notificationId=a.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged","unregistered");case 30:return e.prev=30,this.hasActiveAttempt=!1,setTimeout((function(){return s.persistRegistration()}),0),e.finish(30);case 34:case"end":return e.stop()}}),e,this,[[11,,30,34]])}))),function(){return t.apply(this,arguments)})},{key:"setNotificationId",value:function(e){this.desiredState.notificationId=e,this.persistRegistration()}}]),a}(Dk.EventEmitter);function Bk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Pk.Connector=Uk,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RegistrarConnector=e.Connector=void 0;var t=vk,n=Ek,r=Pk;Object.defineProperty(e,"Connector",{enumerable:!0,get:function(){return r.Connector}});var i={min:2e3,max:12e4,randomness:.2},a=function(e){ma(u,e);var r,a,o,s=Bk(u);function u(e,t,n,r){var i;return xa(this,u),(i=s.call(this,r)).channelType=e,i.context=t,i.transport=n,i}return pa(u,[{key:"updateRegistration",value:(o=ha(Za.mark((function e(t,n){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.has("notificationId")){e.next=3;break}return e.next=3,this.removeRegistration();case 3:if(t.notificationId&&t.notificationId.length){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,this.register(t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"removeRegistration",value:(a=ha(Za.mark((function e(){var r,a,o=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrationId){e.next=2;break}return e.abrupt("return");case 2:return r="".concat(this.config.registrarUrl,"/").concat(this.registrationId,"?productId=").concat(this.context.productId),a={"Content-Type":"application/json","X-Twilio-Token":this.config.token},e.prev=4,n.log.trace("Removing registration for ",this.channelType),e.next=8,new t.Retrier(Object.assign(i,{maxAttemptsCount:3})).run((function(){return o.transport.delete(r,a)}));case 8:n.log.debug("Registration removed for",this.channelType),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(4),n.log.error("Failed to remove of registration ",this.channelType,e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(){return a.apply(this,arguments)})},{key:"register",value:(r=ha(Za.mark((function e(r){var a,o,s,u,c=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.log.trace("Registering",this.channelType,r),a={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:Array.from(r.messageTypes),data:{registration_id:r.notificationId},ttl:"PT24H"},o="".concat(this.config.registrarUrl,"?productId=").concat(this.context.productId),s={"Content-Type":"application/json","X-Twilio-Token":r.token},n.log.trace("Creating registration for channel ",this.channelType),e.prev=5,e.next=8,new t.Retrier(i).run((function(){return c.transport.post(o,s,a)}));case 8:u=e.sent,this.registrationId=u.body.id,n.log.debug("Registration created: ",u),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(5),n.log.error("Registration failed: ",e.t0),e.t0;case 17:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(e){return r.apply(this,arguments)})}]),u}(r.Connector);e.RegistrarConnector=a}(yk);var Fk={};function qk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(Fk,"__esModule",{value:!0}),Fk.TwilsockConnector=void 0;var Wk=Rm,zk=function(e){ma(i,e);var t,n,r=qk(i);function i(e,t,n){var a;return xa(this,i),(a=r.call(this,n)).twilsock=t,a.context=e,e.id=Wk.v4(),a.twilsock.on("stateChanged",(function(e){"connected"!==e&&a.emit("transportReady",!1)})),a.twilsock.on("registered",(function(n){e&&n===e.id&&"connected"===t.state&&a.emit("transportReady",!0)})),a}return pa(i,[{key:"setNotificationId",value:function(){}},{key:"updateToken",value:function(e){}},{key:"updateContextRequest",value:(n=ha(Za.mark((function e(t){var n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,message_types:t},this.emit("transportReady",!1),e.next=4,this.twilsock.setNotificationsContext(this.context.id,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"updateRegistration",value:(t=ha(Za.mark((function e(t,n){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.has("messageType")){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.updateContextRequest(Array.from(t.messageTypes));case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"removeRegistration",value:function(){return this.twilsock.removeNotificationsContext(this.context.id)}}]),i}(Pk.Connector);function Gk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Fk.TwilsockConnector=zk,Object.defineProperty(pk,"__esModule",{value:!0}),pk.Registrar=void 0;var Jk=yk,Vk=Fk,$k=function(e){ma(n,e);var t=Gk(n);function n(e,r,i,a){var o;xa(this,n),(o=t.call(this)).config=a,o.connectors=new Map;var s=o.detectPlatform();return o.connectors.set("gcm",new Jk.RegistrarConnector("gcm",{protocolVersion:3,productId:e,platform:s},r,a)),o.connectors.set("fcm",new Jk.RegistrarConnector("fcm",{protocolVersion:3,productId:e,platform:s},r,a)),o.connectors.set("apn",new Jk.RegistrarConnector("apn",{protocolVersion:4,productId:e,platform:s},r,a)),o.connectors.set("twilsock",new Vk.TwilsockConnector({productId:e,platform:s},i,a)),o.connectors.get("twilsock").on("transportReady",(function(e){return o.emit("transportReady",e)})),o}return pa(n,[{key:"setNotificationId",value:function(e,t){this.connector(e).setNotificationId(t)}},{key:"subscribe",value:function(e,t){return this.connector(t).subscribe(e)}},{key:"unsubscribe",value:function(e,t){return this.connector(t).unsubscribe(e)}},{key:"updateToken",value:function(e){this.connectors.forEach((function(t){return t.updateToken(e)}))}},{key:"connector",value:function(e){var t=this.connectors.get(e);if(!t)throw new Error("Unknown channel type: ".concat(e));return t}},{key:"detectPlatform",value:function(){var e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),n}(Hv.EventEmitter);function Kk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}pk.Registrar=$k,Object.defineProperty(fk,"__esModule",{value:!0}),fk.Client=void 0;var Qk=$v,Hk=hk,Xk=pk,Yk=Ek,Zk=function(e){ma(Client,e);var t,n=Kk(Client);function Client(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(xa(this,Client),t=n.call(this),!e||0===e.length)throw new Error("Token is required for Notifications client");r.logLevel=r.logLevel||"error",Yk.log.setLevel(r.logLevel),r.minTokenRefreshInterval;var i=r.productId||"notifications";return r.twilsockClient=r.twilsockClient||new Qk.TwilsockClient(e,i,r),r.transport=r.transport||r.twilsockClient,t.services={twilsock:r.twilsockClient,transport:r.transport,config:new Hk.Configuration(null,r)},t.registrar=new Xk.Registrar(i,t.services.transport,t.services.twilsock,t.services.config),t.reliableTransportState={overall:!1,transport:!1,registration:!1,lastEmitted:null},t._onTransportStateChange(t.services.twilsock.isConnected),t.registrar.on("transportReady",(function(e){t._onRegistrationStateChange(e?"registered":"")})),t.registrar.on("stateChanged",(function(e){t._onRegistrationStateChange(e)})),t.registrar.on("needReliableTransport",t._onNeedReliableTransport.bind(ya(t))),t.services.twilsock.on("message",(function(e,n){return t._routeMessage(e,n)})),t.services.twilsock.on("connected",(function(e){t._onTransportStateChange(!0),t.registrar.setNotificationId("twilsock",e)})),t.services.twilsock.on("disconnected",(function(){t._onTransportStateChange(!1)})),t.services.config.updateToken(e),t.registrar.updateToken(e),t}return pa(Client,[{key:"connectionState",get:function(){return"disconnected"===this.services.twilsock.state?"disconnected":"disconnecting"===this.services.twilsock.state?"disconnecting":"connected"===this.services.twilsock.state&&this.reliableTransportState.registration?"connected":"rejected"===this.services.twilsock.state?"denied":"connecting"}},{key:"_routeMessage",value:function(e,t){Yk.log.trace("Message arrived: ",e,t),this.emit("message",e,t)}},{key:"_onNeedReliableTransport",value:function(e){e?this.services.twilsock.connect():this.services.twilsock.disconnect()}},{key:"_onRegistrationStateChange",value:function(e){this.reliableTransportState.registration="registered"===e,this._updateTransportState()}},{key:"_onTransportStateChange",value:function(e){this.reliableTransportState.transport=e,this._updateTransportState()}},{key:"_updateTransportState",value:function(){var e=this.reliableTransportState.transport&&this.reliableTransportState.registration;this.reliableTransportState.overall!==e&&(this.reliableTransportState.overall=e,Yk.log.info("Transport ready:",e),this.emit("transportReady",e)),this.reliableTransportState.lastEmitted!==this.connectionState&&(this.reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}},{key:"subscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return Yk.log.trace("Add subscriptions for message type: ",e,t),this.registrar.subscribe(e,t)}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return Yk.log.trace("Remove subscriptions for message type: ",e,t),this.registrar.unsubscribe(e,t)}},{key:"handlePushNotification",value:function(e){return{messageType:e.twi_message_type,payload:e.payload}}},{key:"setPushRegistrationId",value:function(e,t){Yk.log.trace("Set push registration id",e,t),this.registrar.setNotificationId(t,e)}},{key:"updateToken",value:(t=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Yk.log.info("authTokenUpdated"),this.services.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.services.twilsock.updateToken(t);case 5:this.services.config.updateToken(t),this.registrar.updateToken(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),Client}(Hv.EventEmitter);fk.Client=Zk,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Notifications=void 0;var t=fk;Object.defineProperty(e,"Notifications",{enumerable:!0,get:function(){return t.Client}})}(lk);var ew={exports:{}},tw={},nw={};Object.defineProperty(nw,"__esModule",{value:!0});var rw=function(){function e(t){xa(this,e),this.base=t,this.args=new Array,this.paths=new Array}return pa(e,[{key:"pathSegment",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"queryParam",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();nw.UriBuilder=rw;var iw={};function aw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(iw,"__esModule",{value:!0});var ow=function(e){ma(n,e);var t=aw(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return xa(this,n),(r=t.call(this)).name=r.constructor.name,r.message="".concat(e," (status: ").concat(i,", code: ").concat(a,")"),r.status=i,r.code=a,r}return n}(vg(Error));iw.SyncError=ow;var sw=function(e){ma(n,e);var t=aw(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;return xa(this,n),(r=t.call(this,e,i,a)).body=o,r}return n}(ow);iw.SyncNetworkError=sw,iw.default=ow;var uw={};Object.defineProperty(uw,"__esModule",{value:!0});var cw=iw;function lw(e,t){if(!t||void 0!==e){var n,r=ga(e);if("number"!==r||!(fw(n=e)&&n>=0)){var i="object"===r?"object":"'".concat(e,"' of type '").concat(r,"'");throw new cw.default("Invalid TTL, expected a positive integer of type number, was ".concat(i),400,54011)}}}function fw(e){return!isNaN(parseInt(e))&&isFinite(e)}uw.deepClone=function(e){return JSON.parse(JSON.stringify(e))},uw.validateId=function(e){if(void 0!==e){var t=ga(e);if("string"!==t)throw new Error("Invalid ID type, expected a string, got '".concat(t,"'"))}},uw.validateOptionalTtl=function(e){lw(e,!0)},uw.validateMandatoryTtl=function(e){lw(e,!1)},uw.validatePageSize=function(e){var t;if(!(void 0===e||fw(t=e)&&t>0))throw new cw.default("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,20007)},uw.validateMode=function(e){if(!["open_or_create","open_existing","create_new"].includes(e))throw new Error("Invalid open mode. Expected one of { 'create_new', 'open_or_create', 'open_existing' }")};var hw={};Object.defineProperty(hw,"__esModule",{value:!0});var dw=Jh.exports.getLogger("twilio-sync");function pw(e,t){return["".concat((new Date).toISOString()," Sync ").concat(e,":")].concat(Array.from(t))}hw.default={setLevel:function(e){dw.setLevel(e)},trace:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];dw.trace.apply(null,pw("T",t))},debug:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];dw.debug.apply(null,pw("D",t))},info:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];dw.info.apply(null,pw("I",t))},warn:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];dw.warn.apply(null,pw("W",t))},error:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];dw.error.apply(null,pw("E",t))}};var yw={};Object.defineProperty(yw,"__esModule",{value:!0});var vw="/v4/Subscriptions",mw="/v3/Maps",gw="/v3/Lists",bw="/v3/Documents",kw="/v3/Streams",ww="/v3/Insights";function xw(e,t,n){return e&&void 0!==e[t]?e[t]:n}var _w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};xa(this,e);var n=t.region||"us1",r="https://cds.".concat(n,".twilio.com"),i=t.cdsUri||r;this.settings={subscriptionsUri:i+vw,documentsUri:i+bw,listsUri:i+gw,mapsUri:i+mw,streamsUri:i+kw,insightsUri:i+ww,sessionStorageEnabled:xw(t.Sync,"enableSessionStorage",!0),productId:t.productId}}return pa(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"insightsUri",get:function(){return this.settings.insightsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}},{key:"productId",get:function(){return this.settings.productId}}]),e}();yw.Configuration=_w;var Sw={},Tw={},Ew={};function Iw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(Ew,"__esModule",{value:!0});var Cw=function(e){ma(n,e);var t=Iw(n);function n(e){var r;return xa(this,n),(r=t.call(this)).minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return pa(n,[{key:"attempt",value:function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),void this.reject(new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((function(){return t.attempt()}),n)}},{key:"cleanup",value:function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise((function(t,n){e.resolve=t,e.reject=n,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)}))}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}},{key:"succeeded",value:function(e){this.emit("succeeded",e),this.resolve(e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}},{key:"run",value:function(e){var t=this;return this.on("attempt",(function(){e().then((function(e){return t.succeeded(e)})).catch((function(e){return t.failed(e)}))})),this.start()}}]),n}(Hv.EventEmitter);Ew.Retrier=Cw,Ew.default=Cw;var Rw={};function Ow(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}function Mw(e){return null!=e}Object.defineProperty(Rw,"__esModule",{value:!0});var Pw=function(e){ma(n,e);var t=Ow(n);function n(e){var r;if(xa(this,n),r=t.call(this),Mw((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(Mw(e.maxDelay)&&e.maxDelay<=1)throw new Error("The maximal timeout must be greater than 1.");if(Mw(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");if(Mw(e.factor)&&e.factor<=1)throw new Error("Exponential factor should be greater than 1.");if(r.initialDelay=e.initialDelay||100,r.maxDelay=e.maxDelay||1e4,r.maxDelay<=r.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return r.randomisationFactor=e.randomisationFactor||0,r.factor=e.factor||2,r.maxNumberOfRetry=-1,r.reset(),r}return pa(n,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new n(e)}}]),n}(Hv.EventEmitter);Rw.Backoff=Pw,Rw.default=Pw,Object.defineProperty(Tw,"__esModule",{value:!0});var Aw=Ew;Tw.Retrier=Aw.Retrier;var Dw=Rw;function jw(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Nw(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nw(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Nw(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Tw.Backoff=Dw.Backoff,Tw.default=Aw.Retrier,Object.defineProperty(Sw,"__esModule",{value:!0});var Lw=Tw,Uw=iw,Bw=hw,Fw=$v,qw=function(){function e(t){xa(this,e),this.localObject=t,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return pa(e,[{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"indexName",get:function(){return this.localObject.indexName}},{key:"queryString",get:function(){return this.localObject.queryString}},{key:"isEstablished",get:function(){return this.established}},{key:"update",value:function(e,t){this.localObject._update(e,t)}},{key:"updatePending",value:function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{key:"markAsFailed",value:function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new Uw.SyncError("Failed to subscribe on service events: ".concat(e.error.message),e.error.status,e.error.code))}},{key:"complete",value:function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{key:"setSubscriptionState",value:function(e){this.localObject._setSubscriptionState(e)}}]),e}(),Ww=function(){function e(t){var n=this;xa(this,e),this.isConnected=!1,this.maxBatchSize=100,this.subscriptionTtlTimer=null,this.pendingPokeReason=null,this.services=t,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;this.backoff=Lw.Backoff.exponential(Object.assign({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",(function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,r):(n.backoff.reset(),Bw.default.debug("All subscriptions resolved."))}))}var t;return pa(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,n,r){var i,a=[],o=jw(e);try{for(o.s();!(i=o.n()).done;){var s=jy(i.value,2),u=s[0],c=s[1];if(!t.get(u)&&n!==c.pendingAction&&!c.rejectedWithError&&(a.push(c),r&&a.length>=r))break}}catch(e){o.e(e)}finally{o.f()}return a}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var n=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}},{key:"persist",value:function(){this.backoff.backoff()}},{key:"applyNewSubscriptionUpdateBatch",value:(t=ha(Za.mark((function e(t,n){var r,i,a,o,s,u,c,l,f,h,d,p,y=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=4;break}return Bw.default.debug("Twilsock connection (required for subscription) not ready; waiting…"),this.backoff.reset(),e.abrupt("return");case 4:n=this.processLocalActions(t,n),r=(new Date).getTime(),i=jw(n);try{for(i.s();!(a=i.n()).done;)o=a.value,this.recordActionAttemptOn(o,t,r)}catch(e){i.e(e)}finally{i.f()}return s=this.pendingPokeReason,this.pendingPokeReason=null,e.prev=10,e.next=13,this.request(t,r,s,n);case 13:u=e.sent,c=u.body.max_batch_size,!isNaN(parseInt(c))&&isFinite(c)&&c>0&&(this.maxBatchSize=c),this.subscriptionTtlTimer||(l=u.body.ttl_in_s,!isNaN(parseFloat(l))&&isFinite(l)&&l>0&&(this.subscriptionTtlTimer=setTimeout((function(){return y.onSubscriptionTtlElapsed()}),1e3*l))),"establish"===t&&(f=u.body.estimated_delivery_in_ms,!isNaN(parseFloat(f))&&isFinite(f)&&f>0?setTimeout((function(){return y.verifyPokeDelivery(r,f,n)}),f):Bw.default.error("Invalid timeout: ".concat(f)),n.filter((function(e){return e.pendingCorrelationId===r})).forEach((function(e){return e.setSubscriptionState("response_in_flight")}))),this.backoff.reset(),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(10),h=jw(n);try{for(h.s();!(d=h.n()).done;)p=d.value,this.recordActionFailureOn(p,t)}catch(e){h.e(e)}finally{h.f()}e.t0 instanceof Fw.TransportUnavailableError?(Bw.default.debug("Twilsock connection (required for subscription) not ready (c:".concat(r,"); waiting…")),this.backoff.reset()):(Bw.default.debug("Failed an attempt to ".concat(t," subscriptions (c:").concat(r,"); retrying"),e.t0),this.persist());case 26:case"end":return e.stop()}}),e,this,[[10,21]])}))),function(e,n){return t.apply(this,arguments)})},{key:"verifyPokeDelivery",value:function(e,t,n){var r=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),a=i?(new Date).getTime()-i:t;a>=t?(n.filter((function(t){return t.pendingCorrelationId===e})).forEach((function(e){e.updatePending(null,null),e.retryCount++,r.persisted.delete(e.sid)})),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e)):setTimeout((function(){return r.verifyPokeDelivery(e,t,n)}),t-a)}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter((function(e){return!e.rejectedWithError})):t}},{key:"recordActionAttemptOn",value:function(e,t,n){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,n);else{var r=this.persisted.get(e.sid);r&&r.updatePending(t,n)}}},{key:"recordActionFailureOn",value:function(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,n,r){var i=r.map((function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0,index_name:"establish"===e?t.indexName:void 0,query_string:"establish"===e?t.queryString:void 0}})),a=r.filter((function(e){return e.retryCount>0})).length;Bw.default.debug("Attempting '".concat(e,"' request (c:").concat(t,"):"),i);var o={event_protocol_version:3,action:e,correlation_id:t,retried_requests:a,ttl_in_s:-1,requests:i};return"ttl"===n&&(o.reason=n),this.services.network.post(this.services.config.subscriptionsUri,o)}},{key:"add",value:function(e,t){Bw.default.debug("Establishing intent to subscribe to ".concat(e));var n=this.subscriptions.get(e);n&&t&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new qw(t)),this.persist())}},{key:"remove",value:function(e){Bw.default.debug("Establishing intent to unsubscribe from ".concat(e)),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e,t){var n;switch(Bw.default.trace("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(n=e.event_type.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:var r;switch(n[0]){case"map_":r=e.event.map_sid;break;case"list_":r=e.event.list_sid;break;case"document_":r=e.event.document_sid;break;case"stream_":r=e.event.stream_sid;break;case"live_query_":r=e.event.query_id,t=!1,!0===e.strictly_ordered&&(t=!0);break;default:r=void 0}this.applyEventToSubscribedEntity(r,e,t);break;default:Bw.default.debug("Dropping unknown message type ".concat(e.event_type))}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var n=e.object_sid,r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?"interrupted"===e.replay_status?(Bw.default.debug("Event Replay for subscription to ".concat(n," (c:").concat(t,") interrupted; continuing eagerly.")),r.updatePending(null,null),this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(Bw.default.debug("Event Replay for subscription to ".concat(n," (c:").concat(t,") completed. Subscription is ready.")),r.complete(e.last_event_id),this.persisted.set(e.object_sid,r),r.setSubscriptionState("established"),this.backoff.reset()):Bw.default.debug("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?(n.updatePending(null,null),n.setSubscriptionState("none"),this.persisted.delete(e.object_sid)):Bw.default.debug("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var n=e.object_sid,r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.pendingCorrelationId===t&&(Bw.default.error("Failed to subscribe on ".concat(i.sid),e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!r&&i&&(this.persisted.delete(n),i.setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t,n){if(e){var r;n=n||(r=this.persisted.get(e))&&r.isEstablished;var i=this.subscriptions.get(e);i?(t.event.type=t.event_type,i.update(t.event,n)):Bw.default.debug("Message dropped for SID '".concat(e,"', for which there is no subscription."))}}},{key:"onConnectionStateChanged",value:function(e){this.isConnected=e,e&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(e){Bw.default.debug("Triggering event replay for all subscriptions, reason=".concat(e)),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t,n=[],r=jw(this.persisted.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;i.reset(),i.rejectedWithError&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}this.persisted.clear();for(var a=0,o=n;a<o.length;a++){var s=o[a];this.persisted.set(s.sid,s)}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();Sw.Subscriptions=Ww;var zw={};Object.defineProperty(zw,"__esModule",{value:!0});var Gw=hw,Jw="com.twilio.rtd.cds.document",Vw="com.twilio.rtd.cds.list",$w="com.twilio.rtd.cds.map",Kw="twilio.sync.event",Qw=function(){function e(t){var n=this;xa(this,e),this.config=t.config,this.subscriptions=t.subscriptions,this.notifications=t.notifications,this.notifications.subscribe(Kw),this.notifications.subscribe(Jw),this.notifications.subscribe(Vw),this.notifications.subscribe($w),this.notifications.on("message",(function(e,t){return n.onMessage(e,t)})),this.notifications.on("transportReady",(function(e){return n.onConnectionStateChanged(e)}))}return pa(e,[{key:"onMessage",value:function(e,t){switch(Gw.default.trace("Notification type:",e,"content:",t),e){case Jw:case Vw:case $w:this.subscriptions.acceptMessage(t,!1);break;case Kw:this.subscriptions.acceptMessage(t,!0)}}},{key:"subscribe",value:function(e,t){this.subscriptions.add(e,t)}},{key:"unsubscribe",value:function(e){this.subscriptions.remove(e)}},{key:"onConnectionStateChanged",value:function(e){this.subscriptions.onConnectionStateChanged(e)}}]),e}();zw.Router=Qw,zw.default=Qw;var Hw={};Object.defineProperty(Hw,"__esModule",{value:!0});var Xw=Rm,Yw=iw,Zw=hw,ex=Tw,tx=$v;function nx(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function rx(e){return e.body?e.body.code:0}function ix(e){return 409===e.status?new Yw.SyncNetworkError(nx(e),e.status,rx(e),e.body):e.status?new Yw.SyncError(nx(e),e.status,rx(e)):e instanceof tx.TransportUnavailableError?e:new Yw.SyncError(e.message,0,0)}var ax=function(){function e(t,n,r){xa(this,e),this.clientInfo=t,this.config=n,this.transport=r}return pa(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+Xw.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return Object.assign({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(r,i){var a=[502,503,504];n&&a.push(429);var o=new ex.Retrier(t.backoffConfig());o.on("attempt",(function(){e().then((function(e){return o.succeeded(e)})).catch((function(e){if(a.includes(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);o.failed(ix(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?o.failed(ix(e)):(o.removeAllListeners(),o.cancel(),i(ix(e)))}))})),o.on("succeeded",(function(e){r(e)})),o.on("cancelled",(function(e){return i(ix(e))})),o.on("failed",(function(e){return i(ix(e))})),o.start()}))}},{key:"get",value:function(e){var t=this,n=this.createHeaders();return Zw.default.debug("GET",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.get(e,n,t.config.productId)}),!0)}},{key:"post",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.createHeaders();return null!=n&&(a["If-Match"]=n),Zw.default.debug("POST",e,"ID:",a["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.post(e,a,t,r.config.productId)}),i)}},{key:"put",value:function(e,t,n){var r=this,i=this.createHeaders();return null!=n&&(i["If-Match"]=n),Zw.default.debug("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.put(e,i,t,r.config.productId)}),!1)}},{key:"delete",value:function(e){var t=this,n=this.createHeaders();return Zw.default.debug("DELETE",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.delete(e,n,t.config.productId)}),!1)}}]),e}();Hw.NetworkService=ax;var ox={},sx={};function ux(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return cx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cx(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function cx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(sx,"__esModule",{value:!0});var lx=function(){function e(t,n){xa(this,e),this.services=t,this.removalHandler=n,this.subscriptionState="none",this._attachedListeners=new Map}return pa(e,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.broadcastEventToListeners("failure",e)}},{key:"_subscribe",value:function(){this.services.router.subscribe(this.sid,this)}},{key:"_unsubscribe",value:function(){this.services.router.unsubscribe(this.sid)}},{key:"_setSubscriptionState",value:function(e){this.subscriptionState=e,this.broadcastEventToListeners("_subscriptionStateChanged",e)}},{key:"close",value:function(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}},{key:"attach",value:function(e){var t=e.listenerUuid;this._attachedListeners.get(t)||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,e))}},{key:"detach",value:function(e){this._attachedListeners.delete(e),this._attachedListeners.size||this.close()}},{key:"broadcastEventToListeners",value:function(e,t){var n,r=ux(this._attachedListeners.values());try{for(r.s();!(n=r.n()).done;){n.value.emit(e,t)}}catch(e){r.e(e)}finally{r.f()}}}]),e}();sx.SyncEntity=lx,sx.default=lx;var fx={};Object.defineProperty(fx,"__esModule",{value:!0});var hx=function(){function e(t){xa(this,e),this.queuedRequests=[],this.isRequestInFlight=!1,this.inputMergingFunction=t}return pa(e,[{key:"add",value:function(e,t){var n=this,r=new Promise((function(r,i){return n.queuedRequests.push({input:e,requestFunction:t,resolve:r,reject:i})}));return this.wakeupQueue(),r}},{key:"squashAndAdd",value:function(e,t){var n,r=this.queuedRequests;this.queuedRequests=[],r.length>0?(n=r.map((function(e){return e.input})).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;var i=this.add(n,t);return r.forEach((function(e){return i.then(e.resolve,e.reject)})),i}},{key:"isEmpty",value:function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var e=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then((function(t){e.isRequestInFlight=!1,e.wakeupQueue()}))}}}]),e}();fx.MergingQueue=hx;var dx=function(){function e(t){xa(this,e),this.queueByNamespaceKey=new Map,this.inputReducer=t}var t,n;return pa(e,[{key:"add",value:function(){var e=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.add(n,r)})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"squashAndAdd",value:(n=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.squashAndAdd(n,r)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"invokeQueueMethod",value:(t=ha(Za.mark((function e(t,n){var r,i;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.queueByNamespaceKey.has(t)||this.queueByNamespaceKey.set(t,new hx(this.inputReducer)),r=this.queueByNamespaceKey.get(t),i=n(r),this.queueByNamespaceKey.get(t).isEmpty()&&this.queueByNamespaceKey.delete(t),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();fx.NamespacedMergingQueue=dx;var px={};function yx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(px,"__esModule",{value:!0});var vx=Rm,mx=function(e){ma(n,e);var t=yx(n);function n(){var e;return xa(this,n),(e=t.call(this)).closed=!1,e.uuid=vx(),e}return pa(n,[{key:"listenerUuid",get:function(){return this.uuid}},{key:"close",value:function(){this.removeAllListeners(),this.closed=!0}},{key:"ensureNotClosed",value:function(){if(this.closed)throw new Error("Invalid operation on closed object")}}]),n}(Hv.EventEmitter);function gx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}px.Closeable=mx,px.default=mx,Object.defineProperty(ox,"__esModule",{value:!0});var bx=iw,kx=uw,wx=hw,xx=fx,_x=px,Sx=function(e){ma(f,e);var t,n,r,i,a,o,s,u,c,l=gx(f);function f(e,t,n){var r;xa(this,f),(r=l.call(this,e,n)).isDeleted=!1;return r.updateMergingQueue=new xx.MergingQueue((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.descriptor=t,r.descriptor.data=r.descriptor.data||{},r.descriptor.date_updated=new Date(r.descriptor.date_updated),r}return pa(f,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"_update",value:function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":if(e.id<=this.lastEventId){wx.default.trace("Document update skipped, current:",this.lastEventId,", remote:",e.id);break}var t=void 0!==this.descriptor.data?kx.deepClone(this.descriptor.data):null;this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.broadcastEventToListeners("updated",{data:e.document_data,isLocal:!1,previousData:t}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data});break;case"document_removed":this.onRemoved(!1)}}},{key:"set",value:(c=ha(Za.mark((function e(t,n){var r,i=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},kx.validateOptionalTtl(r.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(r,(function(e){return i._setUnconditionally(t,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"mutate",value:(u=ha(Za.mark((function e(t,n){var r,i=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},kx.validateOptionalTtl(r.ttl),e.abrupt("return",this.updateMergingQueue.add(r,(function(e){return i._setWithIfMatch(t,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"update",value:(s=ha(Za.mark((function e(t,n){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate((function(e){return Object.assign(e,t)}),n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"setTtl",value:(o=ha(Za.mark((function e(t){var n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return kx.validateMandatoryTtl(t),e.next=3,this._postUpdateToServer({ttl:t});case 3:n=e.sent,this.descriptor.date_expires=n.date_expires;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_setUnconditionally",value:(a=ha(Za.mark((function e(t,n){var r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({data:t,revision:void 0,ttl:n});case 2:return r=e.sent,this._handleSuccessfulUpdateResult(r),e.abrupt("return",this.descriptor.data);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"_setWithIfMatch",value:(i=ha(Za.mark((function e(t,n){var r,i,a;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t(kx.deepClone(this.descriptor.data)))){e.next=22;break}return i=this.revision,e.prev=3,e.next=6,this._postUpdateToServer({data:r,revision:i,ttl:n});case 6:return a=e.sent,this._handleSuccessfulUpdateResult(a),e.abrupt("return",this.descriptor.data);case 11:if(e.prev=11,e.t0=e.catch(3),412!==e.t0.status){e.next=19;break}return e.next=16,this._softSync();case 16:return e.abrupt("return",this._setWithIfMatch(t));case 19:throw e.t0;case 20:e.next=23;break;case 22:return e.abrupt("return",this.descriptor.data);case 23:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(e,t){return i.apply(this,arguments)})},{key:"_handleSuccessfulUpdateResult",value:function(e){if(!(e.last_event_id<=this.descriptor.last_event_id)){var t=void 0!==this.descriptor.data?kx.deepClone(this.descriptor.data):null;this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.broadcastEventToListeners("updated",{data:this.descriptor.data,isLocal:!0,previousData:t})}}},{key:"_postUpdateToServer",value:(r=ha(Za.mark((function e(t){var n,r,i;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=17;break}return n={data:t.data},void 0!==t.ttl&&(n.ttl=t.ttl),r=t.revision,e.prev=4,e.next=7,this.services.network.post(this.uri,n,r);case 7:return i=e.sent,e.abrupt("return",{revision:i.body.revision,data:t.data,last_event_id:i.body.last_event_id,date_updated:i.body.date_updated,date_expires:i.body.date_expires});case 11:throw e.prev=11,e.t0=e.catch(4),404===e.t0.status&&this.onRemoved(!1),e.t0;case 15:e.next=18;break;case 17:return e.abrupt("return",Promise.reject(new bx.SyncError("The Document has been removed",404,54100)));case 18:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e){return r.apply(this,arguments)})},{key:"_softSync",value:(n=ha(Za.mark((function e(){var t=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.network.get(this.uri).then((function(e){var n={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return t._update(n),t})).catch((function(e){404===e.status?t.onRemoved(!1):wx.default.error("Can't get updates for ".concat(t.sid,":"),e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onRemoved",value:function(e){if(!this.isDeleted){var t=void 0!==this.descriptor.data?kx.deepClone(this.descriptor.data):null;this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e,previousData:t})}}},{key:"removeDocument",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",Promise.reject(new bx.SyncError("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"type",get:function(){return"document"}}]),f}(sx.SyncEntity);ox.SyncDocumentImpl=Sx;var Tx=function(e){ma(s,e);var t,n,r,i,a,o=gx(s);function s(e){var t;return xa(this,s),(t=o.call(this)).syncDocumentImpl=e,t.syncDocumentImpl.attach(ya(t)),t}return pa(s,[{key:"uri",get:function(){return this.syncDocumentImpl.uri}},{key:"revision",get:function(){return this.syncDocumentImpl.revision}},{key:"lastEventId",get:function(){return this.syncDocumentImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncDocumentImpl.dateExpires}},{key:"type",get:function(){return Sx.type}},{key:"sid",get:function(){return this.syncDocumentImpl.sid}},{key:"data",get:function(){return this.syncDocumentImpl.data}},{key:"dateUpdated",get:function(){return this.syncDocumentImpl.dateUpdated}},{key:"uniqueName",get:function(){return this.syncDocumentImpl.uniqueName}},{key:"set",value:(a=ha(Za.mark((function e(t,n){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.set(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"mutate",value:(i=ha(Za.mark((function e(t,n){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.mutate(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"update",value:(r=ha(Za.mark((function e(t,n){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.update(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"setTtl",value:(n=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeDocument",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.removeDocument());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){Kv(ka(s.prototype),"close",this).call(this),this.syncDocumentImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return Sx.type}}]),s}(_x.default);ox.SyncDocument=Tx,ox.default=Tx;var Ex={},Ix={};Object.defineProperty(Ix,"__esModule",{value:!0});var Cx=function(){function e(t){xa(this,e),this.descriptor=t}return pa(e,[{key:"uri",get:function(){return this.descriptor.uri}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.lastEventId}},{key:"dateUpdated",get:function(){return this.descriptor.dateUpdated}},{key:"dateExpires",get:function(){return this.descriptor.dateExpires}},{key:"index",get:function(){return this.descriptor.index}},{key:"data",get:function(){return this.descriptor.data}},{key:"update",value:function(e,t,n,r){return this.descriptor.lastEventId=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.dateUpdated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.dateExpires=e}}]),e}();Ix.ListItem=Cx,Ix.default=Cx;var Rx={};Object.defineProperty(Rx,"__esModule",{value:!0});var Paginator=function(){function Paginator(e,t,n,r){xa(this,Paginator),this.prevToken=n,this.nextToken=r,this.items=e,this.source=t}var e,t;return pa(Paginator,[{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}},{key:"nextPage",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"prevPage",value:(e=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]),Paginator}();Rx.Paginator=Paginator;var Ox={},Mx={};function Px(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ax(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ax(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ax(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(Mx,"__esModule",{value:!0});var Dx=function(){function e(t,n){xa(this,e),this.balanceFactor=0,this.key=t,this.value=n,this.parent=null,this.left=null,this.right=null}return pa(e,[{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}},{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}}]),e}(),jx=function(){function e(t,n){xa(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=n||function(e,t){return e===t},this.root=null,this.count=null}return pa(e,[{key:"size",get:function(){return this.count}},{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var n=this.getNode(e);n?n.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var n=new Dx(e,t);if(this.count++,this.root){for(var r=this.root;;)if(this.isLessThan(e,r.key)){if(!r.left){r.left=n;break}r=r.left}else{if(!r.right){r.right=n;break}r=r.right}for(n.parent=r,r=n;r.parent;){var i=r.parent,a=i.balanceFactor;if(r.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(a))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}r=i}}else this.root=n}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var n=t.parent,r=t.left,i=t.right;if(!!r!=!!i){var a=r||i;n||a?n&&!a?this.root=a:(n.replace(t,null),this.rebalance(n)):this.root=null}else{for(var o=t.left;o.right;)o=o.right;if(t.left===o)t.isRoot?(this.root=o,o.parent=null):(t.isLeftChild?t.parent.left=o:t.parent.right=o,o.parent=t.parent),o.right=t.right,o.right.parent=o,o.balanceFactor=t.balanceFactor,t={parent:o,isLeftChild:!0};else{var s=o.parent,u=o.left;s.right=u,u&&(u.parent=s),t.isRoot?(this.root=o,o.parent=null):(t.isLeftChild?t.parent.left=o:t.parent.right=o,o.parent=t.parent),o.right=t.right,o.right.parent=o,o.left=t.left,o.left.parent=o,o.balanceFactor=t.balanceFactor,t={parent:s,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:Symbol.iterator,value:Za.mark((function e(){var t,n,r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Px(this.getIterator()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"getIterator",value:Za.mark((function e(){var t,n,r,i=arguments;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.left)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)||null===t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:r=!0;case 11:if(!r){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(r=!1,!n.right){e.next=21;break}for(n=n.right;n.left;)n=n.left;r=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}r=n.parent.left===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}r=n.parent.left===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))},{key:"getReverseIterator",value:Za.mark((function e(){var t,n,r,i=arguments;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.right)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)&&null!==t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:r=!0;case 11:if(!r){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(r=!1,!n.left){e.next=21;break}for(n=n.left;n.right;)n=n.right;r=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}r=n.parent.right===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}r=n.parent.right===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))}]),e}();function Nx(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Lx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lx(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Lx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Mx.TreeMap=jx,Object.defineProperty(Ox,"__esModule",{value:!0});var Ux=Mx,Bx=function(){function e(t,n){xa(this,e),this.value=t,this.revision=n||0}return pa(e,[{key:"isValid",get:function(){return!0}}]),e}(),Fx=function(){function e(t){xa(this,e),this.revision=t}return pa(e,[{key:"isValid",get:function(){return!1}}]),e}(),qx=function(){function e(){xa(this,e),this.items=new Ux.TreeMap}return pa(e,[{key:"store",value:function(e,t,n){var r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new Bx(t,n)),t)}},{key:"delete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.items.get(e);(!r||r.revision<t||r&&!0===n)&&this.items.set(e,new Fx(t))}},{key:"isKnown",value:function(e,t){var n=this.items.get(e);return n&&n.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}},{key:"forEach",value:function(e){if(this.items){var t,n=Nx(this.items);try{for(n.s();!(t=n.n()).done;){var r=jy(t.value,2),i=r[0],a=r[1];a.isValid&&e(i,a.value)}}catch(e){n.e(e)}finally{n.f()}}}}]),e}();function Wx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Ox.Cache=qx,Ox.default=qx,Object.defineProperty(Ex,"__esModule",{value:!0});var zx=uw,Gx=nw,Jx=iw,Vx=hw,$x=Ix,Kx=Rx,Qx=Ox,Hx=fx,Xx=px,Yx=function(e){ma(y,e);var t,n,r,i,a,o,s,u,c,l,f,h,d,p=Wx(y);function y(e,t,n){var r;xa(this,y);return(r=p.call(this,e,n)).updateMergingQueue=new Hx.NamespacedMergingQueue((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.cache=new Qx.Cache,r.descriptor=t,r.descriptor.date_updated=new Date(r.descriptor.date_updated),r}return pa(y,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"_addOrUpdateItemOnServer",value:(d=ha(Za.mark((function e(t,n,r,i){var a,o;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={data:n},void 0!==i&&(a.ttl=i),e.next=4,this.services.network.post(t,a,r);case 4:return(o=e.sent).body.data=n,o.body.date_updated=new Date(o.body.date_updated),e.abrupt("return",o.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return d.apply(this,arguments)})},{key:"push",value:(h=ha(Za.mark((function e(t,n){var r,i,a;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n||{}).ttl,zx.validateOptionalTtl(r),e.next=4,this._addOrUpdateItemOnServer(this.links.items,t,void 0,r);case 4:return i=e.sent,a=Number(i.index),this._handleItemMutated(a,i.url,i.last_event_id,i.revision,t,i.date_updated,i.date_expires,!0,!1),e.abrupt("return",this.cache.get(a));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"set",value:(f=ha(Za.mark((function e(t,n,r){var i,a=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},zx.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return a._updateItemUnconditionally(t,n,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"_updateItemUnconditionally",value:(l=ha(Za.mark((function e(t,n,r){var i,a;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return i=e.sent,e.next=5,this._addOrUpdateItemOnServer(i.uri,n,void 0,r);case 5:return a=e.sent,this._handleItemMutated(t,a.url,a.last_event_id,a.revision,a.data,a.date_updated,a.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"_updateItemWithIfMatch",value:(c=ha(Za.mark((function e(t,n,r){var i,a,o,s;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:if(i=e.sent,!(a=n(zx.deepClone(i.data)))){e.next=25;break}return o=i.revision,e.prev=6,e.next=9,this._addOrUpdateItemOnServer(i.uri,a,o,r);case 9:return s=e.sent,this._handleItemMutated(t,s.url,s.last_event_id,s.revision,s.data,s.date_updated,s.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 14:if(e.prev=14,e.t0=e.catch(6),412!==e.t0.status){e.next=22;break}return e.next=19,this._getItemFromServer(t);case 19:return e.abrupt("return",this._updateItemWithIfMatch(t,n,r));case 22:throw e.t0;case 23:e.next=26;break;case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(e,t,n){return c.apply(this,arguments)})},{key:"mutate",value:(u=ha(Za.mark((function e(t,n,r){var i,a=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},zx.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return a._updateItemWithIfMatch(t,n,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"update",value:(s=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"remove",value:function(){var e=ha(Za.mark((function e(t){var n,r,i;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,r=zx.deepClone(n.data),e.next=6,this.services.network.delete(n.uri);case 6:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,r,new Date(i.body.date_updated),!1);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=ha(Za.mark((function e(t){var n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))){e.next=5;break}return e.abrupt("return",n);case 5:return e.abrupt("return",this._getItemFromServer(t));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:(o=ha(Za.mark((function e(t){var n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({index:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new Jx.SyncError("No item with index ".concat(t," found"),404,54151);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"queryItems",value:function(){var e=ha(Za.mark((function e(t){var n,r,i,a,o=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new Gx.UriBuilder(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Index",t.index).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),o.cache.get(e.index)?o._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):o.cache.store(Number(e.index),new $x.ListItem({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,data:e.data}),e.last_event_id),o.cache.get(e.index)})),a=r.body.meta,e.abrupt("return",new Kx.Paginator(i,(function(e){return o.queryItems({pageToken:e})}),a.previous_token,a.next_token));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:(a=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},zx.validatePageSize(t.pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getContext",value:(i=ha(Za.mark((function e(){var t;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=5;break}return e.next=3,this.services.network.get(this.links.context);case 3:t=e.sent,this._updateContextIfRequired(t.body.data,t.body.last_event_id);case 5:return e.abrupt("return",this.context);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setTtl",value:(r=ha(Za.mark((function e(t){var n,r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zx.validateMandatoryTtl(t),e.prev=1,n={ttl:t},e.next=5,this.services.network.post(this.uri,n);case 5:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=ha(Za.mark((function e(t,n){var r,i,a;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zx.validateMandatoryTtl(n),e.next=3,this.get(t);case 3:return r=e.sent,i={ttl:n},e.next=7,this.services.network.post(r.uri,i);case 7:a=e.sent,r.updateDateExpires(a.body.date_expires);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeList",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){var n=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(n,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(n,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,a,o,s,u){if(this.shouldIgnoreEvent(e,n))Vx.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(a);var c=this.cache.get(e);if(!c){var l=new $x.ListItem({index:e,uri:t,lastEventId:n,revision:r,data:i,dateUpdated:a,dateExpires:o});return this.cache.store(e,l,n),void this.emitItemMutationEvent(l,u,s)}var f=zx.deepClone(c.data);c.update(n,r,i,a),this.cache.store(e,c,n),void 0!==o&&c.updateDateExpires(o),this.emitItemMutationEvent(c,u,!1,f)}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n?"itemAdded":"itemUpdated",a={item:e,isLocal:!t};n||(a.previousItemData=r),this.broadcastEventToListeners(i,a)}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{index:e,isLocal:!i,previousItemData:n})}},{key:"_handleContextUpdate",value:function(e,t,n){this._updateRootDateUpdated(n),this._updateContextIfRequired(e,t)&&this.broadcastEventToListeners("contextUpdated",{context:e,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(Vx.default.trace("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}}],[{key:"type",get:function(){return"list"}}]),y}(sx.SyncEntity);Ex.SyncListImpl=Yx;var Zx=function(e){ma(d,e);var t,n,r,i,a,o,s,u,c,l,f,h=Wx(d);function d(e){var t;return xa(this,d),(t=h.call(this)).syncListImpl=e,t.syncListImpl.attach(ya(t)),t}return pa(d,[{key:"uri",get:function(){return this.syncListImpl.uri}},{key:"revision",get:function(){return this.syncListImpl.revision}},{key:"lastEventId",get:function(){return this.syncListImpl.lastEventId}},{key:"links",get:function(){return this.syncListImpl.links}},{key:"dateExpires",get:function(){return this.syncListImpl.dateExpires}},{key:"type",get:function(){return Yx.type}},{key:"sid",get:function(){return this.syncListImpl.sid}},{key:"uniqueName",get:function(){return this.syncListImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncListImpl.dateUpdated}},{key:"push",value:(f=ha(Za.mark((function e(t,n){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.push(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"set",value:(l=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"mutate",value:(c=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"update",value:(u=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(s=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"get",value:(o=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getContext",value:(a=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getContext());case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getItems",value:(i=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=ha(Za.mark((function e(t,n){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeList",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.removeList());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){Kv(ka(d.prototype),"close",this).call(this),this.syncListImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return Yx.type}}]),d}(Xx.default);Ex.SyncList=Zx,Ex.default=Zx;var e_={},t_={};Object.defineProperty(t_,"__esModule",{value:!0});var n_=function(){function e(t){xa(this,e),this.descriptor=t}return pa(e,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"update",value:function(e,t,n,r){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.date_updated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.date_expires=e}}]),e}();function r_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}t_.MapItem=n_,Object.defineProperty(e_,"__esModule",{value:!0});var i_=uw,a_=nw,o_=iw,s_=hw,u_=t_,c_=Rx,l_=Ox,f_=fx,h_=px,d_=function(e){ma(d,e);var t,n,r,i,a,o,s,u,c,l,f,h=r_(d);function d(e,t,n){var r;xa(this,d);return(r=h.call(this,e,n)).updateMergingQueue=new f_.NamespacedMergingQueue((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.cache=new l_.Cache,r.descriptor=t,r.descriptor.date_updated=new Date(r.descriptor.date_updated),t.items&&t.items.forEach((function(e){e.date_updated=new Date(e.date_updated),r.cache.store(e.key,new u_.MapItem(e),e.last_event_id)})),r}return pa(d,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"set",value:(f=ha(Za.mark((function e(t,n,r){var i,a=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},i_.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return a._putItemUnconditionally(t,n,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"get",value:function(){var e=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new o_.SyncError("Item key may not be empty",400,54209);case 2:if(!this.cache.has(t)){e.next=6;break}return e.abrupt("return",this.cache.get(t));case 6:return e.abrupt("return",this._getItemFromServer(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:(l=ha(Za.mark((function e(t){var n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({key:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new o_.SyncError("The specified Map Item does not exist",404,54201);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"mutate",value:(c=ha(Za.mark((function e(t,n,r){var i,a=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},i_.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return a._putItemWithIfMatch(t,n,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"update",value:(u=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"_putItemUnconditionally",value:(s=ha(Za.mark((function e(t,n,r){var i,a;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._putItemToServer(t,n,void 0,r);case 2:return i=e.sent,a=i.item,this._handleItemMutated(a.key,a.url,a.last_event_id,a.revision,a.data,a.date_updated,a.date_expires,i.added,!1),e.abrupt("return",this.cache.get(a.key));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"_putItemWithIfMatch",value:(o=ha(Za.mark((function e(t,n,r){var i,a,o,s,u;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t).catch((function(e){if(404===e.status)return new u_.MapItem({key:t,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw e}));case 2:if(i=e.sent,!(a=n(i_.deepClone(i.data)))){e.next=26;break}return o=i.revision,e.prev=6,e.next=9,this._putItemToServer(t,a,o,r);case 9:return s=e.sent,u=s.item,this._handleItemMutated(u.key,u.url,u.last_event_id,u.revision,u.data,u.date_updated,u.date_expires,s.added,!1),e.abrupt("return",this.cache.get(u.key));case 15:if(e.prev=15,e.t0=e.catch(6),412!==e.t0.status){e.next=23;break}return e.next=20,this._getItemFromServer(t);case 20:return e.abrupt("return",this._putItemWithIfMatch(t,n,r));case 23:throw e.t0;case 24:e.next=27;break;case 26:return e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(e,t,n){return o.apply(this,arguments)})},{key:"_putItemToServer",value:(a=ha(Za.mark((function e(t,n,r,i){var a,o,s,u,c;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new a_.UriBuilder(this.links.items).pathSegment(t).build(),o={data:n},void 0!==i&&(o.ttl=i),e.prev=3,e.next=6,this.services.network.put(a,o,r);case 6:return s=e.sent,(u=s.body).data=n,u.date_updated=new Date(u.date_updated),c=201===s.status.code,e.abrupt("return",{added:c,item:u});case 14:throw e.prev=14,e.t0=e.catch(3),404===e.t0.status&&this.onRemoved(!1),e.t0;case 18:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"remove",value:function(){var e=ha(Za.mark((function e(t){var n,r,i;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,r=i_.deepClone(n.data),e.next=6,this.services.network.delete(n.uri);case 6:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,r,new Date(i.body.date_updated),!1);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryItems",value:function(){var e=ha(Za.mark((function e(t){var n,r,i,a,o=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new a_.UriBuilder(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Key",t.key).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),o.cache.get(e.key)?o._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):o.cache.store(e.key,new u_.MapItem(e),e.last_event_id),o.cache.get(e.key)})),a=r.body.meta,e.abrupt("return",new c_.Paginator(i,(function(e){return o.queryItems({pageToken:e})}),a.previous_token,a.next_token));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:(i=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},i_.validatePageSize(t.pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,a,o,s,u){if(this.shouldIgnoreEvent(e,n))s_.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(a);var c=this.cache.get(e);if(!c){var l=new u_.MapItem({key:e,url:t,last_event_id:n,revision:r,data:i,date_updated:a,date_expires:o});return this.cache.store(e,l,n),void this.emitItemMutationEvent(l,u,s)}var f=i_.deepClone(c.data);c.update(n,r,i,a),this.cache.store(e,c,n),void 0!==o&&c.updateDateExpires(o),this.emitItemMutationEvent(c,u,!1,f)}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n?"itemAdded":"itemUpdated",a={item:e,isLocal:!t};n||(a.previousItemData=r),this.broadcastEventToListeners(i,a)}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{key:e,isLocal:!i,previousItemData:n})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"setTtl",value:(r=ha(Za.mark((function e(t){var n,r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i_.validateMandatoryTtl(t),e.prev=1,n={ttl:t},e.next=5,this.services.network.post(this.uri,n);case 5:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=ha(Za.mark((function e(t,n){var r,i,a;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i_.validateMandatoryTtl(n),e.next=3,this.get(t);case 3:return r=e.sent,i={ttl:n},e.next=7,this.services.network.post(r.uri,i);case 7:a=e.sent,r.updateDateExpires(a.body.date_expires);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeMap",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"type",get:function(){return"map"}}]),d}(sx.SyncEntity);e_.SyncMapImpl=d_;var p_=function(e){ma(f,e);var t,n,r,i,a,o,s,u,c,l=r_(f);function f(e){var t;return xa(this,f),(t=l.call(this)).syncMapImpl=e,t.syncMapImpl.attach(ya(t)),t}return pa(f,[{key:"uri",get:function(){return this.syncMapImpl.uri}},{key:"links",get:function(){return this.syncMapImpl.links}},{key:"revision",get:function(){return this.syncMapImpl.revision}},{key:"lastEventId",get:function(){return this.syncMapImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncMapImpl.dateExpires}},{key:"type",get:function(){return d_.type}},{key:"sid",get:function(){return this.syncMapImpl.sid}},{key:"uniqueName",get:function(){return this.syncMapImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncMapImpl.dateUpdated}},{key:"set",value:(c=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"get",value:(u=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"mutate",value:(s=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"update",value:(o=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"remove",value:(a=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getItems",value:(i=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=ha(Za.mark((function e(t,n){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeMap",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.next=3,this.syncMapImpl.removeMap();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){Kv(ka(f.prototype),"close",this).call(this),this.syncMapImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return d_.type}}]),f}(h_.Closeable);e_.SyncMap=p_,e_.default=p_;var y_={};Object.defineProperty(y_,"__esModule",{value:!0});var v_=$g.exports,m_=function e(t){xa(this,e),this.sdk="js",this.sdkVer=t,this.os=v_.os.family,this.osVer=v_.os.version,this.pl=v_.name,this.plVer=v_.version};y_.ClientInfo=m_,y_.default=m_;var g_={};Object.defineProperty(g_,"__esModule",{value:!0});var b_=function(){function e(){xa(this,e),this.names=new Map,this.entities=new Map}return pa(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();g_.EntitiesCache=b_;var k_={};Object.defineProperty(k_,"__esModule",{value:!0});var w_=function(){function e(t,n){xa(this,e),this.config=t,this.storageId=null;try{this.storage=n||sessionStorage}catch(e){}}return pa(e,[{key:"storageKey",value:function(e,t){return"".concat(this.storageId,"::").concat(e,"::").concat(t)}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(e){}}},{key:"update",value:function(e,t,n,r){if(!this.isReady)return null;this._apply(this.storageKey(e,t),r),n&&this._apply(this.storageKey(e,n),r)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,JSON.stringify(t))}catch(e){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}},{key:"_apply",value:function(e,t){var n=this._read(e);if(!n)return!1;this._store(e,Object.assign(n,t))}}]),e}();k_.SessionStorage=w_;var x_={};function __(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(x_,"__esModule",{value:!0});var S_=uw,T_=px,E_=function(e){ma(a,e);var t,n,r,i=__(a);function a(e,t,n){var r;return xa(this,a),(r=i.call(this,e,n)).descriptor=t,r}return pa(a,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"publishMessage",value:(r=ha(Za.mark((function e(t){var n,r,i,a;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={data:t},e.next=3,this.services.network.post(this.links.messages,n);case 3:return r=e.sent,i=r.body,a=this._handleMessagePublished(i.sid,t,!1),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setTtl",value:(n=ha(Za.mark((function e(t){var n,r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S_.validateMandatoryTtl(t),e.prev=1,n={ttl:t},e.next=5,this.services.network.post(this.uri,n);case 5:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return n.apply(this,arguments)})},{key:"removeStream",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_update",value:function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{key:"_handleMessagePublished",value:function(e,t,n){var r={sid:e,value:t};return this.broadcastEventToListeners("messagePublished",{message:r,isLocal:!n}),r}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}}],[{key:"type",get:function(){return"stream"}}]),a}(sx.SyncEntity);x_.SyncStreamImpl=E_;var I_=function(e){ma(a,e);var t,n,r,i=__(a);function a(e){var t;return xa(this,a),(t=i.call(this)).syncStreamImpl=e,t.syncStreamImpl.attach(ya(t)),t}return pa(a,[{key:"uri",get:function(){return this.syncStreamImpl.uri}},{key:"links",get:function(){return this.syncStreamImpl.links}},{key:"dateExpires",get:function(){return this.syncStreamImpl.dateExpires}},{key:"type",get:function(){return E_.type}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.syncStreamImpl.sid}},{key:"uniqueName",get:function(){return this.syncStreamImpl.uniqueName}},{key:"publishMessage",value:(r=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.publishMessage(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setTtl",value:(n=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeStream",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.removeStream());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){Kv(ka(a.prototype),"close",this).call(this),this.syncStreamImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return E_.type}}]),a}(T_.default);x_.SyncStream=I_,x_.default=I_;var C_={};function R_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(C_,"__esModule",{value:!0});var O_=nw,M_=iw,P_=hw,A_=Hv,D_=sx,j_=px,N_=Ox;C_.InsightsItem=function e(){xa(this,e)};var L_=function(e){ma(n,e);var t=R_(n);function n(e,r,i,a){var o;return xa(this,n),(o=t.call(this,r,i)).descriptor=e,o.cache=new N_.Cache,a&&a.forEach((function(e){o.cache.store(e.key,{key:e.key,value:e.data},e.revision)})),o}return pa(n,[{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return null}},{key:"type",get:function(){return n.type}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"indexName",get:function(){return this.descriptor.indexName}},{key:"queryString",get:function(){return this.descriptor.queryExpression}},{key:"queryUri",get:function(){return this.descriptor.queryUri}},{key:"liveQueryDescriptor",get:function(){return this.descriptor}},{key:"onRemoved",value:function(){}},{key:"getItems",value:function(){var e={};return this.cache.forEach((function(t,n){e[t]=n.value})),e}},{key:"_update",value:function(e,t){switch(e.type){case"live_query_item_updated":this.handleItemMutated(e.item_key,e.item_data,e.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(e.item_key,e.item_revision);break;case"live_query_updated":this.handleBatchUpdate(e.items)}t&&this._advanceLastEventId(e.last_event_id)}},{key:"handleItemMutated",value:function(e,t,n){if(this.shouldIgnoreEvent(e,n))P_.default.trace("Item ".concat(e," update skipped, revision: ").concat(n));else{var r={key:e,value:t};this.cache.store(e,r,n),this.broadcastEventToListeners("itemUpdated",r)}}},{key:"handleItemRemoved",value:function(e,t){var n=null===t;this.shouldIgnoreEvent(e,t)?P_.default.trace("Item ".concat(e," delete skipped, revision: ").concat(t)):(this.cache.delete(e,t,n),this.broadcastEventToListeners("itemRemoved",{key:e}))}},{key:"handleBatchUpdate",value:function(e){var t=this,n={};for(var r in null!=e&&e.forEach((function(e){n[e.key]={data:e.data,revision:e.revision}})),this.cache.forEach((function(e,r){var i=n[e];null!=i?t.handleItemMutated(e,i.data,i.revision):t.handleItemRemoved(e,null),delete n[e]})),n)this.handleItemMutated(r,n[r].data,n[r].revision)}},{key:"shouldIgnoreEvent",value:function(e,t){return null!=e&&null!=t&&this.cache.isKnown(e,t)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e)}}],[{key:"type",get:function(){return"live_query"}}]),n}(D_.SyncEntity);function U_(e){return B_.apply(this,arguments)}function B_(){return(B_=ha(Za.mark((function e(t){var n,r,i,a,o,s;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.network,r=t.queryString,i=t.uri,a=t.type,null!=r){e.next=3;break}throw new M_.SyncError("Invalid query",400,54507);case 3:return o={query_string:r},a===F_.type&&(o.type=a),e.next=7,n.post(i,o,void 0,!0);case 7:return s=e.sent,e.abrupt("return",s.body);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}C_.LiveQueryImpl=L_,C_.queryItems=U_;var F_=function(e){ma(n,e);var t=R_(n);function n(e){var r;return xa(this,n),(r=t.call(this)).liveQueryImpl=e,r.liveQueryImpl.attach(ya(r)),r}return pa(n,[{key:"type",get:function(){return L_.type}},{key:"lastEventId",get:function(){return this.liveQueryImpl.lastEventId}},{key:"sid",get:function(){return this.liveQueryImpl.sid}},{key:"close",value:function(){Kv(ka(n.prototype),"close",this).call(this),this.liveQueryImpl.detach(this.listenerUuid)}},{key:"getItems",value:function(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}],[{key:"type",get:function(){return L_.type}}]),n}(j_.Closeable);C_.LiveQuery=F_;var q_=function(e){ma(i,e);var t,n,r=R_(i);function i(e){var t;return xa(this,i),(t=r.call(this)).queryExpression=null,t.items={},Object.assign(ya(t),e),t.updateIndexName(e.indexName),t}return pa(i,[{key:"type",get:function(){return i.type}},{key:"search",value:(n=ha(Za.mark((function e(t){var n=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.items={},e.abrupt("return",U_({network:this.network,uri:this.queryUri,queryString:t}).then((function(e){n.queryExpression=t,e.items&&e.items.forEach((function(e){n.items[e.key]=e.data})),n.emit("searchResult",n.getItems())})).catch((function(e){throw P_.default.error("Error '".concat(e.message,"' while executing query '").concat(t,"'")),n.queryExpression=null,e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"subscribe",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.queryExpression){e.next=2;break}return e.abrupt("return",Promise.reject(new M_.SyncError("Invalid query",400,54507)));case 2:return e.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getItems",value:function(){return this.items}},{key:"updateIndexName",value:function(e){if(!e||"string"!=typeof e)throw new Error("Index name must contain a non-empty string value");this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}},{key:"generateQueryUri",value:function(e){return new O_.UriBuilder(this.insightsUri).pathSegment(e).pathSegment("Items").build()}}],[{key:"type",get:function(){return"instant_query"}}]),i}(A_.EventEmitter);C_.InstantQuery=q_,C_.default=F_;var W_="1.0.0";function z_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(tw,"__esModule",{value:!0});var G_=$v,J_=lk,V_=nw,$_=iw,K_=uw,Q_=hw,H_=yw,X_=Sw,Y_=zw,Z_=Hw,eS=ox,tS=Ex,nS=e_,rS=y_,iS=g_,aS=k_,oS=x_,sS=C_,uS=C_,cS="data_sync",lS=W_;function fS(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};K_.validateOptionalTtl(e.ttl),K_.validateId(e.id),e.mode&&K_.validateMode(e.mode);var t=e.mode||(e.id?"open_or_create":"create_new");return Object.assign(Object.assign({},e),{mode:t})}return{mode:"create_new"}}var hS=function(e){ma(Client,e);var t,n,r,i,a,o,s,u,c,l,f,h,d,p,y,v=z_(Client);function Client(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(xa(this,Client),t=v.call(this),!e)throw new Error("Sync library needs a valid Twilio token to be passed");n.hasOwnProperty("logLevel")?Q_.default.setLevel(n.logLevel):Q_.default.setLevel("silent");var r=n.productId=n.productId||cS;n.clientMetadata=n.clientMetadata||{},n.clientMetadata.hasOwnProperty("type")||(n.clientMetadata.type="sync"),n.clientMetadata.hasOwnProperty("sdk")||(n.clientMetadata.sdk="JS",n.clientMetadata.sdkv=lS);var i=n.twilsockClient=n.twilsockClient||new G_.Twilsock(e,r,n);i.on("tokenAboutToExpire",(function(e){return t.emit("tokenAboutToExpire",e)})),i.on("tokenExpired",(function(){return t.emit("tokenExpired")})),i.on("connectionError",(function(e){return t.emit("connectionError",e)}));var a=n.notificationsClient=n.notificationsClient||new J_.Notifications(e,n),o=new H_.Configuration(n),s=new Z_.NetworkService(new rS.ClientInfo(lS),o,i),u=new aS.SessionStorage(o);t.localStorageId=null,i.connect(),t.services={config:o,twilsock:i,notifications:a,network:s,storage:u,router:null,subscriptions:null};var c=new X_.Subscriptions(t.services),l=new Y_.Router({config:o,subscriptions:c,notifications:a});return t.services.router=l,t.services.subscriptions=c,t.entities=new iS.EntitiesCache,a.on("connectionStateChanged",(function(){t.emit("connectionStateChanged",t.services.notifications.connectionState)})),t}return pa(Client,[{key:"connectionState",get:function(){return this.services.notifications.connectionState}},{key:"ensureReady",value:(y=ha(Za.mark((function e(){var t;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.services.config.sessionStorageEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.services.twilsock.storageId();case 5:t=e.sent,this.services.storage.updateStorageId(t.id),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),Q_.default.warn("Failed to initialize storage",e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(){return y.apply(this,arguments)})},{key:"storeRootInSessionCache",value:function(e,t,n){if(this.services.config.sessionStorageEnabled&&t){var r=K_.deepClone(n);e!==tS.SyncList.type&&e!==nS.SyncMap.type||(r.last_event_id=null,delete r.items),this.services.storage.store(e,t,r)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:(p=ha(Za.mark((function e(t,n){var r,i,a,o=arguments;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>2&&void 0!==o[2]&&o[2],n){e.next=3;break}throw new $_.SyncError("Cannot get entity without id",404);case 3:return i=new V_.UriBuilder(t).pathSegment(n).queryParam("Include",r?"items":void 0).build(),e.next=6,this.services.network.get(i);case 6:return a=e.sent,e.abrupt("return",a.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"_createDocument",value:function(e,t,n){var r={unique_name:e,data:t||{}};return void 0!==n&&(r.ttl=n),this.services.network.post(this.services.config.documentsUri,r).then((function(e){return e.body.data=r.data,e.body}))}},{key:"_getDocument",value:(d=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(eS.SyncDocument.type,t)||this._get(this.services.config.documentsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"_createList",value:function(e,t,n,r){var i={unique_name:e,purpose:t,context:n};return void 0!==r&&(i.ttl=r),this.services.network.post(this.services.config.listsUri,i).then((function(e){return e.body}))}},{key:"_getList",value:(h=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(tS.SyncList.type,t)||this._get(this.services.config.listsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"_createMap",value:function(e,t){var n={unique_name:e};return void 0!==t&&(n.ttl=t),this.services.network.post(this.services.config.mapsUri,n).then((function(e){return e.body}))}},{key:"_getMap",value:(f=ha(Za.mark((function e(t){var n,r=arguments;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],e.abrupt("return",this.readRootFromSessionCache(nS.SyncMap.type,t)||this._get(this.services.config.mapsUri,t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"_getStream",value:(l=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(oS.SyncStream.type,t)||this._get(this.services.config.streamsUri,t,!1));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"_createStream",value:(c=ha(Za.mark((function e(t,n){var r,i;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={unique_name:t},void 0!==n&&(r.ttl=n),e.next=4,this.services.network.post(this.services.config.streamsUri,r);case 4:return i=e.sent,e.abrupt("return",i.body);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"_getLiveQuery",value:function(e){return this.readRootFromSessionCache(sS.LiveQuery.type,e)}},{key:"getCached",value:function(e,t){return e&&this.entities.get(e,t)||null}},{key:"removeFromCacheAndSession",value:function(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}},{key:"document",value:(u=ha(Za.mark((function e(t){var n,r,i,a,o=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=fS(t)).mode){e.next=9;break}return e.next=6,this._createDocument(n.id,n.data,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,eS.SyncDocument.type))){e.next=14;break}return e.abrupt("return",new eS.SyncDocument(i));case 14:return e.prev=14,e.next=17,this._getDocument(n.id);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createDocument(n.id,n.data,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.document(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(eS.SyncDocument.type,n.id,r),a=new eS.SyncDocumentImpl(this.services,r,(function(e,t,n){return o.removeFromCacheAndSession(e,t,n)})),a=this.entities.store(a),e.abrupt("return",new eS.SyncDocument(a));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return u.apply(this,arguments)})},{key:"map",value:(s=ha(Za.mark((function e(t){var n,r,i,a,o=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=fS(t)).mode){e.next=9;break}return e.next=6,this._createMap(n.id,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,nS.SyncMap.type))){e.next=14;break}return e.abrupt("return",new nS.SyncMap(i));case 14:return e.prev=14,e.next=17,this._getMap(n.id,n.includeItems);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createMap(n.id,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.map(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(nS.SyncMap.type,n.id,r),a=new nS.SyncMapImpl(this.services,r,(function(e,t,n){return o.removeFromCacheAndSession(e,t,n)})),a=this.entities.store(a),e.abrupt("return",new nS.SyncMap(a));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return s.apply(this,arguments)})},{key:"list",value:(o=ha(Za.mark((function e(t){var n,r,i,a,o=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=fS(t)).mode){e.next=9;break}return e.next=6,this._createList(n.id,n.purpose,n.context,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,tS.SyncList.type))){e.next=14;break}return e.abrupt("return",new tS.SyncList(i));case 14:return e.prev=14,e.next=17,this._getList(n.id);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createList(n.id,n.purpose,n.context,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.list(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(tS.SyncList.type,n.id,r),a=new tS.SyncListImpl(this.services,r,(function(e,t,n){return o.removeFromCacheAndSession(e,t,n)})),a=this.entities.store(a),e.abrupt("return",new tS.SyncList(a));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return o.apply(this,arguments)})},{key:"stream",value:(a=ha(Za.mark((function e(t){var n,r,i,a,o,s=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=fS(t)).mode){e.next=9;break}return e.next=6,this._createStream(n.id,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,oS.SyncStream.type))){e.next=14;break}return e.abrupt("return",new oS.SyncStream(i));case 14:return e.prev=14,e.next=17,this._getStream(n.id);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createStream(n.id,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.stream(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(oS.SyncStream.type,n.id,r),a=function(e,t,n){return s.removeFromCacheAndSession(e,t,n)},o=new oS.SyncStreamImpl(this.services,r,a),o=this.entities.store(o),e.abrupt("return",new oS.SyncStream(o));case 44:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return a.apply(this,arguments)})},{key:"shutdown",value:(i=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateToken",value:(r=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("A valid Twilio token should be provided")));case 2:return e.abrupt("return",this.services.twilsock.updateToken(t).catch((function(e){var t,n=null===(t=null==e?void 0:e.reply)||void 0===t?void 0:t.status;if(401===(null==n?void 0:n.code)&&"UNAUTHORIZED"===(null==n?void 0:n.status))throw new $_.SyncError("Updated token was rejected by server",400,51130);throw e})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"liveQuery",value:(n=ha(Za.mark((function e(t,n){var r,i,a,o,s,u=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(t&&"string"==typeof t){e.next=4;break}throw new Error("Index name must contain a non-empty string value");case 4:return r=new V_.UriBuilder(this.services.config.insightsUri).pathSegment(t).pathSegment("Items").build(),e.next=7,uS.queryItems({network:this.services.network,uri:r,queryString:n,type:sS.LiveQuery.type});case 7:return i=e.sent,(a=this.getCached(i.query_id,sS.LiveQuery.type))||((o=this._getLiveQuery(i.query_id))||(o={indexName:t,queryExpression:n,sid:i.query_id,queryUri:r,last_event_id:i.last_event_id}),s=function(e,t,n){return u.removeFromCacheAndSession(e,t,n)},a=new sS.LiveQueryImpl(o,this.services,s,i.items)),this.storeRootInSessionCache(sS.LiveQuery.type,i.query_id,a.liveQueryDescriptor),a=this.entities.store(a),e.abrupt("return",new sS.LiveQuery(a));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"instantQuery",value:(t=ha(Za.mark((function e(t){var n,r,i=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return n=function(e,t){return i.liveQuery(e,t)},r=new sS.InstantQuery({indexName:t,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:n}),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"version",get:function(){return lS}}]),Client}(Hv.EventEmitter);tw.Client=hS,tw.SyncClient=hS,tw.default=hS,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=tw;t.SyncClient=n.SyncClient;var r=ox;t.SyncDocument=r.SyncDocument;var i=Ex;t.SyncList=i.SyncList;var a=Ix;t.SyncListItem=a.ListItem;var o=e_;t.SyncMap=o.SyncMap;var s=t_;t.SyncMapItem=s.MapItem,t.default=n.SyncClient,e.exports=n.SyncClient,e.exports.SyncClient=n.SyncClient}(ew,ew.exports);var dS={},pS={};Object.defineProperty(pS,"__esModule",{value:!0}),pS.Logger=void 0;var yS=Jh.exports;function vS(e,t){return["".concat((new Date).toISOString()," MCS Client ").concat(e,":")].concat(Array.from(t))}var mS=function(){function e(t){xa(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?t+" ":""}return pa(e,[{key:"setLevel",value:function(e){yS.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];yS.trace.apply(null,vS(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];yS.debug.apply(null,vS(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];yS.info.apply(null,vS(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];yS.warn.apply(null,vS(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];yS.error.apply(null,vS(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){yS.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];yS.trace.apply(null,vS("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];yS.debug.apply(null,vS("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];yS.info.apply(null,vS("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];yS.warn.apply(null,vS("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];yS.error.apply(null,vS("E",t))}}]),e}();pS.Logger=mS;var gS={};Object.defineProperty(gS,"__esModule",{value:!0}),gS.Configuration=void 0;var bS=function(){function e(t,n,r){xa(this,e);var i=r.MCS||r||{};this.region=i.region||r.region,this.baseUrl=n,this.token=t,this.retryWhenThrottledOverride=i.retryWhenThrottledOverride,this.backoffConfigOverride=i.backoffConfigOverride}return pa(e,[{key:"updateToken",value:function(e){this.token=e}}],[{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}},{key:"retryWhenThrottledDefault",get:function(){return true}}]),e}();gS.Configuration=bS;var kS={};Object.defineProperty(kS,"__esModule",{value:!0}),kS.Media=void 0;var wS=function(){function Media(e,t,n){xa(this,Media),this.config=e,this.network=t,this._update(n)}var e;return pa(Media,[{key:"sid",get:function(){return this.state.sid}},{key:"serviceSid",get:function(){return this.state.serviceSid}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"fileName",get:function(){return this.state.filename}},{key:"getContentUrl",value:(e=ha(Za.mark((function e(){var t;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.get("".concat(this.config.baseUrl,"/").concat(this.sid));case 2:return t=e.sent,this._update(t.body),e.abrupt("return",Promise.resolve(this.state.contentDirectUrl));case 5:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"_update",value:function(e){this.state={sid:e.sid,serviceSid:e.service_sid,channelSid:e.channel_sid,messageSid:e.message_sid,dateCreated:e.date_created?new Date(e.date_created):null,dateUpdated:e.date_updated?new Date(e.date_updated):null,size:e.size,contentType:e.content_type,url:e.url,contentUrl:e.links.content,contentDirectUrl:e.links.content_direct_temporary,filename:e.filename?e.filename:null}}}]),Media}();kS.Media=wS;var xS={},_S={};function SS(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(_S,"__esModule",{value:!0}),_S.TransportError=void 0;var TS=function(e){ma(n,e);var t=SS(n);function n(e,r,i,a,o){var s;return xa(this,n),(s=t.call(this,e)).code=r,s.body=i,s.status=a,s.headers=o,s}return n}(vg(Error));_S.TransportError=TS,Object.defineProperty(xS,"__esModule",{value:!0}),xS.Transport=void 0;var ES=_S,IS=t.XMLHttpRequest||ab.XMLHttpRequest;var CS=function(){function e(){xa(this,e)}return pa(e,[{key:"get",value:function(t,n){return e.request("GET",t,n)}},{key:"post",value:function(t,n,r){return e.request("POST",t,n,r)}}],[{key:"request",value:function(e,t,n,r){return new Promise((function(i,a){var o=new IS;for(var s in o.open(e,t,!0),o.onreadystatechange=function(){if(4===o.readyState){var e,t=(e=o.getAllResponseHeaders())?e.split("\r\n").map((function(e){return e.split(": ")})).filter((function(e){return 2===e.length&&e[1].length>0})).reduce((function(e,t){return e[t[0]]=t[1],e}),{}):{},n=function(e){var t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(t){return e.responseText}}(o);if(200<=o.status&&o.status<300)i({status:o.status,headers:t,body:n});else{var r,s=o.statusText&&o.statusText.code?o.statusText.code:"NONE";r="string"==typeof n?n&&1===n.split("\n",2).length?n:"":JSON.stringify(n);var u="".concat(o.status,": [").concat(s,"] ").concat(r);a(new ES.TransportError(u,o.status,n,s,t))}}},n)o.setRequestHeader(s,n[s]),"Content-Type"===s&&"application/json"===n[s]&&(r=JSON.stringify(r));o.send(r)}))}}]),e}();xS.Transport=CS;var RS={},OS={},MS={};function PS(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}Object.defineProperty(MS,"__esModule",{value:!0});var AS=function(e){ma(n,e);var t=PS(n);function n(e){var r;return xa(this,n),(r=t.call(this)).minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return pa(n,[{key:"attempt",value:function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),void this.reject(new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((function(){return t.attempt()}),n)}},{key:"cleanup",value:function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise((function(t,n){e.resolve=t,e.reject=n,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)}))}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}},{key:"succeeded",value:function(e){this.emit("succeeded",e),this.resolve(e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}},{key:"run",value:function(e){var t=this;return this.on("attempt",(function(){e().then((function(e){return t.succeeded(e)})).catch((function(e){return t.failed(e)}))})),this.start()}}]),n}(Hv.EventEmitter);MS.Retrier=AS,MS.default=AS;var DS={};function jS(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}function NS(e){return null!=e}Object.defineProperty(DS,"__esModule",{value:!0});var LS=function(e){ma(n,e);var t=jS(n);function n(e){var r;if(xa(this,n),r=t.call(this),NS((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(NS(e.maxDelay)&&e.maxDelay<=1)throw new Error("The maximal timeout must be greater than 1.");if(NS(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");if(NS(e.factor)&&e.factor<=1)throw new Error("Exponential factor should be greater than 1.");if(r.initialDelay=e.initialDelay||100,r.maxDelay=e.maxDelay||1e4,r.maxDelay<=r.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return r.randomisationFactor=e.randomisationFactor||0,r.factor=e.factor||2,r.maxNumberOfRetry=-1,r.reset(),r}return pa(n,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new n(e)}}]),n}(Hv.EventEmitter);DS.Backoff=LS,DS.default=LS,Object.defineProperty(OS,"__esModule",{value:!0});var US=MS;OS.Retrier=US.Retrier;var BS=DS;OS.Backoff=BS.Backoff,OS.default=US.Retrier,Object.defineProperty(RS,"__esModule",{value:!0}),RS.Network=void 0;var FS=OS,qS=gS,WS=pS.Logger.scope("Network"),zS=function(){function e(t,n){xa(this,e),this.config=t,this.transport=n}var t;return pa(e,[{key:"backoffConfig",value:function(){return Object.assign(qS.Configuration.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==qS.Configuration.retryWhenThrottledDefault&&qS.Configuration.retryWhenThrottledDefault}},{key:"executeWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(r,i){var a=[502,503,504];n&&a.push(429);var o=new FS.Retrier(t.backoffConfig());o.on("attempt",(function(){e().then((function(e){return o.succeeded(e)})).catch((function(e){a.indexOf(e.status)>-1||"Twilsock disconnected"===e.message?o.failed(e):(o.removeAllListeners(),o.cancel(),i(e))}))})),o.on("succeeded",(function(e){r(e)})),o.on("cancelled",(function(e){return i(e)})),o.on("failed",(function(e){return i(e)})),o.start()}))}},{key:"get",value:function(){var e=ha(Za.mark((function e(t){var n,r,i=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={"X-Twilio-Token":this.config.token},WS.trace("sending GET request to ",t," headers ",n),e.next=4,this.executeWithRetry((function(){return i.transport.get(t,n)}),this.retryWhenThrottled());case 4:return r=e.sent,WS.trace("response",r),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"post",value:(t=ha(Za.mark((function e(t,n,r){var i,a;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={"X-Twilio-Token":this.config.token},"undefined"!=typeof FormData&&n instanceof FormData||!r||Object.assign(i,{"Content-Type":r}),WS.trace("sending POST request to ",t," headers ",i),e.prev=3,e.next=6,this.transport.post(t,i,n);case 6:a=e.sent,e.next=17;break;case 9:if(e.prev=9,e.t0=e.catch(3),!(e.t0 instanceof TypeError)){e.next=16;break}throw WS.trace("got error in post response",e.t0),new TypeError("Posting FormData supported only with browser engine's FormData");case 16:throw e.t0;case 17:return WS.trace("response",a),e.abrupt("return",a);case 19:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();RS.Network=zS;var GS="0.4.1";!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.McsMedia=e.Media=e.McsClient=e.Client=void 0;var t=pS,n=gS,r=kS;Object.defineProperty(e,"Media",{enumerable:!0,get:function(){return r.Media}}),Object.defineProperty(e,"McsMedia",{enumerable:!0,get:function(){return r.Media}});var i=xS,a=RS,o=t.Logger.scope(""),s=GS,u="A valid Twilio token should be provided",Client=function(){function Client(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(xa(this,Client),this.options=r,this.options.logLevel=this.options.logLevel||"silent",this.config=new n.Configuration(e,t,this.options),!e)throw new Error(u);o.setLevel(this.options.logLevel),this.options.transport=this.options.transport||new i.Transport,this.transport=this.options.transport,this.network=new a.Network(this.config,this.transport)}var e,t;return pa(Client,[{key:"updateToken",value:function(e){if(o.info("updateToken"),!e)throw new Error(u);this.config.updateToken(e)}},{key:"get",value:function(){var e=ha(Za.mark((function e(t){var n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.get("".concat(this.config.baseUrl,"/").concat(t));case 2:return n=e.sent,e.abrupt("return",new r.Media(this.config,this.network,n.body));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"post",value:(t=ha(Za.mark((function e(t,n){var i;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.post(this.config.baseUrl,n,t);case 2:return i=e.sent,e.abrupt("return",new r.Media(this.config,this.network,i.body));case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"postFormData",value:(e=ha(Za.mark((function e(t){var n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.post(this.config.baseUrl,t);case 2:return n=e.sent,e.abrupt("return",new r.Media(this.config,this.network,n.body));case 4:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})}]),Client}();e.Client=Client,e.McsClient=Client,Client.version=s,e.default=Client}(dS);var JS=dS;ov("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),bv);var VS=vt.includes,$S=bo;Xt({target:"Array",proto:!0},{includes:function(e){return VS(this,e,arguments.length>1?arguments[1]:void 0)}}),$S("includes");var KS=x,QS=Math.floor;Xt({target:"Number",stat:!0},{isInteger:function(e){return!KS(e)&&isFinite(e)&&QS(e)===e}});var HS,XS={exports:{}},YS="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,ZS=YS,eT=s,tT=i,nT=x,rT=R,iT=xs,aT=ee,oT=te.exports,sT=G.f,uT=Io,cT=Go,lT=hr,fT=we,hT=tT.Int8Array,dT=hT&&hT.prototype,pT=tT.Uint8ClampedArray,yT=pT&&pT.prototype,vT=hT&&uT(hT),mT=dT&&uT(dT),gT=Object.prototype,bT=gT.isPrototypeOf,kT=lT("toStringTag"),wT=fT("TYPED_ARRAY_TAG"),xT=ZS&&!!cT&&"Opera"!==iT(tT.opera),_T=!1,ST={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},TT={BigInt64Array:8,BigUint64Array:8},ET=function(e){if(!nT(e))return!1;var t=iT(e);return rT(ST,t)||rT(TT,t)};for(HS in ST)tT[HS]||(xT=!1);if((!xT||"function"!=typeof vT||vT===Function.prototype)&&(vT=function(){throw TypeError("Incorrect invocation")},xT))for(HS in ST)tT[HS]&&cT(tT[HS],vT);if((!xT||!mT||mT===gT)&&(mT=vT.prototype,xT))for(HS in ST)tT[HS]&&cT(tT[HS].prototype,mT);if(xT&&uT(yT)!==mT&&cT(yT,mT),eT&&!rT(mT,kT))for(HS in _T=!0,sT(mT,kT,{get:function(){return nT(this)?this[wT]:void 0}}),ST)tT[HS]&&aT(tT[HS],wT,HS);var IT={NATIVE_ARRAY_BUFFER_VIEWS:xT,TYPED_ARRAY_TAG:_T&&wT,aTypedArray:function(e){if(ET(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(cT){if(bT.call(vT,e))return e}else for(var t in ST)if(rT(ST,HS)){var n=tT[t];if(n&&(e===n||bT.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n){if(eT){if(n)for(var r in ST){var i=tT[r];if(i&&rT(i.prototype,e))try{delete i.prototype[e]}catch(e){}}mT[e]&&!n||oT(mT,e,n?t:xT&&dT[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(eT){if(cT){if(n)for(r in ST)if((i=tT[r])&&rT(i,e))try{delete i[e]}catch(e){}if(vT[e]&&!n)return;try{return oT(vT,e,n?t:xT&&vT[e]||t)}catch(e){}}for(r in ST)!(i=tT[r])||i[e]&&!n||oT(i,e,t)}},isView:function(e){if(!nT(e))return!1;var t=iT(e);return"DataView"===t||rT(ST,t)||rT(TT,t)},isTypedArray:ET,TypedArray:vT,TypedArrayPrototype:mT},CT=i,RT=o,OT=uu,MT=IT.NATIVE_ARRAY_BUFFER_VIEWS,PT=CT.ArrayBuffer,AT=CT.Int8Array,DT=!MT||!RT((function(){AT(1)}))||!RT((function(){new AT(-1)}))||!OT((function(e){new AT,new AT(null),new AT(1.5),new AT(e)}),!0)||RT((function(){return 1!==new AT(new PT(2),1,void 0).length})),jT=it,NT=st,LT=function(e){if(void 0===e)return 0;var t=jT(e),n=NT(t);if(t!==n)throw RangeError("Wrong length or index");return n},UT=Math.abs,BT=Math.pow,FT=Math.floor,qT=Math.log,WT=Math.LN2,zT=E,GT=ft,JT=st,VT=function(e){for(var t=zT(this),n=JT(t.length),r=arguments.length,i=GT(r>1?arguments[1]:void 0,n),a=r>2?arguments[2]:void 0,o=void 0===a?n:GT(a,n);o>i;)t[i++]=e;return t},$T=i,KT=s,QT=YS,HT=ee,XT=Os,YT=o,ZT=Ns,eE=it,tE=st,nE=LT,rE={pack:function(e,t,n){var r,i,a,o=new Array(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?BT(2,-24)-BT(2,-77):0,f=e<0||0===e&&1/e<0?1:0,h=0;for((e=UT(e))!=e||e===1/0?(i=e!=e?1:0,r=u):(r=FT(qT(e)/WT),e*(a=BT(2,-r))<1&&(r--,a*=2),(e+=r+c>=1?l/a:l*BT(2,1-c))*a>=2&&(r++,a/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*a-1)*BT(2,t),r+=c):(i=e*BT(2,c-1)*BT(2,t),r=0));t>=8;o[h++]=255&i,i/=256,t-=8);for(r=r<<t|i,s+=t;s>0;o[h++]=255&r,r/=256,s-=8);return o[--h]|=128*f,o},unpack:function(e,t){var n,r=e.length,i=8*r-t-1,a=(1<<i)-1,o=a>>1,s=i-7,u=r-1,c=e[u--],l=127&c;for(c>>=7;s>0;l=256*l+e[u],u--,s-=8);for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;n=256*n+e[u],u--,s-=8);if(0===l)l=1-o;else{if(l===a)return n?NaN:c?-1/0:1/0;n+=BT(2,t),l-=o}return(c?-1:1)*n*BT(2,l-t)}},iE=Io,aE=Go,oE=tt.f,sE=G.f,uE=VT,cE=_r,lE=qe.get,fE=qe.set,hE="ArrayBuffer",dE="DataView",pE="Wrong index",yE=$T.ArrayBuffer,vE=yE,mE=$T.DataView,gE=mE&&mE.prototype,bE=Object.prototype,kE=$T.RangeError,wE=rE.pack,xE=rE.unpack,_E=function(e){return[255&e]},SE=function(e){return[255&e,e>>8&255]},TE=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},EE=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},IE=function(e){return wE(e,23,4)},CE=function(e){return wE(e,52,8)},RE=function(e,t){sE(e.prototype,t,{get:function(){return lE(this)[t]}})},OE=function(e,t,n,r){var i=nE(n),a=lE(e);if(i+t>a.byteLength)throw kE(pE);var o=lE(a.buffer).bytes,s=i+a.byteOffset,u=o.slice(s,s+t);return r?u:u.reverse()},ME=function(e,t,n,r,i,a){var o=nE(n),s=lE(e);if(o+t>s.byteLength)throw kE(pE);for(var u=lE(s.buffer).bytes,c=o+s.byteOffset,l=r(+i),f=0;f<t;f++)u[c+f]=l[a?f:t-f-1]};if(QT){if(!YT((function(){yE(1)}))||!YT((function(){new yE(-1)}))||YT((function(){return new yE,new yE(1.5),new yE(NaN),yE.name!=hE}))){for(var PE,AE=(vE=function(e){return ZT(this,vE),new yE(nE(e))}).prototype=yE.prototype,DE=oE(yE),jE=0;DE.length>jE;)(PE=DE[jE++])in vE||HT(vE,PE,yE[PE]);AE.constructor=vE}aE&&iE(gE)!==bE&&aE(gE,bE);var NE=new mE(new vE(2)),LE=gE.setInt8;NE.setInt8(0,2147483648),NE.setInt8(1,2147483649),!NE.getInt8(0)&&NE.getInt8(1)||XT(gE,{setInt8:function(e,t){LE.call(this,e,t<<24>>24)},setUint8:function(e,t){LE.call(this,e,t<<24>>24)}},{unsafe:!0})}else vE=function(e){ZT(this,vE,hE);var t=nE(e);fE(this,{bytes:uE.call(new Array(t),0),byteLength:t}),KT||(this.byteLength=t)},mE=function(e,t,n){ZT(this,mE,dE),ZT(e,vE,dE);var r=lE(e).byteLength,i=eE(t);if(i<0||i>r)throw kE("Wrong offset");if(i+(n=void 0===n?r-i:tE(n))>r)throw kE("Wrong length");fE(this,{buffer:e,byteLength:n,byteOffset:i}),KT||(this.buffer=e,this.byteLength=n,this.byteOffset=i)},KT&&(RE(vE,"byteLength"),RE(mE,"buffer"),RE(mE,"byteLength"),RE(mE,"byteOffset")),XT(mE.prototype,{getInt8:function(e){return OE(this,1,e)[0]<<24>>24},getUint8:function(e){return OE(this,1,e)[0]},getInt16:function(e){var t=OE(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=OE(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return EE(OE(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return EE(OE(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return xE(OE(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return xE(OE(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){ME(this,1,e,_E,t)},setUint8:function(e,t){ME(this,1,e,_E,t)},setInt16:function(e,t){ME(this,2,e,SE,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){ME(this,2,e,SE,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){ME(this,4,e,TE,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){ME(this,4,e,TE,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){ME(this,4,e,IE,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){ME(this,8,e,CE,t,arguments.length>2?arguments[2]:void 0)}});cE(vE,hE),cE(mE,dE);var UE={ArrayBuffer:vE,DataView:mE},BE=it,FE=function(e){var t=BE(e);if(t<0)throw RangeError("The argument can't be less than 0");return t},qE=function(e,t){var n=FE(e);if(n%t)throw RangeError("Wrong offset");return n},WE=E,zE=st,GE=Gs,JE=Fs,VE=Tr,$E=IT.aTypedArrayConstructor,KE=Xt,QE=i,HE=s,XE=DT,YE=IT,ZE=UE,eI=Ns,tI=h,nI=ee,rI=st,iI=LT,aI=qE,oI=S,sI=R,uI=xs,cI=x,lI=gn,fI=Go,hI=tt.f,dI=function(e){var t,n,r,i,a,o,s=WE(e),u=arguments.length,c=u>1?arguments[1]:void 0,l=void 0!==c,f=GE(s);if(null!=f&&!JE(f))for(o=(a=f.call(s)).next,s=[];!(i=o.call(a)).done;)s.push(i.value);for(l&&u>2&&(c=VE(c,arguments[2],2)),n=zE(s.length),r=new($E(this))(n),t=0;n>t;t++)r[t]=l?c(s[t],t):s[t];return r},pI=Lr.forEach,yI=js,vI=G,mI=a,gI=Tf,bI=qe.get,kI=qe.set,wI=vI.f,xI=mI.f,_I=Math.round,SI=QE.RangeError,TI=ZE.ArrayBuffer,EI=ZE.DataView,II=YE.NATIVE_ARRAY_BUFFER_VIEWS,CI=YE.TYPED_ARRAY_TAG,RI=YE.TypedArray,OI=YE.TypedArrayPrototype,MI=YE.aTypedArrayConstructor,PI=YE.isTypedArray,AI="BYTES_PER_ELEMENT",DI="Wrong length",jI=function(e,t){for(var n=0,r=t.length,i=new(MI(e))(r);r>n;)i[n]=t[n++];return i},NI=function(e,t){wI(e,t,{get:function(){return bI(this)[t]}})},LI=function(e){var t;return e instanceof TI||"ArrayBuffer"==(t=uI(e))||"SharedArrayBuffer"==t},UI=function(e,t){return PI(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},BI=function(e,t){return UI(e,t=oI(t,!0))?tI(2,e[t]):xI(e,t)},FI=function(e,t,n){return!(UI(e,t=oI(t,!0))&&cI(n)&&sI(n,"value"))||sI(n,"get")||sI(n,"set")||n.configurable||sI(n,"writable")&&!n.writable||sI(n,"enumerable")&&!n.enumerable?wI(e,t,n):(e[t]=n.value,e)};HE?(II||(mI.f=BI,vI.f=FI,NI(OI,"buffer"),NI(OI,"byteOffset"),NI(OI,"byteLength"),NI(OI,"length")),KE({target:"Object",stat:!0,forced:!II},{getOwnPropertyDescriptor:BI,defineProperty:FI}),XS.exports=function(e,t,n){var r=e.match(/\d+$/)[0]/8,i=e+(n?"Clamped":"")+"Array",a="get"+e,o="set"+e,s=QE[i],u=s,c=u&&u.prototype,l={},f=function(e,t){wI(e,t,{get:function(){return function(e,t){var n=bI(e);return n.view[a](t*r+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var a=bI(e);n&&(i=(i=_I(i))<0?0:i>255?255:255&i),a.view[o](t*r+a.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};II?XE&&(u=t((function(e,t,n,a){return eI(e,u,i),gI(cI(t)?LI(t)?void 0!==a?new s(t,aI(n,r),a):void 0!==n?new s(t,aI(n,r)):new s(t):PI(t)?jI(u,t):dI.call(u,t):new s(iI(t)),e,u)})),fI&&fI(u,RI),pI(hI(s),(function(e){e in u||nI(u,e,s[e])})),u.prototype=c):(u=t((function(e,t,n,a){eI(e,u,i);var o,s,c,l=0,h=0;if(cI(t)){if(!LI(t))return PI(t)?jI(u,t):dI.call(u,t);o=t,h=aI(n,r);var d=t.byteLength;if(void 0===a){if(d%r)throw SI(DI);if((s=d-h)<0)throw SI(DI)}else if((s=rI(a)*r)+h>d)throw SI(DI);c=s/r}else c=iI(t),o=new TI(s=c*r);for(kI(e,{buffer:o,byteOffset:h,byteLength:s,length:c,view:new EI(o)});l<c;)f(e,l++)})),fI&&fI(u,RI),c=u.prototype=lI(OI)),c.constructor!==u&&nI(c,"constructor",u),CI&&nI(c,CI,i),l[i]=u,KE({global:!0,forced:u!=s,sham:!II},l),AI in u||nI(u,AI,r),AI in c||nI(c,AI,r),yI(i)}):XS.exports=function(){},(0,XS.exports)("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var qI=E,WI=ft,zI=st,GI=Math.min,JI=[].copyWithin||function(e,t){var n=qI(this),r=zI(n.length),i=WI(e,r),a=WI(t,r),o=arguments.length>2?arguments[2]:void 0,s=GI((void 0===o?r:WI(o,r))-a,r-i),u=1;for(a<i&&i<a+s&&(u=-1,a+=s-1,i+=s-1);s-- >0;)a in n?n[i]=n[a]:delete n[i],i+=u,a+=u;return n},VI=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("copyWithin",(function(e,t){return JI.call(VI(this),e,t,arguments.length>2?arguments[2]:void 0)}));var $I=Lr.every,KI=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("every",(function(e){return $I(KI(this),e,arguments.length>1?arguments[1]:void 0)}));var QI=VT,HI=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("fill",(function(e){return QI.apply(HI(this),arguments)}));var XI=IT.aTypedArrayConstructor,YI=hu,ZI=Lr.filter,eC=function(e,t){for(var n=YI(e,e.constructor),r=0,i=t.length,a=new(XI(n))(i);i>r;)a[r]=t[r++];return a},tC=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("filter",(function(e){var t=ZI(tC(this),e,arguments.length>1?arguments[1]:void 0);return eC(this,t)}));var nC=Lr.find,rC=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("find",(function(e){return nC(rC(this),e,arguments.length>1?arguments[1]:void 0)}));var iC=Lr.findIndex,aC=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("findIndex",(function(e){return iC(aC(this),e,arguments.length>1?arguments[1]:void 0)}));var oC=Lr.forEach,sC=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("forEach",(function(e){oC(sC(this),e,arguments.length>1?arguments[1]:void 0)}));var uC=vt.includes,cC=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("includes",(function(e){return uC(cC(this),e,arguments.length>1?arguments[1]:void 0)}));var lC=vt.indexOf,fC=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("indexOf",(function(e){return lC(fC(this),e,arguments.length>1?arguments[1]:void 0)}));var hC=i,dC=IT,pC=ys,yC=hr("iterator"),vC=hC.Uint8Array,mC=pC.values,gC=pC.keys,bC=pC.entries,kC=dC.aTypedArray,wC=dC.exportTypedArrayMethod,xC=vC&&vC.prototype[yC],_C=!!xC&&("values"==xC.name||null==xC.name),SC=function(){return mC.call(kC(this))};wC("entries",(function(){return bC.call(kC(this))})),wC("keys",(function(){return gC.call(kC(this))})),wC("values",SC,!_C),wC(yC,SC,!_C);var TC=IT.aTypedArray,EC=[].join;(0,IT.exportTypedArrayMethod)("join",(function(e){return EC.apply(TC(this),arguments)}));var IC=w,CC=it,RC=st,OC=no,MC=Math.min,PC=[].lastIndexOf,AC=!!PC&&1/[1].lastIndexOf(1,-0)<0,DC=OC("lastIndexOf"),jC=AC||!DC?function(e){if(AC)return PC.apply(this,arguments)||0;var t=IC(this),n=RC(t.length),r=n-1;for(arguments.length>1&&(r=MC(r,CC(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:PC,NC=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("lastIndexOf",(function(e){return jC.apply(NC(this),arguments)}));var LC=Lr.map,UC=hu,BC=IT.aTypedArray,FC=IT.aTypedArrayConstructor;(0,IT.exportTypedArrayMethod)("map",(function(e){return LC(BC(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(FC(UC(e,e.constructor)))(t)}))}));var qC=Yt,WC=E,zC=m,GC=st,JC=function(e){return function(t,n,r,i){qC(n);var a=WC(t),o=zC(a),s=GC(a.length),u=e?s-1:0,c=e?-1:1;if(r<2)for(;;){if(u in o){i=o[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw TypeError("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=c)u in o&&(i=n(i,o[u],u,a));return i}},VC={left:JC(!1),right:JC(!0)},$C=VC.left,KC=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("reduce",(function(e){return $C(KC(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var QC=VC.right,HC=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("reduceRight",(function(e){return QC(HC(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var XC=IT.aTypedArray,YC=IT.exportTypedArrayMethod,ZC=Math.floor;YC("reverse",(function(){for(var e,t=this,n=XC(t).length,r=ZC(n/2),i=0;i<r;)e=t[i],t[i++]=t[--n],t[n]=e;return t}));var eR=st,tR=qE,nR=E,rR=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("set",(function(e){rR(this);var t=tR(arguments.length>1?arguments[1]:void 0,1),n=this.length,r=nR(e),i=eR(r.length),a=0;if(i+t>n)throw RangeError("Wrong length");for(;a<i;)this[t+a]=r[a++]}),o((function(){new Int8Array(1).set({})})));var iR=hu,aR=IT.aTypedArray,oR=IT.aTypedArrayConstructor,sR=[].slice;(0,IT.exportTypedArrayMethod)("slice",(function(e,t){for(var n=sR.call(aR(this),e,t),r=iR(this,this.constructor),i=0,a=n.length,o=new(oR(r))(a);a>i;)o[i]=n[i++];return o}),o((function(){new Int8Array(1).slice()})));var uR=Lr.some,cR=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("some",(function(e){return uR(cR(this),e,arguments.length>1?arguments[1]:void 0)}));var lR=o,fR=Yt,hR=st,dR=Zl,pR=tf,yR=nf,vR=Jn,mR=af,gR=IT.aTypedArray,bR=IT.exportTypedArrayMethod,kR=i.Uint16Array,wR=kR&&kR.prototype.sort,xR=!!wR&&!lR((function(){var e=new kR(2);e.sort(null),e.sort({})})),_R=!!wR&&!lR((function(){if(vR)return vR<74;if(pR)return pR<67;if(yR)return!0;if(mR)return mR<602;var e,t,n=new kR(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(n.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));bR("sort",(function(e){var t=this;if(void 0!==e&&fR(e),_R)return wR.call(t,e);gR(t);var n,r=hR(t.length),i=Array(r);for(n=0;n<r;n++)i[n]=t[n];for(i=dR(t,function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e)),n=0;n<r;n++)t[n]=i[n];return t}),!_R||xR);var SR=st,TR=ft,ER=hu,IR=IT.aTypedArray;(0,IT.exportTypedArrayMethod)("subarray",(function(e,t){var n=IR(this),r=n.length,i=TR(e,r);return new(ER(n,n.constructor))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,SR((void 0===t?r:TR(t,r))-i))}));var CR=IT,RR=o,OR=i.Int8Array,MR=CR.aTypedArray,PR=CR.exportTypedArrayMethod,AR=[].toLocaleString,DR=[].slice,jR=!!OR&&RR((function(){AR.call(new OR(1))}));PR("toLocaleString",(function(){return AR.apply(jR?DR.call(MR(this)):MR(this),arguments)}),RR((function(){return[1,2].toLocaleString()!=new OR([1,2]).toLocaleString()}))||!RR((function(){OR.prototype.toLocaleString.call([1,2])})));var NR=IT.exportTypedArrayMethod,LR=o,UR=i.Uint8Array,BR=UR&&UR.prototype||{},FR=[].toString,qR=[].join;LR((function(){FR.call({})}))&&(FR=function(){return qR.call(this)});var WR=BR.toString!=FR;NR("toString",FR,WR);var zR=js,GR="ArrayBuffer",JR=UE.ArrayBuffer;Xt({global:!0,forced:i.ArrayBuffer!==JR},{ArrayBuffer:JR}),zR(GR);var VR={},$R={exports:{}};!function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}($R);var KR={exports:{}},QR={exports:{}};!function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0}(QR);var HR={exports:{}};!function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}},e.exports.default=e.exports,e.exports.__esModule=!0}(HR);var XR={exports:{}},YR={exports:{}};!function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.default=e.exports,e.exports.__esModule=!0}(YR),function(e){var t=YR.exports;e.exports=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0}(XR);var ZR={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}(ZR),function(e){var t=QR.exports,n=HR.exports,r=XR.exports,i=ZR.exports;e.exports=function(e,a){return t(e)||n(e,a)||r(e,a)||i()},e.exports.default=e.exports,e.exports.__esModule=!0}(KR);var eO=s,tO=tn,nO=w,rO=u.f,iO=function(e){return function(t){for(var n,r=nO(t),i=tO(r),a=i.length,o=0,s=[];a>o;)n=i[o++],eO&&!rO.call(r,n)||s.push(e?[n,r[n]]:r[n]);return s}},aO={entries:iO(!0),values:iO(!1)}.entries;Xt({target:"Object",stat:!0},{entries:function(e){return aO(e)}});var oO={exports:{}},sO={exports:{}};!function(e){var t=YR.exports;e.exports=function(e){if(Array.isArray(e))return t(e)},e.exports.default=e.exports,e.exports.__esModule=!0}(sO);var uO={exports:{}};!function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0}(uO);var cO={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}(cO),function(e){var t=sO.exports,n=uO.exports,r=XR.exports,i=cO.exports;e.exports=function(e){return t(e)||n(e)||r(e)||i()},e.exports.default=e.exports,e.exports.__esModule=!0}(oO);var lO={exports:{}};!function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0}(lO);var fO={exports:{}},hO={exports:{}};!function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,t(n,r)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(hO),function(e){var t=hO.exports;e.exports=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&t(e,n)},e.exports.default=e.exports,e.exports.__esModule=!0}(fO);var dO={exports:{}},pO={exports:{}};!function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.default=e.exports,e.exports.__esModule=!0}(pO),function(e){var t=$R.exports.default,n=pO.exports;e.exports=function(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?n(e):r},e.exports.default=e.exports,e.exports.__esModule=!0}(dO);var yO={exports:{}};!function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.default=e.exports,e.exports.__esModule=!0,t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(yO),Object.defineProperty(VR,"__esModule",{value:!0});var vO=KR.exports,mO=oO.exports,gO=lO.exports,bO=fO.exports,kO=dO.exports,wO=yO.exports;function xO(e){return e&&"object"===ga(e)&&"default"in e?e:{default:e}}var _O=xO($R.exports),SO=xO(vO),TO=xO(mO),EO=xO(gO),IO=xO(bO),CO=xO(kO),RO=xO(wO),OO=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{checks:t}};function MO(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return PO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return PO(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function PO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var AO=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return OO((function(e){var n,r=!1,i=[],a=MO(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;"string"!=typeof o?(r=r||e instanceof o,i.push("an instance of ".concat(o.name))):(r=r||_O.default(e)===o,i.push("of type ".concat(o)))}}catch(e){a.e(e)}finally{a.f()}return[r,i]}))};function DO(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return jO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jO(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function jO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var NO=OO((function(e){return["string"==typeof e&&e.length>0,"a non-empty string"]})),LO=OO((function(e){return["number"==typeof e&&Number.isInteger(e)&&e>=0,"a non-negative integer"]})),UO=OO((function(e){return["object"===_O.default(e)&&null!==e&&!Array.isArray(e),"a pure object (non-null and non-array)"]}));function BO(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=RO.default(e);if(t){var i=RO.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return CO.default(this,n)}}function FO(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return qO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qO(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function qO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var WO=function(e,t){if(t.length>e.length)throw new Error("Expected at most ".concat(e.length," argument(s), but got ").concat(t.length));for(;t.length<e.length;)t.push(void 0);var n,r=FO(t.entries());try{for(r.s();!(n=r.n()).done;){var i=SO.default(n.value,2),a=i[0],o=i[1],s=VO(e[a],o),u=SO.default(s,4),c=u[0],l=u[1],f=u[2],h=u[3];if(!c)throw new Error("Argument ".concat(a+1," is expected to be ").concat(f).concat(h," but got ").concat(l))}}catch(e){r.e(e)}finally{r.f()}},zO=function(e){var t,n,r;(["undefined","boolean","number","bigint","string"].includes(_O.default(e))&&(n="string"==typeof e?'"'.concat(e,'"'):"".concat(e)),"object"===_O.default(e)&&"Object"!==(null==e||null===(t=e.constructor)||void 0===t?void 0:t.name))&&(n=null===e?"null":"instance of ".concat(null==e||null===(r=e.constructor)||void 0===r?void 0:r.name));return n||(n=_O.default(e)),n},GO=function(e){var t,n=[],r=FO(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(JO(i))}}catch(e){r.e(e)}finally{r.f()}return n},JO=function(e){var t,n=[],r=FO(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var i=t.value;"string"!=typeof i&&"function"!=typeof i?n.push(i):n.push(AO(i))}}catch(e){r.e(e)}finally{r.f()}return n},VO=function(e,t){var n,r,i=[],a=!1,o=FO(e);try{for(o.s();!(r=o.n()).done;){var s,u=FO(r.value.checks);try{for(u.s();!(s=u.n()).done;){var c=(0,s.value)(t),l=SO.default(c,3),f=l[0],h=l[1],d=l[2];a=a||f,!n&&d&&(n=d),h&&(i=[].concat(TO.default(i),"string"==typeof h?[h]:TO.default(h)))}}catch(e){u.e(e)}finally{u.f()}}}catch(e){o.e(e)}finally{o.f()}if(a)return[!0];var p=n||zO(t),y=i.length-1;return[!1,p,y>0?"".concat(i.slice(0,y).join(", ")," or ").concat(i[y]):i.join(", "),y>1?";":","]};function $O(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return KO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return KO(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function KO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}VR.array=function(e,t){return OO((function(n){if(!Array.isArray(n))return[!1,"an array of ".concat(e)];var r,i=$O(n.entries());try{for(i.s();!(r=i.n()).done;){var a=SO.default(r.value,2),o=a[0],s=a[1],u=VO(JO(t),s),c=SO.default(u,3),l=c[0],f=c[1],h=c[2];if(!l)return[!1,"a valid array of ".concat(e," (index ").concat(o," should be ").concat(h,")"),"malformed array of ".concat(e," (index ").concat(o," is ").concat(f,")")]}}catch(e){i.e(e)}finally{i.f()}return[!0]}))};var QO=VR.custom=OO,HO=VR.literal=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return OO((function(e){var n,r=!1,i=[],a=DO(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;r=r||e===o,i.push("string"==typeof o?'"'.concat(o,'"'):"".concat(o))}}catch(e){a.e(e)}finally{a.f()}return[r,i]}))},XO=VR.nonEmptyString=NO,YO=VR.nonNegativeInteger=LO,ZO=VR.objectSchema=function(e,t){return OO((function(n){if("object"!==_O.default(n)||null===n||Array.isArray(n))return[!1,"valid ".concat(e," (should be a pure object)")];for(var r=0,i=Object.entries(t);r<i.length;r++){var a=SO.default(i[r],2),o=a[0],s=a[1],u=VO(JO(s),n[o]),c=SO.default(u,3),l=c[0],f=c[1],h=c[2];if(!l)return[!1,"valid ".concat(e,' (key "').concat(o,'" should be ').concat(h,")"),"malformed ".concat(e,' (key "').concat(o,'" is ').concat(f,")")]}return[!0]}))},eM=VR.pureObject=UO;VR.runtimeTypeValidation=WO,VR.stringifyReceivedType=zO,VR.type=AO,VR.validateConstructorTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=GO(t);return function(e){return function(e){IO.default(n,e);var t=BO(n);function n(){EO.default(this,n);for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return WO(r,i),t.call.apply(t,[this].concat(i))}return n}(e)}};var tM=VR.validateTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=GO(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypes decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return WO(r,t),i.apply(this,t)}}},nM=VR.validateTypesAsync=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=GO(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypesAsync decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];try{WO(r,t)}catch(e){return Promise.reject(e)}return i.apply(this,t)}}};function rM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}var iM=Hh.scope("Member"),Member=function(e){ma(Member,e);var t,n,r,i=rM(Member);function Member(e,t,n,r,a){var o;if(xa(this,Member),(o=i.call(this)).channel=n,o.links=r,o.services=a,o.services=a,o.state={attributes:Hp(e.attributes,"Retrieved malformed attributes from the server for member: "+t,iM),dateCreated:e.dateCreated?Qp(e.dateCreated):null,dateUpdated:e.dateCreated?Qp(e.dateUpdated):null,sid:t,typingTimeout:null,isTyping:!1,identity:e.identity||null,roleSid:e.roleSid||null,lastConsumedMessageIndex:Number.isInteger(e.lastConsumedMessageIndex)?e.lastConsumedMessageIndex:null,lastConsumptionTimestamp:e.lastConsumptionTimestamp?Qp(e.lastConsumptionTimestamp):null,type:e.type||"chat",userInfo:e.userInfo},!e.identity&&!e.type)throw new Error("Received invalid Member object from server: Missing identity or type of Member.");return o}return pa(Member,[{key:"sid",get:function(){return this.state.sid}},{key:"attributes",get:function(){return this.state.attributes}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}},{key:"lastConsumptionTimestamp",get:function(){return this.state.lastConsumptionTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}},{key:"type",get:function(){return this.state.type}},{key:"_startTyping",value:function(e){var t=this;return clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this.state.typingTimeout=setTimeout((function(){return t._endTyping()}),e),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(e){var t=[],n=Hp(e.attributes,"Retrieved malformed attributes from the server for member: "+this.state.sid,iM);e.attributes&&!Vp(this.state.attributes,n)&&(this.state.attributes=n,t.push("attributes"));var r=Qp(e.dateUpdated);e.dateUpdated&&r.getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=r,t.push("dateUpdated"));var i=Qp(e.dateCreated);if(e.dateCreated&&i.getTime()!==(this.state.dateCreated&&this.state.dateCreated.getTime())&&(this.state.dateCreated=i,t.push("dateCreated")),e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,t.push("roleSid")),!Number.isInteger(e.lastConsumedMessageIndex)&&null!==e.lastConsumedMessageIndex||this.state.lastConsumedMessageIndex===e.lastConsumedMessageIndex||(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,t.push("lastConsumedMessageIndex")),e.lastConsumptionTimestamp){var a=new Date(e.lastConsumptionTimestamp);this.state.lastConsumptionTimestamp&&this.state.lastConsumptionTimestamp.getTime()===a.getTime()||(this.state.lastConsumptionTimestamp=a,t.push("lastConsumptionTimestamp"))}return t.length>0&&this.emit("updated",{member:this,updateReasons:t}),this}},{key:"getUserDescriptor",value:(r=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User Descriptor is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUserDescriptor(this.state.identity));case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getUser",value:(n=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"remove",value:function(){var e=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channel.removeMember(this));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateAttributes",value:(t=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:void 0!==t?JSON.stringify(t):void 0});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),Member}(ih);function aM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}th([nM(["string","number","boolean","object",HO(null)]),nh("design:type",Function),nh("design:paramtypes",[Object]),nh("design:returntype",Promise)],Member.prototype,"updateAttributes",null);var oM=Hh.scope("Members"),sM=function(e){ma(s,e);var t,n,r,i,a,o=aM(s);function s(e,t,n,r,i){var a;return xa(this,s),(a=o.call(this)).channel=e,a.members=t,a.links=n,a.configuration=r,a.services=i,a}return pa(s,[{key:"unsubscribe",value:(a=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:e.sent.close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"subscribe",value:function(e){var t=this;return this.rosterEntityPromise=this.rosterEntityPromise||this.services.syncClient.map({id:e,mode:"open_existing"}).then((function(e){e.on("itemAdded",(function(e){oM.debug(t.channel.sid+" itemAdded: "+e.item.key),t.upsertMember(e.item.key,e.item.data).then((function(e){t.emit("memberJoined",e)}))})),e.on("itemRemoved",(function(e){oM.debug(t.channel.sid+" itemRemoved: "+e.key);var n=e.key;if(t.members.has(n)){var r=t.members.get(n);t.members.delete(n),t.emit("memberLeft",r)}})),e.on("itemUpdated",(function(e){oM.debug(t.channel.sid+" itemUpdated: "+e.item.key),t.upsertMember(e.item.key,e.item.data)}));var n=[],r=t;return e.getItems().then((function e(t){return t.items.forEach((function(e){n.push(r.upsertMember(e.key,e.data))})),t.hasNextPage?t.nextPage().then(e):null})).then((function(){return Promise.all(n)})).then((function(){return e}))})).catch((function(e){throw t.rosterEntityPromise=null,"disconnected"!=t.services.syncClient.connectionState&&oM.error("Failed to get roster object for channel",t.channel.sid,e),oM.debug("ERROR: Failed to get roster object for channel",t.channel.sid,e),e}))}},{key:"upsertMember",value:(i=ha(Za.mark((function e(t,n){var r,i,a=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.members.get(t))){e.next=3;break}return e.abrupt("return",r._update(n));case 3:return i={self:"".concat(this.links.participants,"/").concat(t)},r=new Member(n,t,this.channel,i,this.services),this.members.set(t,r),r.on("updated",(function(e){return a.emit("memberUpdated",e)})),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"getMembers",value:function(){var e=this;return this.rosterEntityPromise.then((function(){var t=[];return e.members.forEach((function(e){return t.push(e)})),t}))}},{key:"getMemberBySid",value:(r=ha(Za.mark((function e(t){var n=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise.then((function(){var e=n.members.get(t);if(!e)throw new Error("Member with SID "+t+" was not found");return e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getMemberByIdentity",value:(n=ha(Za.mark((function e(t){var n,r=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.abrupt("return",this.rosterEntityPromise.then((function(){if(r.members.forEach((function(e){e.identity===t&&(n=e)})),!n)throw new Error("Member with identity "+t+" was not found");return n})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"add",value:function(){var e=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.participants,{identity:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"invite",value:(t=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.channel.links.invites,{identity:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"remove",value:function(){var e=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("delete","".concat(this.links.participants,"/").concat(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),s}(ih),Media=function(){function Media(e,t){xa(this,Media),wa(this,"mcsMedia",null),this.services=t,this.state={sid:e.sid,filename:e.filename,contentType:e.contentType,size:e.size}}var e;return pa(Media,[{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"getContentTemporaryUrl",value:(e=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mcsMedia){e.next=8;break}if(!this.services.mcsClient){e.next=7;break}return e.next=4,this.services.mcsClient.get(this.state.sid);case 4:this.mcsMedia=e.sent,e.next=8;break;case 7:throw new Error("Media Content Service is unavailable");case 8:return e.abrupt("return",this.mcsMedia.getContentUrl());case 9:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]),Media}();function uM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}var cM=Hh.scope("Message"),Message=function(e){ma(Message,e);var t,n,r,i=uM(Message);function Message(e,t,n,r,a,o){var s;return xa(this,Message),(s=i.call(this)).channel=n,s.links=r,s.configuration=a,s.services=o,s.state={sid:t.sid,index:e,author:null==t.author?null:t.author,body:t.text,timestamp:t.timestamp?new Date(t.timestamp):null,dateUpdated:t.dateUpdated?new Date(t.dateUpdated):null,lastUpdatedBy:t.lastUpdatedBy?t.lastUpdatedBy:null,attributes:Hp(t.attributes,"Got malformed attributes for the message ".concat(t.sid),cM),type:t.type?t.type:"text",media:t.type&&"media"===t.type&&t.media?new Media(t.media,s.services):null,memberSid:null==t.memberSid?null:t.memberSid},s}return pa(Message,[{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"body",get:function(){return"media"===this.type?null:this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"dateCreated",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}},{key:"memberSid",get:function(){return this.state.memberSid}},{key:"_update",value:function(e){var t=[];!e.text&&"string"!=typeof e.text||e.text===this.state.body||(this.state.body=e.text,t.push("body")),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t.push("lastUpdatedBy")),e.author&&e.author!==this.state.author&&(this.state.author=e.author,t.push("author")),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t.push("dateUpdated")),e.timestamp&&new Date(e.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(e.timestamp),t.push("dateCreated"));var n=Hp(e.attributes,"Got malformed attributes for the message ".concat(this.sid),cM);Vp(this.state.attributes,n)||(this.state.attributes=n,t.push("attributes")),t.length>0&&this.emit("updated",{message:this,updateReasons:t})}},{key:"getMember",value:(r=ha(Za.mark((function e(){var t,n,r=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.state.memberSid){e.next=5;break}return e.next=4,this.channel.getMemberBySid(this.memberSid).catch((function(){return cM.debug('Member with sid "'+r.memberSid+'" not found for message '+r.sid),null}));case 4:t=e.sent;case 5:if(t||!this.state.author){e.next=9;break}return e.next=8,this.channel.getMemberByIdentity(this.state.author).catch((function(){return cM.debug('Member with identity "'+r.author+'" not found for message '+r.sid),null}));case 8:t=e.sent;case 9:if(!t){e.next=11;break}return e.abrupt("return",t);case 11:throw n="Member with ",this.state.memberSid&&(n+="SID '"+this.state.memberSid+"' "),this.state.author&&(this.state.memberSid&&(n+="or "),n+="identity '"+this.state.author+"' "),"Member with "===n&&(n="Member "),n+="was not found",new Error(n);case 17:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"remove",value:function(){var e=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("delete",this.links.self);case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateBody",value:(n=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{body:t});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"updateAttributes",value:(t=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:void 0!==t?JSON.stringify(t):void 0});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),Message}(ih);function lM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}th([nM("string"),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Message.prototype,"updateBody",null),th([nM(["string","number","boolean","object",HO(null)]),nh("design:type",Function),nh("design:paramtypes",[Object]),nh("design:returntype",Promise)],Message.prototype,"updateAttributes",null);var fM=Hh.scope("Messages"),hM=function(e){ma(a,e);var t,n,r,i=lM(a);function a(e,t,n){var r;return xa(this,a),(r=i.call(this)).channel=e,r.configuration=t,r.services=n,r.messagesByIndex=new Map,r.messagesListPromise=null,r}return pa(a,[{key:"subscribe",value:function(e){var t=this;return this.messagesListPromise=this.messagesListPromise||this.services.syncClient.list({id:e,mode:"open_existing"}).then((function(e){return e.on("itemAdded",(function(e){fM.debug(t.channel.sid+" itemAdded: "+e.item.index);var n={self:"".concat(t.channel.links.messages,"/").concat(e.item.data.sid),conversation:t.channel.links.self,messages_receipts:"".concat(t.channel.links.messages,"/").concat(e.item.data.sid,"/Receipts")},r=new Message(e.item.index,e.item.data,t.channel,n,t.configuration,t.services);t.messagesByIndex.has(r.index)?fM.debug("Message arrived, but already known and ignored",t.channel.sid,r.index):(t.messagesByIndex.set(r.index,r),r.on("updated",(function(e){return t.emit("messageUpdated",e)})),t.emit("messageAdded",r))})),e.on("itemRemoved",(function(e){fM.debug(t.channel.sid+" itemRemoved: "+e.index);var n=e.index;if(t.messagesByIndex.has(n)){var r=t.messagesByIndex.get(n);t.messagesByIndex.delete(r.index),r.removeAllListeners("updated"),t.emit("messageRemoved",r)}})),e.on("itemUpdated",(function(e){fM.debug(t.channel.sid+" itemUpdated: "+e.item.index);var n=t.messagesByIndex.get(e.item.index);n&&n._update(e.item.data)})),e})).catch((function(e){throw t.messagesListPromise=null,"disconnected"!=t.services.syncClient.connectionState&&fM.error("Failed to get messages object for channel",t.channel.sid,e),fM.debug("ERROR: Failed to get messages object for channel",t.channel.sid,e),e}))}},{key:"unsubscribe",value:(r=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=6;break}return e.next=3,this.messagesListPromise;case 3:e.sent.close(),this.messagesListPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"send",value:(n=ha(Za.mark((function e(t){var n,r=arguments;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},fM.debug("Sending text message",t,n),e.next=4,this.services.commandExecutor.mutateResource("post",this.channel.links.messages,{body:t||"",attributes:void 0!==n?JSON.stringify(n):void 0});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sendMedia",value:(t=ha(Za.mark((function e(t){var n,r,i,a=arguments;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},fM.debug("Sending media message",t,n),!("undefined"!=typeof FormData&&t instanceof FormData)){e.next=9;break}return fM.debug("Sending media message as FormData",t,n),e.next=6,this.services.mcsClient.postFormData(t);case 6:r=e.sent,e.next=16;break;case 9:if(fM.debug("Sending media message as SendMediaOptions",t,n),(i=t).contentType&&i.media){e.next=13;break}throw new Error("Media content <Channel#SendMediaOptions> must contain non-empty contentType and media");case 13:return e.next=15,this.services.mcsClient.post(i.contentType,i.media);case 15:r=e.sent;case 16:return e.next=18,this.services.commandExecutor.mutateResource("post",this.channel.links.messages,{media_sid:r.sid,attributes:void 0!==n?JSON.stringify(n):void 0});case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getMessages",value:function(e,t,n){return t=void 0!==t?t:"end",n=n||"backwards",this._getMessages(e,t,n)}},{key:"wrapPaginator",value:function(e,t,n){var r=this,i="desc"===e,a=function(){return t.nextPage().then((function(t){return r.wrapPaginator(e,t,n)}))},o=function(){return t.prevPage().then((function(t){return r.wrapPaginator(e,t,n)}))};return n(t.items).then((function(e){return{items:e.sort((function(e,t){return e.index-t.index})),hasPrevPage:i?t.hasNextPage:t.hasPrevPage,hasNextPage:i?t.hasPrevPage:t.hasNextPage,prevPage:i?a:o,nextPage:i?o:a}}))}},{key:"_upsertMessage",value:function(e,t){var n=this,r=this.messagesByIndex.get(e);if(r)return r;var i={self:"".concat(this.channel.links.messages,"/").concat(t.sid),conversation:this.channel.links.self,messages_receipts:"".concat(this.channel.links.messages,"/").concat(t.sid,"/Receipts")},a=new Message(e,t,this.channel,i,this.configuration,this.services);return this.messagesByIndex.set(a.index,a),a.on("updated",(function(e){return n.emit("messageUpdated",e)})),a}},{key:"_getMessages",value:function(e,t,n){var r=this;t=void 0!==t?t:"end",e=e||30;var i="backwards"===n?"desc":"asc";return this.messagesListPromise.then((function(n){return n.getItems({from:"end"!==t?t:void 0,pageSize:e,order:i})})).then((function(e){return r.wrapPaginator(i,e,(function(e){return Promise.all(e.map((function(e){return r._upsertMessage(e.index,e.data)})))}))}))}}]),a}(ih);function dM(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return pM(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pM(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function pM(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function yM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}var vM=Hh.scope("Channel"),mM={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",notificationLevel:"notificationLevel",sid:"sid",status:"status",type:"type",uniqueName:"uniqueName",state:"state"};function gM(e){try{return new Date(e)}catch(e){return null}}var Channel=function(e){ma(Channel,e);var t,n,r,i,a,o,s,u,c,l,f,h,d,p,y,v,m,g,b,k,w,x,_,S,T,E,I,C=yM(Channel);function Channel(e,t,n,r,i){var a;xa(this,Channel),(a=C.call(this)).sid=t,a.links=n,a.configuration=r,a.services=i;var o=e.attributes||{},s=e.createdBy,u=gM(e.dateCreated),c=gM(e.dateUpdated),l=e.friendlyName||null,f=Number.isInteger(e.lastConsumedMessageIndex)?e.lastConsumedMessageIndex:null,h=e.uniqueName||null;try{JSON.stringify(o)}catch(e){throw new Error("Attributes must be a valid JSON object.")}a.entityName=e.channel,a.channelState={uniqueName:h,status:"notParticipating",type:e.type,attributes:o,createdBy:s,dateCreated:u,dateUpdated:c,friendlyName:l,lastConsumedMessageIndex:f},e.notificationLevel&&(a.channelState.notificationLevel=e.notificationLevel);var d={participants:a.links.participants};return a.members=new Map,a.membersEntity=new sM(ya(a),a.members,d,a.configuration,a.services),a.membersEntity.on("memberJoined",a.emit.bind(ya(a),"memberJoined")),a.membersEntity.on("memberLeft",a.emit.bind(ya(a),"memberLeft")),a.membersEntity.on("memberUpdated",(function(e){return a.emit("memberUpdated",e)})),a.messagesEntity=new hM(ya(a),a.configuration,i),a.messagesEntity.on("messageAdded",(function(e){return a._onMessageAdded(e)})),a.messagesEntity.on("messageUpdated",(function(e){return a.emit("messageUpdated",e)})),a.messagesEntity.on("messageRemoved",a.emit.bind(ya(a),"messageRemoved")),a}return pa(Channel,[{key:"status",get:function(){return this.channelState.status}},{key:"type",get:function(){return this.channelState.type}},{key:"uniqueName",get:function(){return this.channelState.uniqueName}},{key:"isPrivate",get:function(){return"private"===this.channelState.type}},{key:"friendlyName",get:function(){return this.channelState.friendlyName}},{key:"dateUpdated",get:function(){return this.channelState.dateUpdated}},{key:"dateCreated",get:function(){return this.channelState.dateCreated}},{key:"createdBy",get:function(){return this.channelState.createdBy}},{key:"attributes",get:function(){return this.channelState.attributes}},{key:"lastConsumedMessageIndex",get:function(){return this.channelState.lastConsumedMessageIndex}},{key:"lastMessage",get:function(){return this.channelState.lastMessage}},{key:"notificationLevel",get:function(){return this.channelState.notificationLevel}},{key:"state",get:function(){return this.channelState.state}},{key:"_subscribe",value:function(){var e=this;return this.entityPromise?this.entityPromise:this.entityPromise=this.entityPromise||this.services.syncClient.document({id:this.entityName,mode:"open_existing"}).then((function(t){return e.entity=t,e.entity.on("updated",(function(t){e._update(t.data)})),e.entity.on("removed",(function(){return e.emit("removed",e)})),e._update(e.entity.data),t})).catch((function(t){throw e.entity=null,e.entityPromise=null,"disconnected"!=e.services.syncClient.connectionState&&vM.error("Failed to get channel object",t),vM.debug("ERROR: Failed to get channel object",t),t}))}},{key:"_subscribeStreams",value:(I=ha(Za.mark((function e(){var t,n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._subscribe();case 3:return vM.trace("_subscribeStreams, this.entity.data=",this.entity.data),t=this.entity.data.messages,n=this.entity.data.roster,e.next=8,Promise.all([this.messagesEntity.subscribe(t),this.membersEntity.subscribe(n)]);case 8:e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(0),"disconnected"!==this.services.syncClient.connectionState&&vM.error("Failed to subscribe on channel objects",this.sid,e.t0),vM.debug("ERROR: Failed to subscribe on channel objects",this.sid,e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return I.apply(this,arguments)})},{key:"_unsubscribe",value:(E=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrivate||!this.entity){e.next=5;break}return e.next=3,this.entity.close();case 3:this.entity=null,this.entityPromise=null;case 5:return e.abrupt("return",Promise.all([this.membersEntity.unsubscribe(),this.messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"_setStatus",value:function(e,t){var n=this;this.statusSource=t,this.channelState.status!==e&&(this.channelState.status=e,"joined"===e?this._subscribeStreams().catch((function(t){if(vM.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})):"invited"===e?this._subscribe().catch((function(t){if(vM.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})):this.entityPromise&&this._unsubscribe().catch((function(t){if(vM.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})))}},{key:"_statusSource",value:function(){return this.statusSource}},{key:"_update",value:function(e){var t,n,r,i,a;vM.trace("_update",e),Channel.preprocessUpdate(e,this.sid);for(var o=new Set,s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=mM[c];if(l)switch(l){case mM.status:if(!e.status||"unknown"===e.status||this.channelState.status===e.status)break;this.channelState.status=e.status,o.add(l);break;case mM.attributes:if(Vp(this.channelState.attributes,e.attributes))break;this.channelState.attributes=e.attributes,o.add(l);break;case mM.lastConsumedMessageIndex:if(void 0===e.lastConsumedMessageIndex||e.lastConsumedMessageIndex===this.channelState.lastConsumedMessageIndex)break;this.channelState.lastConsumedMessageIndex=e.lastConsumedMessageIndex,o.add(l);break;case mM.lastMessage:if(this.channelState.lastMessage&&!e.lastMessage){delete this.channelState.lastMessage,o.add(l);break}this.channelState.lastMessage=this.channelState.lastMessage||{},void 0!==(null===(t=e.lastMessage)||void 0===t?void 0:t.index)&&e.lastMessage.index!==this.channelState.lastMessage.index&&(this.channelState.lastMessage.index=e.lastMessage.index,o.add(l)),void 0!==(null===(n=e.lastMessage)||void 0===n?void 0:n.timestamp)&&(null===(r=this.channelState.lastMessage)||void 0===r||null===(i=r.dateCreated)||void 0===i?void 0:i.getTime())!==e.lastMessage.timestamp.getTime()&&(this.channelState.lastMessage.dateCreated=e.lastMessage.timestamp,o.add(l)),Vp(this.channelState.lastMessage,{})&&delete this.channelState.lastMessage;break;case mM.state:var f=e.state||void 0;if(void 0!==f&&(f.dateUpdated=new Date(f.dateUpdated)),Vp(this.channelState.state,f))break;this.channelState.state=f,o.add(l);break;default:var h=e[c]instanceof Date,d=h&&(null===(a=this.channelState[l])||void 0===a?void 0:a.getTime())===e[c].getTime(),p=!h&&this[l]===e[c];if(d||p)break;this.channelState[l]=e[c],o.add(l)}}o.size>0&&this.emit("updated",{channel:this,updateReasons:Mk(o)})}},{key:"_onMessageAdded",value:function(e){var t,n=dM(this.members.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.identity===e.author){r._endTyping();break}}}catch(e){n.e(e)}finally{n.f()}this.emit("messageAdded",e)}},{key:"_setLastConsumedMessageIndex",value:(T=ha(Za.mark((function e(t){var n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post","".concat(this.configuration.links.myConversations,"/").concat(this.sid),{last_consumed_message_index:t});case 2:return n=e.sent,e.abrupt("return",n.unread_messages_count);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"add",value:function(){var e=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.membersEntity.add(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"advanceLastConsumedMessageIndex",value:(S=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:if(!(t<this.lastConsumedMessageIndex)){e.next=6;break}return e.next=5,this._setLastConsumedMessageIndex(this.lastConsumedMessageIndex);case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,this._setLastConsumedMessageIndex(t);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"decline",value:(_=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("delete","".concat(this.links.invites,"/").concat(this.configuration.userIdentity));case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"delete",value:(x=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("delete",this.links.self);case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"getAttributes",value:(w=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"getMessages",value:(k=ha(Za.mark((function e(t,n,r){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.messagesEntity.getMessages(t,n,r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return k.apply(this,arguments)})},{key:"getMembers",value:(b=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.membersEntity.getMembers());case 3:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"getMembersCount",value:(g=ha(Za.mark((function e(){var t,n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Xp(this.configuration.links.conversations).path(this.sid).build(),e.next=3,this.services.network.get(t);case 3:return n=e.sent,e.abrupt("return",n.body.participants_count);case 5:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"getMemberBySid",value:(m=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.membersEntity.getMemberBySid(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getMemberByIdentity",value:(v=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.membersEntity.getMemberByIdentity(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getMessagesCount",value:(y=ha(Za.mark((function e(){var t,n;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Xp(this.configuration.links.conversations).path(this.sid).build(),e.next=3,this.services.network.get(t);case 3:return n=e.sent,e.abrupt("return",n.body.messages_count);case 5:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getUnconsumedMessagesCount",value:(p=ha(Za.mark((function e(){var t,n,r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Xp(this.configuration.links.myConversations).path(this.sid).build(),e.next=3,this.services.network.get(t);case 3:if((n=e.sent).body.conversation_sid===this.sid){e.next=6;break}throw new Error("Channel was not found in the user channels list");case 6:if("number"!=typeof(r=n.body.unread_messages_count)){e.next=9;break}return e.abrupt("return",r);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"invite",value:(d=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.membersEntity.invite(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"join",value:(h=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.participants,{identity:this.configuration.userIdentity});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"leave",value:(f=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this.channelState.status){e.next=3;break}return e.next=3,this.services.commandExecutor.mutateResource("delete","".concat(this.links.participants,"/").concat(this.configuration.userIdentity));case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"removeMember",value:(l=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.membersEntity.remove("string"==typeof t?t:t.sid);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"sendMessage",value:(c=ha(Za.mark((function e(t,n){var r,i;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t&&null!==t){e.next=5;break}return e.next=3,this.messagesEntity.send(t,n);case 3:return r=e.sent,e.abrupt("return",Kp(r.index));case 5:return e.next=7,this.messagesEntity.sendMedia(t,n);case 7:return i=e.sent,e.abrupt("return",Kp(i.index));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"setAllMessagesConsumed",value:(u=ha(Za.mark((function e(){var t;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.getMessages(1);case 4:if(!((t=e.sent).items.length>0)){e.next=7;break}return e.abrupt("return",this.advanceLastConsumedMessageIndex(t.items[0].index));case 7:return e.abrupt("return",Promise.resolve(0));case 8:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"setNoMessagesConsumed",value:(s=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this._setLastConsumedMessageIndex(null);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"setUserNotificationLevel",value:(o=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post","".concat(this.configuration.links.myConversations,"/").concat(this.sid),{notification_level:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"typing",value:function(){return this.services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:(a=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:void 0!==t?JSON.stringify(t):void 0});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateFriendlyName",value:(i=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channelState.friendlyName===t){e.next=3;break}return e.next=3,this.services.commandExecutor.mutateResource("post",this.links.self,{friendly_name:t});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"updateLastConsumedMessageIndex",value:(r=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this._setLastConsumedMessageIndex(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateUniqueName",value:(n=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channelState.uniqueName===t){e.next=4;break}return t||(t=""),e.next=4,this.services.commandExecutor.mutateResource("post",this.links.self,{unique_name:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getUserDescriptors",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getChannelUserDescriptors(this.sid));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"preprocessUpdate",value:function(e,t){try{"string"==typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&JSON.stringify(e.attributes)}catch(n){vM.warn("Retrieved malformed attributes from the server for channel: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(n){vM.warn("Retrieved malformed dateCreated from the server for channel: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(n){vM.warn("Retrieved malformed dateUpdated from the server for channel: "+t),delete e.dateUpdated}try{e.lastMessage&&e.lastMessage.timestamp&&(e.lastMessage.timestamp=new Date(e.lastMessage.timestamp))}catch(n){vM.warn("Retrieved malformed lastMessage.timestamp from the server for channel: "+t),delete e.lastMessage.timestamp}}}]),Channel}(ih);th([nM(XO),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Channel.prototype,"add",null),th([nM(YO),nh("design:type",Function),nh("design:paramtypes",[Number]),nh("design:returntype",Promise)],Channel.prototype,"advanceLastConsumedMessageIndex",null),th([nM(["undefined",YO],["undefined",YO],["undefined",HO("backwards","forward")]),nh("design:type",Function),nh("design:paramtypes",[Number,Number,String]),nh("design:returntype",Promise)],Channel.prototype,"getMessages",null),th([nM(XO),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Channel.prototype,"getMemberBySid",null),th([nM(XO),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Channel.prototype,"getMemberByIdentity",null),th([nM(XO),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Channel.prototype,"invite",null),th([nM([XO,Member]),nh("design:type",Function),nh("design:paramtypes",[Object]),nh("design:returntype",Promise)],Channel.prototype,"removeMember",null),th([nM(["string",HO(null),QO((function(e){return[e instanceof FormData,"an instance of FormData"]})),ZO("media options",{contentType:[XO,"undefined"],media:QO((function(e){var t="string"==typeof e&&e.length>0||e instanceof Uint8Array||e instanceof ArrayBuffer;return"function"==typeof Blob&&(t=t||e instanceof Blob),[t,"a non-empty string, an instance of Buffer or an instance of Blob"]}))})],["undefined","string","number","boolean","object",HO(null)]),nh("design:type",Function),nh("design:paramtypes",[Object,Object]),nh("design:returntype",Promise)],Channel.prototype,"sendMessage",null),th([nM(HO("default","muted")),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Channel.prototype,"setUserNotificationLevel",null),th([nM(["string","number","boolean","object",HO(null)]),nh("design:type",Function),nh("design:paramtypes",[Object]),nh("design:returntype",Promise)],Channel.prototype,"updateAttributes",null),th([nM("string"),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Channel.prototype,"updateFriendlyName",null),th([nM([HO(null),YO]),nh("design:type",Function),nh("design:paramtypes",[Number]),nh("design:returntype",Promise)],Channel.prototype,"updateLastConsumedMessageIndex",null),th([nM(["string",HO(null)]),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Channel.prototype,"updateUniqueName",null);var bM=function(){function e(){var t=this;xa(this,e),this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return pa(e,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}}]),e}();function kM(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return wM(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wM(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function wM(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xM(Object(n),!0).forEach((function(t){wa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function SM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}var TM=Hh.scope("Channels"),EM=function(e){ma(o,e);var t,n,r,i,a=SM(o);function o(e,t){var n;return xa(this,o),wa(ya(n=a.call(this)),"channels",new Map),wa(ya(n),"tombstones",new Set),wa(ya(n),"myChannelsFetched",!1),wa(ya(n),"myChannelsRead",new bM),n.configuration=e,n.services=t,n}return pa(o,[{key:"getMap",value:(i=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.syncClient.map({id:this.configuration.myConversations,mode:"open_existing"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"addChannel",value:(r=ha(Za.mark((function e(t){var n,r,i,a,o,s,u;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0===t.attributes?{}:t.attributes,e.next=3,this.services.commandExecutor.mutateResource("post",this.configuration.links.conversations,{type:t.isPrivate?"private":"public",unique_name:t.uniqueName,friendly_name:t.friendlyName,attributes:void 0!==n?JSON.stringify(n):void 0});case 3:if(r=e.sent,i=r.sid||null,a=r.sync_objects.conversation||null,o=_M({self:r.url},r.links),!(s=this.channels.get(i))){e.next=12;break}return e.next=11,s._subscribe();case 11:return e.abrupt("return",s);case 12:return u=new Channel({channel:a,entityName:null,uniqueName:null,attributes:null,createdBy:null,friendlyName:null,lastConsumedMessageIndex:null,type:t.isPrivate?"private":"public",dateCreated:null,dateUpdated:null},i,o,this.configuration,this.services),this.channels.set(u.sid,u),this.registerForEvents(u),e.next=17,u._subscribe();case 17:return this.emit("channelAdded",u),e.abrupt("return",u);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetchChannels",value:(n=ha(Za.mark((function e(){var t,n,r,i,a,o,s,u=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getMap();case 3:return(t=e.sent).on("itemAdded",(function(e){TM.debug("itemAdded: ".concat(e.item.key)),u.upsertChannel("sync",e.item.key,e.item.data)})),t.on("itemRemoved",(function(e){TM.debug("itemRemoved: ".concat(e.key));var t=e.key;u.myChannelsFetched||u.tombstones.add(t);var n=u.channels.get(t);n&&("joined"!==n.status&&"invited"!==n.status||(n._setStatus("notParticipating","sync"),u.emit("channelLeft",n)),n.isPrivate&&(u.channels.delete(t),u.emit("channelRemoved",n),n.emit("removed",n)))})),t.on("itemUpdated",(function(e){TM.debug("itemUpdated: ".concat(e.item.key)),u.upsertChannel("sync",e.item.key,e.item.data)})),e.next=9,this._fetchMyChannels();case 9:n=e.sent,r=[],i=kM(n);try{for(i.s();!(a=i.n()).done;)o=a.value,r.push(this.upsertChannel("rest",o.channel_sid,o))}catch(e){i.e(e)}finally{i.f()}return this.myChannelsRead.set(!0),e.next=16,Promise.all(r);case 16:return this.myChannelsFetched=!0,this.tombstones.clear(),TM.debug("The channels list has been successfully fetched"),e.abrupt("return",this);case 22:throw e.prev=22,e.t0=e.catch(0),s="Failed to fetch the channels list","disconnected"!==this.services.syncClient.connectionState&&TM.error(s,e.t0),TM.debug("ERROR: ".concat(s),e.t0),e.t0;case 28:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(){return n.apply(this,arguments)})},{key:"_wrapPaginator",value:function(e,t){var n=this;return t(e.items).then((function(r){return{items:r,hasNextPage:e.hasNextPage,hasPrevPage:e.hasPrevPage,nextPage:function(){return e.nextPage().then((function(e){return n._wrapPaginator(e,t)}))},prevPage:function(){return e.prevPage().then((function(e){return n._wrapPaginator(e,t)}))}}}))}},{key:"getChannels",value:function(e){var t=this;return this.getMap().then((function(t){return t.getItems(e)})).then((function(e){return t._wrapPaginator(e,(function(e){return Promise.all(e.map((function(e){return t.upsertChannel("sync",e.key,e.data)})))}))}))}},{key:"getChannel",value:function(e){var t=this;return this.getMap().then((function(t){return t.getItems({key:e})})).then((function(e){return e.items.map((function(e){return t.upsertChannel("sync",e.key,e.data)}))})).then((function(e){return e.length>0?e[0]:null}))}},{key:"pushChannel",value:function(e){var t=e.sid,n={entityName:null,lastConsumedMessageIndex:e.lastConsumedMessageIndex,type:e.type,status:e.status,friendlyName:e.friendlyName,dateUpdated:e.dateUpdated,dateCreated:e.dateCreated,uniqueName:e.uniqueName,createdBy:e.createdBy,attributes:e.attributes,channel:e.channel,notificationLevel:e.notificationLevel,sid:t};return this.upsertChannel("chat",t,n)}},{key:"_updateChannel",value:function(e,t,n){var r=this,i=void 0!==t._statusSource()&&e!==t._statusSource(),a="rest"!==e||"sync"===t._statusSource();if(i&&a&&"sync"!==e)TM.trace("upsertChannel: the channel is known from sync and it came from chat, ignoring",{sid:t.sid,data:n.status,channel:t.status});else{if(["joined","invited"].includes(n.status)&&t.status!==n.status){t._setStatus(n.status,e);var o={};return void 0!==n.notificationLevel&&(o.notificationLevel=n.notificationLevel),void 0!==n.lastConsumedMessageIndex&&(o.lastConsumedMessageIndex=n.lastConsumedMessageIndex),Vp(o,{})||t._update(o),void t._subscribe().then((function(){r.emit("joined"===n.status?"channelJoined":"channelInvited",t)}))}if(["joined","invited"].includes(t.status)&&"notParticipating"===n.status)return t._setStatus("notParticipating",e),t._update(n),void t._subscribe().then((function(){r.emit("channelLeft",t)}));"private"!==n.type||"notParticipating"!==n.status?t._update(n):t._subscribe()}}},{key:"upsertChannel",value:function(e,t,n){var r=this;TM.trace("upsertChannel called for ".concat(t),n);var i=this.channels.get(t);if(i)return TM.trace("upsertChannel: the channel ".concat(i.sid," is known;")+"its status is known from source ".concat(i._statusSource()," ")+"and the update came from source ".concat(e),i),this._updateChannel(e,i,n),i._subscribe().then((function(){return i}));if(!["chat","rest"].includes(e)||!this.tombstones.has(t)){TM.trace("upsertChannel: creating a local channel object with sid ".concat(t),n);var a="".concat(this.configuration.links.conversations,"/").concat(t),o={self:a,messages:"".concat(a,"/Messages"),participants:"".concat(a,"/Participants"),invites:"".concat(a,"/Invites")},s=new Channel(n,t,o,this.configuration,this.services);return this.channels.set(t,s),s._subscribe().then((function(){return r.registerForEvents(s),r.emit("channelAdded",s),["joined","invited"].includes(n.status)&&(s._setStatus(n.status,e),r.emit("joined"===n.status?"channelJoined":"channelInvited",s)),s}))}TM.trace("upsertChannel: the channel is deleted but reappeared again from chat, ignoring",t)}},{key:"onChannelRemoved",value:function(e){var t=this.channels.get(e);t&&(this.channels.delete(e),this.emit("channelRemoved",t))}},{key:"registerForEvents",value:function(e){var t=this;e.on("removed",(function(){return t.onChannelRemoved(e.sid)})),e.on("updated",(function(e){return t.emit("channelUpdated",e)})),e.on("memberJoined",this.emit.bind(this,"memberJoined")),e.on("memberLeft",this.emit.bind(this,"memberLeft")),e.on("memberUpdated",(function(e){return t.emit("memberUpdated",e)})),e.on("messageAdded",this.emit.bind(this,"messageAdded")),e.on("messageUpdated",(function(e){return t.emit("messageUpdated",e)})),e.on("messageRemoved",this.emit.bind(this,"messageRemoved")),e.on("typingStarted",this.emit.bind(this,"typingStarted")),e.on("typingEnded",this.emit.bind(this,"typingEnded"))}},{key:"_fetchMyChannels",value:(t=ha(Za.mark((function e(){var t,n,r,i,a;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=null;case 2:return r=new Xp(this.configuration.links.myConversations),n&&r.arg("PageToken",n),e.next=6,this.services.network.get(r.build());case 6:i=e.sent,a=i.body.conversations.map((function(e){return{descriptor:e,channel_sid:e.conversation_sid,status:e.status,channel:e.sync_objects.conversation,messages:e.sync_objects.messages,roster:"".concat(e.conversation_sid,".roster"),lastConsumedMessageIndex:e.last_consumed_message_index,notificationLevel:e.notification_level}})),n=i.body.meta.next_token,t=[].concat(Mk(t),Mk(a));case 10:if(n){e.next=2;break}case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),o}(ih),IM=Xt,CM=Lr.find,RM=bo,OM="find",MM=!0;OM in[]&&Array(1).find((function(){MM=!1})),IM({target:"Array",proto:!0,forced:MM},{find:function(e){return CM(this,e,arguments.length>1?arguments[1]:void 0)}}),RM(OM);var PM=Xt,AM=ft,DM=it,jM=st,NM=E,LM=Rr,UM=oa,BM=Qi("splice"),FM=Math.max,qM=Math.min,WM=9007199254740991,zM="Maximum allowed length exceeded";function GM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}PM({target:"Array",proto:!0,forced:!BM},{splice:function(e,t){var n,r,i,a,o,s,u=NM(this),c=jM(u.length),l=AM(e,c),f=arguments.length;if(0===f?n=r=0:1===f?(n=0,r=c-l):(n=f-2,r=qM(FM(DM(t),0),c-l)),c+n-r>WM)throw TypeError(zM);for(i=LM(u,r),a=0;a<r;a++)(o=l+a)in u&&UM(i,a,u[o]);if(i.length=r,n<r){for(a=l;a<c-r;a++)s=a+n,(o=a+r)in u?u[s]=u[o]:delete u[s];for(a=c;a>c-r+n;a--)delete u[a-1]}else if(n>r)for(a=c-r;a>l;a--)s=a+n-1,(o=a+r-1)in u?u[s]=u[o]:delete u[s];for(a=0;a<n;a++)u[a+l]=arguments[a+2];return u.length=c-r+n,i}});var JM=Hh.scope("User"),User=function(e){ma(User,e);var t,n,r,i,a,o=GM(User);function User(e,t,n,r,i){var a;return xa(this,User),(a=o.call(this)).links=n,a.configuration=r,a.services=i,a.subscribed="initializing",a.setMaxListeners(0),a.state={identity:e,entityName:t,friendlyName:null,attributes:{},online:null,notifiable:null},a}return pa(User,[{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"entityName",set:function(e){this.state.entityName=e}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"online",get:function(){return this.state.online}},{key:"notifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return"subscribed"==this.subscribed}},{key:"_update",value:function(e,t){var n=[];switch(JM.debug("User for",this.state.identity,"updated:",e,t),e){case"friendlyName":this.state.friendlyName!==t.value&&(n.push("friendlyName"),this.state.friendlyName=t.value);break;case"attributes":var r=Hp(t.value,"Retrieved malformed attributes from the server for user: ".concat(this.state.identity),JM);Vp(this.state.attributes,r)||(this.state.attributes=r,n.push("attributes"));break;case"reachability":this.state.online!==t.online&&(this.state.online=t.online,n.push("online")),this.state.notifiable!==t.notifiable&&(this.state.notifiable=t.notifiable,n.push("notifiable"));break;default:return}n.length>0&&this.emit("updated",{user:this,updateReasons:n})}},{key:"_updateReachabilityInfo",value:(a=ha(Za.mark((function e(t,n){var r=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.configuration.reachabilityEnabled){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.abrupt("return",t.get("reachability").then(n).catch((function(e){JM.warn("Failed to get reachability info for ",r.state.identity,e)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"_fetch",value:(i=ha(Za.mark((function e(){var t=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.entityName){e.next=2;break}return e.abrupt("return",this);case 2:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then((function(e){return t.entity=e,e.on("itemUpdated",(function(e){return JM.debug(t.state.entityName+" ("+t.state.identity+") itemUpdated: "+e.item.key),t._update(e.item.key,e.item.data)})),Promise.all([e.get("friendlyName").then((function(e){return t._update(e.key,e.data)})),e.get("attributes").then((function(e){return t._update(e.key,e.data)})),t._updateReachabilityInfo(e,(function(e){return t._update(e.key,e.data)}))])})).then((function(){return JM.debug("Fetched for",t.identity),t.subscribed="subscribed",t.emit("userSubscribed",t),t})).catch((function(e){throw t.promiseToFetch=null,e})),e.abrupt("return",this.promiseToFetch);case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_ensureFetched",value:function(){return this.promiseToFetch||this._fetch()}},{key:"updateAttributes",value:(r=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("unsubscribed"!=this.subscribed){e.next=2;break}throw new Error("Can't modify unsubscribed object");case 2:return e.next=4,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(t)});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateFriendlyName",value:(n=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("unsubscribed"!=this.subscribed){e.next=2;break}throw new Error("Can't modify unsubscribed object");case 2:return e.next=4,this.services.commandExecutor.mutateResource("post",this.links.self,{friendly_name:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unsubscribe",value:(t=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.promiseToFetch){e.next=7;break}return e.next=3,this.promiseToFetch;case 3:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),User}(ih);th([nM(["string","number","boolean","object",HO(null)]),nh("design:type",Function),nh("design:paramtypes",[Object]),nh("design:returntype",Promise)],User.prototype,"updateAttributes",null),th([nM("string"),nh("design:type",Function),nh("design:paramtypes",[Object]),nh("design:returntype",Promise)],User.prototype,"updateFriendlyName",null);var VM=Hh.scope("UserDescriptor"),UserDescriptor=function(){function UserDescriptor(e,t){xa(this,UserDescriptor),this.services=e,this.descriptor=t,this.identity=t.identity,this.friendlyName=t.friendly_name,this.attributes=Hp(t.attributes,"Failed to parse user attributes",VM),this.online=t.is_online,this.notifiable=t.is_notifiable}return pa(UserDescriptor,[{key:"subscribe",value:function(){return this.services.users.getUser(this.identity,this.descriptor.sync_unique_name)}},{key:"_getDescriptor",value:function(){return this.descriptor}}]),UserDescriptor}(),$M=function(){function e(t,n){xa(this,e),this.configuration=t,this.services=n}var t,n;return pa(e,[{key:"getUserDescriptor",value:(n=ha(Za.mark((function e(t){var n,r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Xp(this.configuration.links.users).path(t).build(),e.next=3,this.services.network.get(n);case 3:return r=e.sent,e.abrupt("return",new UserDescriptor(this.services,r.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getChannelUserDescriptors",value:(t=ha(Za.mark((function e(t){var n,r,i,a=this,o=arguments;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=new Xp(this.configuration.links.users).arg("ConversationSid",t).arg("PageToken",n.pageToken).build(),e.next=4,this.services.network.get(r);case 4:return i=e.sent,e.abrupt("return",new Yp(i.body.users.map((function(e){return new UserDescriptor(a.services,e)})),(function(e){return a.getChannelUserDescriptors(t,{pageToken:e})}),i.body.meta.prev_token,i.body.meta.next_token));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function KM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function QM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KM(Object(n),!0).forEach((function(t){wa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function HM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}var XM=function(e){ma(o,e);var t,n,r,i,a=HM(o);function o(e,t){var n;xa(this,o),(n=a.call(this)).configuration=e,n.services=t;var r={self:"".concat(e.links.users,"/").concat(e.userIdentity)};return n.fifoStack=[],n.myself=new User(n.configuration.userIdentity,n.configuration.userInfo,r,n.configuration,n.services),n.myself.on("updated",(function(e){return n.emit("userUpdated",e)})),n.myself.on("userSubscribed",(function(){return n.emit("userSubscribed",n.myself)})),n.myself.on("userUnsubscribed",(function(){n.emit("userUnsubscribed",n.myself),n.myself._ensureFetched()})),n.subscribedUsers=new Map,n.userDescriptors=new $M(n.configuration,QM(QM({},n.services),{},{users:ya(n)})),n}return pa(o,[{key:"handleUnsubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)&&this.subscribedUsers.delete(e.identity);var t=-1;this.fifoStack.find((function(n,r){return n==e.identity&&(t=r,!0)}))&&this.fifoStack.splice(t,1),this.emit("userUnsubscribed",e)}},{key:"handleSubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)||(this.fifoStack.length>=this.configuration.userInfosToSubscribe&&this.subscribedUsers.get(this.fifoStack.shift()).unsubscribe(),this.fifoStack.push(e.identity),this.subscribedUsers.set(e.identity,e),this.emit("userSubscribed",e))}},{key:"getUser",value:(i=ha(Za.mark((function e(t){var n,r,i,a,o=this,s=arguments;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:null,e.next=3,this.myself._ensureFetched();case 3:if(t!=this.myself.identity){e.next=5;break}return e.abrupt("return",this.myself);case 5:if(r=this.subscribedUsers.get(t)){e.next=19;break}if(n){e.next=12;break}return e.next=10,this.getUserDescriptor(t);case 10:i=e.sent,n=i._getDescriptor().sync_objects.user_info_map;case 12:return a={self:"".concat(this.configuration.links.users,"/").concat(t)},(r=new User(t,n,a,this.configuration,this.services)).on("updated",(function(e){return o.emit("userUpdated",e)})),r.on("userSubscribed",(function(){return o.handleSubscribeUser(r)})),r.on("userUnsubscribed",(function(){return o.handleUnsubscribeUser(r)})),e.next=19,r._ensureFetched();case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getUserDescriptor",value:(r=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.userDescriptors.getUserDescriptor(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getChannelUserDescriptors",value:(n=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.userDescriptors.getChannelUserDescriptors(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getSubscribedUsers",value:(t=ha(Za.mark((function e(){var t;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.myself._ensureFetched();case 2:return t=[this.myself],this.subscribedUsers.forEach((function(e){return t.push(e)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),o}(ih),YM=Hh.scope("TypingIndicator"),ZM=function(){function e(t,n,r){xa(this,e),this.getChannel=t,this.configuration=n,this.services=r,this.serviceTypingTimeout=null,this.sentUpdates=new Map}return pa(e,[{key:"typingTimeout",get:function(){return this.configuration.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.configuration.typingIndicatorTimeoutDefault}},{key:"initialize",value:function(){var e=this;this.services.notificationClient.subscribe(Vv.TYPING_INDICATOR,"twilsock"),this.services.notificationClient.on("message",(function(t,n){t===Vv.TYPING_INDICATOR&&e.handleRemoteTyping(n)}))}},{key:"handleRemoteTyping",value:function(e){var t=this;YM.trace("Got new typing indicator ",e),this.getChannel(e.channel_sid).then((function(n){n&&n.members.forEach((function(n){if(n.identity===e.identity){var r=t.configuration.typingIndicatorTimeoutOverride+1e3||1e3*e.typing_timeout;n._startTyping(r)}}))})).catch((function(e){throw YM.error(e),e}))}},{key:"send",value:function(e){var t=this.sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?Promise.resolve():(this.sentUpdates.set(e,Date.now()),this._send(e))}},{key:"_send",value:function(e){var t=this;YM.trace("Sending typing indicator");var n=this.configuration.links.typing,r="ChannelSid="+e;return this.services.transport.post(n,{"Content-Type":"application/x-www-form-urlencoded"},r,this.configuration.productId).then((function(e){e.body.hasOwnProperty("typing_timeout")&&(t.serviceTypingTimeout=1e3*e.body.typing_timeout)})).catch((function(e){throw YM.error("Failed to send typing indicator:",e),e}))}}]),e}(),eP=function(){function e(t,n,r){xa(this,e),this.client=t,this.services=n,this.url=r}var t;return pa(e,[{key:"getChannels",value:(t=ha(Za.mark((function e(){var t,n,r,i=this,a=arguments;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=new Xp(this.url).arg("PageToken",t.pageToken).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,e.abrupt("return",new Yp(r.body.conversations.map((function(e){return new ChannelDescriptor(i.client,e)})),(function(e){return i.getChannels({pageToken:e})}),r.body.meta.previous_token,r.body.meta.next_token));case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),PushNotification=function PushNotification(e){xa(this,PushNotification),this.title=e.title||null,this.body=e.body||null,this.sound=e.sound||null,this.badge=e.badge||null,this.action=e.action||null,this.type=e.type||null,this.data=e.data||{}};function tP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tP(Object(n),!0).forEach((function(t){wa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rP=function(e){return e.replace(/(^\/+|\/+$)/g,"")},iP=function(){function e(t,n,r){xa(this,e),this._serviceUrl=t,this._services=n,this._productId=r}var t,n,r;return pa(e,[{key:"_preProcessUrl",value:function(e){var t=rP(e);return/^https?:\/\//.test(e)?t:"".concat(rP(this._serviceUrl),"/").concat(t)}},{key:"_makeRequest",value:(r=ha(Za.mark((function e(t,n,r,i){var a,o,s,u;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this._preProcessUrl(n),o=nP({"Content-Type":"application/json; charset=utf-8"},i||{}),e.t0=t,e.next="get"===e.t0?5:"post"===e.t0?11:"delete"===e.t0?15:19;break;case 5:return u=a,r&&(u+="?"+Object.entries(r).map((function(e){return e.map(encodeURIComponent).join("=")})).join("&")),e.next=9,this._services.transport.get(u,o,this._productId);case 9:return s=e.sent,e.abrupt("break",19);case 11:return e.next=13,this._services.transport.post(a,o,JSON.stringify(r),this._productId);case 13:return s=e.sent,e.abrupt("break",19);case 15:return e.next=17,this._services.transport.delete(a,o,this._productId);case 17:return s=e.sent,e.abrupt("break",19);case 19:if(!(s.status.code<200||s.status.code>=300)){e.next=21;break}throw new Error("Request responded with a non-success code ".concat(s.status.code));case 21:return e.abrupt("return",s);case 22:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"fetchResource",value:(n=ha(Za.mark((function e(t,n){var r,i=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,new qv({min:50,max:1600,maxAttemptsCount:6}).run((function(){return i._makeRequest("get",t,n)}));case 4:r=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),new Error('Fetch resource from "'.concat(t,'" failed.'));case 10:return e.abrupt("return",r.body);case 11:case"end":return e.stop()}}),e,null,[[1,7]])}))),function(e,t){return n.apply(this,arguments)})},{key:"mutateResource",value:(t=ha(Za.mark((function e(t,n,r){var i;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._makeRequest(t,n,r,{"X-Twilio-Mutation-Id":Rm.v4()});case 2:if(202!==(i=e.sent).status.code){e.next=7;break}return e.next=6,this.fetchResource(i.body.resource_url);case 6:return e.abrupt("return",e.sent);case 7:return e.abrupt("return",i.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();function aP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aP(Object(n),!0).forEach((function(t){wa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function sP(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ka(e);if(t){var i=ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}var uP=Hh.scope("Client"),cP="5.0.1",lP=function e(){xa(this,e)},Client=function(e){ma(Client,e);var t,n,r,i,a,o,s,u,c,l,f,h=sP(Client);function Client(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(xa(this,Client),wa(ya(n=h.call(this)),"connectionState","connecting"),wa(ya(n),"channelsPromise",null),wa(ya(n),"configurationPromise",null),wa(ya(n),"version",cP),wa(ya(n),"parsePushNotification",Client.parsePushNotification),n.options=r,!n.options.disableDeepClone){var i=oP(oP({},n.options),{},{transport:void 0,twilsockClient:void 0});(i=$p(i)).transport=n.options.transport,i.twilsockClient=n.options.twilsockClient,n.options=i}n.options.logLevel=n.options.logLevel||"silent",uP.setLevel(n.options.logLevel);var a=n.options.productId="ip_messaging";if(n.options.clientMetadata=n.options.clientMetadata||{},n.options.clientMetadata.hasOwnProperty("type")||(n.options.clientMetadata.type="chat"),n.options.clientMetadata.hasOwnProperty("sdk")||(n.options.clientMetadata.sdk="JS",n.options.clientMetadata.sdkv=cP),n.options.Sync=n.options.Sync||{},null!==(t=n.options.Sync)&&void 0!==t&&t.enableSessionStorage||(n.options.Sync.enableSessionStorage=!0),n.options.region&&(n.options.Sync.region=n.options.region),!e)throw new Error("A valid Twilio token should be provided");n.services=new lP,n.options.twilsockClient=n.options.twilsockClient||new sk(e,a,n.options),n.options.transport=n.options.transport||n.options.twilsockClient,n.options.notificationsClient=n.options.notificationsClient||new lk.Notifications(e,n.options),n.options.syncClient=n.options.syncClient||new ew.exports.SyncClient(e,n.options),n.services.syncClient=n.options.syncClient,n.services.transport=n.options.transport,n.services.twilsockClient=n.options.twilsockClient,n.services.notificationClient=n.options.notificationsClient;var o=r.Chat||r.IPMessaging||r||{},s=o.region||r.region,u=o.apiUri||o.typingUri||"https://aim.".concat(s||"us1",".twilio.com");return n.services.commandExecutor=new iP(u,{transport:n.options.transport},a),n.configurationPromise=n.services.commandExecutor.fetchResource("Client/v1/Configuration"),n.configurationPromise.then((function(e){return n.configuration=new sd(n.options,e,uP),n.services.typingIndicator=new ZM(n.getChannelBySid.bind(ya(n)),n.configuration,n.services),n.services.network=new Jv(n.configuration,n.services),n.services.users=new XM(n.configuration,n.services),n.services.users.on("userSubscribed",n.emit.bind(ya(n),"userSubscribed")),n.services.users.on("userUpdated",(function(e){return n.emit("userUpdated",e)})),n.services.users.on("userUnsubscribed",n.emit.bind(ya(n),"userUnsubscribed")),n.services.twilsockClient.on("tokenAboutToExpire",(function(e){return n.emit("tokenAboutToExpire",e)})),n.services.twilsockClient.on("tokenExpired",(function(){return n.emit("tokenExpired")})),n.services.twilsockClient.on("connectionError",(function(e){return n.emit("connectionError",e)})),n.channels=new EM(n.configuration,n.services),n.channels.on("channelAdded",n.emit.bind(ya(n),"channelAdded")),n.channels.on("channelInvited",n.emit.bind(ya(n),"channelInvited")),n.channels.on("channelRemoved",n.emit.bind(ya(n),"channelRemoved")),n.channels.on("channelJoined",n.emit.bind(ya(n),"channelJoined")),n.channels.on("channelLeft",n.emit.bind(ya(n),"channelLeft")),n.channels.on("channelUpdated",(function(e){return n.emit("channelUpdated",e)})),n.channels.on("memberJoined",n.emit.bind(ya(n),"memberJoined")),n.channels.on("memberLeft",n.emit.bind(ya(n),"memberLeft")),n.channels.on("memberUpdated",(function(e){return n.emit("memberUpdated",e)})),n.channels.on("messageAdded",n.emit.bind(ya(n),"messageAdded")),n.channels.on("messageUpdated",(function(e){return n.emit("messageUpdated",e)})),n.channels.on("messageRemoved",n.emit.bind(ya(n),"messageRemoved")),n.channels.on("typingStarted",n.emit.bind(ya(n),"typingStarted")),n.channels.on("typingEnded",n.emit.bind(ya(n),"typingEnded")),n.services.users.myself._ensureFetched()})),n.channelsPromise=n.configurationPromise.then((function(){return n.channels.fetchChannels()})).then((function(){return n.channels})),n.services.notificationClient.on("connectionStateChanged",(function(e){var t=null;switch(e){case"connected":t="connected";break;case"denied":t="denied";break;case"disconnecting":t="disconnecting";break;case"disconnected":t="disconnected";break;default:t="connecting"}t!==n.connectionState&&(n.connectionState=t,n.emit("connectionStateChanged",n.connectionState))})),n.fpaToken=e,n}return pa(Client,[{key:"user",get:function(){return this.services.users.myself}},{key:"reachabilityEnabled",get:function(){return this.configuration.reachabilityEnabled}},{key:"token",get:function(){return this.fpaToken}},{key:"subscribeToPushNotifications",value:function(e){var t=this,n=[];return[Vv.NEW_MESSAGE,Vv.ADDED_TO_CHANNEL,Vv.INVITED_TO_CHANNEL,Vv.REMOVED_FROM_CHANNEL,Vv.TYPING_INDICATOR,Vv.CONSUMPTION_UPDATE].forEach((function(r){n.push(t.services.notificationClient.subscribe(r,e))})),Promise.all(n)}},{key:"unsubscribeFromPushNotifications",value:function(e){var t=this,n=[];return[Vv.NEW_MESSAGE,Vv.ADDED_TO_CHANNEL,Vv.INVITED_TO_CHANNEL,Vv.REMOVED_FROM_CHANNEL,Vv.TYPING_INDICATOR,Vv.CONSUMPTION_UPDATE].forEach((function(r){n.push(t.services.notificationClient.unsubscribe(r,e))})),Promise.all(n)}},{key:"initialize",value:(f=ha(Za.mark((function e(){var t,n=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configurationPromise;case 2:return Client.supportedPushChannels.forEach((function(e){return n.subscribeToPushNotifications(e)})),this.services.publicChannels=new ey(this,this.services,this.configuration.links.conversations),this.services.userChannels=new eP(this,this.services,this.configuration.links.myConversations),(t=Object.assign(this.options)).transport=null,this.services.mcsClient=new JS.McsClient(this.fpaToken,this.configuration.links.mediaService,t),e.next=10,this.services.typingIndicator.initialize();case 10:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"shutdown",value:(l=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.twilsockClient.disconnect();case 2:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"updateToken",value:(c=ha(Za.mark((function e(t){var n=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uP.info("updateToken"),this.fpaToken!==t){e.next=3;break}return e.abrupt("return",this);case 3:return e.next=5,this.services.twilsockClient.updateToken(t).then((function(){return n.fpaToken=t})).then((function(){return n.services.mcsClient.updateToken(t)})).then((function(){return n.configurationPromise}));case 5:return e.abrupt("return",this);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getChannelBySid",value:(u=ha(Za.mark((function e(t){var n=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channels.myChannelsRead.promise.then((function(){return n.channels.getChannel(t).then((function(e){return e||n.services.publicChannels.getChannelBySid(t).then((function(e){return n.channels.pushChannel(e)}))}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getChannelByUniqueName",value:(s=ha(Za.mark((function e(t){var n=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channels.myChannelsRead.promise.then((function(){return n.services.publicChannels.getChannelByUniqueName(t).then((function(e){return n.channels.pushChannel(e)}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getSubscribedChannels",value:function(e){return this.channelsPromise.then((function(t){return t.getChannels(e)}))}},{key:"getLocalChannels",value:function(e){return this.channelsPromise.then((function(t){var n=[];t.channels.forEach((function(e){n.push(e)}));var r=(null==e?void 0:e.order)||"ascending";return e&&e.criteria&&("lastMessage"===e.criteria?n.sort((function(e,t){return Client.compareChannelsByLastMessage(e,t,r)})):"uniqueName"===e.criteria?n.sort((function(e,t){return Client.compareChannelsByStringProperty(e.uniqueName,t.uniqueName,r)})):"friendlyName"===e.criteria&&n.sort((function(e,t){return Client.compareChannelsByStringProperty(e.friendlyName,t.friendlyName,r)}))),n}))}},{key:"getPublicChannelDescriptors",value:function(){return this.services.publicChannels.getChannels()}},{key:"getUserChannelDescriptors",value:function(){return this.services.userChannels.getChannels()}},{key:"createChannel",value:function(e){return e=e||{},this.channelsPromise.then((function(t){return t.addChannel(e)}))}},{key:"setPushRegistrationId",value:(o=ha(Za.mark((function e(t,n){var r=this;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subscribeToPushNotifications(t).then((function(){return r.services.notificationClient.setPushRegistrationId(n,t)}));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"unsetPushRegistrationId",value:(a=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==Client.supportedPushChannels.indexOf(t)){e.next=2;break}throw new Error("Invalid or unsupported channelType: "+t);case 2:return e.next=4,this.unsubscribeFromPushNotifications(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"handlePushNotification",value:(i=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:uP.debug("handlePushNotification, notificationPayload=",t),this.emit("pushNotification",Client.parsePushNotification(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getUser",value:function(e){return this.services.users.getUser(e)}},{key:"getUserDescriptor",value:(r=ha(Za.mark((function e(t){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getUserDescriptor(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getSubscribedUsers",value:(n=ha(Za.mark((function e(){return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getSubscribedUsers());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}],[{key:"create",value:(t=ha(Za.mark((function e(t,n){var r;return Za.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Client(t,n),e.next=3,r.initialize();case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"compareChannelsByLastMessage",value:function(e,t,n){if(e.lastMessage&&t.lastMessage){if(e.lastMessage.dateCreated&&t.lastMessage.dateCreated)return e.lastMessage.dateCreated.getTime()<t.lastMessage.dateCreated.getTime()?"ascending"===n?-1:1:"ascending"===n?1:-1;if(e.lastMessage.dateCreated)return-1;if(t.lastMessage.dateCreated)return 1}return e.lastMessage?-1:t.lastMessage?1:0}},{key:"compareChannelsByStringProperty",value:function(e,t,n){return e&&t?"ascending"===n?e.localeCompare(t):-1*e.localeCompare(t):e?-1:t?1:0}},{key:"parsePushNotificationChatData",value:function(e){var t={};for(var n in Client.supportedPushDataFields)void 0!==e[n]&&null!==e[n]&&("message_index"===n?null!==Kp(e[n])&&(t[Client.supportedPushDataFields[n]]=Number(e[n])):t[Client.supportedPushDataFields[n]]=e[n]);return t}},{key:"parsePushNotification",value:function(e){if(uP.debug("parsePushNotification, notificationPayload=",e),void 0!==e.aps){if(!e.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var t=Client.parsePushNotificationChatData(e),n=e.aps,r=null,i=null;return"string"==typeof n.alert?r=n.alert||null:(r=n.alert.body||null,i=n.alert.title||null),new PushNotification({title:i,body:r,sound:n.sound||null,badge:n.badge||null,action:n.category||null,type:e.twi_message_type,data:t})}if(void 0!==e.data){var a=e.data;if(!a.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var o=Client.parsePushNotificationChatData(e.data);return new PushNotification({title:a.twi_title||null,body:a.twi_body||null,sound:a.twi_sound||null,badge:null,action:a.twi_action||null,type:a.twi_message_type,data:o})}throw new Error("Provided push notification payload is not Programmable Chat notification")}}]),Client}(ih);return wa(Client,"version",cP),wa(Client,"supportedPushChannels",["fcm","apn","gcm"]),wa(Client,"supportedPushDataFields",{channel_sid:"channelSid",message_sid:"messageSid",message_index:"messageIndex"}),th([nM(XO),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Client.prototype,"updateToken",null),th([nM(XO),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Client.prototype,"getChannelBySid",null),th([nM(XO),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Client.prototype,"getChannelByUniqueName",null),th([nM(["undefined",ZO("sorting options",{criteria:[HO("lastMessage","friendlyName","uniqueName"),"undefined"],order:[HO("ascending","descending"),"undefined"]})]),nh("design:type",Function),nh("design:paramtypes",[Object]),nh("design:returntype",Promise)],Client.prototype,"getLocalChannels",null),th([nM(["undefined",ZO("channel options",{friendlyName:["string","undefined"],isPrivate:["boolean","undefined"],uniqueName:["string","undefined"]})]),nh("design:type",Function),nh("design:paramtypes",[Object]),nh("design:returntype",Promise)],Client.prototype,"createChannel",null),th([nM(HO("gcm","fcm","apn"),"string"),nh("design:type",Function),nh("design:paramtypes",[String,String]),nh("design:returntype",Promise)],Client.prototype,"setPushRegistrationId",null),th([nM(HO("gcm","fcm","apn")),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Client.prototype,"unsetPushRegistrationId",null),th([nM(eM),nh("design:type",Function),nh("design:paramtypes",[Object]),nh("design:returntype",Promise)],Client.prototype,"handlePushNotification",null),th([nM(XO),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Client.prototype,"getUser",null),th([nM(XO),nh("design:type",Function),nh("design:paramtypes",[String]),nh("design:returntype",Promise)],Client.prototype,"getUserDescriptor",null),th([nM("string",["undefined",eM]),nh("design:type",Function),nh("design:paramtypes",[String,Object]),nh("design:returntype",Promise)],Client,"create",null),th([tM(eM),nh("design:type",Function),nh("design:paramtypes",[Object]),nh("design:returntype",PushNotification)],Client,"parsePushNotification",null),e.Client=Client,e.PushNotification=PushNotification,e.User=User,e.default=Client,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
