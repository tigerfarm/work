/* twilio-notifications.js 0.5.12
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2016, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes Backoff library under the following license

    Copyright (C) 2012 Mathieu Turcotte

    Permission is hereby granted, free of charge, to any person obtaining a copy of
    this software and associated documentation files (the "Software"), to deal in
    the Software without restriction, including without limitation the rights to
    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
    of the Software, and to permit persons to whom the Software is furnished to do
    so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

This software includes Event-to-Promise library under the following license

    Copyright (c) 2014, Julien Fontanet <julien.fontanet@isonoe.net>.

    Permission to use, copy, modify, and/or distribute this software for any purpose
    with or without fee is hereby granted, provided that the above copyright notice
    and this permission notice appear in all copies.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
    FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
    OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
    TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
    THIS SOFTWARE.
*/
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;((t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Twilio||(t.Twilio={})).Notifications=e()}}(function(){return function(){return function e(t,r,n){function o(s,a){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[s]={exports:{}};t[s][0].call(u.exports,function(e){return o(t[s][1][e]||e)},u,u.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}}()({1:[function(e,t,r){"use strict";var n=u(e("babel-runtime/regenerator")),o=u(e("babel-runtime/helpers/asyncToGenerator")),i=u(e("babel-runtime/core-js/object/get-prototype-of")),s=u(e("babel-runtime/helpers/classCallCheck")),a=u(e("babel-runtime/helpers/createClass")),c=u(e("babel-runtime/helpers/possibleConstructorReturn")),l=u(e("babel-runtime/helpers/inherits"));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.Client=void 0;var f=e("events"),d=e("twilsock"),p=e("./configuration"),h=e("./registrar"),b=e("./logger"),m=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.default)(this,t);var n=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this));if(!e||0===e.length)throw new Error("Token is required for Notifications client");r.logLevel=r.logLevel||"error",b.log.setLevel(r.logLevel);r.minTokenRefreshInterval;var o=r.productId||"notifications";return r.twilsockClient=r.twilsockClient||new d.TwilsockClient(e,o,r),r.transport=r.transport||r.twilsockClient,n.services={twilsock:r.twilsockClient,transport:r.transport,config:new p.Configuration(null,r)},n.registrar=new h.Registrar(o,n.services.transport,n.services.twilsock,n.services.config),n.reliableTransportState={overall:!1,transport:!1,registration:!1,lastEmitted:null},n._onTransportStateChange(n.services.twilsock.isConnected),n.registrar.on("transportReady",function(e){n._onRegistrationStateChange(e?"registered":"")}),n.registrar.on("stateChanged",function(e){n._onRegistrationStateChange(e)}),n.registrar.on("needReliableTransport",n._onNeedReliableTransport.bind(n)),n.services.twilsock.on("message",function(e,t){return n._routeMessage(e,t)}),n.services.twilsock.on("connected",function(e){n._onTransportStateChange(!0),n.registrar.setNotificationId("twilsock",e)}),n.services.twilsock.on("disconnected",function(){n._onTransportStateChange(!1)}),n.services.config.updateToken(e),n.registrar.updateToken(e),n}return(0,l.default)(t,e),(0,a.default)(t,[{key:"_routeMessage",value:function(e,t){b.log.trace("Message arrived: ",e,t),this.emit("message",e,t)}},{key:"_onNeedReliableTransport",value:function(e){e?this.services.twilsock.connect():this.services.twilsock.disconnect()}},{key:"_onRegistrationStateChange",value:function(e){this.reliableTransportState.registration="registered"===e,this._updateTransportState()}},{key:"_onTransportStateChange",value:function(e){this.reliableTransportState.transport=e,this._updateTransportState()}},{key:"_updateTransportState",value:function(){var e=this.reliableTransportState.transport&&this.reliableTransportState.registration;this.reliableTransportState.overall!==e&&(this.reliableTransportState.overall=e,b.log.info("Transport ready:",e),this.emit("transportReady",e)),this.reliableTransportState.lastEmitted!==this.connectionState&&(this.reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}},{key:"subscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return b.log.trace("Add subscriptions for message type: ",e,t),this.registrar.subscribe(e,t)}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return b.log.trace("Remove subscriptions for message type: ",e,t),this.registrar.unsubscribe(e,t)}},{key:"handlePushNotification",value:function(e){return{messageType:e.twi_message_type,payload:e.payload}}},{key:"setPushRegistrationId",value:function(e,t){b.log.trace("Set push registration id",e,t),this.registrar.setNotificationId(t,e)}},{key:"updateToken",value:function(){var e=(0,o.default)(n.default.mark(function e(t){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(b.log.info("authTokenUpdated"),this.services.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.services.twilsock.updateToken(t);case 5:this.services.config.updateToken(t),this.registrar.updateToken(t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"connectionState",get:function(){return"disconnected"===this.services.twilsock.state?"disconnected":"disconnecting"===this.services.twilsock.state?"disconnecting":"connected"===this.services.twilsock.state&&this.reliableTransportState.registration?"connected":"rejected"===this.services.twilsock.state?"denied":"connecting"}}]),t}(f.EventEmitter);r.Client=m},{"./configuration":2,"./logger":4,"./registrar":6,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/asyncToGenerator":23,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,"babel-runtime/regenerator":32,events:162,twilsock:179}],2:[function(e,t,r){"use strict";var n=i(e("babel-runtime/helpers/classCallCheck")),o=i(e("babel-runtime/helpers/createClass"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.Configuration=void 0;var s=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,n.default)(this,e);var o=r.notifications||{},i="https://ers."+(o.region||r.region||"us1")+".twilio.com/v1/registrations";this.registrarUrl=o.ersUrl||i,this._token=t}return(0,o.default)(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"token",get:function(){return this._token}}]),e}();r.Configuration=s},{"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25}],3:[function(e,t,r){"use strict";var n=p(e("babel-runtime/helpers/slicedToArray")),o=p(e("babel-runtime/regenerator")),i=p(e("babel-runtime/helpers/asyncToGenerator")),s=p(e("babel-runtime/core-js/object/get-prototype-of")),a=p(e("babel-runtime/helpers/possibleConstructorReturn")),c=p(e("babel-runtime/helpers/inherits")),l=p(e("babel-runtime/helpers/toConsumableArray")),u=p(e("babel-runtime/core-js/set")),f=p(e("babel-runtime/helpers/classCallCheck")),d=p(e("babel-runtime/helpers/createClass"));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.Connector=r.RegistrationState=void 0;var h=e("events"),b=e("./logger"),m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.default;(0,f.default)(this,e),this.token=t,this.notificationId=r,this.messageTypes=n}return(0,d.default)(e,[{key:"clone",value:function(){return new e(this.token,this.notificationId,new u.default(this.messageTypes))}}]),e}();function v(e,t){var r=new u.default;return e.notificationId!==t.notificationId&&r.add("notificationId"),e.token!==t.token&&r.add("token"),function(e,t){return[].concat((0,l.default)([].concat((0,l.default)(e)).filter(function(e){return!t.has(e)})),(0,l.default)([].concat((0,l.default)(t)).filter(function(t){return!e.has(t)})))}(e.messageTypes,t.messageTypes).length>0&&r.add("messageType"),[r.size>0,r]}r.RegistrationState=m;var g=function(e){function t(e){(0,f.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return r.config=e,r.desiredState=new m,r.currentState=new m,r.hasActiveAttempt=!1,r}return(0,c.default)(t,e),(0,d.default)(t,[{key:"subscribe",value:function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.desiredState.messageTypes.has(t)){e.next=3;break}return b.log.debug("message type already registered ",t),e.abrupt("return");case 3:return this.desiredState.messageTypes.add(t),e.next=6,this.persistRegistration();case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.desiredState.messageTypes.has(t)){e.next=2;break}return e.abrupt("return");case 2:return this.desiredState.messageTypes.delete(t),e.next=5,this.persistRegistration();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateToken",value:function(e){this.desiredState.token=e,this.persistRegistration()}},{key:"persistRegistration",value:function(){var e=(0,i.default)(o.default.mark(function e(){var t,r,i,s,a,c,l=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.token&&0!==this.config.token.length){e.next=3;break}return b.log.trace("Can't persist registration: token is not set"),e.abrupt("return");case 3:if(!this.hasActiveAttempt){e.next=6;break}return b.log.trace("One registration attempt is already in progress"),e.abrupt("return");case 6:if(t=v(this.desiredState,this.currentState),r=(0,n.default)(t,2),i=r[0],s=r[1],i){e.next=9;break}return e.abrupt("return");case 9:if(this.currentState.notificationId||s.delete("notificationId"),b.log.trace("Persisting registration",s,this.desiredState),e.prev=11,this.hasActiveAttempt=!0,!((a=this.desiredState.clone()).messageTypes.size>0)){e.next=24;break}return e.next=17,this.updateRegistration(a,s);case 17:c=e.sent,this.currentState.token=c.token,this.currentState.notificationId=c.notificationId,this.currentState.messageTypes=c.messageTypes,this.emit("stateChanged","registered"),e.next=30;break;case 24:return e.next=26,this.removeRegistration();case 26:this.currentState.token=a.token,this.currentState.notificationId=a.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged","unregistered");case 30:return e.prev=30,this.hasActiveAttempt=!1,setTimeout(function(){return l.persistRegistration()},0),e.finish(30);case 34:case"end":return e.stop()}},e,this,[[11,,30,34]])}));return function(){return e.apply(this,arguments)}}()},{key:"setNotificationId",value:function(e){this.desiredState.notificationId=e,this.persistRegistration()}}]),t}(h.EventEmitter);r.Connector=g},{"./logger":4,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/core-js/set":20,"babel-runtime/helpers/asyncToGenerator":23,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,"babel-runtime/helpers/slicedToArray":29,"babel-runtime/helpers/toConsumableArray":30,"babel-runtime/regenerator":32,events:162}],4:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),o=s(e("babel-runtime/helpers/createClass")),i=s(e("babel-runtime/core-js/array/from"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.log=r.Logger=void 0;var a=e("loglevel");function c(e,t){return[(new Date).toISOString()+" Notifications "+e+":"].concat((0,i.default)(t))}var l=function(){function e(){(0,n.default)(this,e),this.prefix=""}return(0,o.default)(e,[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,c("T"+this.prefix,t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,c("D"+this.prefix,t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info.apply(null,c("I"+this.prefix,t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.warn.apply(null,c("W"+this.prefix,t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.error.apply(null,c("E"+this.prefix,t))}}],[{key:"scope",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new e}}]),e}();r.Logger=l;var u=l.scope();r.log=u},{"babel-runtime/core-js/array/from":8,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,loglevel:164}],5:[function(e,t,r){"use strict";var n=d(e("babel-runtime/core-js/array/from")),o=d(e("babel-runtime/core-js/object/assign")),i=d(e("babel-runtime/regenerator")),s=d(e("babel-runtime/helpers/asyncToGenerator")),a=d(e("babel-runtime/core-js/object/get-prototype-of")),c=d(e("babel-runtime/helpers/classCallCheck")),l=d(e("babel-runtime/helpers/createClass")),u=d(e("babel-runtime/helpers/possibleConstructorReturn")),f=d(e("babel-runtime/helpers/inherits"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.RegistrarConnector=r.Connector=void 0;var p=e("operation-retrier"),h=e("./logger"),b=e("./connector");Object.defineProperty(r,"Connector",{enumerable:!0,get:function(){return b.Connector}});var m={min:2e3,max:12e4,randomness:.2},v=function(e){function t(e,r,n,o){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,a.default)(t)).call(this,o));return i.channelType=e,i.context=r,i.transport=n,i}return(0,f.default)(t,e),(0,l.default)(t,[{key:"updateRegistration",value:function(){var e=(0,s.default)(i.default.mark(function e(t,r){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.has("notificationId")){e.next=3;break}return e.next=3,this.removeRegistration();case 3:if(t.notificationId&&t.notificationId.length){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,this.register(t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeRegistration",value:function(){var e=(0,s.default)(i.default.mark(function e(){var t,r,n=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrationId){e.next=2;break}return e.abrupt("return");case 2:return t=this.config.registrarUrl+"/"+this.registrationId+"?productId="+this.context.productId,r={"Content-Type":"application/json","X-Twilio-Token":this.config.token},e.prev=4,h.log.trace("Removing registration for ",this.channelType),e.next=8,new p.Retrier((0,o.default)(m,{maxAttemptsCount:3})).run(function(){return n.transport.delete(t,r)});case 8:h.log.debug("Registration removed for",this.channelType),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(4),h.log.error("Failed to remove of registration ",this.channelType,e.t0),e.t0;case 15:case"end":return e.stop()}},e,this,[[4,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"register",value:function(){var e=(0,s.default)(i.default.mark(function e(t){var r,o,s,a,c=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h.log.trace("Registering",this.channelType,t),r={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:(0,n.default)(t.messageTypes),data:{registration_id:t.notificationId},ttl:"PT24H"},o=this.config.registrarUrl+"?productId="+this.context.productId,s={"Content-Type":"application/json","X-Twilio-Token":t.token},h.log.trace("Creating registration for channel ",this.channelType),e.prev=5,e.next=8,new p.Retrier(m).run(function(){return c.transport.post(o,s,r)});case 8:a=e.sent,this.registrationId=a.body.id,h.log.debug("Registration created: ",a),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(5),h.log.error("Registration failed: ",e.t0),e.t0;case 17:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(b.Connector);r.RegistrarConnector=v},{"./connector":3,"./logger":4,"babel-runtime/core-js/array/from":8,"babel-runtime/core-js/object/assign":13,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/asyncToGenerator":23,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,"babel-runtime/regenerator":32,"operation-retrier":166}],6:[function(e,t,r){"use strict";var n=l(e("babel-runtime/core-js/map")),o=l(e("babel-runtime/core-js/object/get-prototype-of")),i=l(e("babel-runtime/helpers/classCallCheck")),s=l(e("babel-runtime/helpers/createClass")),a=l(e("babel-runtime/helpers/possibleConstructorReturn")),c=l(e("babel-runtime/helpers/inherits"));function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.Registrar=void 0;var u=e("events"),f=e("./registrar.connector"),d=e("./twilsock.connector"),p=function(e){function t(e,r,s,c){(0,i.default)(this,t);var l=(0,a.default)(this,(t.__proto__||(0,o.default)(t)).call(this));l.config=c,l.connectors=new n.default;var u=l.detectPlatform();return l.connectors.set("gcm",new f.RegistrarConnector("gcm",{protocolVersion:3,productId:e,platform:u},r,c)),l.connectors.set("fcm",new f.RegistrarConnector("fcm",{protocolVersion:3,productId:e,platform:u},r,c)),l.connectors.set("apn",new f.RegistrarConnector("apn",{protocolVersion:4,productId:e,platform:u},r,c)),l.connectors.set("twilsock",new d.TwilsockConnector({productId:e,platform:u},s,c)),l.connectors.get("twilsock").on("transportReady",function(e){return l.emit("transportReady",e)}),l}return(0,c.default)(t,e),(0,s.default)(t,[{key:"setNotificationId",value:function(e,t){this.connector(e).setNotificationId(t)}},{key:"subscribe",value:function(e,t){return this.connector(t).subscribe(e)}},{key:"unsubscribe",value:function(e,t){return this.connector(t).unsubscribe(e)}},{key:"updateToken",value:function(e){this.connectors.forEach(function(t){return t.updateToken(e)})}},{key:"connector",value:function(e){var t=this.connectors.get(e);if(!t)throw new Error("Unknown channel type: "+e);return t}},{key:"detectPlatform",value:function(){var e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),t}(u.EventEmitter);r.Registrar=p},{"./registrar.connector":5,"./twilsock.connector":7,"babel-runtime/core-js/map":12,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,events:162}],7:[function(e,t,r){"use strict";var n=f(e("babel-runtime/core-js/array/from")),o=f(e("babel-runtime/regenerator")),i=f(e("babel-runtime/helpers/asyncToGenerator")),s=f(e("babel-runtime/core-js/object/get-prototype-of")),a=f(e("babel-runtime/helpers/classCallCheck")),c=f(e("babel-runtime/helpers/createClass")),l=f(e("babel-runtime/helpers/possibleConstructorReturn")),u=f(e("babel-runtime/helpers/inherits"));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.TwilsockConnector=void 0;var d=e("uuid"),p=function(e){function t(e,r,n){(0,a.default)(this,t);var o=(0,l.default)(this,(t.__proto__||(0,s.default)(t)).call(this,n));return o.twilsock=r,o.context=e,e.id=d.v4(),o.twilsock.on("stateChanged",function(e){"connected"!==e&&o.emit("transportReady",!1)}),o.twilsock.on("registered",function(t){e&&t===e.id&&"connected"===r.state&&o.emit("transportReady",!0)}),o}return(0,u.default)(t,e),(0,c.default)(t,[{key:"setNotificationId",value:function(){}},{key:"updateToken",value:function(e){}},{key:"updateContextRequest",value:function(){var e=(0,i.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,message_types:t},this.emit("transportReady",!1),e.next=4,this.twilsock.setNotificationsContext(this.context.id,r);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateRegistration",value:function(){var e=(0,i.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.has("messageType")){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.updateContextRequest((0,n.default)(t.messageTypes));case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeRegistration",value:function(){return this.twilsock.removeNotificationsContext(this.context.id)}}]),t}(e("./connector").Connector);r.TwilsockConnector=p},{"./connector":3,"babel-runtime/core-js/array/from":8,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/asyncToGenerator":23,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,"babel-runtime/regenerator":32,uuid:200}],8:[function(e,t,r){t.exports={default:e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":34}],9:[function(e,t,r){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":35}],10:[function(e,t,r){t.exports={default:e("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":36}],11:[function(e,t,r){t.exports={default:e("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":37}],12:[function(e,t,r){t.exports={default:e("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":38}],13:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":39}],14:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":40}],15:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":41}],16:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/get-own-property-descriptor"),__esModule:!0}},{"core-js/library/fn/object/get-own-property-descriptor":42}],17:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":43}],18:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":44}],19:[function(e,t,r){t.exports={default:e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":45}],20:[function(e,t,r){t.exports={default:e("core-js/library/fn/set"),__esModule:!0}},{"core-js/library/fn/set":46}],21:[function(e,t,r){t.exports={default:e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":47}],22:[function(e,t,r){t.exports={default:e("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":48}],23:[function(e,t,r){"use strict";r.__esModule=!0;var n,o=e("../core-js/promise"),i=(n=o)&&n.__esModule?n:{default:n};r.default=function(e){return function(){var t=e.apply(this,arguments);return new i.default(function(e,r){return function n(o,s){try{var a=t[o](s),c=a.value}catch(e){return void r(e)}if(!a.done)return i.default.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}},{"../core-js/promise":19}],24:[function(e,t,r){"use strict";r.__esModule=!0,r.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],25:[function(e,t,r){"use strict";r.__esModule=!0;var n,o=e("../core-js/object/define-property"),i=(n=o)&&n.__esModule?n:{default:n};r.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,i.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()},{"../core-js/object/define-property":15}],26:[function(e,t,r){"use strict";r.__esModule=!0;var n=i(e("../core-js/object/get-prototype-of")),o=i(e("../core-js/object/get-own-property-descriptor"));function i(e){return e&&e.__esModule?e:{default:e}}r.default=function e(t,r,i){null===t&&(t=Function.prototype);var s=(0,o.default)(t,r);if(void 0===s){var a=(0,n.default)(t);return null===a?void 0:e(a,r,i)}if("value"in s)return s.value;var c=s.get;return void 0!==c?c.call(i):void 0}},{"../core-js/object/get-own-property-descriptor":16,"../core-js/object/get-prototype-of":17}],27:[function(e,t,r){"use strict";r.__esModule=!0;var n=s(e("../core-js/object/set-prototype-of")),o=s(e("../core-js/object/create")),i=s(e("../helpers/typeof"));function s(e){return e&&e.__esModule?e:{default:e}}r.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,i.default)(t)));e.prototype=(0,o.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}},{"../core-js/object/create":14,"../core-js/object/set-prototype-of":18,"../helpers/typeof":31}],28:[function(e,t,r){"use strict";r.__esModule=!0;var n,o=e("../helpers/typeof"),i=(n=o)&&n.__esModule?n:{default:n};r.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},{"../helpers/typeof":31}],29:[function(e,t,r){"use strict";r.__esModule=!0;var n=i(e("../core-js/is-iterable")),o=i(e("../core-js/get-iterator"));function i(e){return e&&e.__esModule?e:{default:e}}r.default=function(){return function(e,t){if(Array.isArray(e))return e;if((0,n.default)(Object(e)))return function(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var a,c=(0,o.default)(e);!(n=(a=c.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{!n&&c.return&&c.return()}finally{if(i)throw s}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},{"../core-js/get-iterator":9,"../core-js/is-iterable":10}],30:[function(e,t,r){"use strict";r.__esModule=!0;var n,o=e("../core-js/array/from"),i=(n=o)&&n.__esModule?n:{default:n};r.default=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return(0,i.default)(e)}},{"../core-js/array/from":8}],31:[function(e,t,r){"use strict";r.__esModule=!0;var n=s(e("../core-js/symbol/iterator")),o=s(e("../core-js/symbol")),i="function"==typeof o.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?"symbol":typeof e};function s(e){return e&&e.__esModule?e:{default:e}}r.default="function"==typeof o.default&&"symbol"===i(n.default)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?"symbol":void 0===e?"undefined":i(e)}},{"../core-js/symbol":21,"../core-js/symbol/iterator":22}],32:[function(e,t,r){t.exports=e("regenerator-runtime")},{"regenerator-runtime":169}],33:[function(e,t,r){},{}],34:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":63,"../../modules/es6.array.from":137,"../../modules/es6.string.iterator":149}],35:[function(e,t,r){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":135,"../modules/es6.string.iterator":149,"../modules/web.dom.iterable":161}],36:[function(e,t,r){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.is-iterable")},{"../modules/core.is-iterable":136,"../modules/es6.string.iterator":149,"../modules/web.dom.iterable":161}],37:[function(e,t,r){var n=e("../../modules/_core"),o=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(e){return o.stringify.apply(o,arguments)}},{"../../modules/_core":63}],38:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),e("../modules/es7.map.of"),e("../modules/es7.map.from"),t.exports=e("../modules/_core").Map},{"../modules/_core":63,"../modules/es6.map":139,"../modules/es6.object.to-string":146,"../modules/es6.string.iterator":149,"../modules/es7.map.from":151,"../modules/es7.map.of":152,"../modules/es7.map.to-json":153,"../modules/web.dom.iterable":161}],39:[function(e,t,r){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":63,"../../modules/es6.object.assign":140}],40:[function(e,t,r){e("../../modules/es6.object.create");var n=e("../../modules/_core").Object;t.exports=function(e,t){return n.create(e,t)}},{"../../modules/_core":63,"../../modules/es6.object.create":141}],41:[function(e,t,r){e("../../modules/es6.object.define-property");var n=e("../../modules/_core").Object;t.exports=function(e,t,r){return n.defineProperty(e,t,r)}},{"../../modules/_core":63,"../../modules/es6.object.define-property":142}],42:[function(e,t,r){e("../../modules/es6.object.get-own-property-descriptor");var n=e("../../modules/_core").Object;t.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)}},{"../../modules/_core":63,"../../modules/es6.object.get-own-property-descriptor":143}],43:[function(e,t,r){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":63,"../../modules/es6.object.get-prototype-of":144}],44:[function(e,t,r){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":63,"../../modules/es6.object.set-prototype-of":145}],45:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),e("../modules/es7.promise.finally"),e("../modules/es7.promise.try"),t.exports=e("../modules/_core").Promise},{"../modules/_core":63,"../modules/es6.object.to-string":146,"../modules/es6.promise":147,"../modules/es6.string.iterator":149,"../modules/es7.promise.finally":154,"../modules/es7.promise.try":155,"../modules/web.dom.iterable":161}],46:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.set"),e("../modules/es7.set.to-json"),e("../modules/es7.set.of"),e("../modules/es7.set.from"),t.exports=e("../modules/_core").Set},{"../modules/_core":63,"../modules/es6.object.to-string":146,"../modules/es6.set":148,"../modules/es6.string.iterator":149,"../modules/es7.set.from":156,"../modules/es7.set.of":157,"../modules/es7.set.to-json":158,"../modules/web.dom.iterable":161}],47:[function(e,t,r){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":63,"../../modules/es6.object.to-string":146,"../../modules/es6.symbol":150,"../../modules/es7.symbol.async-iterator":159,"../../modules/es7.symbol.observable":160}],48:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":132,"../../modules/es6.string.iterator":149,"../../modules/web.dom.iterable":161}],49:[function(e,t,r){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],50:[function(e,t,r){t.exports=function(){}},{}],51:[function(e,t,r){t.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},{}],52:[function(e,t,r){var n=e("./_is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":83}],53:[function(e,t,r){var n=e("./_for-of");t.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},{"./_for-of":73}],54:[function(e,t,r){var n=e("./_to-iobject"),o=e("./_to-length"),i=e("./_to-absolute-index");t.exports=function(e){return function(t,r,s){var a,c=n(t),l=o(c.length),u=i(s,l);if(e&&r!=r){for(;l>u;)if((a=c[u++])!=a)return!0}else for(;l>u;u++)if((e||u in c)&&c[u]===r)return e||u||0;return!e&&-1}}},{"./_to-absolute-index":122,"./_to-iobject":124,"./_to-length":125}],55:[function(e,t,r){var n=e("./_ctx"),o=e("./_iobject"),i=e("./_to-object"),s=e("./_to-length"),a=e("./_array-species-create");t.exports=function(e,t){var r=1==e,c=2==e,l=3==e,u=4==e,f=6==e,d=5==e||f,p=t||a;return function(t,a,h){for(var b,m,v=i(t),g=o(v),y=n(a,h,3),_=s(g.length),k=0,w=r?p(t,_):c?p(t,0):void 0;_>k;k++)if((d||k in g)&&(m=y(b=g[k],k,v),e))if(r)w[k]=m;else if(m)switch(e){case 3:return!0;case 5:return b;case 6:return k;case 2:w.push(b)}else if(u)return!1;return f?-1:l||u?u:w}}},{"./_array-species-create":57,"./_ctx":65,"./_iobject":80,"./_to-length":125,"./_to-object":126}],56:[function(e,t,r){var n=e("./_is-object"),o=e("./_is-array"),i=e("./_wks")("species");t.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)||(t=void 0),n(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},{"./_is-array":82,"./_is-object":83,"./_wks":133}],57:[function(e,t,r){var n=e("./_array-species-constructor");t.exports=function(e,t){return new(n(e))(t)}},{"./_array-species-constructor":56}],58:[function(e,t,r){var n=e("./_cof"),o=e("./_wks")("toStringTag"),i="Arguments"==n(function(){return arguments}());t.exports=function(e){var t,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?r:i?n(t):"Object"==(s=n(t))&&"function"==typeof t.callee?"Arguments":s}},{"./_cof":59,"./_wks":133}],59:[function(e,t,r){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],60:[function(e,t,r){"use strict";var n=e("./_object-dp").f,o=e("./_object-create"),i=e("./_redefine-all"),s=e("./_ctx"),a=e("./_an-instance"),c=e("./_for-of"),l=e("./_iter-define"),u=e("./_iter-step"),f=e("./_set-species"),d=e("./_descriptors"),p=e("./_meta").fastKey,h=e("./_validate-collection"),b=d?"_s":"size",m=function(e,t){var r,n=p(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};t.exports={getConstructor:function(e,t,r,l){var u=e(function(e,n){a(e,u,t,"_i"),e._t=t,e._i=o(null),e._f=void 0,e._l=void 0,e[b]=0,null!=n&&c(n,r,e[l],e)});return i(u.prototype,{clear:function(){for(var e=h(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[b]=0},delete:function(e){var r=h(this,t),n=m(r,e);if(n){var o=n.n,i=n.p;delete r._i[n.i],n.r=!0,i&&(i.n=o),o&&(o.p=i),r._f==n&&(r._f=o),r._l==n&&(r._l=i),r[b]--}return!!n},forEach:function(e){h(this,t);for(var r,n=s(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!m(h(this,t),e)}}),d&&n(u.prototype,"size",{get:function(){return h(this,t)[b]}}),u},def:function(e,t,r){var n,o,i=m(e,t);return i?i.v=r:(e._l=i={i:o=p(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=i),n&&(n.n=i),e[b]++,"F"!==o&&(e._i[o]=i)),e},getEntry:m,setStrong:function(e,t,r){l(e,t,function(e,r){this._t=h(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?u(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,u(1))},r?"entries":"values",!r,!0),f(t)}}},{"./_an-instance":51,"./_ctx":65,"./_descriptors":67,"./_for-of":73,"./_iter-define":86,"./_iter-step":88,"./_meta":91,"./_object-create":95,"./_object-dp":96,"./_redefine-all":110,"./_set-species":115,"./_validate-collection":130}],61:[function(e,t,r){var n=e("./_classof"),o=e("./_array-from-iterable");t.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return o(this)}}},{"./_array-from-iterable":53,"./_classof":58}],62:[function(e,t,r){"use strict";var n=e("./_global"),o=e("./_export"),i=e("./_meta"),s=e("./_fails"),a=e("./_hide"),c=e("./_redefine-all"),l=e("./_for-of"),u=e("./_an-instance"),f=e("./_is-object"),d=e("./_set-to-string-tag"),p=e("./_object-dp").f,h=e("./_array-methods")(0),b=e("./_descriptors");t.exports=function(e,t,r,m,v,g){var y=n[e],_=y,k=v?"set":"add",w=_&&_.prototype,j={};return b&&"function"==typeof _&&(g||w.forEach&&!s(function(){(new _).entries().next()}))?(_=t(function(t,r){u(t,_,e,"_c"),t._c=new y,null!=r&&l(r,v,t[k],t)}),h("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in w&&(!g||"clear"!=e)&&a(_.prototype,e,function(r,n){if(u(this,_,e),!t&&g&&!f(r))return"get"==e&&void 0;var o=this._c[e](0===r?0:r,n);return t?this:o})}),g||p(_.prototype,"size",{get:function(){return this._c.size}})):(_=m.getConstructor(t,e,v,k),c(_.prototype,r),i.NEED=!0),d(_,e),j[e]=_,o(o.G+o.W+o.F,j),g||m.setStrong(_,e,v),_}},{"./_an-instance":51,"./_array-methods":55,"./_descriptors":67,"./_export":71,"./_fails":72,"./_for-of":73,"./_global":74,"./_hide":76,"./_is-object":83,"./_meta":91,"./_object-dp":96,"./_redefine-all":110,"./_set-to-string-tag":116}],63:[function(e,t,r){var n=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},{}],64:[function(e,t,r){"use strict";var n=e("./_object-dp"),o=e("./_property-desc");t.exports=function(e,t,r){t in e?n.f(e,t,o(0,r)):e[t]=r}},{"./_object-dp":96,"./_property-desc":109}],65:[function(e,t,r){var n=e("./_a-function");t.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":49}],66:[function(e,t,r){t.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},{}],67:[function(e,t,r){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":72}],68:[function(e,t,r){var n=e("./_is-object"),o=e("./_global").document,i=n(o)&&n(o.createElement);t.exports=function(e){return i?o.createElement(e):{}}},{"./_global":74,"./_is-object":83}],69:[function(e,t,r){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],70:[function(e,t,r){var n=e("./_object-keys"),o=e("./_object-gops"),i=e("./_object-pie");t.exports=function(e){var t=n(e),r=o.f;if(r)for(var s,a=r(e),c=i.f,l=0;a.length>l;)c.call(e,s=a[l++])&&t.push(s);return t}},{"./_object-gops":101,"./_object-keys":104,"./_object-pie":105}],71:[function(e,t,r){var n=e("./_global"),o=e("./_core"),i=e("./_ctx"),s=e("./_hide"),a=e("./_has"),c=function(e,t,r){var l,u,f,d=e&c.F,p=e&c.G,h=e&c.S,b=e&c.P,m=e&c.B,v=e&c.W,g=p?o:o[t]||(o[t]={}),y=g.prototype,_=p?n:h?n[t]:(n[t]||{}).prototype;for(l in p&&(r=t),r)(u=!d&&_&&void 0!==_[l])&&a(g,l)||(f=u?_[l]:r[l],g[l]=p&&"function"!=typeof _[l]?r[l]:m&&u?i(f,n):v&&_[l]==f?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):b&&"function"==typeof f?i(Function.call,f):f,b&&((g.virtual||(g.virtual={}))[l]=f,e&c.R&&y&&!y[l]&&s(y,l,f)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},{"./_core":63,"./_ctx":65,"./_global":74,"./_has":75,"./_hide":76}],72:[function(e,t,r){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],73:[function(e,t,r){var n=e("./_ctx"),o=e("./_iter-call"),i=e("./_is-array-iter"),s=e("./_an-object"),a=e("./_to-length"),c=e("./core.get-iterator-method"),l={},u={};(r=t.exports=function(e,t,r,f,d){var p,h,b,m,v=d?function(){return e}:c(e),g=n(r,f,t?2:1),y=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(i(v)){for(p=a(e.length);p>y;y++)if((m=t?g(s(h=e[y])[0],h[1]):g(e[y]))===l||m===u)return m}else for(b=v.call(e);!(h=b.next()).done;)if((m=o(b,g,h.value,t))===l||m===u)return m}).BREAK=l,r.RETURN=u},{"./_an-object":52,"./_ctx":65,"./_is-array-iter":81,"./_iter-call":84,"./_to-length":125,"./core.get-iterator-method":134}],74:[function(e,t,r){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],75:[function(e,t,r){var n={}.hasOwnProperty;t.exports=function(e,t){return n.call(e,t)}},{}],76:[function(e,t,r){var n=e("./_object-dp"),o=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},{"./_descriptors":67,"./_object-dp":96,"./_property-desc":109}],77:[function(e,t,r){var n=e("./_global").document;t.exports=n&&n.documentElement},{"./_global":74}],78:[function(e,t,r){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":67,"./_dom-create":68,"./_fails":72}],79:[function(e,t,r){t.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},{}],80:[function(e,t,r){var n=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},{"./_cof":59}],81:[function(e,t,r){var n=e("./_iterators"),o=e("./_wks")("iterator"),i=Array.prototype;t.exports=function(e){return void 0!==e&&(n.Array===e||i[o]===e)}},{"./_iterators":89,"./_wks":133}],82:[function(e,t,r){var n=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==n(e)}},{"./_cof":59}],83:[function(e,t,r){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],84:[function(e,t,r){var n=e("./_an-object");t.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){var i=e.return;throw void 0!==i&&n(i.call(e)),t}}},{"./_an-object":52}],85:[function(e,t,r){"use strict";var n=e("./_object-create"),o=e("./_property-desc"),i=e("./_set-to-string-tag"),s={};e("./_hide")(s,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,r){e.prototype=n(s,{next:o(1,r)}),i(e,t+" Iterator")}},{"./_hide":76,"./_object-create":95,"./_property-desc":109,"./_set-to-string-tag":116,"./_wks":133}],86:[function(e,t,r){"use strict";var n=e("./_library"),o=e("./_export"),i=e("./_redefine"),s=e("./_hide"),a=e("./_iterators"),c=e("./_iter-create"),l=e("./_set-to-string-tag"),u=e("./_object-gpo"),f=e("./_wks")("iterator"),d=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(e,t,r,h,b,m,v){c(r,t,h);var g,y,_,k=function(e){if(!d&&e in C)return C[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},w=t+" Iterator",j="values"==b,x=!1,C=e.prototype,S=C[f]||C["@@iterator"]||b&&C[b],T=S||k(b),E=b?j?k("entries"):T:void 0,O="Array"==t&&C.entries||S;if(O&&(_=u(O.call(new e)))!==Object.prototype&&_.next&&(l(_,w,!0),n||"function"==typeof _[f]||s(_,f,p)),j&&S&&"values"!==S.name&&(x=!0,T=function(){return S.call(this)}),n&&!v||!d&&!x&&C[f]||s(C,f,T),a[t]=T,a[w]=p,b)if(g={values:j?T:k("values"),keys:m?T:k("keys"),entries:E},v)for(y in g)y in C||i(C,y,g[y]);else o(o.P+o.F*(d||x),t,g);return g}},{"./_export":71,"./_hide":76,"./_iter-create":85,"./_iterators":89,"./_library":90,"./_object-gpo":102,"./_redefine":111,"./_set-to-string-tag":116,"./_wks":133}],87:[function(e,t,r){var n=e("./_wks")("iterator"),o=!1;try{var i=[7][n]();i.return=function(){o=!0},Array.from(i,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!o)return!1;var r=!1;try{var i=[7],s=i[n]();s.next=function(){return{done:r=!0}},i[n]=function(){return s},e(i)}catch(e){}return r}},{"./_wks":133}],88:[function(e,t,r){t.exports=function(e,t){return{value:t,done:!!e}}},{}],89:[function(e,t,r){t.exports={}},{}],90:[function(e,t,r){t.exports=!0},{}],91:[function(e,t,r){var n=e("./_uid")("meta"),o=e("./_is-object"),i=e("./_has"),s=e("./_object-dp").f,a=0,c=Object.isExtensible||function(){return!0},l=!e("./_fails")(function(){return c(Object.preventExtensions({}))}),u=function(e){s(e,n,{value:{i:"O"+ ++a,w:{}}})},f=t.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,n)){if(!c(e))return"F";if(!t)return"E";u(e)}return e[n].i},getWeak:function(e,t){if(!i(e,n)){if(!c(e))return!0;if(!t)return!1;u(e)}return e[n].w},onFreeze:function(e){return l&&f.NEED&&c(e)&&!i(e,n)&&u(e),e}}},{"./_fails":72,"./_has":75,"./_is-object":83,"./_object-dp":96,"./_uid":128}],92:[function(e,t,r){var n=e("./_global"),o=e("./_task").set,i=n.MutationObserver||n.WebKitMutationObserver,s=n.process,a=n.Promise,c="process"==e("./_cof")(s);t.exports=function(){var e,t,r,l=function(){var n,o;for(c&&(n=s.domain)&&n.exit();e;){o=e.fn,e=e.next;try{o()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){s.nextTick(l)};else if(!i||n.navigator&&n.navigator.standalone)if(a&&a.resolve){var u=a.resolve(void 0);r=function(){u.then(l)}}else r=function(){o.call(n,l)};else{var f=!0,d=document.createTextNode("");new i(l).observe(d,{characterData:!0}),r=function(){d.data=f=!f}}return function(n){var o={fn:n,next:void 0};t&&(t.next=o),e||(e=o,r()),t=o}}},{"./_cof":59,"./_global":74,"./_task":121}],93:[function(e,t,r){"use strict";
// 25.4.1.5 NewPromiseCapability(C)
var n=e("./_a-function");function o(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=n(t),this.reject=n(r)}t.exports.f=function(e){return new o(e)}},{"./_a-function":49}],94:[function(e,t,r){"use strict";var n=e("./_descriptors"),o=e("./_object-keys"),i=e("./_object-gops"),s=e("./_object-pie"),a=e("./_to-object"),c=e("./_iobject"),l=Object.assign;t.exports=!l||e("./_fails")(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=l({},e)[r]||Object.keys(l({},t)).join("")!=n})?function(e,t){for(var r=a(e),l=arguments.length,u=1,f=i.f,d=s.f;l>u;)for(var p,h=c(arguments[u++]),b=f?o(h).concat(f(h)):o(h),m=b.length,v=0;m>v;)p=b[v++],n&&!d.call(h,p)||(r[p]=h[p]);return r}:l},{"./_descriptors":67,"./_fails":72,"./_iobject":80,"./_object-gops":101,"./_object-keys":104,"./_object-pie":105,"./_to-object":126}],95:[function(e,t,r){var n=e("./_an-object"),o=e("./_object-dps"),i=e("./_enum-bug-keys"),s=e("./_shared-key")("IE_PROTO"),a=function(){},c=function(){var t,r=e("./_dom-create")("iframe"),n=i.length;for(r.style.display="none",e("./_html").appendChild(r),r.src="javascript:",(t=r.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),c=t.F;n--;)delete c.prototype[i[n]];return c()};t.exports=Object.create||function(e,t){var r;return null!==e?(a.prototype=n(e),r=new a,a.prototype=null,r[s]=e):r=c(),void 0===t?r:o(r,t)}},{"./_an-object":52,"./_dom-create":68,"./_enum-bug-keys":69,"./_html":77,"./_object-dps":97,"./_shared-key":117}],96:[function(e,t,r){var n=e("./_an-object"),o=e("./_ie8-dom-define"),i=e("./_to-primitive"),s=Object.defineProperty;r.f=e("./_descriptors")?Object.defineProperty:function(e,t,r){if(n(e),t=i(t,!0),n(r),o)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},{"./_an-object":52,"./_descriptors":67,"./_ie8-dom-define":78,"./_to-primitive":127}],97:[function(e,t,r){var n=e("./_object-dp"),o=e("./_an-object"),i=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){o(e);for(var r,s=i(t),a=s.length,c=0;a>c;)n.f(e,r=s[c++],t[r]);return e}},{"./_an-object":52,"./_descriptors":67,"./_object-dp":96,"./_object-keys":104}],98:[function(e,t,r){var n=e("./_object-pie"),o=e("./_property-desc"),i=e("./_to-iobject"),s=e("./_to-primitive"),a=e("./_has"),c=e("./_ie8-dom-define"),l=Object.getOwnPropertyDescriptor;r.f=e("./_descriptors")?l:function(e,t){if(e=i(e),t=s(t,!0),c)try{return l(e,t)}catch(e){}if(a(e,t))return o(!n.f.call(e,t),e[t])}},{"./_descriptors":67,"./_has":75,"./_ie8-dom-define":78,"./_object-pie":105,"./_property-desc":109,"./_to-iobject":124,"./_to-primitive":127}],99:[function(e,t,r){var n=e("./_to-iobject"),o=e("./_object-gopn").f,i={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(e){return s&&"[object Window]"==i.call(e)?function(e){try{return o(e)}catch(e){return s.slice()}}(e):o(n(e))}},{"./_object-gopn":100,"./_to-iobject":124}],100:[function(e,t,r){var n=e("./_object-keys-internal"),o=e("./_enum-bug-keys").concat("length","prototype");r.f=Object.getOwnPropertyNames||function(e){return n(e,o)}},{"./_enum-bug-keys":69,"./_object-keys-internal":103}],101:[function(e,t,r){r.f=Object.getOwnPropertySymbols},{}],102:[function(e,t,r){var n=e("./_has"),o=e("./_to-object"),i=e("./_shared-key")("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=o(e),n(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},{"./_has":75,"./_shared-key":117,"./_to-object":126}],103:[function(e,t,r){var n=e("./_has"),o=e("./_to-iobject"),i=e("./_array-includes")(!1),s=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var r,a=o(e),c=0,l=[];for(r in a)r!=s&&n(a,r)&&l.push(r);for(;t.length>c;)n(a,r=t[c++])&&(~i(l,r)||l.push(r));return l}},{"./_array-includes":54,"./_has":75,"./_shared-key":117,"./_to-iobject":124}],104:[function(e,t,r){var n=e("./_object-keys-internal"),o=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return n(e,o)}},{"./_enum-bug-keys":69,"./_object-keys-internal":103}],105:[function(e,t,r){r.f={}.propertyIsEnumerable},{}],106:[function(e,t,r){var n=e("./_export"),o=e("./_core"),i=e("./_fails");t.exports=function(e,t){var r=(o.Object||{})[e]||Object[e],s={};s[e]=t(r),n(n.S+n.F*i(function(){r(1)}),"Object",s)}},{"./_core":63,"./_export":71,"./_fails":72}],107:[function(e,t,r){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],108:[function(e,t,r){var n=e("./_an-object"),o=e("./_is-object"),i=e("./_new-promise-capability");t.exports=function(e,t){if(n(e),o(t)&&t.constructor===e)return t;var r=i.f(e);return(0,r.resolve)(t),r.promise}},{"./_an-object":52,"./_is-object":83,"./_new-promise-capability":93}],109:[function(e,t,r){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],110:[function(e,t,r){var n=e("./_hide");t.exports=function(e,t,r){for(var o in t)r&&e[o]?e[o]=t[o]:n(e,o,t[o]);return e}},{"./_hide":76}],111:[function(e,t,r){t.exports=e("./_hide")},{"./_hide":76}],112:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_a-function"),i=e("./_ctx"),s=e("./_for-of");t.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,a,c=arguments[1];return o(this),(t=void 0!==c)&&o(c),null==e?new this:(r=[],t?(n=0,a=i(c,arguments[2],2),s(e,!1,function(e){r.push(a(e,n++))})):s(e,!1,r.push,r),new this(r))}})}},{"./_a-function":49,"./_ctx":65,"./_export":71,"./_for-of":73}],113:[function(e,t,r){"use strict";var n=e("./_export");t.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},{"./_export":71}],114:[function(e,t,r){var n=e("./_is-object"),o=e("./_an-object"),i=function(e,t){if(o(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,r,n){try{(n=e("./_ctx")(Function.call,e("./_object-gopd").f(Object.prototype,"__proto__").set,2))(t,[]),r=!(t instanceof Array)}catch(e){r=!0}return function(e,t){return i(e,t),r?e.__proto__=t:n(e,t),e}}({},!1):void 0),check:i}},{"./_an-object":52,"./_ctx":65,"./_is-object":83,"./_object-gopd":98}],115:[function(e,t,r){"use strict";var n=e("./_global"),o=e("./_core"),i=e("./_object-dp"),s=e("./_descriptors"),a=e("./_wks")("species");t.exports=function(e){var t="function"==typeof o[e]?o[e]:n[e];s&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},{"./_core":63,"./_descriptors":67,"./_global":74,"./_object-dp":96,"./_wks":133}],116:[function(e,t,r){var n=e("./_object-dp").f,o=e("./_has"),i=e("./_wks")("toStringTag");t.exports=function(e,t,r){e&&!o(e=r?e:e.prototype,i)&&n(e,i,{configurable:!0,value:t})}},{"./_has":75,"./_object-dp":96,"./_wks":133}],117:[function(e,t,r){var n=e("./_shared")("keys"),o=e("./_uid");t.exports=function(e){return n[e]||(n[e]=o(e))}},{"./_shared":118,"./_uid":128}],118:[function(e,t,r){var n=e("./_core"),o=e("./_global"),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(t.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:e("./_library")?"pure":"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})},{"./_core":63,"./_global":74,"./_library":90}],119:[function(e,t,r){var n=e("./_an-object"),o=e("./_a-function"),i=e("./_wks")("species");t.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||null==(r=n(s)[i])?t:o(r)}},{"./_a-function":49,"./_an-object":52,"./_wks":133}],120:[function(e,t,r){var n=e("./_to-integer"),o=e("./_defined");t.exports=function(e){return function(t,r){var i,s,a=String(o(t)),c=n(r),l=a.length;return c<0||c>=l?e?"":void 0:(i=a.charCodeAt(c))<55296||i>56319||c+1===l||(s=a.charCodeAt(c+1))<56320||s>57343?e?a.charAt(c):i:e?a.slice(c,c+2):s-56320+(i-55296<<10)+65536}}},{"./_defined":66,"./_to-integer":123}],121:[function(e,t,r){var n,o,i,s=e("./_ctx"),a=e("./_invoke"),c=e("./_html"),l=e("./_dom-create"),u=e("./_global"),f=u.process,d=u.setImmediate,p=u.clearImmediate,h=u.MessageChannel,b=u.Dispatch,m=0,v={},g=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},y=function(e){g.call(e.data)};d&&p||(d=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return v[++m]=function(){a("function"==typeof e?e:Function(e),t)},n(m),m},p=function(e){delete v[e]},"process"==e("./_cof")(f)?n=function(e){f.nextTick(s(g,e,1))}:b&&b.now?n=function(e){b.now(s(g,e,1))}:h?(i=(o=new h).port2,o.port1.onmessage=y,n=s(i.postMessage,i,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(n=function(e){u.postMessage(e+"","*")},u.addEventListener("message",y,!1)):n="onreadystatechange"in l("script")?function(e){c.appendChild(l("script")).onreadystatechange=function(){c.removeChild(this),g.call(e)}}:function(e){setTimeout(s(g,e,1),0)}),t.exports={set:d,clear:p}},{"./_cof":59,"./_ctx":65,"./_dom-create":68,"./_global":74,"./_html":77,"./_invoke":79}],122:[function(e,t,r){var n=e("./_to-integer"),o=Math.max,i=Math.min;t.exports=function(e,t){return(e=n(e))<0?o(e+t,0):i(e,t)}},{"./_to-integer":123}],123:[function(e,t,r){var n=Math.ceil,o=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?o:n)(e)}},{}],124:[function(e,t,r){var n=e("./_iobject"),o=e("./_defined");t.exports=function(e){return n(o(e))}},{"./_defined":66,"./_iobject":80}],125:[function(e,t,r){var n=e("./_to-integer"),o=Math.min;t.exports=function(e){return e>0?o(n(e),9007199254740991):0}},{"./_to-integer":123}],126:[function(e,t,r){var n=e("./_defined");t.exports=function(e){return Object(n(e))}},{"./_defined":66}],127:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e))return e;var r,o;if(t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;if("function"==typeof(r=e.valueOf)&&!n(o=r.call(e)))return o;if(!t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":83}],128:[function(e,t,r){var n=0,o=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+o).toString(36))}},{}],129:[function(e,t,r){var n=e("./_global").navigator;t.exports=n&&n.userAgent||""},{"./_global":74}],130:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},{"./_is-object":83}],131:[function(e,t,r){var n=e("./_global"),o=e("./_core"),i=e("./_library"),s=e("./_wks-ext"),a=e("./_object-dp").f;t.exports=function(e){var t=o.Symbol||(o.Symbol=i?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},{"./_core":63,"./_global":74,"./_library":90,"./_object-dp":96,"./_wks-ext":132}],132:[function(e,t,r){r.f=e("./_wks")},{"./_wks":133}],133:[function(e,t,r){var n=e("./_shared")("wks"),o=e("./_uid"),i=e("./_global").Symbol,s="function"==typeof i;(t.exports=function(e){return n[e]||(n[e]=s&&i[e]||(s?i:o)("Symbol."+e))}).store=n},{"./_global":74,"./_shared":118,"./_uid":128}],134:[function(e,t,r){var n=e("./_classof"),o=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(null!=e)return e[o]||e["@@iterator"]||i[n(e)]}},{"./_classof":58,"./_core":63,"./_iterators":89,"./_wks":133}],135:[function(e,t,r){var n=e("./_an-object"),o=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=o(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},{"./_an-object":52,"./_core":63,"./core.get-iterator-method":134}],136:[function(e,t,r){var n=e("./_classof"),o=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").isIterable=function(e){var t=Object(e);return void 0!==t[o]||"@@iterator"in t||i.hasOwnProperty(n(t))}},{"./_classof":58,"./_core":63,"./_iterators":89,"./_wks":133}],137:[function(e,t,r){"use strict";var n=e("./_ctx"),o=e("./_export"),i=e("./_to-object"),s=e("./_iter-call"),a=e("./_is-array-iter"),c=e("./_to-length"),l=e("./_create-property"),u=e("./core.get-iterator-method");o(o.S+o.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,o,f,d=i(e),p="function"==typeof this?this:Array,h=arguments.length,b=h>1?arguments[1]:void 0,m=void 0!==b,v=0,g=u(d);if(m&&(b=n(b,h>2?arguments[2]:void 0,2)),null==g||p==Array&&a(g))for(r=new p(t=c(d.length));t>v;v++)l(r,v,m?b(d[v],v):d[v]);else for(f=g.call(d),r=new p;!(o=f.next()).done;v++)l(r,v,m?s(f,b,[o.value,v],!0):o.value);return r.length=v,r}})},{"./_create-property":64,"./_ctx":65,"./_export":71,"./_is-array-iter":81,"./_iter-call":84,"./_iter-detect":87,"./_to-length":125,"./_to-object":126,"./core.get-iterator-method":134}],138:[function(e,t,r){"use strict";var n=e("./_add-to-unscopables"),o=e("./_iter-step"),i=e("./_iterators"),s=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,o(1)):o(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),i.Arguments=i.Array,n("keys"),n("values"),n("entries")},{"./_add-to-unscopables":50,"./_iter-define":86,"./_iter-step":88,"./_iterators":89,"./_to-iobject":124}],139:[function(e,t,r){"use strict";var n=e("./_collection-strong"),o=e("./_validate-collection");t.exports=e("./_collection")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(o(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(o(this,"Map"),0===e?0:e,t)}},n,!0)},{"./_collection":62,"./_collection-strong":60,"./_validate-collection":130}],140:[function(e,t,r){var n=e("./_export");n(n.S+n.F,"Object",{assign:e("./_object-assign")})},{"./_export":71,"./_object-assign":94}],141:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{create:e("./_object-create")})},{"./_export":71,"./_object-create":95}],142:[function(e,t,r){var n=e("./_export");n(n.S+n.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":67,"./_export":71,"./_object-dp":96}],143:[function(e,t,r){var n=e("./_to-iobject"),o=e("./_object-gopd").f;e("./_object-sap")("getOwnPropertyDescriptor",function(){return function(e,t){return o(n(e),t)}})},{"./_object-gopd":98,"./_object-sap":106,"./_to-iobject":124}],144:[function(e,t,r){var n=e("./_to-object"),o=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return o(n(e))}})},{"./_object-gpo":102,"./_object-sap":106,"./_to-object":126}],145:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{setPrototypeOf:e("./_set-proto").set})},{"./_export":71,"./_set-proto":114}],146:[function(e,t,r){arguments[4][33][0].apply(r,arguments)},{dup:33}],147:[function(e,t,r){"use strict";var n,o,i,s,a=e("./_library"),c=e("./_global"),l=e("./_ctx"),u=e("./_classof"),f=e("./_export"),d=e("./_is-object"),p=e("./_a-function"),h=e("./_an-instance"),b=e("./_for-of"),m=e("./_species-constructor"),v=e("./_task").set,g=e("./_microtask")(),y=e("./_new-promise-capability"),_=e("./_perform"),k=e("./_user-agent"),w=e("./_promise-resolve"),j=c.TypeError,x=c.process,C=x&&x.versions,S=C&&C.v8||"",T=c.Promise,E="process"==u(x),O=function(){},M=o=y.f,R=!!function(){try{var t=T.resolve(1),r=(t.constructor={})[e("./_wks")("species")]=function(e){e(O,O)};return(E||"function"==typeof PromiseRejectionEvent)&&t.then(O)instanceof r&&0!==S.indexOf("6.6")&&-1===k.indexOf("Chrome/66")}catch(e){}}(),P=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},I=function(e,t){if(!e._n){e._n=!0;var r=e._c;g(function(){for(var n=e._v,o=1==e._s,i=0,s=function(t){var r,i,s,a=o?t.ok:t.fail,c=t.resolve,l=t.reject,u=t.domain;try{a?(o||(2==e._h&&D(e),e._h=1),!0===a?r=n:(u&&u.enter(),r=a(n),u&&(u.exit(),s=!0)),r===t.promise?l(j("Promise-chain cycle")):(i=P(r))?i.call(r,c,l):c(r)):l(n)}catch(e){u&&!s&&u.exit(),l(e)}};r.length>i;)s(r[i++]);e._c=[],e._n=!1,t&&!e._h&&A(e)})}},A=function(e){v.call(c,function(){var t,r,n,o=e._v,i=L(e);if(i&&(t=_(function(){E?x.emit("unhandledRejection",o,e):(r=c.onunhandledrejection)?r({promise:e,reason:o}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",o)}),e._h=E||L(e)?2:1),e._a=void 0,i&&t.e)throw t.v})},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){v.call(c,function(){var t;E?x.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},F=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),I(t,!0))},N=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw j("Promise can't be resolved itself");(t=P(e))?g(function(){var n={_w:r,_d:!1};try{t.call(e,l(N,n,1),l(F,n,1))}catch(e){F.call(n,e)}}):(r._v=e,r._s=1,I(r,!1))}catch(e){F.call({_w:r,_d:!1},e)}}};R||(T=function(e){h(this,T,"Promise","_h"),p(e),n.call(this);try{e(l(N,this,1),l(F,this,1))}catch(e){F.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=e("./_redefine-all")(T.prototype,{then:function(e,t){var r=M(m(this,T));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=E?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&I(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n;this.promise=e,this.resolve=l(N,e,1),this.reject=l(F,e,1)},y.f=M=function(e){return e===T||e===s?new i(e):o(e)}),f(f.G+f.W+f.F*!R,{Promise:T}),e("./_set-to-string-tag")(T,"Promise"),e("./_set-species")("Promise"),s=e("./_core").Promise,f(f.S+f.F*!R,"Promise",{reject:function(e){var t=M(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(a||!R),"Promise",{resolve:function(e){return w(a&&this===s?T:this,e)}}),f(f.S+f.F*!(R&&e("./_iter-detect")(function(e){T.all(e).catch(O)})),"Promise",{all:function(e){var t=this,r=M(t),n=r.resolve,o=r.reject,i=_(function(){var r=[],i=0,s=1;b(e,!1,function(e){var a=i++,c=!1;r.push(void 0),s++,t.resolve(e).then(function(e){c||(c=!0,r[a]=e,--s||n(r))},o)}),--s||n(r)});return i.e&&o(i.v),r.promise},race:function(e){var t=this,r=M(t),n=r.reject,o=_(function(){b(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return o.e&&n(o.v),r.promise}})},{"./_a-function":49,"./_an-instance":51,"./_classof":58,"./_core":63,"./_ctx":65,"./_export":71,"./_for-of":73,"./_global":74,"./_is-object":83,"./_iter-detect":87,"./_library":90,"./_microtask":92,"./_new-promise-capability":93,"./_perform":107,"./_promise-resolve":108,"./_redefine-all":110,"./_set-species":115,"./_set-to-string-tag":116,"./_species-constructor":119,"./_task":121,"./_user-agent":129,"./_wks":133}],148:[function(e,t,r){"use strict";var n=e("./_collection-strong"),o=e("./_validate-collection");t.exports=e("./_collection")("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return n.def(o(this,"Set"),e=0===e?0:e,e)}},n)},{"./_collection":62,"./_collection-strong":60,"./_validate-collection":130}],149:[function(e,t,r){"use strict";var n=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":86,"./_string-at":120}],150:[function(e,t,r){"use strict";var n=e("./_global"),o=e("./_has"),i=e("./_descriptors"),s=e("./_export"),a=e("./_redefine"),c=e("./_meta").KEY,l=e("./_fails"),u=e("./_shared"),f=e("./_set-to-string-tag"),d=e("./_uid"),p=e("./_wks"),h=e("./_wks-ext"),b=e("./_wks-define"),m=e("./_enum-keys"),v=e("./_is-array"),g=e("./_an-object"),y=e("./_is-object"),_=e("./_to-object"),k=e("./_to-iobject"),w=e("./_to-primitive"),j=e("./_property-desc"),x=e("./_object-create"),C=e("./_object-gopn-ext"),S=e("./_object-gopd"),T=e("./_object-gops"),E=e("./_object-dp"),O=e("./_object-keys"),M=S.f,R=E.f,P=C.f,I=n.Symbol,A=n.JSON,L=A&&A.stringify,D=p("_hidden"),F=p("toPrimitive"),N={}.propertyIsEnumerable,B=u("symbol-registry"),U=u("symbols"),W=u("op-symbols"),G=Object.prototype,z="function"==typeof I&&!!T.f,K=n.QObject,q=!K||!K.prototype||!K.prototype.findChild,V=i&&l(function(){return 7!=x(R({},"a",{get:function(){return R(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=M(G,t);n&&delete G[t],R(e,t,r),n&&e!==G&&R(G,t,n)}:R,$=function(e){var t=U[e]=x(I.prototype);return t._k=e,t},X=z&&"symbol"==typeof I.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof I},H=function(e,t,r){return e===G&&H(W,t,r),g(e),t=w(t,!0),g(r),o(U,t)?(r.enumerable?(o(e,D)&&e[D][t]&&(e[D][t]=!1),r=x(r,{enumerable:j(0,!1)})):(o(e,D)||R(e,D,j(1,{})),e[D][t]=!0),V(e,t,r)):R(e,t,r)},J=function(e,t){g(e);for(var r,n=m(t=k(t)),o=0,i=n.length;i>o;)H(e,r=n[o++],t[r]);return e},Y=function(e){var t=N.call(this,e=w(e,!0));return!(this===G&&o(U,e)&&!o(W,e))&&(!(t||!o(this,e)||!o(U,e)||o(this,D)&&this[D][e])||t)},Z=function(e,t){if(e=k(e),t=w(t,!0),e!==G||!o(U,t)||o(W,t)){var r=M(e,t);return!r||!o(U,t)||o(e,D)&&e[D][t]||(r.enumerable=!0),r}},Q=function(e){for(var t,r=P(k(e)),n=[],i=0;r.length>i;)o(U,t=r[i++])||t==D||t==c||n.push(t);return n},ee=function(e){for(var t,r=e===G,n=P(r?W:k(e)),i=[],s=0;n.length>s;)!o(U,t=n[s++])||r&&!o(G,t)||i.push(U[t]);return i};z||(a((I=function(){if(this instanceof I)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(r){this===G&&t.call(W,r),o(this,D)&&o(this[D],e)&&(this[D][e]=!1),V(this,e,j(1,r))};return i&&q&&V(G,e,{configurable:!0,set:t}),$(e)}).prototype,"toString",function(){return this._k}),S.f=Z,E.f=H,e("./_object-gopn").f=C.f=Q,e("./_object-pie").f=Y,T.f=ee,i&&!e("./_library")&&a(G,"propertyIsEnumerable",Y,!0),h.f=function(e){return $(p(e))}),s(s.G+s.W+s.F*!z,{Symbol:I});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)p(te[re++]);for(var ne=O(p.store),oe=0;ne.length>oe;)b(ne[oe++]);s(s.S+s.F*!z,"Symbol",{for:function(e){return o(B,e+="")?B[e]:B[e]=I(e)},keyFor:function(e){if(!X(e))throw TypeError(e+" is not a symbol!");for(var t in B)if(B[t]===e)return t},useSetter:function(){q=!0},useSimple:function(){q=!1}}),s(s.S+s.F*!z,"Object",{create:function(e,t){return void 0===t?x(e):J(x(e),t)},defineProperty:H,defineProperties:J,getOwnPropertyDescriptor:Z,getOwnPropertyNames:Q,getOwnPropertySymbols:ee});var ie=l(function(){T.f(1)});s(s.S+s.F*ie,"Object",{getOwnPropertySymbols:function(e){return T.f(_(e))}}),A&&s(s.S+s.F*(!z||l(function(){var e=I();return"[null]"!=L([e])||"{}"!=L({a:e})||"{}"!=L(Object(e))})),"JSON",{stringify:function(e){for(var t,r,n=[e],o=1;arguments.length>o;)n.push(arguments[o++]);if(r=t=n[1],(y(t)||void 0!==e)&&!X(e))return v(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!X(t))return t}),n[1]=t,L.apply(A,n)}}),I.prototype[F]||e("./_hide")(I.prototype,F,I.prototype.valueOf),f(I,"Symbol"),f(Math,"Math",!0),f(n.JSON,"JSON",!0)},{"./_an-object":52,"./_descriptors":67,"./_enum-keys":70,"./_export":71,"./_fails":72,"./_global":74,"./_has":75,"./_hide":76,"./_is-array":82,"./_is-object":83,"./_library":90,"./_meta":91,"./_object-create":95,"./_object-dp":96,"./_object-gopd":98,"./_object-gopn":100,"./_object-gopn-ext":99,"./_object-gops":101,"./_object-keys":104,"./_object-pie":105,"./_property-desc":109,"./_redefine":111,"./_set-to-string-tag":116,"./_shared":118,"./_to-iobject":124,"./_to-object":126,"./_to-primitive":127,"./_uid":128,"./_wks":133,"./_wks-define":131,"./_wks-ext":132}],151:[function(e,t,r){e("./_set-collection-from")("Map")},{"./_set-collection-from":112}],152:[function(e,t,r){e("./_set-collection-of")("Map")},{"./_set-collection-of":113}],153:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Map",{toJSON:e("./_collection-to-json")("Map")})},{"./_collection-to-json":61,"./_export":71}],154:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_core"),i=e("./_global"),s=e("./_species-constructor"),a=e("./_promise-resolve");n(n.P+n.R,"Promise",{finally:function(e){var t=s(this,o.Promise||i.Promise),r="function"==typeof e;return this.then(r?function(r){return a(t,e()).then(function(){return r})}:e,r?function(r){return a(t,e()).then(function(){throw r})}:e)}})},{"./_core":63,"./_export":71,"./_global":74,"./_promise-resolve":108,"./_species-constructor":119}],155:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_new-promise-capability"),i=e("./_perform");n(n.S,"Promise",{try:function(e){var t=o.f(this),r=i(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},{"./_export":71,"./_new-promise-capability":93,"./_perform":107}],156:[function(e,t,r){e("./_set-collection-from")("Set")},{"./_set-collection-from":112}],157:[function(e,t,r){e("./_set-collection-of")("Set")},{"./_set-collection-of":113}],158:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Set",{toJSON:e("./_collection-to-json")("Set")})},{"./_collection-to-json":61,"./_export":71}],159:[function(e,t,r){e("./_wks-define")("asyncIterator")},{"./_wks-define":131}],160:[function(e,t,r){e("./_wks-define")("observable")},{"./_wks-define":131}],161:[function(e,t,r){e("./es6.array.iterator");for(var n=e("./_global"),o=e("./_hide"),i=e("./_iterators"),s=e("./_wks")("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<a.length;c++){var l=a[c],u=n[l],f=u&&u.prototype;f&&!f[s]&&o(f,s,l),i[l]=i.Array}},{"./_global":74,"./_hide":76,"./_iterators":89,"./_wks":133,"./es6.array.iterator":138}],162:[function(e,t,r){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},o=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},i=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function s(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=n(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0;var a,c=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),a=0===l.x}catch(e){a=!1}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function f(e,t,r,o){var i,s,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]):(s=e._events=n(null),e._eventsCount=0),a){if("function"==typeof a?a=s[t]=o?[r,a]:[a,r]:o?a.unshift(r):a.push(r),!a.warned&&(i=u(e))&&i>0&&a.length>i){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else a=s[t]=r,++e._eventsCount;return e}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=i.call(d,n);return o.listener=r,n.wrapFn=o,o}function h(e,t,r){var n=e._events;if(!n)return[];var o=n[t];return o?"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):m(o,o.length):[]}function b(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}a?Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');c=e}}):s.defaultMaxListeners=c,s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){var t,r,n,o,i,s,a="error"===e;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var c=new Error('Unhandled "error" event. ('+t+")");throw c.context=t,c}if(!(r=s[e]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,o=m(e,n),i=0;i<n;++i)o[i].call(r)}(r,l,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var o=e.length,i=m(e,o),s=0;s<o;++s)i[s].call(r,n)}(r,l,this,arguments[1]);break;case 3:!function(e,t,r,n,o){if(t)e.call(r,n,o);else for(var i=e.length,s=m(e,i),a=0;a<i;++a)s[a].call(r,n,o)}(r,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,o,i){if(t)e.call(r,n,o,i);else for(var s=e.length,a=m(e,s),c=0;c<s;++c)a[c].call(r,n,o,i)}(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];!function(e,t,r,n){if(t)e.apply(r,n);else for(var o=e.length,i=m(e,o),s=0;s<o;++s)i[s].apply(r,n)}(r,l,this,o)}return!0},s.prototype.addListener=function(e,t){return f(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return f(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,o,i,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(r=o[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=n(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}(r,i),1===r.length&&(o[e]=r[0]),o.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.removeAllListeners=function(e){var t,r,i;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=n(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=n(null):delete r[e]),this;if(0===arguments.length){var s,a=o(r);for(i=0;i<a.length;++i)"removeListener"!==(s=a[i])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=n(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):b.call(e,t)},s.prototype.listenerCount=b,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],163:[function(e,t,r){var n,o;n=this,o=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){"use strict";e.exports=function(e,t){var r,n,o;for(r=1;r<arguments.length;r++)for(o in n=arguments[r])n.hasOwnProperty(o)&&(e[o]=n[o]);return e}},function(e,t,r){"use strict";var n=r(0);e.exports={build:function(e,t){var r,o,i,s=t.plugins;for(r=0,o=s.length;r<o;r++)(i=s[r]).methods&&n(e,i.methods),i.properties&&Object.defineProperties(e,i.properties)},hook:function(e,t,r){var n,o,i,s,a=e.config.plugins,c=[e.context];for(r&&(c=c.concat(r)),n=0,o=a.length;n<o;n++)s=a[n],(i=a[n][t])&&i.apply(s,c)}}},function(e,t,r){"use strict";function n(e){if(0===e.length)return e;var t,r,n=e.split(/[_-]/);if(1===n.length&&n[0][0].toLowerCase()===n[0][0])return e;for(r=n[0].toLowerCase(),t=1;t<n.length;t++)r=r+n[t].charAt(0).toUpperCase()+n[t].substring(1).toLowerCase();return r}n.prepended=function(e,t){return e+(t=n(t))[0].toUpperCase()+t.substring(1)},e.exports=n},function(e,t,r){"use strict";var n=r(0),o=r(2);function i(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}n(i.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=o.prepended("onEnter",e),this.lifecycle.onLeave[e]=o.prepended("onLeave",e),this.lifecycle.on[e]=o.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=o.prepended("onBefore",e),this.lifecycle.onAfter[e]=o.prepended("onAfter",e),this.lifecycle.on[e]=o.prepended("on",e)},mapTransition:function(e){var t=e.name,r=e.from,n=e.to;return this.addState(r),"function"!=typeof n&&this.addState(n),this.addTransition(t),this.map[r][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(n({},this.defaults.init,{to:e,active:!0})):"object"==typeof e?this.mapTransition(n({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var r,n,o;for(r=0,n=(e=e||[]).length;r<n;r++)"function"==typeof(o=e[r])&&(e[r]=o=o()),o.configure&&o.configure(this);return e},configureTransitions:function(e){var t,r,n,o,i,s=this.defaults.wildcard;for(r=0;r<e.length;r++)for(n=e[r],o=Array.isArray(n.from)?n.from:[n.from||s],i=n.to||s,t=0;t<o.length;t++)this.mapTransition({name:n.name,from:o[t],to:i})},transitionFor:function(e,t){var r=this.defaults.wildcard;return this.map[e][t]||this.map[r][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=i},function(e,t,r){var n=r(0),o=r(6),i=r(1),s=[null,[]];function a(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}n(a.prototype,{init:function(e){if(n(this.context,this.config.data.apply(this.context,e)),i.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var r=this.config.defaults.wildcard,n=this.config.transitionFor(this.state,e),o=n&&n.to;return"function"==typeof o?o.apply(this.context,t):o===r?this.state:o},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,r,n){var o=this.config.lifecycle,i=this.config.options.observeUnchangedState||t!==r;return r?this.isPending()?this.context.onPendingTransition(e,t,r):(this.config.addState(r),this.beginTransit(),n.unshift({transition:e,from:t,to:r,fsm:this.context}),this.observeEvents([this.observersForEvent(o.onBefore.transition),this.observersForEvent(o.onBefore[e]),i?this.observersForEvent(o.onLeave.state):s,i?this.observersForEvent(o.onLeave[t]):s,this.observersForEvent(o.on.transition),i?["doTransit",[this]]:s,i?this.observersForEvent(o.onEnter.state):s,i?this.observersForEvent(o.onEnter[r]):s,i?this.observersForEvent(o.on[r]):s,this.observersForEvent(o.onAfter.transition),this.observersForEvent(o.onAfter[e]),this.observersForEvent(o.on[e])],n)):this.context.onInvalidTransition(e,t,r)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,r=0,n=this.observers.length,o=[];r<n;r++)(t=this.observers[r])[e]&&o.push(t);return[e,o,!0]},observeEvents:function(e,t,r,n){if(0===e.length)return this.endTransit(void 0===n||n);var o=e[0][0],s=e[0][1],a=e[0][2];if(t[0].event=o,o&&a&&o!==r&&i.hook(this,"lifecycle",t),0===s.length)return e.shift(),this.observeEvents(e,t,o,n);var c=s.shift(),l=c[o].apply(c,t);return l&&"function"==typeof l.then?l.then(this.observeEvents.bind(this,e,t,o)).catch(this.failTransit.bind(this)):!1===l?this.endTransit(!1):this.observeEvents(e,t,o,l)},onInvalidTransition:function(e,t,r){throw new o("transition is invalid in current state",e,t,r,this.state)},onPendingTransition:function(e,t,r){throw new o("transition is invalid while previous transition is still in progress",e,t,r,this.state)}}),e.exports=a},function(e,t,r){"use strict";var n=r(0),o=r(2),i=r(1),s=r(3),a=r(4),c={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,r){return this._fsm.onInvalidTransition(e,t,r)},onPendingTransition:function(e,t,r){return this._fsm.onPendingTransition(e,t,r)}},l={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function u(e){return f(this||{},e)}function f(e,t){return d(e,new s(t,u)),e._fsm(),e}function d(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");i.build(e,t),Object.defineProperties(e,l),n(e,c),n(e,t.methods),t.allTransitions().forEach(function(t){e[o(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}}),e._fsm=function(){this._fsm=new a(this,t),this._fsm.init(arguments)}}u.version="3.0.1",u.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var r=new s(t,u);return d(e.prototype,r),e.prototype._fsm.config=r,e},u.apply=f,u.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=u},function(e,t,r){"use strict";e.exports=function(e,t,r,n,o){this.message=e,this.transition=t,this.from=r,this.to=n,this.current=o}}])},"object"==typeof r&&"object"==typeof t?t.exports=o():"object"==typeof r?r.StateMachine=o():n.StateMachine=o()},{}],164:[function(e,t,r){
/*
* loglevel - https://github.com/pimterry/loglevel
*
* Copyright (c) 2013 Tim Perry
* Licensed under the MIT license.
*/
!function(e,r){"use strict";"object"==typeof t&&t.exports?t.exports=r():e.log=r()}(this,function(){"use strict";var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function o(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(t,r){for(var o=0;o<n.length;o++){var i=n[o];this[i]=o<t?e:this.methodFactory(i,t,r)}this.log=this.debug}function a(n,a,c){return function(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&r?i:void 0!==console[n]?o(console,n):void 0!==console.log?o(console,"log"):e)}(n)||function(e,r,n){return function(){typeof console!==t&&(s.call(this,r,n),this[e].apply(this,arguments))}}.apply(this,arguments)}function c(e,r,o){var i,c=this,l="loglevel";function u(){var e;if(typeof window!==t&&l){try{e=window.localStorage[l]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,n=r.indexOf(encodeURIComponent(l)+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n))[1])}catch(e){}return void 0===c.levels[e]&&(e=void 0),e}}"string"==typeof e?l+=":"+e:"symbol"==typeof e&&(l=void 0),c.name=e,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=o||a,c.getLevel=function(){return i},c.setLevel=function(r,o){if("string"==typeof r&&void 0!==c.levels[r.toUpperCase()]&&(r=c.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(i=r,!1!==o&&function(e){var r=(n[e]||"silent").toUpperCase();if(typeof window!==t&&l){try{return void(window.localStorage[l]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+r+";"}catch(e){}}}(r),s.call(c,r,e),typeof console===t&&r<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(e){u()||c.setLevel(e,!1)},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var f=u();null==f&&(f=null==r?"WARN":r),c.setLevel(f,!1)}var l=new c,u={};l.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=u[e];return t||(t=u[e]=new c(e,l.getLevel(),l.methodFactory)),t};var f=typeof window!==t?window.log:void 0;return l.noConflict=function(){return typeof window!==t&&window.log===l&&(window.log=f),l},l.getLoggers=function(){return u},l.default=l,l})},{}],165:[function(e,t,r){"use strict";var n=c(e("babel-runtime/core-js/object/get-prototype-of")),o=c(e("babel-runtime/helpers/classCallCheck")),i=c(e("babel-runtime/helpers/createClass")),s=c(e("babel-runtime/helpers/possibleConstructorReturn")),a=c(e("babel-runtime/helpers/inherits"));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return null!=e}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(e){(0,o.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,n.default)(t)).call(this));if(l((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(l(e.maxDelay)&&e.maxDelay<=1)throw new Error("The maximal timeout must be greater than 1.");if(l(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");if(l(e.factor)&&e.factor<=1)throw new Error("Exponential factor should be greater than 1.");if(r.initialDelay=e.initialDelay||100,r.maxDelay=e.maxDelay||1e4,r.maxDelay<=r.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return r.randomisationFactor=e.randomisationFactor||0,r.factor=e.factor||2,r.maxNumberOfRetry=-1,r.reset(),r}return(0,a.default)(t,e),(0,i.default)(t,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got "+e);this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new t(e)}}]),t}(e("events").EventEmitter);r.Backoff=u,r.default=u},{"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,events:162}],166:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./retrier");r.Retrier=n.Retrier;var o=e("./backoff");r.Backoff=o.Backoff,r.default=n.Retrier},{"./backoff":165,"./retrier":167}],167:[function(e,t,r){"use strict";var n=l(e("babel-runtime/core-js/promise")),o=l(e("babel-runtime/core-js/object/get-prototype-of")),i=l(e("babel-runtime/helpers/classCallCheck")),s=l(e("babel-runtime/helpers/createClass")),a=l(e("babel-runtime/helpers/possibleConstructorReturn")),c=l(e("babel-runtime/helpers/inherits"));function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(e){(0,i.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return r.minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return(0,c.default)(t,e),(0,s.default)(t,[{key:"attempt",value:function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,r=Math.round(Math.random()*t*2-t);return Math.max(0,e+r)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var r=this.nextDelay(e);if(r=this.randomize(r),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+r)return this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),void this.reject(new Error("Maximum attempt time limit reached"));this.timeout=setTimeout(function(){return t.attempt()},r)}},{key:"cleanup",value:function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new n.default(function(t,r){e.resolve=t,e.reject=r,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)})}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}},{key:"succeeded",value:function(e){this.emit("succeeded",e),this.resolve(e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}},{key:"run",value:function(e){var t=this;return this.on("attempt",function(){e().then(function(e){return t.succeeded(e)}).catch(function(e){return t.failed(e)})}),this.start()}}]),t}(e("events").EventEmitter);r.Retrier=u,r.default=u},{"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/core-js/promise":19,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,events:162}],168:[function(e,t,r){(function(e){(function(){(function(){"use strict";var n={function:!0,object:!0},o=n[typeof window]&&window||this,i=n[typeof r]&&r,s=n[typeof t]&&t&&!t.nodeType&&t,a=i&&s&&"object"==typeof e&&e;!a||a.global!==a&&a.window!==a&&a.self!==a||(o=a);var c=Math.pow(2,53)-1,l=/\bOpera/,u=Object.prototype,f=u.hasOwnProperty,d=u.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function h(e){return e=y(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function b(e,t){for(var r in e)f.call(e,r)&&t(e[r],r,e)}function m(e){return null==e?p(e):d.call(e).slice(8,-1)}function v(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function g(e,t){var r=null;return function(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=c)for(;++r<n;)t(e[r],r,e);else b(e,t)}(e,function(n,o){r=t(r,n,o,e)}),r}function y(e){return String(e).replace(/^ +| +$/g,"")}var _=function e(t){var r=o,n=t&&"object"==typeof t&&"String"!=m(t);n&&(r=t,t=null);var i=r.navigator||{},s=i.userAgent||"";t||(t=s);var a,c,u,f,p,_=n?!!i.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(d.toString()),k=n?"Object":"ScriptBridgingProxyObject",w=n?"Object":"Environment",j=n&&r.java?"JavaPackage":m(r.java),x=n?"Object":"RuntimeObject",C=/\bJava/.test(j)&&r.java,S=C&&m(r.environment)==w,T=C?"a":"\u03b1",E=C?"b":"\u03b2",O=r.document||{},M=r.operamini||r.opera,R=l.test(R=n&&M?M["[[Class]]"]:m(M))?R:M=null,P=t,I=[],A=null,L=t==s,D=L&&M&&"function"==typeof M.version&&M.version(),F=g([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(e,r){return e||RegExp("\\b"+(r.pattern||v(r))+"\\b","i").exec(t)&&(r.label||r)}),N=function(e){return g(e,function(e,r){return e||RegExp("\\b"+(r.pattern||v(r))+"\\b","i").exec(t)&&(r.label||r)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),B=G([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),U=function(e){return g(e,function(e,r,n){return e||(r[B]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(B)]||RegExp("\\b"+v(n)+"(?:\\b|\\w*\\d)","i").exec(t))&&n})}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),W=function(e){return g(e,function(e,r){var n=r.pattern||v(r);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),e=h(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,r.label||r)),e})}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function G(e){return g(e,function(e,r){var n=r.pattern||v(r);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(r.label&&!RegExp(n,"i").test(r.label)?r.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),r=r.label||r,e=h(e[0].replace(RegExp(n,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),e})}function z(e){return g(e,function(e,r){return e||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null})}if(F&&(F=[F]),/\bAndroid\b/.test(W)&&!B&&(a=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(B=y(a[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),U&&!B?B=G([U]):U&&B&&(B=B.replace(RegExp("^("+v(U)+")[-_.\\s]","i"),U+" ").replace(RegExp("^("+v(U)+")[-_.]?(\\w)","i"),U+" $2")),(a=/\bGoogle TV\b/.exec(B))&&(B=a[0]),/\bSimulator\b/i.test(t)&&(B=(B?B+" ":"")+"Simulator"),"Opera Mini"==N&&/\bOPiOS\b/.test(t)&&I.push("running in Turbo/Uncompressed mode"),"IE"==N&&/\blike iPhone OS\b/.test(t)?(U=(a=e(t.replace(/like iPhone OS/,""))).manufacturer,B=a.product):/^iP/.test(B)?(N||(N="Safari"),W="iOS"+((a=/ OS ([\d_]+)/i.exec(t))?" "+a[1].replace(/_/g,"."):"")):"Konqueror"==N&&/^Linux\b/i.test(W)?W="Kubuntu":U&&"Google"!=U&&(/Chrome/.test(N)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(B))||/\bAndroid\b/.test(W)&&/^Chrome/.test(N)&&/\bVersion\//i.test(t)?(N="Android Browser",W=/\bAndroid\b/.test(W)?W:"Android"):"Silk"==N?(/\bMobi/i.test(t)||(W="Android",I.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&I.unshift("accelerated")):"UC Browser"==N&&/\bUCWEB\b/.test(t)?I.push("speed mode"):"PaleMoon"==N&&(a=/\bFirefox\/([\d.]+)\b/.exec(t))?I.push("identifying as Firefox "+a[1]):"Firefox"==N&&(a=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(W||(W="Firefox OS"),B||(B=a[1])):!N||(a=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(N))?(N&&!B&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(a+"/")+8))&&(N=null),(a=B||U||W)&&(B||U||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(W))&&(N=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(W)?W:a)+" Browser")):"Electron"==N&&(a=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&I.push("Chromium "+a),D||(D=z(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",v(N),"(?:Firefox|Minefield|NetFront)"])),(a=("iCab"==F&&parseFloat(D)>3?"WebKit":/\bOpera\b/.test(N)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(F)&&"WebKit"||!F&&/\bMSIE\b/i.test(t)&&("Mac OS"==W?"Tasman":"Trident")||"WebKit"==F&&/\bPlayStation\b(?! Vita\b)/i.test(N)&&"NetFront")&&(F=[a]),"IE"==N&&(a=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(N+=" Mobile",W="Windows Phone "+(/\+$/.test(a)?a:a+".x"),I.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(N="IE Mobile",W="Windows Phone 8.x",I.unshift("desktop mode"),D||(D=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=N&&"Trident"==F&&(a=/\brv:([\d.]+)/.exec(t))&&(N&&I.push("identifying as "+N+(D?" "+D:"")),N="IE",D=a[1]),L){if(f="global",p=null!=(u=r)?typeof u[f]:"number",/^(?:boolean|number|string|undefined)$/.test(p)||"object"==p&&!u[f])m(a=r.runtime)==k?(N="Adobe AIR",W=a.flash.system.Capabilities.os):m(a=r.phantom)==x?(N="PhantomJS",D=(a=a.version||null)&&a.major+"."+a.minor+"."+a.patch):"number"==typeof O.documentMode&&(a=/\bTrident\/(\d+)/i.exec(t))?(D=[D,O.documentMode],(a=+a[1]+4)!=D[1]&&(I.push("IE "+D[1]+" mode"),F&&(F[1]=""),D[1]=a),D="IE"==N?String(D[1].toFixed(1)):D[0]):"number"==typeof O.documentMode&&/^(?:Chrome|Firefox)\b/.test(N)&&(I.push("masking as "+N+" "+D),N="IE",D="11.0",F=["Trident"],W="Windows");else if(C&&(P=(a=C.lang.System).getProperty("os.arch"),W=W||a.getProperty("os.name")+" "+a.getProperty("os.version")),S){try{D=r.require("ringo/engine").version.join("."),N="RingoJS"}catch(e){(a=r.system)&&a.global.system==r.system&&(N="Narwhal",W||(W=a[0].os||null))}N||(N="Rhino")}else"object"==typeof r.process&&!r.process.browser&&(a=r.process)&&("object"==typeof a.versions&&("string"==typeof a.versions.electron?(I.push("Node "+a.versions.node),N="Electron",D=a.versions.electron):"string"==typeof a.versions.nw&&(I.push("Chromium "+D,"Node "+a.versions.node),N="NW.js",D=a.versions.nw)),N||(N="Node.js",P=a.arch,W=a.platform,D=(D=/[\d.]+/.exec(a.version))?D[0]:null));W=W&&h(W)}if(D&&(a=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(D)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(L&&i.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(A=/b/i.test(a)?"beta":"alpha",D=D.replace(RegExp(a+"\\+?$"),"")+("beta"==A?E:T)+(/\d+\+?/.exec(a)||"")),"Fennec"==N||"Firefox"==N&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(W))N="Firefox Mobile";else if("Maxthon"==N&&D)D=D.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(B))"Xbox 360"==B&&(W=null),"Xbox 360"==B&&/\bIEMobile\b/.test(t)&&I.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(N)&&(!N||B||/Browser|Mobi/.test(N))||"Windows CE"!=W&&!/Mobi/i.test(t))if("IE"==N&&L)try{null===r.external&&I.unshift("platform preview")}catch(e){I.unshift("embedded")}else(/\bBlackBerry\b/.test(B)||/\bBB10\b/.test(t))&&(a=(RegExp(B.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||D)?(W=((a=[a,/BB10/.test(t)])[1]?(B=null,U="BlackBerry"):"Device Software")+" "+a[0],D=null):this!=b&&"Wii"!=B&&(L&&M||/Opera/.test(N)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==N&&/\bOS X (?:\d+\.){2,}/.test(W)||"IE"==N&&(W&&!/^Win/.test(W)&&D>5.5||/\bWindows XP\b/.test(W)&&D>8||8==D&&!/\bTrident\b/.test(t)))&&!l.test(a=e.call(b,t.replace(l,"")+";"))&&a.name&&(a="ing as "+a.name+((a=a.version)?" "+a:""),l.test(N)?(/\bIE\b/.test(a)&&"Mac OS"==W&&(W=null),a="identify"+a):(a="mask"+a,N=R?h(R.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(a)&&(W=null),L||(D=null)),F=["Presto"],I.push(a));else N+=" Mobile";(a=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(a=[parseFloat(a.replace(/\.(\d)$/,".0$1")),a],"Safari"==N&&"+"==a[1].slice(-1)?(N="WebKit Nightly",A="alpha",D=a[1].slice(0,-1)):D!=a[1]&&D!=(a[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(D=null),a[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==a[0]&&537.36==a[2]&&parseFloat(a[1])>=28&&"WebKit"==F&&(F=["Blink"]),L&&(_||a[1])?(F&&(F[1]="like Chrome"),a=a[1]||((a=a[0])<530?1:a<532?2:a<532.05?3:a<533?4:a<534.03?5:a<534.07?6:a<534.1?7:a<534.13?8:a<534.16?9:a<534.24?10:a<534.3?11:a<535.01?12:a<535.02?"13+":a<535.07?15:a<535.11?16:a<535.19?17:a<536.05?18:a<536.1?19:a<537.01?20:a<537.11?"21+":a<537.13?23:a<537.18?24:a<537.24?25:a<537.36?26:"Blink"!=F?"27":"28")):(F&&(F[1]="like Safari"),a=(a=a[0])<400?1:a<500?2:a<526?3:a<533?4:a<534?"4+":a<535?5:a<537?6:a<538?7:a<601?8:a<602?9:a<604?10:a<606?11:a<608?12:"12"),F&&(F[1]+=" "+(a+="number"==typeof a?".x":/[.+]/.test(a)?"":"+")),"Safari"==N&&(!D||parseInt(D)>45)?D=a:"Chrome"==N&&/\bHeadlessChrome/i.test(t)&&I.unshift("headless")),"Opera"==N&&(a=/\bzbov|zvav$/.exec(W))?(N+=" ",I.unshift("desktop mode"),"zvav"==a?(N+="Mini",D=null):N+="Mobile",W=W.replace(RegExp(" *"+a+"$"),"")):"Safari"==N&&/\bChrome\b/.exec(F&&F[1])?(I.unshift("desktop mode"),N="Chrome Mobile",D=null,/\bOS X\b/.test(W)?(U="Apple",W="iOS 4.3+"):W=null):/\bSRWare Iron\b/.test(N)&&!D&&(D=z("Chrome")),D&&0==D.indexOf(a=/[\d.]+$/.exec(W))&&t.indexOf("/"+a+"-")>-1&&(W=y(W.replace(a,""))),W&&-1!=W.indexOf(N)&&!RegExp(N+" OS").test(W)&&(W=W.replace(RegExp(" *"+v(N)+" *"),"")),F&&!/\b(?:Avant|Nook)\b/.test(N)&&(/Browser|Lunascape|Maxthon/.test(N)||"Safari"!=N&&/^iOS/.test(W)&&/\bSafari\b/.test(F[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(N)&&F[1])&&(a=F[F.length-1])&&I.push(a),I.length&&(I=["("+I.join("; ")+")"]),U&&B&&B.indexOf(U)<0&&I.push("on "+U),B&&I.push((/^on /.test(I[I.length-1])?"":"on ")+B),W&&(a=/ ([\d.+]+)$/.exec(W),c=a&&"/"==W.charAt(W.length-a[0].length-1),W={architecture:32,family:a&&!c?W.replace(a[0],""):W,version:a?a[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(a=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(P))&&!/\bi686\b/i.test(P)?(W&&(W.architecture=64,W.family=W.family.replace(RegExp(" *"+a),"")),N&&(/\bWOW64\b/i.test(t)||L&&/\w(?:86|32)$/.test(i.cpuClass||i.platform)&&!/\bWin64; x64\b/i.test(t))&&I.unshift("32-bit")):W&&/^OS X/.test(W.family)&&"Chrome"==N&&parseFloat(D)>=39&&(W.architecture=64),t||(t=null);var K={};return K.description=t,K.layout=F&&F[0],K.manufacturer=U,K.name=N,K.prerelease=A,K.product=B,K.ua=t,K.version=N&&D,K.os=W||{architecture:null,family:null,version:null,toString:function(){return"null"}},K.parse=e,K.toString=function(){return this.description||""},K.version&&I.unshift(D),K.name&&I.unshift(N),W&&N&&(W!=String(W).split(" ")[0]||W!=N.split(" ")[0]&&!B)&&I.push(B?"("+W+")":"on "+W),I.length&&(K.description=I.join(" ")),K}();i&&s?b(_,function(e,t){i[t]=e}):o.platform=_}).call(this)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],169:[function(e,t,r){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n=function(){return this}()||Function("return this")(),o=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=e("./runtime"),o)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},{"./runtime":170}],170:[function(e,t,r){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){"use strict";var r,n=Object.prototype,o=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag",l="object"==typeof t,u=e.regeneratorRuntime;if(u)l&&(t.exports=u);else{(u=e.regeneratorRuntime=l?t.exports:{}).wrap=_;var f="suspendedStart",d="suspendedYield",p="executing",h="completed",b={},m={};m[s]=function(){return this};var v=Object.getPrototypeOf,g=v&&v(v(R([])));g&&g!==n&&o.call(g,s)&&(m=g);var y=x.prototype=w.prototype=Object.create(m);j.prototype=y.constructor=x,x.constructor=j,x[c]=j.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===j||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(y),e},u.awrap=function(e){return{__await:e}},C(S.prototype),S.prototype[a]=function(){return this},u.AsyncIterator=S,u.async=function(e,t,r,n){var o=new S(_(e,t,r,n));return u.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},C(y),y[c]="Generator",y[s]=function(){return this},y.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},u.values=R,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return a.type="throw",a.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var c=o.call(s,"catchLoc"),l=o.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),b}}}function _(e,t,r,n){var o=t&&t.prototype instanceof w?t:w,i=Object.create(o.prototype),s=new M(n||[]);return i._invoke=function(e,t,r){var n=f;return function(o,i){if(n===p)throw new Error("Generator is already running");if(n===h){if("throw"===o)throw i;return P()}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var a=T(s,r);if(a){if(a===b)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var c=k(e,t,r);if("normal"===c.type){if(n=r.done?h:d,c.arg===b)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=h,r.method="throw",r.arg=c.arg)}}}(e,r,s),i}function k(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function w(){}function j(){}function x(){}function C(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function S(e){var t;this._invoke=function(r,n){function i(){return new Promise(function(t,i){!function t(r,n,i,s){var a=k(e[r],e,n);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==typeof l&&o.call(l,"__await")?Promise.resolve(l.__await).then(function(e){t("next",e,i,s)},function(e){t("throw",e,i,s)}):Promise.resolve(l).then(function(e){c.value=e,i(c)},s)}s(a.arg)}(r,n,t,i)})}return t=t?t.then(i,i):i()}}function T(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,T(e,t),"throw"===t.method))return b;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return b}var o=k(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,b;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,b):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function R(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}return{next:P}}function P(){return{value:r,done:!0}}}(function(){return this}()||Function("return this")())},{}],171:[function(e,t,r){"use strict";var n=l(e("babel-runtime/core-js/object/assign")),o=l(e("babel-runtime/core-js/object/get-prototype-of")),i=l(e("babel-runtime/helpers/classCallCheck")),s=l(e("babel-runtime/helpers/createClass")),a=l(e("babel-runtime/helpers/possibleConstructorReturn")),c=l(e("babel-runtime/helpers/inherits"));function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=e("events"),f=e("operation-retrier"),d=function(e){function t(e){(0,i.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return r.options=e?(0,n.default)({},e):{},r}return(0,c.default)(t,e),(0,s.default)(t,[{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(e){this.newBackoff=e}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");this.newBackoff?!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():this.retrier.failed(new Error):this.retrier.failed(new Error)}},{key:"cancel",value:function(){this.retrier&&this.retrier.cancel()}},{key:"cleanRetrier",value:function(){this.retrier&&(this.retrier.removeAllListeners(),this.retrier.cancel(),this.retrier=null)}},{key:"getRetryPolicy",value:function(){var e=(0,n.default)({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}},{key:"createRetrier",value:function(){var e=this;this.cleanRetrier();var t=this.getRetryPolicy();this.retrier=new f.Retrier(t),this.retrier.once("attempt",function(){e.retrier.on("attempt",function(){return e.emit("attempt")}),e.retrier.failed(new Error("Skipping first attempt"))}),this.retrier.on("failed",function(t){return e.emit("failed",t)}),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start().catch(function(e){})}},{key:"inProgress",get:function(){return!!this.retrier}}]),t}(u.EventEmitter);r.BackoffRetrier=d},{"babel-runtime/core-js/object/assign":13,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,events:162,"operation-retrier":166}],172:[function(e,t,r){"use strict";var n=d(e("babel-runtime/regenerator")),o=d(e("babel-runtime/helpers/asyncToGenerator")),i=d(e("babel-runtime/core-js/json/stringify")),s=d(e("babel-runtime/core-js/object/get-prototype-of")),a=d(e("babel-runtime/helpers/createClass")),c=d(e("babel-runtime/helpers/possibleConstructorReturn")),l=d(e("babel-runtime/helpers/get")),u=d(e("babel-runtime/helpers/inherits")),f=d(e("babel-runtime/helpers/classCallCheck"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=e("events"),h=e("./logger"),b=e("./configuration"),m=e("./twilsock"),v=e("./packetinterface"),g=e("./websocketchannel"),y=e("./services/registrations"),_=e("./services/upstream"),k=e("./deferred"),w=e("./error/twilsockerror"),j=e("./offlinestorage"),x=e("./tokenStorage"),C=e("./services/telemetrytracker"),S=function e(){(0,f.default)(this,e)};r.TelemetryEvents=S,S.TWILSOCK_CONNECT="twilsock.sdk.connect",S.TWILSOCK_INIT="twilsock.sdk.init";var T=function(e){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,f.default)(this,t);var o=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this));o.offlineStorageDeferred=new k.Deferred,n.continuationToken=n.continuationToken?n.continuationToken:x.TokenStorage.getStoredToken(r);var i=o.config=new b.Configuration(e,r,n);h.log.setLevel(i.logLevel);var a=new g.WebSocketChannel(i.url),l=n.transport?n.transport:new v.PacketInterface(a,i);return o.channel=n.channel?n.channel:new m.TwilsockImpl(a,l,i),o.registrations=n.registrations?n.registrations:new y.Registrations(l),o.upstream=new _.Upstream(l,o.channel,i),o.telemetryTracker=new C.TelemetryTracker(i,l),o.channel.on("initialized",function(){return o.telemetryTracker.canSendTelemetry=!0}),a.on("disconnected",function(){return o.telemetryTracker.canSendTelemetry=!1}),o.registrations.on("registered",function(e){return o.emit("registered",e)}),o.channel.on("message",function(e,t){return setTimeout(function(){return o.emit("message",e,t)},0)}),o.channel.on("stateChanged",function(e){return setTimeout(function(){return o.emit("stateChanged",e)},0)}),o.channel.on("connectionError",function(e){return setTimeout(function(){return o.emit("connectionError",e)},0)}),o.channel.on("tokenAboutToExpire",function(){return setTimeout(function(){return o.emit("tokenAboutToExpire")},0)}),o.channel.on("tokenExpired",function(){return setTimeout(function(){return o.emit("tokenExpired")},0)}),o.channel.on("connected",function(){return o.registrations.updateRegistrations()}),o.channel.on("connected",function(){return o.upstream.sendPendingMessages()}),o.channel.on("connected",function(){return setTimeout(function(){return o.emit("connected")},0)}),o.channel.on("beforeConnect",function(){return o.telemetryTracker.addPartialEvent(new C.TelemetryEventDescription("Establish WebSocket connection","",new Date),S.TWILSOCK_CONNECT,C.TelemetryPoint.Start)}),o.channel.on("connected",function(){return o.telemetryTracker.addPartialEvent(new C.TelemetryEventDescription("Establish WebSocket connection","",new Date,new Date),S.TWILSOCK_CONNECT,C.TelemetryPoint.End)}),o.channel.on("beforeSendInit",function(){return o.telemetryTracker.addPartialEvent(new C.TelemetryEventDescription("Send Twilsock init","",new Date),S.TWILSOCK_INIT,C.TelemetryPoint.Start)}),o.channel.on("initialized",function(){return o.telemetryTracker.addPartialEvent(new C.TelemetryEventDescription("Send Twilsock init","Succeeded",new Date,new Date),S.TWILSOCK_INIT,C.TelemetryPoint.End)}),o.channel.on("sendInitFailed",function(){return o.telemetryTracker.addPartialEvent(new C.TelemetryEventDescription("Send Twilsock init","Failed",new Date,new Date),S.TWILSOCK_INIT,C.TelemetryPoint.End)}),o.channel.on("initialized",function(e){o.handleStorageId(r,e),x.TokenStorage.storeToken(e.continuationToken,r),setTimeout(function(){return o.emit("initialized",e)},0)}),o.channel.on("disconnected",function(){return setTimeout(function(){return o.emit("disconnected")},0)}),o.channel.on("disconnected",function(){return o.upstream.rejectPendingMessages()}),o.channel.on("disconnected",function(){return o.offlineStorageDeferred.fail(new w.TwilsockError("Client disconnected"))}),o.offlineStorageDeferred.promise.catch(function(){}),o}return(0,u.default)(t,e),(0,a.default)(t,[{key:"emit",value:function(e){for(var r,n=arguments.length,o=Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return h.log.debug("Emitting "+e.toString()+"("+o.map(function(e){return(0,i.default)(e)}).join(", ")+")"),(r=(0,l.default)(t.prototype.__proto__||(0,s.default)(t.prototype),"emit",this)).call.apply(r,[this,e].concat(o))}},{key:"handleStorageId",value:function(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(j.OfflineProductStorage.create(t.offlineStorage[e])),h.log.debug("Offline storage for '"+e+"' product: "+(0,i.default)(t.offlineStorage[e])+".")}catch(r){this.offlineStorageDeferred.fail(new w.TwilsockError("Failed to parse offline storage for "+e+" "+(0,i.default)(t.offlineStorage[e])+". "+r+"."))}else this.offlineStorageDeferred.fail(new w.TwilsockError("No offline storage id for '"+e+"' product: "+(0,i.default)(t.offlineStorage)));else this.offlineStorageDeferred.fail(new w.TwilsockError("No offline storage id"))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"updateToken",value:function(){var e=(0,o.default)(n.default.mark(function e(t){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(h.log.trace("updating token '"+t+"'"),this.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return this.config.updateToken(t),e.abrupt("return",this.channel.updateToken(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setNotificationsContext",value:function(e,t){this.registrations.setNotificationsContext(e,t)}},{key:"removeNotificationsContext",value:function(e){this.registrations.removeNotificationsContext(e)}},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:function(){return this.telemetryTracker.sendTelemetry(C.EventSendingLimitation.AnyEventsIncludingUnfinished),this.channel.disconnect()}},{key:"get",value:function(e,t,r){return this.telemetryTracker.sendTelemetry(C.EventSendingLimitation.AnyEvents),this.upstream.send("GET",e,t,void 0,r)}},{key:"post",value:function(e,t,r,n){return this.telemetryTracker.sendTelemetry(C.EventSendingLimitation.AnyEvents),this.upstream.send("POST",e,t,r,n)}},{key:"put",value:function(e,t,r,n){return this.telemetryTracker.sendTelemetry(C.EventSendingLimitation.AnyEvents),this.upstream.send("PUT",e,t,r,n)}},{key:"delete",value:function(e,t,r){return this.telemetryTracker.sendTelemetry(C.EventSendingLimitation.AnyEvents),this.upstream.send("DELETE",e,t,void 0,r)}},{key:"addTelemetryEvent",value:function(e){this.telemetryTracker.addTelemetryEvent(e),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"addPartialTelemetryEvent",value:function(e,t,r){this.telemetryTracker.addPartialEvent(e,t,r),r===C.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}}]),t}(p.EventEmitter);r.TwilsockClient=T,r.Twilsock=T},{"./configuration":173,"./deferred":174,"./error/twilsockerror":176,"./logger":180,"./offlinestorage":182,"./packetinterface":183,"./services/registrations":194,"./services/telemetrytracker":195,"./services/upstream":196,"./tokenStorage":197,"./twilsock":198,"./websocketchannel":199,"babel-runtime/core-js/json/stringify":11,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/asyncToGenerator":23,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/get":26,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,"babel-runtime/regenerator":32,events:162}],173:[function(e,t,r){"use strict";var n=s(e("babel-runtime/core-js/set")),o=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a="0.6.2",c=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,o.default)(this,e),this.confirmedCapabilities=new n.default,this.activeGrant=r,this._token=t;var s="wss://tsock."+(i.region||"us1")+".twilio.com/v3/wsconnect",c=i.twilsock||i.Twilsock||{};this.url=c.uri||s,this._continuationToken=i.continuationToken?i.continuationToken:null,this.logLevel=i.logLevel?i.logLevel:"error",this.retryPolicy=i.retryPolicy?i.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=i.clientMetadata?i.clientMetadata:{},this.clientMetadata.ver=a,this.initRegistrations=i.initRegistrations?i.initRegistrations:null,this.tweaks=i.tweaks?i.tweaks:null}return(0,i.default)(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"updateContinuationToken",value:function(e){this._continuationToken=e}},{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}}]),e}();r.Configuration=c},{"babel-runtime/core-js/set":20,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25}],174:[function(e,t,r){"use strict";var n=s(e("babel-runtime/core-js/promise")),o=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(){var t=this;(0,o.default)(this,e),this._promise=new n.default(function(e,r){t._resolve=e,t._reject=r})}return(0,i.default)(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();r.Deferred=a},{"babel-runtime/core-js/promise":19,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25}],175:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function t(e){return(0,o.default)(this,t),(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),t}(e("./twilsockerror").TwilsockError);r.TransportUnavailableError=c},{"./twilsockerror":176,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],176:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function t(e){return(0,o.default)(this,t),(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),t}(Error);r.TwilsockError=c},{"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],177:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function t(e,r){(0,o.default)(this,t);var s=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return s.reply=r,s}return(0,s.default)(t,e),t}(e("./twilsockerror").TwilsockError);r.TwilsockReplyError=c},{"./twilsockerror":176,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],178:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function t(e,r,s){(0,o.default)(this,t);var a=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this,r));return a.status=e,a.description=r,a.body=s,a}return(0,s.default)(t,e),t}(e("./twilsockerror").TwilsockError);r.TwilsockUpstreamError=c},{"./twilsockerror":176,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],179:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./client");r.TwilsockClient=n.TwilsockClient,r.Twilsock=n.TwilsockClient;var o=e("./error/twilsockerror");r.TwilsockError=o.TwilsockError;var i=e("./error/transportunavailableerror");r.TransportUnavailableError=i.TransportUnavailableError},{"./client":172,"./error/transportunavailableerror":175,"./error/twilsockerror":176}],180:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),o=s(e("babel-runtime/helpers/createClass")),i=s(e("babel-runtime/core-js/array/from"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("loglevel").getLogger("twilsock");function c(e,t){return[(new Date).toISOString()+" Twilsock "+e+":"].concat((0,i.default)(t))}var l=function(){function e(t){(0,n.default)(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?" "+t+":":""}return(0,o.default)(e,[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,c("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,c("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info.apply(null,c("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.warn.apply(null,c("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.error.apply(null,c("E",t))}}],[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.trace.apply(null,c("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,c("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info.apply(null,c("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.warn.apply(null,c("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.error.apply(null,c("E",t))}}]),e}();r.Logger=l;var u=new l("");r.log=u},{"babel-runtime/core-js/array/from":8,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,loglevel:164}],181:[function(e,t,r){"use strict";var n=i(e("babel-runtime/helpers/classCallCheck")),o=i(e("babel-runtime/helpers/createClass"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=e("platform"),a=function(){function e(){(0,n.default)(this,e)}return(0,o.default)(e,null,[{key:"getMetadata",value:function(e){"undefined"!=typeof navigator&&s.parse(navigator.userAgent);var t=e&&e.clientMetadata?e.clientMetadata:{},r={env:s.name,envv:s.version,os:s.os.family,osv:s.os.version,osa:s.os.architecture,sdk:"js-default"},n={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter(function(e){return e in t||e in r}).forEach(function(e){return n[e]=e in t?t[e]:r[e]}),n}}]),e}();r.Metadata=a},{"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,platform:168}],182:[function(e,t,r){"use strict";var n=i(e("babel-runtime/helpers/classCallCheck")),o=i(e("babel-runtime/helpers/createClass"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=e("./error/twilsockerror"),a=function(){function e(t){(0,n.default)(this,e),this.id=t}return(0,o.default)(e,null,[{key:"create",value:function(t){if(t instanceof Object&&"storage_id"in t)return new e(t.storage_id);throw new s.TwilsockError('Field "storage_id" is missing')}}]),e}();r.OfflineProductStorage=a},{"./error/twilsockerror":176,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25}],183:[function(e,t,r){"use strict";var n=d(e("babel-runtime/core-js/promise")),o=d(e("babel-runtime/regenerator")),i=d(e("babel-runtime/core-js/set")),s=d(e("babel-runtime/helpers/asyncToGenerator")),a=d(e("babel-runtime/core-js/map")),c=d(e("babel-runtime/helpers/createClass")),l=d(e("babel-runtime/helpers/classCallCheck")),u=d(e("babel-runtime/core-js/json/stringify")),f=d(e("babel-runtime/helpers/typeof"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=e("./logger"),h=e("uuid"),b=e("./error/twilsockerror"),m=e("./error/twilsockreplyerror"),v=e("./parser"),g=e("./protocol/messages"),y=e("./metadata");r.PacketResponse=function e(){(0,l.default)(this,e)};var _=function(){function e(t,r){var n=this;(0,l.default)(this,e),this.config=r,this.activeRequests=new a.default,this.channel=t,this.channel.on("reply",function(e){return n.processReply(e)}),this.channel.on("disconnected",function(){n.activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new b.TwilsockError("disconnected"))}),n.activeRequests.clear()})}return(0,c.default)(e,[{key:"processReply",value:function(e){var t,r=this.activeRequests.get(e.id);r&&(clearTimeout(r.timeout),this.activeRequests.delete(e.id),(t=e.status.code)>=200&&t<300?r.resolve(e):(r.reject(new m.TwilsockReplyError("Transport failure: "+e.status.status,e)),p.log.trace("message rejected")))}},{key:"storeRequest",value:function(e,t,r){var n={resolve:t,reject:r,timeout:setTimeout(function(){p.log.trace("request",e,"is timed out"),r(new b.TwilsockError("Twilsock: request timeout: "+e))},3e4)};this.activeRequests.set(e,n)}},{key:"shutdown",value:function(){this.activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new b.TwilsockError("Twilsock: request cancelled by user"))}),this.activeRequests.clear()}},{key:"sendInit",value:function(){var e=(0,s.default)(o.default.mark(function e(){var t,r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.log.trace("sendInit"),t=y.Metadata.getMetadata(this.config),r=new g.Init(this.config.token,this.config.continuationToken,t,this.config.initRegistrations,this.config.tweaks),e.next=5,this.sendWithReply(r);case 5:return n=e.sent,e.abrupt("return",new g.InitReply(n.id,n.header.continuation_token,n.header.continuation_token_status,n.header.offline_storage,n.header.init_registrations,n.header.debug_info,new i.default(n.header.capabilities)));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sendClose",value:function(){var e=new g.Close;this.send(e)}},{key:"sendWithReply",value:function(e,t){var r=this;return new n.default(function(n,o){var i=r.send(e,t);r.storeRequest(i,n,o)})}},{key:"send",value:function(e,t){e.id=e.id||"TM"+h.v4();var r=v.Parser.createPacket(e,function(e){switch(void 0===e?"undefined":(0,f.default)(e)){case"undefined":return"";case"object":return(0,u.default)(e);default:return e}}(t));try{return this.channel.send(r),e.id}catch(t){throw p.log.debug("failed to send ",e,t),p.log.trace(t.stack),t}}},{key:"isConnected",get:function(){return this.channel.isConnected}}]),e}();r.PacketInterface=_},{"./error/twilsockerror":176,"./error/twilsockreplyerror":177,"./logger":180,"./metadata":181,"./parser":184,"./protocol/messages":187,"babel-runtime/core-js/json/stringify":11,"babel-runtime/core-js/map":12,"babel-runtime/core-js/promise":19,"babel-runtime/core-js/set":20,"babel-runtime/helpers/asyncToGenerator":23,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/typeof":31,"babel-runtime/regenerator":32,uuid:200}],184:[function(e,t,r){"use strict";var n=s(e("babel-runtime/core-js/json/stringify")),o=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./logger");function c(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}).length}function l(e){var t=Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join("").replace(/(.)/g,function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r});return decodeURIComponent(t)}function u(e){return JSON.parse(l(e))}var f=function(){function e(){(0,o.default)(this,e)}return(0,i.default)(e,null,[{key:"parse",value:function(e){var t=new Uint8Array(e),r=function(e){for(var t="",r=0;r<e.length;++r){var n=String.fromCharCode(e[r]);if(t+=n,"\r"===n){r+=2;break}}var o=t.split(" ");return{size:r,protocol:o[0],version:o[1],headerSize:Number(o[2])}}(t);if("TWILSOCK"===r.protocol&&"V3.0"===r.version){var n=null;try{n=u(t.subarray(r.size,r.size+r.headerSize))}catch(t){return void a.log.error("failed to parse message header",t,e)}a.log.debug("message received: ",n.method),a.log.trace("message received: ",n);var o=null;if(n.payload_size>0){var i=2+r.size+r.headerSize,s=n.payload_size;if(n.hasOwnProperty("payload_type")&&0!==n.payload_type.indexOf("application/json"))0===n.payload_type.indexOf("text/plain")&&(o=l(t.subarray(i,i+s)));else try{o=u(t.subarray(i,i+s))}catch(t){return void a.log.error("failed to parse message body",t,e)}}return{method:n.method,header:n,payload:o}}a.log.error("unsupported protocol: "+r.protocol+" ver "+r.version)}},{key:"createPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=c(t);var r,o,i=(0,n.default)(e)+"\r\n",s="TWILSOCK V3.0 "+(c(i)-2)+"\r\n";return a.log.debug("send request:",s+i+t),(r=encodeURIComponent(s+i+t).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}),o=new Uint8Array(r.length),Array.prototype.forEach.call(r,function(e,t){o[t]=e.charCodeAt(0)}),o).buffer}}]),e}();r.Parser=f},{"./logger":180,"babel-runtime/core-js/json/stringify":11,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25}],185:[function(e,t,r){"use strict";var n,o=e("babel-runtime/helpers/classCallCheck"),i=(n=o)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var s=e("uuid");r.AbstractMessage=function e(t){(0,i.default)(this,e),this.id=t||"TM"+s.v4()}},{"babel-runtime/helpers/classCallCheck":24,uuid:200}],186:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function t(){(0,o.default)(this,t);var e=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return e.method="close",e}return(0,s.default)(t,e),t}(e("./abstractmessage").AbstractMessage);r.Close=c},{"./abstractmessage":185,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],187:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./init");r.Init=n.Init;var o=e("./initReply");r.InitReply=o.InitReply;var i=e("./update");r.Update=i.Update;var s=e("./message");r.Message=s.Message;var a=e("./reply");r.Reply=a.Reply;var c=e("./close");r.Close=c.Close;var l=e("./telemetry");r.Telemetry=l.Telemetry},{"./close":186,"./init":188,"./initReply":189,"./message":190,"./reply":191,"./telemetry":192,"./update":193}],188:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function t(e,r,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,o.default)(this,t);var l=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return l.method="init",l.token=e,l.continuation_token=r,l.metadata=s,l.registrations=a,l.tweaks=c,l.capabilities=["client_update","offline_storage","telemetry.v1"],l}return(0,s.default)(t,e),t}(e("./abstractmessage").AbstractMessage);r.Init=c},{"./abstractmessage":185,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],189:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),i=a(e("babel-runtime/helpers/inherits")),s=a(e("babel-runtime/helpers/classCallCheck"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("./abstractmessage");r.ContinuationTokenStatus=function e(){(0,s.default)(this,e)};var l=function(e){function t(e,r,i,a,c,l,u){(0,s.default)(this,t);var f=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return f.continuationToken=r,f.continuationTokenStatus=i,f.offlineStorage=a,f.initRegistrations=c,f.debugInfo=l,f.confirmedCapabilities=u,f}return(0,i.default)(t,e),t}(c.AbstractMessage);r.InitReply=l},{"./abstractmessage":185,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],190:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function t(e,r,s){(0,o.default)(this,t);var a=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return a.method="message",a.active_grant=e,a.payload_type=r,a.http_request=s,a}return(0,s.default)(t,e),t}(e("./abstractmessage").AbstractMessage);r.Message=c},{"./abstractmessage":185,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],191:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function t(e){(0,o.default)(this,t);var r=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return r.method="reply",r.payload_type="application/json",r.status={code:200,status:"OK"},r}return(0,s.default)(t,e),t}(e("./abstractmessage").AbstractMessage);r.Reply=c},{"./abstractmessage":185,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],192:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),i=a(e("babel-runtime/helpers/inherits")),s=a(e("babel-runtime/helpers/classCallCheck"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("./abstractmessage");r.TelemetryEvent=function e(t,r,n,o,i,a){(0,s.default)(this,e),this.start=t,this.end=r,this.title=n,this.details=o,this.id=i,this.type=a};var l=function(e){function t(e){(0,s.default)(this,t);var r=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return r.method="telemetry.v1",r.events=e,r}return(0,i.default)(t,e),t}(c.AbstractMessage);r.Telemetry=l},{"./abstractmessage":185,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],193:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function t(e){(0,o.default)(this,t);var r=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return r.method="update",r.token=e,r}return(0,s.default)(t,e),t}(e("./abstractmessage").AbstractMessage);r.Update=c},{"./abstractmessage":185,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28}],194:[function(e,t,r){"use strict";var n=d(e("babel-runtime/core-js/set")),o=d(e("babel-runtime/regenerator")),i=d(e("babel-runtime/helpers/asyncToGenerator")),s=d(e("babel-runtime/core-js/map")),a=d(e("babel-runtime/core-js/object/get-prototype-of")),c=d(e("babel-runtime/helpers/classCallCheck")),l=d(e("babel-runtime/helpers/createClass")),u=d(e("babel-runtime/helpers/possibleConstructorReturn")),f=d(e("babel-runtime/helpers/inherits"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=e("../logger"),h=e("events"),b=e("uuid"),m=e("../error/twilsockerror"),v=function(e){function t(e){(0,c.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return r.transport=e,r.registrations=new s.default,r.registrationsInProgress=new s.default,r}return(0,f.default)(t,e),(0,l.default)(t,[{key:"putNotificationContext",value:function(){var e=(0,i.default)(o.default.mark(function e(t,r){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"put_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(n,r);case 3:e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteNotificationContext",value:function(){var e=(0,i.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"delete_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(r);case 3:e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateRegistration",value:function(){var e=(0,i.default)(o.default.mark(function e(t,r){var i,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.log.debug("update registration for context",t),(i=this.registrationsInProgress.get(t))||(i=new n.default,this.registrationsInProgress.set(t,i)),s=b.v4(),i.add(s),e.prev=5,e.next=8,this.putNotificationContext(t,r);case 8:p.log.debug("registration attempt succeeded for context",r),i.delete(s),0===i.size&&(this.registrationsInProgress.delete(t),this.emit("registered",t)),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(5),p.log.warn("registration attempt failed for context",r),p.log.debug(e.t0),i.delete(s),0===i.size&&(this.registrationsInProgress.delete(t),this.emit("registrationFailed",t,e.t0));case 19:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateRegistrations",value:function(){var e=this;p.log.trace("refreshing "+this.registrations.size+" registrations"),this.registrations.forEach(function(t,r){e.updateRegistration(r,t)})}},{key:"setNotificationsContext",value:function(e,t){if(!e||!t)throw new m.TwilsockError("Invalid arguments provided");this.registrations.set(e,t),this.transport.isConnected&&this.updateRegistration(e,t)}},{key:"removeNotificationsContext",value:function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrations.has(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.deleteNotificationContext(t);case 4:this.transport.isConnected&&this.registrations.delete(t);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(h.EventEmitter);r.Registrations=v},{"../error/twilsockerror":176,"../logger":180,"babel-runtime/core-js/map":12,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/core-js/set":20,"babel-runtime/helpers/asyncToGenerator":23,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,"babel-runtime/regenerator":32,events:162,uuid:200}],195:[function(e,t,r){"use strict";var n=s(e("babel-runtime/core-js/map")),o=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a,c,l=e("../protocol/messages/telemetry"),u=e("../logger"),f=function(){function e(t,r,n,i,s,a){(0,o.default)(this,e),this.title=t,this.details=r,this.start=n,this.type=s,this.id=a,this.end=i}return(0,i.default)(e,[{key:"toTelemetryEvent",value:function(){var e=new Date,t=this.start,r=this.end?this.end:e;if(r<t){var n=r;r=t,t=n}var o=t.getTime()-e.getTime(),i=r.getTime()-e.getTime();return new l.TelemetryEvent(o,i,this.title,this.details,this.id,this.type)}}]),e}();r.TelemetryEventDescription=f,function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(a||(a={})),r.TelemetryPoint=a,function(e){e[e.MinEventsPortion=0]="MinEventsPortion",e[e.AnyEvents=1]="AnyEvents",e[e.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished"}(c||(c={})),r.EventSendingLimitation=c;var d=function(){function e(t,r){(0,o.default)(this,e),this.minEventsPortionToSend=50,this.maxEventsPortionToSend=100,this.pendingEvents=new n.default,this.readyEvents=[],this.hasInitializationFinished=!1,this._canSendTelemetry=!1,this.config=t,this.packetInterface=r}return(0,i.default)(e,[{key:"addTelemetryEvent",value:function(e){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(e)}},{key:"addPartialEvent",value:function(e,t,r){u.log.debug("Adding "+(r===a.Start?"starting":"ending")+" timepoint for '"+t+"' event");var n=this.pendingEvents.has(t);if(r===a.Start)n&&u.log.debug("Overwriting starting point for '"+t+"' event"),this.pendingEvents.set(t,e);else{if(!n)return void u.log.info("Could not find started event for '"+t+"' event");this.addTelemetryEvent(this.merge(this.pendingEvents.get(t),e)),this.pendingEvents.delete(t)}}},{key:"getTelemetryToSend",value:function(e){return this.canSendTelemetry&&0!=this.readyEvents.length?e==c.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(e==c.AnyEventsIncludingUnfinished):[]}},{key:"getTelemetryPortion",value:function(e){var t=this,r=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),n=this.readyEvents.splice(0,r);return e&&n.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach(function(e,r){if(!(n.length>=t.maxEventsPortionToSend)){var o=t.pendingEvents.get(r);t.pendingEvents.delete(r),n.push(new f("[UNFINISHED] "+o.title,o.details,o.start,null,o.type,o.id))}}),n}},{key:"merge",value:function(e,t){return new f(t.title?t.title:e.title,t.details?t.details:e.details,e.start,t.end,t.type?t.type:e.type,t.id?t.id:e.id)}},{key:"sendTelemetryIfMinimalPortionCollected",value:function(){this.sendTelemetry(c.MinEventsPortion)}},{key:"sendTelemetry",value:function(e){var t=this.getTelemetryToSend(e);if(0!==t.length)try{this.packetInterface.send(new l.Telemetry(t.map(function(e){return e.toTelemetryEvent()})))}catch(e){u.log.debug("Error while sending "+t.length+" telemetry events due to "+e+"; they will be resubmitted"),this.readyEvents=this.readyEvents.concat(t)}}},{key:"isTelemetryEnabled",get:function(){return this.config.confirmedCapabilities.has("telemetry.v1")}},{key:"canSendTelemetry",get:function(){return this._canSendTelemetry&&this.isTelemetryEnabled},set:function(e){u.log.debug("TelemetryTracker.canSendTelemetry: "+e+" TelemetryTracker.isTelemetryEnabled: "+this.isTelemetryEnabled),this._canSendTelemetry&&!e&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=e,e&&this.sendTelemetry(c.AnyEvents),e&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}}]),e}();r.TelemetryTracker=d},{"../logger":180,"../protocol/messages/telemetry":192,"babel-runtime/core-js/map":12,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25}],196:[function(e,t,r){"use strict";var n=c(e("babel-runtime/regenerator")),o=c(e("babel-runtime/helpers/asyncToGenerator")),i=c(e("babel-runtime/core-js/promise")),s=c(e("babel-runtime/helpers/createClass")),a=c(e("babel-runtime/helpers/classCallCheck"));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=e("../logger"),u=e("../error/twilsockerror"),f=e("../error/twilsockupstreamerror"),d=e("../protocol/messages"),p=e("../error/transportunavailableerror");function h(e,t){var r=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var r={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:null};if(r.search.length>0){var n=r.search.substring(1);r.params=n.split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e},{})}return r}throw new u.TwilsockError("Incorrect URI: "+e)}(t),n={method:e,host:r.host,path:r.pathname};return r.params&&(n.params=r.params),n}var b=function(){function e(t,r,n){(0,a.default)(this,e),this.config=n,this.transport=t,this.pendingMessages=[],this.twilsock=r}return(0,s.default)(e,[{key:"saveMessage",value:function(e){var t=this;return new i.default(function(r,n){var o={message:e,resolve:r,reject:n,alreadyRejected:!1,timeout:setTimeout(function(){l.log.debug("request is timed out"),n(new u.TwilsockError("request '"+e.to.method+"' to '"+e.to.host+"' timed out")),o.alreadyRejected=!0},2e4)};t.pendingMessages.push(o)})}},{key:"sendPendingMessages",value:function(){for(var e=this,t=function(){var t=e.pendingMessages[0];if(!t.alreadyRejected)try{var r=t.message;e.actualSend(r).then(function(e){return t.resolve(e)}).catch(function(e){return t.reject(e)}),clearTimeout(t.timeout)}catch(e){return l.log.debug("Failed to send pending message",e),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length;){if("break"===t())break}}},{key:"rejectPendingMessages",value:function(){var e=this;this.pendingMessages.forEach(function(t){t.reject(new p.TransportUnavailableError("Unable to connect: "+e.twilsock.getTerminationReason)),clearTimeout(t.timeout)}),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:function(){var e=(0,o.default)(n.default.mark(function e(t){var r,o,i,s,a,c,l;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.to,o=t.headers,i=t.body,s=t.grant?t.grant:this.config.activeGrant,a={host:r.host,path:r.path,method:r.method,params:r.params,headers:o},c=new d.Message(s,o["Content-Type"]||"application/json",a),e.next=8,this.transport.sendWithReply(c,i);case 8:if(l=e.sent,!((u=l)&&u.header&&u.header.http_status)||(n=l.header.http_status.code)>=200&&n<300){e.next=11;break}throw new f.TwilsockUpstreamError(l.header.http_status.code,l.header.http_status.status,l.body);case 11:return e.abrupt("return",{status:l.header.http_status,headers:l.header.http_headers,body:l.body});case 12:case"end":return e.stop()}var n,u},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"send",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3],o=arguments[4];if(this.twilsock.isTerminalState)return i.default.reject(new p.TransportUnavailableError("Unable to connect: "+this.twilsock.getTerminationReason));var s=function(e,t,r,n,o){return{to:h(e,t),headers:r,body:n,grant:o}}(e,t,r,n,o);return this.twilsock.isConnected?this.actualSend(s):this.saveMessage(s)}}]),e}();r.Upstream=b},{"../error/transportunavailableerror":175,"../error/twilsockerror":176,"../error/twilsockupstreamerror":178,"../logger":180,"../protocol/messages":187,"babel-runtime/core-js/promise":19,"babel-runtime/helpers/asyncToGenerator":23,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/regenerator":32}],197:[function(e,t,r){(function(t){(function(){"use strict";var n=i(e("babel-runtime/helpers/classCallCheck")),o=i(e("babel-runtime/helpers/createClass"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(){(0,n.default)(this,e)}return(0,o.default)(e,null,[{key:"storeToken",value:function(t,r){e.canStore&&e.sessionStorage.setItem(e.getKeyName(r),t)}},{key:"getStoredToken",value:function(t){return e.canStore?e.sessionStorage.getItem(e.getKeyName(t)):null}},{key:"initialize",value:function(){e.canStore&&(e.sessionStorage.getItem(e.initializedFlag)&&this.clear(),e.sessionStorage.setItem(e.initializedFlag,"true"),e.window.addEventListener("unload",function(){e.sessionStorage.removeItem(e.initializedFlag)}))}},{key:"clear",value:function(){if(e.canStore){for(var t=[],r=0;r<e.sessionStorage.length;r++){var n=e.sessionStorage.key(r);0===n.indexOf(e.tokenStoragePrefix)&&t.push(n)}t.forEach(function(t){return e.sessionStorage.removeItem(t)}),e.sessionStorage.removeItem(e.initializedFlag)}}},{key:"getKeyName",value:function(t){return""+e.tokenStoragePrefix+t}},{key:"sessionStorage",get:function(){try{return t.sessionStorage}catch(e){return null}}},{key:"window",get:function(){try{return t.window}catch(e){return null}}},{key:"canStore",get:function(){return e.sessionStorage&&e.window}}]),e}();r.TokenStorage=s,s.initializedFlag="twilio_twilsock_token_storage",s.tokenStoragePrefix="twilio_continuation_token_",s.initialize()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25}],198:[function(e,t,r){"use strict";var n=d(e("babel-runtime/core-js/promise")),o=d(e("babel-runtime/regenerator")),i=d(e("babel-runtime/helpers/asyncToGenerator")),s=d(e("babel-runtime/core-js/object/get-prototype-of")),a=d(e("babel-runtime/helpers/createClass")),c=d(e("babel-runtime/helpers/possibleConstructorReturn")),l=d(e("babel-runtime/helpers/inherits")),u=d(e("babel-runtime/helpers/classCallCheck")),f=d(e("babel-runtime/core-js/json/stringify"));d(e("babel-runtime/helpers/typeof"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=e("events"),h=e("javascript-state-machine"),b=e("./logger"),m=e("./protocol/messages"),v=e("./parser"),g=e("./error/twilsockreplyerror"),y=e("./backoffretrier");r.Response=function e(){(0,u.default)(this,e)};var _=function(e){function t(e,r,n){(0,u.default)(this,t);var o=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return o.terminalStates=["disconnected","rejected"],o.lastEmittedState=void 0,o.tokenExpiredSasCode=20104,o.terminationReason="Connection is not initialized",o.websocket=e,o.websocket.on("connected",function(){return o.fsm.socketConnected()}),o.websocket.on("disconnected",function(e){return o.fsm.socketClosed()}),o.websocket.on("message",function(e){return o.onIncomingMessage(e)}),o.websocket.on("socketError",function(e){return o.emit("connectionError",{terminal:!1,message:"Socket error: "+e.message,httpStatusCode:null,errorCode:null})}),o.transport=r,o.config=n,o.retrier=new y.BackoffRetrier(n.retryPolicy),o.retrier.on("attempt",function(){return o.retry()}),o.retrier.on("failed",function(e){b.log.warn("Retrying failed: "+e.message),o.disconnect()}),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",function(){b.log.debug("Browser reported connectivity state: online"),o.resetBackoff(),o.fsm.systemOnline()}),window.addEventListener("offline",function(){b.log.debug("Browser reported connectivity state: offline"),o.websocket.close(),o.fsm.socketClosed()})),o.fsm=new h({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){o.setupSocket(),o.emit("connecting")},onEnterInitialising:function(){o.sendInit()},onLeaveInitialising:function(){o.cancelInit()},onEnterUpdating:function(){o.sendUpdate()},onLeaveUpdating:function(){o.cancelUpdate()},onEnterRetrying:function(){o.initRetry(),o.emit("connecting")},onEnterConnected:function(){o.resetBackoff(),o.onConnected()},onUserUpdateToken:function(){o.resetBackoff()},onTokenRejected:function(){o.resetBackoff(),o.closeSocket(!0),o.finalizeSocket()},onUserDisconnect:function(){o.closeSocket(!0)},onEnterDisconnecting:function(){o.startDisconnectTimer()},onLeaveDisconnecting:function(){o.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){o.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){o.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){o.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){o.cancelDisconnectTimer()},onDisconnected:function(){o.resetBackoff(),o.finalizeSocket()},onReceiveClose:function(e,t){o.onCloseReceived(t)},onReceiveOffload:function(e,t){b.log.debug("onreceiveoffload: ",t),o.modifyBackoff(t.body),o.onCloseReceived(t.status)},onUnsupported:function(){o.closeSocket(!0),o.finalizeSocket()},onError:function(e,t){o.closeSocket(t),o.finalizeSocket()},onEnterState:function(e){"none"!==e.from&&o.changeState(e)},onInvalidTransition:function(e,t,r){b.log.warn("FSM: unexpected transition",t,r)}}}),o}return(0,l.default)(t,e),(0,a.default)(t,[{key:"changeState",value:function(e){b.log.debug("FSM: "+e.transition+": "+e.from+" --\x3e "+e.to),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){b.log.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(e){b.log.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}},{key:"startDisconnectTimer",value:function(){var e=this;b.log.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout(function(){b.log.debug("disconnecting is timed out"),e.closeSocket(!0)},3e3)}},{key:"cancelDisconnectTimer",value:function(){b.log.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"initRetry",value:function(){b.log.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{key:"retry",value:function(){"connecting"!=this.fsm.state?(b.log.trace("retry"),this.websocket.close(),this.fsm.userRetry()):b.log.trace("can\t retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){b.log.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){b.log.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}},{key:"onIncomingMessage",value:function(e){var t=v.Parser.parse(e),r=t.method,n=t.header,o=t.payload;if("reply"!==r&&this.confirmReceiving(n),"notification"===r)this.emit("message",n.message_type,o);else if("reply"===n.method)this.transport.processReply({id:n.id,status:n.status,header:n,body:o});else if("client_update"===n.method)"token_about_to_expire"===n.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===n.method)if(308===n.status.code)b.log.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:n.status.status,body:o});else if(406===n.status.code){var i="Server closed connection because can't parse protocol: "+(0,f.default)(n.status);this.emitReplyConnectionError(i,n,!0),b.log.error(i),this.fsm.receiveFatalClose()}else 417===n.status.code?(b.log.error("Server closed connection because can't parse client reply: "+(0,f.default)(n.status)),this.fsm.receiveFatalClose(n.status.status)):410===n.status.code?(b.log.warn("Server closed connection: "+(0,f.default)(n.status)),this.fsm.receiveClose(n.status.status),this.emit("tokenExpired")):401===n.status.code?(b.log.error("Server closed connection: "+(0,f.default)(n.status)),this.fsm.receiveClose(n.status.status)):(b.log.warn("unexpected message: ",n.status),this.fsm.receiveOffload({status:n.status.status,body:null}))}},{key:"sendInit",value:function(){var e=(0,i.default)(o.default.mark(function e(){var t,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return b.log.trace("sendInit"),e.prev=1,this.emit("beforeSendInit"),e.next=5,this.transport.sendInit();case 5:t=e.sent,this.config.updateContinuationToken(t.continuationToken),this.config.confirmedCapabilities=t.confirmedCapabilities,this.fsm.initSuccess(t),this.emit("initialized",t),this.emit("tokenUpdated"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),e.t0 instanceof g.TwilsockReplyError?(r=!1,b.log.warn("Init rejected by server: "+(0,f.default)(e.t0.reply.status)),this.emit("sendInitFailed"),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(r=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.initError(!0)):500===e.t0.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(e.t0.message,e.t0.reply,r)):(this.terminationReason=e.t0.message,this.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: "+e.t0.message+"\n"+(0,f.default)(e.t0,null,2),httpStatusCode:null,errorCode:null}),this.fsm.initError(!0)),this.emit("tokenUpdated",e.t0);case 17:case"end":return e.stop()}},e,this,[[1,13]])}));return function(){return e.apply(this,arguments)}}()},{key:"sendUpdate",value:function(){var e=(0,i.default)(o.default.mark(function e(){var t,r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return b.log.trace("sendUpdate"),t=new m.Update(this.config.token),e.prev=2,e.next=5,this.transport.sendWithReply(t);case 5:r=e.sent,this.fsm.updateSuccess(r.body),this.emit("tokenUpdated"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0 instanceof g.TwilsockReplyError?(n=!1,b.log.warn("Token update rejected by server: "+(0,f.default)(e.t0.reply.status)),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(n=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0.reply.status),this.emitReplyConnectionError(e.t0.message,e.t0.reply,n)):(this.emit("error",!1,e.t0.message,null,null),this.fsm.updateError(e.t0)),this.emit("tokenUpdated",e.t0);case 14:case"end":return e.stop()}},e,this,[[2,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"emitReplyConnectionError",value:function(e,t,r){var n=t.status&&t.status.description?t.status.description:e,o=t.status.code,i=t.status&&t.status.errorCode?t.status.errorCode:null;r&&(this.terminationReason=n),this.emit("connectionError",{terminal:r,message:"Connection error: "+n,httpStatusCode:o,errorCode:i})}},{key:"cancelInit",value:function(){b.log.trace("cancelInit")}},{key:"cancelUpdate",value:function(){b.log.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(e){b.log.trace("confirmReceiving");try{this.transport.send(new m.Reply(e.id))}catch(e){b.log.debug("failed to confirm packet receiving",e)}}},{key:"closeSocket",value:function(e){var t=this;b.log.trace("closeSocket (graceful: "+e+")"),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout(function(){return t.fsm.socketClosed()},0)}},{key:"connect",value:function(){b.log.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return b.log.trace("disconnect"),this.fsm.is("disconnected")?n.default.resolve():new n.default(function(t){e.disconnectedPromiseResolve=t,e.fsm.userDisconnect()})}},{key:"updateToken",value:function(e){var t=this;return b.log.trace("updateToken:",e),new n.default(function(e,r){t.once("tokenUpdated",function(t){t?r(t):e()}),t.fsm.userUpdateToken()})}},{key:"onCloseReceived",value:function(e){this.websocket.close()}},{key:"isConnected",get:function(){return"connected"===this.state&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"rejected";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{key:"isTerminalState",get:function(){return-1!==this.terminalStates.indexOf(this.fsm.state)}},{key:"getTerminationReason",get:function(){return this.terminationReason}}]),t}(p.EventEmitter);r.TwilsockChannel=_,r.TwilsockImpl=_},{"./backoffretrier":171,"./error/twilsockreplyerror":177,"./logger":180,"./parser":184,"./protocol/messages":187,"babel-runtime/core-js/json/stringify":11,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/core-js/promise":19,"babel-runtime/helpers/asyncToGenerator":23,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,"babel-runtime/helpers/typeof":31,"babel-runtime/regenerator":32,events:162,"javascript-state-machine":163}],199:[function(e,t,r){(function(t){(function(){"use strict";var n=c(e("babel-runtime/core-js/object/get-prototype-of")),o=c(e("babel-runtime/helpers/classCallCheck")),i=c(e("babel-runtime/helpers/createClass")),s=c(e("babel-runtime/helpers/possibleConstructorReturn")),a=c(e("babel-runtime/helpers/inherits"));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=e("events"),u=e("./logger"),f=function(r){function c(r){(0,o.default)(this,c);var i=(0,s.default)(this,(c.__proto__||(0,n.default)(c)).call(this));return i.url=r,i.WebSocket=t.WebSocket||t.MozWebSocket||e("ws"),i}return(0,a.default)(c,r),(0,i.default)(c,[{key:"connect",value:function(){var e=this;u.log.trace("connecting to socket");var t=void 0;try{t=new this.WebSocket(this.url)}catch(e){return u.log.debug("Socket error: "+this.url),void this.emit("socketError",e)}t.binaryType="arraybuffer",t.onopen=function(){u.log.debug("socket opened "+e.url),e.emit("connected")},t.onclose=function(t){u.log.debug("socket closed",t),e.emit("disconnected",t)},t.onerror=function(t){u.log.debug("Socket error:",t),e.emit("socketError",t)},t.onmessage=function(t){e.emit("message",t.data)},this.socket=t}},{key:"send",value:function(e){this.socket.send(e)}},{key:"close",value:function(){if(u.log.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}},{key:"isConnected",get:function(){return this.socket&&1===this.socket.readyState}}]),c}(l.EventEmitter);r.WebSocketChannel=f}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./logger":180,"babel-runtime/core-js/object/get-prototype-of":17,"babel-runtime/helpers/classCallCheck":24,"babel-runtime/helpers/createClass":25,"babel-runtime/helpers/inherits":27,"babel-runtime/helpers/possibleConstructorReturn":28,events:162,ws:33}],200:[function(e,t,r){var n=e("./v1"),o=e("./v4"),i=o;i.v1=n,i.v4=o,t.exports=i},{"./v1":203,"./v4":204}],201:[function(e,t,r){for(var n=[],o=0;o<256;++o)n[o]=(o+256).toString(16).substr(1);t.exports=function(e,t){var r=t||0,o=n;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}},{}],202:[function(e,t,r){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var o=new Uint8Array(16);t.exports=function(){return n(o),o}}else{var i=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},{}],203:[function(e,t,r){var n,o,i=e("./lib/rng"),s=e("./lib/bytesToUuid"),a=0,c=0;t.exports=function(e,t,r){var l=t&&r||0,u=t||[],f=(e=e||{}).node||n,d=void 0!==e.clockseq?e.clockseq:o;if(null==f||null==d){var p=i();null==f&&(f=n=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==d&&(d=o=16383&(p[6]<<8|p[7]))}var h=void 0!==e.msecs?e.msecs:(new Date).getTime(),b=void 0!==e.nsecs?e.nsecs:c+1,m=h-a+(b-c)/1e4;if(m<0&&void 0===e.clockseq&&(d=d+1&16383),(m<0||h>a)&&void 0===e.nsecs&&(b=0),b>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=h,c=b,o=d;var v=(1e4*(268435455&(h+=122192928e5))+b)%4294967296;u[l++]=v>>>24&255,u[l++]=v>>>16&255,u[l++]=v>>>8&255,u[l++]=255&v;var g=h/4294967296*1e4&268435455;u[l++]=g>>>8&255,u[l++]=255&g,u[l++]=g>>>24&15|16,u[l++]=g>>>16&255,u[l++]=d>>>8|128,u[l++]=255&d;for(var y=0;y<6;++y)u[l+y]=f[y];return t||s(u)}},{"./lib/bytesToUuid":201,"./lib/rng":202}],204:[function(e,t,r){var n=e("./lib/rng"),o=e("./lib/bytesToUuid");t.exports=function(e,t,r){var i=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||o(s)}},{"./lib/bytesToUuid":201,"./lib/rng":202}]},{},[1])(1)});