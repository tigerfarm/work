#!/bin/bash

# Usage: fetchFromNpm <artifacts-dir> <package-name> <release-version>
function fetchFromNpm() {
  local RESULT_ARTIFACTS_DIR=$1
  local NPM_PACKAGE_NAME=$2
  local NPM_RELEASE_VERSION=$3
  local TMP_DIR="$RESULT_ARTIFACTS_DIR/fetch-$NPM_RELEASE_VERSION"

  echo "==== Fetching package $NPM_PACKAGE_NAME@$NPM_RELEASE_VERSION from npmjs.com to $RESULT_ARTIFACTS_DIR ===="
  rm -rf "$TMP_DIR"
  mkdir -p "$TMP_DIR"
  cd "$TMP_DIR"
  echo "{}" > package.json
  npm install $NPM_PACKAGE_NAME@${NPM_RELEASE_VERSION} || exit 1
  mv node_modules/$NPM_PACKAGE_NAME/* "$RESULT_ARTIFACTS_DIR"
  rm -rf "$TMP_DIR"
}
